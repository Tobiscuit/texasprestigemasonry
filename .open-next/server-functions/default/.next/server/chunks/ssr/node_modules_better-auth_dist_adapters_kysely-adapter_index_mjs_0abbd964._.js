module.exports=[36063,a=>{"use strict";var b=a.i(97251),c=a.i(19560);a.i(6592);var d=a.i(12799);let e=(a,b)=>{let e=null,f=a=>({getFieldName:d,schema:e,getDefaultFieldName:f,getDefaultModelName:g,getFieldAttributes:h,getModelName:i})=>{let j=a=>{let b=[],d=[];if(a)for(let[f,h]of Object.entries(a)){let a=e[g(f)]?.fields,[h,i]=f.includes(".")?f.split("."):[void 0,f];if(a)for(let[e,g]of(a.id={type:"string"},Object.entries(a)))b.push(c.sql`${c.sql.ref(`join_${i}`)}.${c.sql.ref(g.fieldName||e)} as ${c.sql.ref(`_joined_${i}_${g.fieldName||e}`)}`),d.push({joinModel:f,joinModelRef:i,fieldName:g.fieldName||e})}return{allSelectsStr:d,allSelects:b}},k=async(c,e,f,g)=>{if(b?.type==="mysql"){await e.execute();let b=c.id?"id":g.length>0&&g[0]?.field?g[0].field:"id";if(!c.id&&0===g.length)return await a.selectFrom(f).selectAll().orderBy(d({model:f,field:b}),"desc").limit(1).executeTakeFirst();let h=c[b]||g[0]?.value;return await a.selectFrom(f).selectAll().orderBy(d({model:f,field:b}),"desc").where(d({model:f,field:b}),"=",h).limit(1).executeTakeFirst()}return b?.type==="mssql"?await e.outputAll("inserted").executeTakeFirst():await e.returningAll().executeTakeFirst()};function l(a,b){if(!b)return{and:null,or:null};let c=[],e=[];return b.forEach(b=>{let{field:f,value:g,operator:h="=",connector:i="AND"}=b,j=d({model:a,field:f}),k=b=>{let c=`${a}.${j}`;return"in"===h.toLowerCase()?b(c,"in",Array.isArray(g)?g:[g]):"not_in"===h.toLowerCase()?b(c,"not in",Array.isArray(g)?g:[g]):"contains"===h?b(c,"like",`%${g}%`):"starts_with"===h?b(c,"like",`${g}%`):"ends_with"===h?b(c,"like",`%${g}`):b(c,"eq"===h?"=":"ne"===h?"<>":"gt"===h?">":"gte"===h?">=":"lt"===h?"<":"lte"===h?"<=":h,g)};"OR"===i?e.push(k):c.push(k)}),{and:c.length?c:null,or:e.length?e:null}}function m(a,b,c){if(!b||!a.length)return a;let e=new Map;for(let f of a){let a={},g={};for(let[a]of Object.entries(b))g[i(a)]={};for(let[b,e]of Object.entries(f)){let f=String(b),h=!1;for(let{joinModel:a,fieldName:b,joinModelRef:j}of c)if(f===`_joined_${j}_${b}`){g[i(a)][d({model:a,field:b})]=e,h=!0;break}h||(a[b]=e)}let h=a.id;if(!h)continue;if(!e.has(h)){let c={...a};for(let[a,d]of Object.entries(b))c[i(a)]="one-to-one"===d.relation?null:[];e.set(h,c)}let j=e.get(h);for(let[a,c]of Object.entries(b)){let b="one-to-one"===c.relation,e=c.limit??100,f=g[i(a)],h=f&&Object.keys(f).length>0&&Object.values(f).some(a=>null!=a);if(b)j[i(a)]=h?f:null;else{let b=i(a);if(Array.isArray(j[b])&&h){if(j[b].length>=e)continue;let c=d({model:a,field:"id"}),g=f[c];g?!j[b].some(a=>a[c]===g)&&j[b].length<e&&j[b].push(f):j[b].length<e&&j[b].push(f)}}}}let f=Array.from(e.values());for(let a of f)for(let[c,d]of Object.entries(b))if("one-to-one"!==d.relation){let b=i(c);if(Array.isArray(a[b])){let c=d.limit??100;a[b].length>c&&(a[b]=a[b].slice(0,c))}}return f}return{create:async({data:b,model:c})=>await k(b,a.insertInto(c).values(b),c,[]),async findOne({model:b,where:c,select:e,join:f}){let{and:g,or:h}=l(b,c),i=a.selectFrom(a=>{let c=a.selectFrom(b);return g&&(c=c.where(a=>a.and(g.map(b=>b(a))))),h&&(c=c.where(a=>a.or(h.map(b=>b(a))))),(c=e?.length&&e.length>0?c.select(e.map(a=>d({model:b,field:a}))):c.selectAll()).as("primary")}).selectAll("primary");if(f)for(let[a,b]of Object.entries(f)){let[c,d]=a.includes(".")?a.split("."):[void 0,a];i=i.leftJoin(`${a} as join_${d}`,a=>a.onRef(`join_${d}.${b.on.to}`,"=",`primary.${b.on.from}`))}let{allSelectsStr:k,allSelects:n}=j(f);i=i.select(n);let o=await i.execute();if(!o||!Array.isArray(o)||0===o.length)return null;let p=o[0];return f?m(o,f,k)[0]:p},async findMany({model:c,where:e,limit:f,select:g,offset:h,sortBy:i,join:k}){let{and:n,or:o}=l(c,e),p=a.selectFrom(a=>{let e=a.selectFrom(c);return b?.type==="mssql"?void 0!==h?(i||(e=e.orderBy(d({model:c,field:"id"}))),e=e.offset(h).fetch(f||100)):void 0!==f&&(e=e.top(f)):(void 0!==f&&(e=e.limit(f)),void 0!==h&&(e=e.offset(h))),i?.field&&(e=e.orderBy(`${d({model:c,field:i.field})}`,i.direction)),n&&(e=e.where(a=>a.and(n.map(b=>b(a))))),o&&(e=e.where(a=>a.or(o.map(b=>b(a))))),(e=g?.length&&g.length>0?e.select(g.map(a=>d({model:c,field:a}))):e.selectAll()).as("primary")}).selectAll("primary");if(k)for(let[a,b]of Object.entries(k)){let[c,d]=a.includes(".")?a.split("."):[void 0,a];p=p.leftJoin(`${a} as join_${d}`,a=>a.onRef(`join_${d}.${b.on.to}`,"=",`primary.${b.on.from}`))}let{allSelectsStr:q,allSelects:r}=j(k);p=p.select(r),i?.field&&(p=p.orderBy(`${d({model:c,field:i.field})}`,i.direction));let s=await p.execute();return s?k?m(s,k,q):s:[]},async update({model:b,where:c,update:d}){let{and:e,or:f}=l(b,c),g=a.updateTable(b).set(d);return e&&(g=g.where(a=>a.and(e.map(b=>b(a))))),f&&(g=g.where(a=>a.or(f.map(b=>b(a))))),await k(d,g,b,c)},async updateMany({model:b,where:c,update:d}){let{and:e,or:f}=l(b,c),g=a.updateTable(b).set(d);e&&(g=g.where(a=>a.and(e.map(b=>b(a))))),f&&(g=g.where(a=>a.or(f.map(b=>b(a)))));let h=(await g.executeTakeFirst()).numUpdatedRows;return h>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number(h)},async count({model:b,where:c}){let{and:d,or:e}=l(b,c),f=a.selectFrom(b).select(a.fn.count("id").as("count"));d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a)))));let g=await f.execute();return"number"==typeof g[0].count?g[0].count:"bigint"==typeof g[0].count?Number(g[0].count):parseInt(g[0].count)},async delete({model:b,where:c}){let{and:d,or:e}=l(b,c),f=a.deleteFrom(b);d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),await f.execute()},async deleteMany({model:b,where:c}){let{and:d,or:e}=l(b,c),f=a.deleteFrom(b);d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a)))));let g=(await f.executeTakeFirst()).numDeletedRows;return g>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number(g)},options:b}},g=null;g={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:b?.usePlural,debugLogs:b?.debugLogs,supportsBooleans:b?.type!=="sqlite"&&b?.type!=="mssql"&&b?.type!=="mysql"&&!!b?.type,supportsDates:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsJSON:b?.type==="postgres",supportsArrays:!1,supportsUUIDs:b?.type==="postgres",transaction:!!b?.transaction&&(b=>a.transaction().execute(a=>b((0,d.createAdapterFactory)({config:g.config,adapter:f(a)})(e))))},adapter:f(a)};let h=(0,d.createAdapterFactory)(g);return a=>(e=a,h(a))};a.s([],32540),a.i(32540),a.s(["createKyselyAdapter",()=>b.createKyselyAdapter,"getKyselyDatabaseType",()=>b.getKyselyDatabaseType,"kyselyAdapter",()=>e],36063)}];

//# sourceMappingURL=node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js.map