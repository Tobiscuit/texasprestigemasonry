module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},24516,a=>{"use strict";var b=a.i(37936),c=a.i(54799),d=a.i(13095);let e="production"===process.env.SQUARE_ENVIRONMENT;async function f(a,b,c){let d=await fetch(`${e?"https://connect.squareup.com":"https://connect.squareupsandbox.com"}/v2/${a}`,{method:b,headers:{"Square-Version":"2024-01-18",Authorization:`Bearer ${process.env.SQUARE_ACCESS_TOKEN}`,"Content-Type":"application/json"},body:c?JSON.stringify(c):void 0}),f=await d.json();if(!d.ok)throw Error(f.errors?.[0]?.detail||f.errors?.[0]?.category||"Square API Error");return f}async function g({sourceId:b,amount:d=9900,customerDetails:g}){try{let h;console.log(`[ProcessPayment] Env: ${e?"Production":"Sandbox"}`);try{let a=await f("customers/search","POST",{query:{filter:{email_address:{exact:g.email}}}});if(a.customers&&a.customers.length>0)h=a.customers[0].id;else{let a=await f("customers","POST",{given_name:g.name.split(" ")[0],family_name:g.name.split(" ").slice(1).join(" ")||"",email_address:g.email,phone_number:g.phone,address:{address_line_1:g.address},reference_id:g.email,note:"Created via Dispatch App"});h=a.customer?.id}}catch(a){console.warn("Failed to sync Square Customer profile:",a)}let i=(0,c.randomUUID)(),j=(await f("payments","POST",{source_id:b,idempotency_key:i,amount_money:{amount:d,currency:"USD"},customer_id:h,autocomplete:!0,note:`Dispatch Fee - ${g.name}`})).payment;try{let{revalidatePath:b}=await a.A(6728);b("/dashboard")}catch(a){console.warn("Failed to revalidate dashboard path",a)}return{success:!0,payment:j,ticket:{id:1,status:"confirmed"}}}catch(a){return console.error("Payment/Booking Error:",a),{success:!1,error:a.message||"Payment failed"}}}(0,d.ensureServerEntryExports)([g]),(0,b.registerServerReference)(g,"40ced57baa3dd20e1459ebdade1e3c14bce72ecf3f",null),a.s([],96273),a.i(96273),a.s(["40ced57baa3dd20e1459ebdade1e3c14bce72ecf3f",()=>g],24516)},6728,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_next_b5b87ce8._.js"].map(b=>a.l(b))).then(()=>b(18558)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__16b9edf6._.js.map