module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},33463,(a,b,c)=>{"use strict";function d(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(d=function(a){return a?c:b})(a)}c._=function(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=d(b);if(c&&c.has(a))return c.get(a);var e={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(e,g,h):e[g]=a[g]}return e.default=a,c&&c.set(a,e),e}},88347,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={ACTION_HMR_REFRESH:function(){return k},ACTION_NAVIGATE:function(){return h},ACTION_REFRESH:function(){return g},ACTION_RESTORE:function(){return i},ACTION_SERVER_ACTION:function(){return l},ACTION_SERVER_PATCH:function(){return j},PrefetchKind:function(){return m}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g="refresh",h="navigate",i="restore",j="server-patch",k="hmr-refresh",l="server-action";var m=((d={}).AUTO="auto",d.FULL="full",d);("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},67009,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},90841,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={dispatchAppRouterAction:function(){return i},useActionQueue:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33463)._(a.r(72131)),g=a.r(67009),h=null;function i(a){if(null===h)throw Object.defineProperty(Error("Internal Next.js error: Router action dispatched before initialization."),"__NEXT_ERROR_CODE",{value:"E668",enumerable:!1,configurable:!0});h(a)}function j(a){let[b,c]=f.default.useState(a.state);h=b=>a.dispatch(b,c);let d=(0,f.useMemo)(()=>b,[b]);return(0,g.isThenable)(d)?(0,f.use)(d):d}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},20611,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"callServer",{enumerable:!0,get:function(){return g}});let d=a.r(72131),e=a.r(88347),f=a.r(90841);async function g(a,b){return new Promise((c,g)=>{(0,d.startTransition)(()=>{(0,f.dispatchAppRouterAction)({type:e.ACTION_SERVER_ACTION,actionId:a,actionArgs:b,resolve:c,reject:g})})})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},1722,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findSourceMapURL",{enumerable:!0,get:function(){return d}});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},39118,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},NOT_FOUND_SEGMENT_KEY:function(){return m},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__",m="/_not-found"},52814,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(50944);let f={en:{initialMessage:"I'm listening. Point your camera at the masonry issue.",startButton:"Start Diagnostic",permissionPrompt:"I need to <strong>see</strong> and <strong>hear</strong> your issue.",heading:"Let's see what's wrong.",exitLabel:"Exit"},es:{initialMessage:"Estoy escuchando. Apunte la c√°mara al problema.",startButton:"Iniciar Diagn√≥stico",permissionPrompt:"Necesito <strong>ver</strong> y <strong>escuchar</strong> el problema.",heading:"Veamos qu√© pasa.",exitLabel:"Salir"},vi:{initialMessage:"T√¥i ƒëang l·∫Øng nghe. H√£y h∆∞·ªõng camera v√†o khu v·ª±c g·∫∑p v·∫•n ƒë·ªÅ.",startButton:"B·∫Øt ƒë·∫ßu Ch·∫©n ƒëo√°n",permissionPrompt:"T√¥i c·∫ßn <strong>nh√¨n</strong> v√† <strong>nghe</strong> v·∫•n ƒë·ªÅ c·ªßa b·∫°n.",heading:"H√£y xem c√≥ v·∫•n ƒë·ªÅ g√¨.",exitLabel:"Tho√°t"}};function g(){(0,e.useRouter)();let a=(0,e.useSearchParams)().get("lang")||"en",g=f[a]||f.en,[h,i]=(0,c.useState)(null),[j,k]=(0,c.useState)("idle"),[l,m]=(0,c.useState)("listening"),[n,o]=(0,c.useState)(g.initialMessage),[p,q]=(0,c.useState)(Array(20).fill(0)),r=(0,c.useRef)(null),s=(0,c.useRef)(null),t=(0,c.useRef)(null),u=(0,c.useRef)(null),v=(0,c.useRef)(0),w=(0,c.useRef)(null),x=(0,c.useRef)(!1),y=(0,c.useRef)(null),z=(0,c.useRef)(null),A=(0,c.useRef)(""),B=(0,c.useRef)(null),C=(0,c.useRef)(0);(0,c.useEffect)(()=>()=>{D(),s.current?.close(),B.current&&clearInterval(B.current)},[]),(0,c.useEffect)(()=>{let a=()=>{document.hidden&&(t.current?.suspend(),u.current?.suspend(),s.current?.close(),k("idle"))};return document.addEventListener("visibilitychange",a),()=>document.removeEventListener("visibilitychange",a)},[]);let D=()=>{r.current&&r.current.srcObject&&(r.current.srcObject.getTracks().forEach(a=>{a.stop(),a.enabled=!1}),r.current.srcObject=null),t.current?.close(),u.current?.close(),null!==w.current&&(window.clearInterval(w.current),w.current=null),null!==z.current&&(cancelAnimationFrame(z.current),z.current=null),x.current=!1},E=async()=>{try{let a=new(window.AudioContext||window.webkitAudioContext)({sampleRate:16e3});t.current=a,"suspended"===a.state&&await a.resume();let b=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:{sampleRate:16e3,channelCount:1,echoCancellation:!0}});i(!0),r.current&&(r.current.srcObject=b,r.current.play().catch(a=>console.error("Play Error:",a))),F(b)}catch(a){console.error("Camera Error:",a),i(!1),alert("We need camera access. Please check permissions.")}},F=b=>{k("connecting");let c="localhost"===window.location.hostname?"ws://localhost:3001":"wss://mobile-garage-door-realtime-proxy.tobiasramzy.workers.dev",d=new WebSocket(`${c}?lang=${a}`);s.current=d,d.onopen=()=>{k("connected")},d.onmessage=async a=>{try{let c=JSON.parse(a.data),e=Object.keys(c);if(e.includes("serverContent")&&c.serverContent?.modelTurn?.parts?.some(a=>a.inlineData)||console.log("[WS] Message keys:",e,JSON.stringify(c).substring(0,500)),c.setupComplete&&!x.current&&(x.current=!0,G(b),H(),d.send(JSON.stringify({clientContent:{turns:[{role:"user",parts:[{text:"[The customer has connected and pointed their camera at the masonry issue. Greet them warmly and begin your visual inspection.]"}]}],turnComplete:!0}}))),c.serverContent?.modelTurn?.parts)for(let a of(m("speaking"),c.serverContent.modelTurn.parts))a.inlineData&&a.inlineData.mimeType.startsWith("audio/pcm")&&I(a.inlineData.data);let f=c.toolCall||c.serverContent?.toolCall;if(f?.functionCalls){for(let a of(console.log("[WS] üîß TOOL CALL DETECTED:",JSON.stringify(f)),f.functionCalls))if("report_diagnosis"===a.name){let b=a.args||{},c=new Date().getHours(),d=c<7||c>=19,e="emergency"===b.urgency||d?"emergency":"standard";sessionStorage.setItem("aiDiagnosis",JSON.stringify({issueDescription:b.issue_summary||"Automated diagnostic completed.",urgency:e,fromDiagnosis:!0})),console.log("[WS] ‚úÖ DIAGNOSIS STORED, REDIRECTING in 1.5s:",b),o("Filing your service report... Redirecting you now."),setTimeout(()=>{s.current?.close(),D(),window.location.href="/book-service"},1500)}}if(c.serverContent?.outputTranscription?.text){let a=c.serverContent.outputTranscription.text;A.current+=a,B.current||(B.current=setInterval(()=>{C.current<A.current.length&&(C.current+=1,o(A.current.slice(0,C.current)))},30))}c.serverContent?.turnComplete&&(m("listening"),A.current="",C.current=0,B.current&&(clearInterval(B.current),B.current=null))}catch(a){console.error("Parse error",a)}},d.onerror=a=>{console.error("WS Error:",a),k("error")},d.onclose=()=>{k("idle")}},G=async a=>{let b=t.current;if(b)try{await b.audioWorklet.addModule("/worklets/pcm-processor.js");let c=b.createMediaStreamSource(a),d=new AudioWorkletNode(b,"pcm-processor"),e=b.createAnalyser();e.fftSize=64,c.connect(e),y.current=e;let f=()=>{if(!y.current)return;let a=new Uint8Array(y.current.frequencyBinCount);y.current.getByteFrequencyData(a);let b=Array.from({length:20},(b,c)=>{let d=Math.floor(c/20*a.length);return a[d]/255});q(b),z.current=requestAnimationFrame(f)};f(),d.port.onmessage=a=>{if(s.current?.readyState!==WebSocket.OPEN)return;let b=a.data,c=btoa(String.fromCharCode(...new Uint8Array(b)));s.current.send(JSON.stringify({realtimeInput:{audio:{mimeType:"audio/pcm;rate=16000",data:c}}}))},c.connect(d),d.connect(b.destination)}catch(a){console.error("AudioWorklet Error:",a)}},H=()=>{w.current=window.setInterval(()=>{if(s.current?.readyState!==WebSocket.OPEN||!r.current||r.current.readyState<2||0===r.current.videoWidth)return;let a=document.createElement("canvas");a.width=r.current.videoWidth||640,a.height=r.current.videoHeight||480;let b=a.getContext("2d");if(!b)return;b.drawImage(r.current,0,0,a.width,a.height);let c=a.toDataURL("image/jpeg",.6).split(",")[1];s.current.send(JSON.stringify({realtimeInput:{video:{mimeType:"image/jpeg",data:c}}}))},500)},I=a=>{try{u.current&&"closed"!==u.current.state||(u.current=new AudioContext({sampleRate:24e3}),v.current=u.current.currentTime);let b=u.current;if(!b)return;let c=atob(a),d=c.length,e=new Uint8Array(d);for(let a=0;a<d;a++)e[a]=c.charCodeAt(a);let f=new Float32Array(e.length/2),g=new DataView(e.buffer);for(let a=0;a<f.length;a++){let b=g.getInt16(2*a,!0);f[a]=b/32768}let h=b.createBuffer(1,f.length,24e3);h.getChannelData(0).set(f);let i=b.createBufferSource();i.buffer=h,i.connect(b.destination),v.current<b.currentTime&&(v.current=b.currentTime),i.start(v.current),v.current+=h.duration}catch(a){console.error("Audio Out Error:",a)}};return(0,b.jsxs)("div",{className:"fixed inset-0 bg-black text-white flex flex-col z-50",children:[(0,b.jsxs)("div",{className:"absolute top-0 left-0 right-0 p-4 flex justify-between items-center z-20 bg-gradient-to-b from-black/80 to-transparent",children:[(0,b.jsxs)(d.default,{href:"/",className:"text-white/80 hover:text-white flex items-center gap-2",children:[(0,b.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,b.jsx)("span",{className:"text-sm font-bold uppercase tracking-widest",children:g.exitLabel})]}),(0,b.jsxs)("div",{className:`px-3 py-1 border rounded-full flex items-center gap-2 backdrop-blur-md transition-colors ${"connected"===j?"bg-green-600/30 border-green-500/50":"error"===j?"bg-red-600/30 border-red-500/50":"bg-yellow-600/30 border-yellow-500/50"}`,children:[(0,b.jsxs)("span",{className:"relative flex h-2 w-2",children:[(0,b.jsx)("span",{className:`animate-ping absolute inline-flex h-full w-full rounded-full opacity-75 ${"connected"===j?"bg-green-400":"error"===j?"bg-red-400":"bg-yellow-400"}`}),(0,b.jsx)("span",{className:`relative inline-flex rounded-full h-2 w-2 ${"connected"===j?"bg-green-500":"error"===j?"bg-red-500":"bg-yellow-500"}`})]}),(0,b.jsx)("span",{className:"text-xs font-bold text-white uppercase tracking-wider",children:"connected"===j?"Live Connection":"connecting"===j?"Connecting...":"error"===j?"Connection Failed":"Ready to Connect"})]})]}),(0,b.jsxs)("div",{className:"flex-1 relative flex items-center justify-center",children:[(0,b.jsx)("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:`absolute inset-0 w-full h-full object-cover ${!h?"hidden":""}`}),h?(0,b.jsx)(b.Fragment,{children:(0,b.jsx)("div",{className:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black via-black/80 to-transparent pt-32 pb-10 px-6",children:(0,b.jsx)("div",{className:"flex items-end gap-4",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"bg-black/40 backdrop-blur-md rounded-2xl p-4 border border-white/10 mb-4 animate-in slide-in-from-bottom-5 fade-in duration-500 delay-200",children:[(0,b.jsx)("p",{className:"text-[#f1c40f] font-bold text-xs uppercase tracking-wider mb-1",children:"Service Hero AI"}),(0,b.jsxs)("p",{className:"text-lg font-medium leading-snug",children:['"',n,'"']})]}),(0,b.jsx)("div",{className:"flex items-center justify-center gap-1 h-8",children:p.map((a,c)=>(0,b.jsx)("div",{className:"w-1 bg-[#f1c40f]/70 rounded-full transition-all duration-75",style:{height:`${Math.max(8,100*a)}%`}},c))})]})})})}):(0,b.jsxs)("div",{className:"text-center p-8 max-w-md animate-in fade-in zoom-in duration-500",children:[(0,b.jsxs)("div",{className:"w-24 h-24 bg-[#f1c40f]/10 rounded-full flex items-center justify-center mx-auto mb-8 border border-[#f1c40f]/30 relative",children:[(0,b.jsx)("span",{className:"absolute inset-0 rounded-full animate-ping bg-[#f1c40f]/20"}),(0,b.jsx)("svg",{className:"w-10 h-10 text-[#f1c40f]",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})]}),(0,b.jsx)("h1",{className:"text-3xl font-black mb-4 tracking-tight",children:g.heading}),(0,b.jsx)("p",{className:"text-gray-400 mb-8 text-lg leading-relaxed",dangerouslySetInnerHTML:{__html:g.permissionPrompt}}),(0,b.jsx)("button",{onClick:E,className:"w-full py-4 bg-[#f1c40f] hover:bg-yellow-400 text-midnight-slate font-black text-lg uppercase tracking-widest rounded-xl shadow-[0_0_40px_rgba(241,196,15,0.3)] transition-all transform hover:scale-105",children:g.startButton})]})]})]})}a.s(["default",()=>g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__519faac3._.js.map