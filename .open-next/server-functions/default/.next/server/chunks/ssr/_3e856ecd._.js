module.exports=[48647,(a,b,c)=>{var d,e;e=d||(d={}),function(b){var c="object"==typeof globalThis?globalThis:a.g,d=f(e);function f(a,b){return function(c,d){Object.defineProperty(a,c,{configurable:!0,writable:!0,value:d}),b&&b(c,d)}}void 0!==c.Reflect&&(d=f(c.Reflect,d)),b(d,c),void 0===c.Reflect&&(c.Reflect=e)}(function(a,b){var c,d=Object.prototype.hasOwnProperty,e="function"==typeof Symbol,f=e&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",g=e&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",h="function"==typeof Object.create,i=({__proto__:[]})instanceof Array,j=!h&&!i,k={create:h?function(){return L(Object.create(null))}:i?function(){return L({__proto__:null})}:function(){return L({})},has:j?function(a,b){return d.call(a,b)}:function(a,b){return b in a},get:j?function(a,b){return d.call(a,b)?a[b]:void 0}:function(a,b){return a[b]}},l=Object.getPrototypeOf(Function),m="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:function(){var a={},b=[],c=function(){function a(a,b,c){this._index=0,this._keys=a,this._values=b,this._selector=c}return a.prototype["@@iterator"]=function(){return this},a.prototype[g]=function(){return this},a.prototype.next=function(){var a=this._index;if(a>=0&&a<this._keys.length){var c=this._selector(this._keys[a],this._values[a]);return a+1>=this._keys.length?(this._index=-1,this._keys=b,this._values=b):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},a.prototype.throw=function(a){throw this._index>=0&&(this._index=-1,this._keys=b,this._values=b),a},a.prototype.return=function(a){return this._index>=0&&(this._index=-1,this._keys=b,this._values=b),{value:a,done:!0}},a}();function d(){this._keys=[],this._values=[],this._cacheKey=a,this._cacheIndex=-2}return Object.defineProperty(d.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),d.prototype.has=function(a){return this._find(a,!1)>=0},d.prototype.get=function(a){var b=this._find(a,!1);return b>=0?this._values[b]:void 0},d.prototype.set=function(a,b){var c=this._find(a,!0);return this._values[c]=b,this},d.prototype.delete=function(b){var c=this._find(b,!1);if(c>=0){for(var d=this._keys.length,e=c+1;e<d;e++)this._keys[e-1]=this._keys[e],this._values[e-1]=this._values[e];return this._keys.length--,this._values.length--,E(b,this._cacheKey)&&(this._cacheKey=a,this._cacheIndex=-2),!0}return!1},d.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=a,this._cacheIndex=-2},d.prototype.keys=function(){return new c(this._keys,this._values,e)},d.prototype.values=function(){return new c(this._keys,this._values,f)},d.prototype.entries=function(){return new c(this._keys,this._values,h)},d.prototype["@@iterator"]=function(){return this.entries()},d.prototype[g]=function(){return this.entries()},d.prototype._find=function(a,b){if(!E(this._cacheKey,a)){this._cacheIndex=-1;for(var c=0;c<this._keys.length;c++)if(E(this._keys[c],a)){this._cacheIndex=c;break}}return this._cacheIndex<0&&b&&(this._cacheIndex=this._keys.length,this._keys.push(a),this._values.push(void 0)),this._cacheIndex},d;function e(a,b){return a}function f(a,b){return b}function h(a,b){return[a,b]}}(),n="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:function(){function a(){this._map=new m}return Object.defineProperty(a.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),a.prototype.has=function(a){return this._map.has(a)},a.prototype.add=function(a){return this._map.set(a,a),this},a.prototype.delete=function(a){return this._map.delete(a)},a.prototype.clear=function(){this._map.clear()},a.prototype.keys=function(){return this._map.keys()},a.prototype.values=function(){return this._map.keys()},a.prototype.entries=function(){return this._map.entries()},a.prototype["@@iterator"]=function(){return this.keys()},a.prototype[g]=function(){return this.keys()},a}(),o="function"==typeof WeakMap?WeakMap:function(){var a=k.create(),b=e();function c(){this._key=e()}return c.prototype.has=function(a){var b=f(a,!1);return void 0!==b&&k.has(b,this._key)},c.prototype.get=function(a){var b=f(a,!1);return void 0!==b?k.get(b,this._key):void 0},c.prototype.set=function(a,b){return f(a,!0)[this._key]=b,this},c.prototype.delete=function(a){var b=f(a,!1);return void 0!==b&&delete b[this._key]},c.prototype.clear=function(){this._key=e()},c;function e(){var b;do b="@@WeakMap@@"+function(){var a=function(a){if("function"==typeof Uint8Array){var b=new Uint8Array(16);return"u">typeof crypto?crypto.getRandomValues(b):"u">typeof msCrypto?msCrypto.getRandomValues(b):g(b,16),b}return g(Array(16),16)}(0);a[6]=79&a[6]|64,a[8]=191&a[8]|128;for(var b="",c=0;c<16;++c){var d=a[c];(4===c||6===c||8===c)&&(b+="-"),d<16&&(b+="0"),b+=d.toString(16).toLowerCase()}return b}();while(k.has(a,b))return a[b]=!0,b}function f(a,c){if(!d.call(a,b)){if(!c)return;Object.defineProperty(a,b,{value:k.create()})}return a[b]}function g(a,b){for(var c=0;c<b;++c)a[c]=255*Math.random()|0;return a}}(),p=e?Symbol.for("@reflect-metadata:registry"):void 0,q=(!x(p)&&z(b.Reflect)&&Object.isExtensible(b.Reflect)&&(c=b.Reflect[p]),x(c)&&(c=function(){x(p)||void 0===b.Reflect||p in b.Reflect||"function"!=typeof b.Reflect.defineMetadata||(c=(a=b.Reflect).defineMetadata,d=a.hasOwnMetadata,e=a.getOwnMetadata,f=a.getOwnMetadataKeys,g=a.deleteMetadata,h=new o,i={isProviderFor:function(a,b){var c=h.get(a);return!!(!x(c)&&c.has(b))||!!f(a,b).length&&(x(c)&&(c=new n,h.set(a,c)),c.add(b),!0)},OrdinaryDefineOwnMetadata:c,OrdinaryHasOwnMetadata:d,OrdinaryGetOwnMetadata:e,OrdinaryOwnMetadataKeys:f,OrdinaryDeleteMetadata:g});var a,c,d,e,f,g,h,i,j,k,l,q=new o,r={registerProvider:function(a){if(!Object.isExtensible(r))throw Error("Cannot add provider to a frozen registry.");switch(!0){case i===a:break;case x(j):j=a;break;case j===a:break;case x(k):k=a;break;case k===a:break;default:void 0===l&&(l=new n),l.add(a)}},getProvider:s,setProvider:function(a,b,c){if(!function(a){if(x(a))throw TypeError();return j===a||k===a||!x(l)&&l.has(a)}(c))throw Error("Metadata provider not registered.");var d=s(a,b);if(d!==c){if(!x(d))return!1;var e=q.get(a);x(e)&&(e=new m,q.set(a,e)),e.set(b,c)}return!0}};return r;function s(a,b){var c,d=q.get(a);return x(d)||(c=d.get(b)),x(c)&&(c=function(a,b){if(!x(j)){if(j.isProviderFor(a,b))return j;if(!x(k)){if(k.isProviderFor(a,b))return j;if(!x(l))for(var c=G(l);;){var d=H(c);if(!d)return;var e=d.value;if(e.isProviderFor(a,b))return I(c),e}}}if(!x(i)&&i.isProviderFor(a,b))return i}(a,b),x(c)||(x(d)&&(d=new m,q.set(a,d)),d.set(b,c))),c}}()),!x(p)&&z(b.Reflect)&&Object.isExtensible(b.Reflect)&&Object.defineProperty(b.Reflect,p,{enumerable:!1,configurable:!1,writable:!1,value:c}),c),r=function(a){var b=new o,c={isProviderFor:function(a,c){var d=b.get(a);return!x(d)&&d.has(c)},OrdinaryDefineOwnMetadata:function(a,b,c,e){d(c,e,!0).set(a,b)},OrdinaryHasOwnMetadata:function(a,b,c){var e=d(b,c,!1);return!x(e)&&!!e.has(a)},OrdinaryGetOwnMetadata:function(a,b,c){var e=d(b,c,!1);if(!x(e))return e.get(a)},OrdinaryOwnMetadataKeys:function(a,b){var c=[],e=d(a,b,!1);if(x(e))return c;for(var f=G(e.keys()),g=0;;){var h=H(f);if(!h)return c.length=g,c;var i=h.value;try{c[g]=i}catch(a){try{I(f)}finally{throw a}}g++}},OrdinaryDeleteMetadata:function(a,c,e){var f=d(c,e,!1);if(x(f)||!f.delete(a))return!1;if(0===f.size){var g=b.get(c);x(g)||(g.delete(e),0===g.size&&b.delete(g))}return!0}};return q.registerProvider(c),c;function d(d,e,f){var g=b.get(d),h=!1;if(x(g)){if(!f)return;g=new m,b.set(d,g),h=!0}var i=g.get(e);if(x(i)){if(!f)return;if(i=new m,g.set(e,i),!a.setProvider(d,e,c))throw g.delete(e),h&&b.delete(d),Error("Wrong provider for target.")}return i}}(q);function s(a,b,c){var d=K(b,c,!1);return!x(d)&&!!d.OrdinaryHasOwnMetadata(a,b,c)}function t(a,b,c){var d=K(b,c,!1);if(!x(d))return d.OrdinaryGetOwnMetadata(a,b,c)}function u(a,b,c,d){K(c,d,!0).OrdinaryDefineOwnMetadata(a,b,c,d)}function v(a,b){var c=K(a,b,!1);return c?c.OrdinaryOwnMetadataKeys(a,b):[]}function w(a){if(null===a)return 1;switch(typeof a){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===a?1:6;default:return 6}}function x(a){return void 0===a}function y(a){return null===a}function z(a){return"object"==typeof a?null!==a:"function"==typeof a}a("decorate",function(a,b,c,d){if(x(c)){if(!B(a)||!D(b))throw TypeError();for(var e=a,f=b,g=e.length-1;g>=0;--g){var h=(0,e[g])(f);if(!x(h)&&!y(h)){if(!D(h))throw TypeError();f=h}}return f}if(!B(a)||!z(b)||!z(d)&&!x(d)&&!y(d))throw TypeError();return y(d)&&(d=void 0),function(a,b,c,d){for(var e=a.length-1;e>=0;--e){var f=(0,a[e])(b,c,d);if(!x(f)&&!y(f)){if(!z(f))throw TypeError();d=f}}return d}(a,b,c=A(c),d)}),a("metadata",function(a,b){return function(c,d){if(!z(c)||!x(d)&&!function(a){switch(w(a)){case 3:case 4:return!0;default:return!1}}(d))throw TypeError();u(a,b,c,d)}}),a("defineMetadata",function(a,b,c,d){if(!z(c))throw TypeError();return x(d)||(d=A(d)),u(a,b,c,d)}),a("hasMetadata",function(a,b,c){if(!z(b))throw TypeError();return x(c)||(c=A(c)),function a(b,c,d){if(s(b,c,d))return!0;var e=J(c);return!y(e)&&a(b,e,d)}(a,b,c)}),a("hasOwnMetadata",function(a,b,c){if(!z(b))throw TypeError();return x(c)||(c=A(c)),s(a,b,c)}),a("getMetadata",function(a,b,c){if(!z(b))throw TypeError();return x(c)||(c=A(c)),function a(b,c,d){if(s(b,c,d))return t(b,c,d);var e=J(c);if(!y(e))return a(b,e,d)}(a,b,c)}),a("getOwnMetadata",function(a,b,c){if(!z(b))throw TypeError();return x(c)||(c=A(c)),t(a,b,c)}),a("getMetadataKeys",function(a,b){if(!z(a))throw TypeError();return x(b)||(b=A(b)),function a(b,c){var d=v(b,c),e=J(b);if(null===e)return d;var f=a(e,c);if(f.length<=0)return d;if(d.length<=0)return f;for(var g=new n,h=[],i=0;i<d.length;i++){var j=d[i],k=g.has(j);k||(g.add(j),h.push(j))}for(var l=0;l<f.length;l++){var j=f[l],k=g.has(j);k||(g.add(j),h.push(j))}return h}(a,b)}),a("getOwnMetadataKeys",function(a,b){if(!z(a))throw TypeError();return x(b)||(b=A(b)),v(a,b)}),a("deleteMetadata",function(a,b,c){if(!z(b)||(x(c)||(c=A(c)),!z(b)))throw TypeError();x(c)||(c=A(c));var d=K(b,c,!1);return!x(d)&&d.OrdinaryDeleteMetadata(a,b,c)});function A(a){var b=function(a,b){switch(w(a)){case 0:case 1:case 2:case 3:case 4:case 5:return a}var c="string",d=F(a,f);if(void 0!==d){var e=d.call(a,c);if(z(e))throw TypeError();return e}return function(a,b){if("string"===b){var c=a.toString;if(C(c)){var d=c.call(a);if(!z(d))return d}var e=a.valueOf;if(C(e)){var d=e.call(a);if(!z(d))return d}}else{var e=a.valueOf;if(C(e)){var d=e.call(a);if(!z(d))return d}var f=a.toString;if(C(f)){var d=f.call(a);if(!z(d))return d}}throw TypeError()}(a,c)}(a,0);return"symbol"==typeof b?b:""+b}function B(a){return Array.isArray?Array.isArray(a):a instanceof Object?a instanceof Array:"[object Array]"===Object.prototype.toString.call(a)}function C(a){return"function"==typeof a}function D(a){return"function"==typeof a}function E(a,b){return a===b||a!=a&&b!=b}function F(a,b){var c=a[b];if(null!=c){if(!C(c))throw TypeError();return c}}function G(a){var b=F(a,g);if(!C(b))throw TypeError();var c=b.call(a);if(!z(c))throw TypeError();return c}function H(a){var b=a.next();return!b.done&&b}function I(a){var b=a.return;b&&b.call(a)}function J(a){var b=Object.getPrototypeOf(a);if("function"!=typeof a||a===l||b!==l)return b;var c=a.prototype,d=c&&Object.getPrototypeOf(c);if(null==d||d===Object.prototype)return b;var e=d.constructor;return"function"!=typeof e||e===a?b:e}function K(a,b,c){var d=q.getProvider(a,b);if(!x(d))return d;if(c){if(q.setProvider(a,b,r))return r;throw Error("Illegal state.")}}function L(a){return a.__=void 0,delete a.__,a}})},35525,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k,l;var m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI,aJ,aK,aL,aM,aN,aO,aP,aQ,aR,aS,aT,aU,aV,aW,aX,aY,aZ,a$,a_,a0,a1,a2,a3,a4,a5,a6,a7,a8,a9,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs=a.i(85078);let bt=(0,bs.createRandomStringGenerator)("a-z","0-9","A-Z","-_");function bu(a,b=""){if(!Number.isSafeInteger(a)||a<0){let c=b&&`"${b}" `;throw Error(`${c}expected integer >= 0, got ${a}`)}}function bv(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function bw(a){if("function"!=typeof a||"function"!=typeof a.create)throw Error("Hash must wrapped by utils.createHasher");bu(a.outputLen),bu(a.blockLen)}function bx(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function by(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function bz(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}function bA(a){return new DataView(a.buffer,a.byteOffset,a.byteLength)}function bB(a,b){return a<<32-b|a>>>b}function bC(a,b){return a<<b|a>>>32-b>>>0}let bD=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0]?a=>a:function(a){for(let c=0;c<a.length;c++){var b;a[c]=(b=a[c])<<24&0xff000000|b<<8&0xff0000|b>>>8&65280|b>>>24&255}return a},bE="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex;function bF(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}let bG=async()=>{};async function bH(a,b,c){let d=Date.now();for(let e=0;e<a;e++){c(e);let a=Date.now()-d;a>=0&&a<b||(await bG(),d+=a)}}function bI(a,b=""){if("string"==typeof a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}return bv(a,void 0,b)}function bJ(a,b){if(void 0!==b&&"[object Object]"!==({}).toString.call(b))throw Error("options must be object or undefined");return Object.assign(a,b)}class bK{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(a,b){if(bw(a),bv(b,void 0,"key"),this.iHash=a.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const c=this.blockLen,d=new Uint8Array(c);d.set(b.length>c?a.create().update(b).digest():b);for(let a=0;a<d.length;a++)d[a]^=54;this.iHash.update(d),this.oHash=a.create();for(let a=0;a<d.length;a++)d[a]^=106;this.oHash.update(d),bz(d)}update(a){return bx(this),this.iHash.update(a),this}digestInto(a){bx(this),bv(a,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(a),this.oHash.update(a),this.oHash.digestInto(a),this.destroy()}digest(){let a=new Uint8Array(this.oHash.outputLen);return this.digestInto(a),a}_cloneInto(a){a||=Object.create(Object.getPrototypeOf(this),{});let{oHash:b,iHash:c,finished:d,destroyed:e,blockLen:f,outputLen:g}=this;return a.finished=d,a.destroyed=e,a.blockLen=f,a.outputLen=g,a.oHash=b._cloneInto(a.oHash),a.iHash=c._cloneInto(a.iHash),a}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}let bL=(a,b,c)=>new bK(a,b).update(c).digest();bL.create=(a,b)=>new bK(a,b);let bM=Uint8Array.of(0),bN=Uint8Array.of(),bO=(a,b,c,d,e)=>{var f;return function(a,b,c,d=32){bw(a),bu(d,"length");let e=a.outputLen;if(d>255*e)throw Error("Length must be <= 255*HashLen");let f=Math.ceil(d/e);void 0===c?c=bN:bv(c,void 0,"info");let g=new Uint8Array(f*e),h=bL.create(a,b),i=h._cloneInto(),j=new Uint8Array(h.outputLen);for(let a=0;a<f;a++)bM[0]=a+1,i.update(0===a?bN:j).update(c).update(bM).digestInto(j),g.set(j,e*a),h._cloneInto(i);return h.destroy(),i.destroy(),bz(j,bM),g.slice(0,d)}(a,(f=c,bw(a),void 0===f&&(f=new Uint8Array(a.outputLen)),bL(a,f,b)),d,e)};class bP{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(a,b,c,d){this.blockLen=a,this.outputLen=b,this.padOffset=c,this.isLE=d,this.buffer=new Uint8Array(a),this.view=bA(this.buffer)}update(a){bx(this),bv(a);let{view:b,buffer:c,blockLen:d}=this,e=a.length;for(let f=0;f<e;){let g=Math.min(d-this.pos,e-f);if(g===d){let b=bA(a);for(;d<=e-f;f+=d)this.process(b,f);continue}c.set(a.subarray(f,f+g),this.pos),this.pos+=g,f+=g,this.pos===d&&(this.process(b,0),this.pos=0)}return this.length+=a.length,this.roundClean(),this}digestInto(a){bx(this);bv(a,void 0,"digestInto() output");let b=this.outputLen;if(a.length<b)throw Error('"digestInto() output" expected to be of length >='+b);this.finished=!0;let{buffer:c,view:d,blockLen:e,isLE:f}=this,{pos:g}=this;c[g++]=128,bz(this.buffer.subarray(g)),this.padOffset>e-g&&(this.process(d,0),g=0);for(let a=g;a<e;a++)c[a]=0;d.setBigUint64(e-8,BigInt(8*this.length),f),this.process(d,0);let h=bA(a),i=this.outputLen;if(i%4)throw Error("_sha2: outputLen must be aligned to 32bit");let j=i/4,k=this.get();if(j>k.length)throw Error("_sha2: outputLen bigger than state");for(let a=0;a<j;a++)h.setUint32(4*a,k[a],f)}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}_cloneInto(a){(a||=new this.constructor).set(...this.get());let{blockLen:b,buffer:c,length:d,finished:e,destroyed:f,pos:g}=this;return a.destroyed=f,a.finished=e,a.length=d,a.pos=g,d%b&&a.buffer.set(c),a}clone(){return this._cloneInto()}}let bQ=Uint32Array.from([0x6a09e667,0xbb67ae85,0x3c6ef372,0xa54ff53a,0x510e527f,0x9b05688c,0x1f83d9ab,0x5be0cd19]),bR=Uint32Array.from([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4]),bS=Uint32Array.from([0xcbbb9d5d,0xc1059ed8,0x629a292a,0x367cd507,0x9159015a,0x3070dd17,0x152fecd8,0xf70e5939,0x67332667,0xffc00b31,0x8eb44a87,0x68581511,0xdb0c2e0d,0x64f98fa7,0x47b5481d,0xbefa4fa4]),bT=Uint32Array.from([0x6a09e667,0xf3bcc908,0xbb67ae85,0x84caa73b,0x3c6ef372,0xfe94f82b,0xa54ff53a,0x5f1d36f1,0x510e527f,0xade682d1,0x9b05688c,0x2b3e6c1f,0x1f83d9ab,0xfb41bd6b,0x5be0cd19,0x137e2179]),bU=BigInt(0x100000000-1),bV=BigInt(32),bW=Uint32Array.from([0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2]),bX=new Uint32Array(64);class bY extends bP{constructor(a){super(64,a,8,!1)}get(){let{A:a,B:b,C:c,D:d,E:e,F:f,G:g,H:h}=this;return[a,b,c,d,e,f,g,h]}set(a,b,c,d,e,f,g,h){this.A=0|a,this.B=0|b,this.C=0|c,this.D=0|d,this.E=0|e,this.F=0|f,this.G=0|g,this.H=0|h}process(a,b){for(let c=0;c<16;c++,b+=4)bX[c]=a.getUint32(b,!1);for(let a=16;a<64;a++){let b=bX[a-15],c=bX[a-2],d=bB(b,7)^bB(b,18)^b>>>3,e=bB(c,17)^bB(c,19)^c>>>10;bX[a]=e+bX[a-7]+d+bX[a-16]|0}let{A:c,B:d,C:e,D:f,E:g,F:h,G:i,H:j}=this;for(let a=0;a<64;a++){var k,l,m,n;let b=j+(bB(g,6)^bB(g,11)^bB(g,25))+((k=g)&h^~k&i)+bW[a]+bX[a]|0,o=(bB(c,2)^bB(c,13)^bB(c,22))+((l=c)&(m=d)^l&(n=e)^m&n)|0;j=i,i=h,h=g,g=f+b|0,f=e,e=d,d=c,c=b+o|0}c=c+this.A|0,d=d+this.B|0,e=e+this.C|0,f=f+this.D|0,g=g+this.E|0,h=h+this.F|0,i=i+this.G|0,j=j+this.H|0,this.set(c,d,e,f,g,h,i,j)}roundClean(){bz(bX)}destroy(){this.set(0,0,0,0,0,0,0,0),bz(this.buffer)}}class bZ extends bY{A=0|bQ[0];B=0|bQ[1];C=0|bQ[2];D=0|bQ[3];E=0|bQ[4];F=0|bQ[5];G=0|bQ[6];H=0|bQ[7];constructor(){super(32)}}let b$=function(a,b=!1){let c=a.length,d=new Uint32Array(c),e=new Uint32Array(c);for(let f=0;f<c;f++){let{h:c,l:g}=function(a,b=!1){return b?{h:Number(a&bU),l:Number(a>>bV&bU)}:{h:0|Number(a>>bV&bU),l:0|Number(a&bU)}}(a[f],b);[d[f],e[f]]=[c,g]}return[d,e]}(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(a=>BigInt(a))),b_=b$[0],b0=b$[1],b1=new Uint32Array(80),b2=new Uint32Array(80),b3=function(a,b={}){let c=(b,c)=>a(c).update(b).digest(),d=a(void 0);return c.outputLen=d.outputLen,c.blockLen=d.blockLen,c.create=b=>a(b),Object.assign(c,b),Object.freeze(c)}(()=>new bZ,{oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,1])}),b4=new TextEncoder,b5=new TextDecoder;function b6(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}function b7(a,b,c){if(b<0||b>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${b}`);a.set([b>>>24,b>>>16,b>>>8,255&b],c)}function b8(a){let b=Math.floor(a/0x100000000),c=new Uint8Array(8);return b7(c,b,0),b7(c,a%0x100000000,4),c}function b9(a){let b=new Uint8Array(4);return b7(b,a),b}function ca(a){let b=new Uint8Array(a.length);for(let c=0;c<a.length;c++){let d=a.charCodeAt(c);if(d>127)throw TypeError("non-ASCII string encountered in encode()");b[c]=d}return b}function cb(a){if(Uint8Array.fromBase64)return Uint8Array.fromBase64("string"==typeof a?a:b5.decode(a),{alphabet:"base64url"});let b=a;b instanceof Uint8Array&&(b=b5.decode(b)),b=b.replace(/-/g,"+").replace(/_/g,"/");try{var c=b;if(Uint8Array.fromBase64)return Uint8Array.fromBase64(c);let a=atob(c),d=new Uint8Array(a.length);for(let b=0;b<a.length;b++)d[b]=a.charCodeAt(b);return d}catch{throw TypeError("The input to be decoded is not correctly encoded.")}}function cc(a){let b=a;return("string"==typeof b&&(b=b4.encode(b)),Uint8Array.prototype.toBase64)?b.toBase64({alphabet:"base64url",omitPadding:!0}):(function(a){if(Uint8Array.prototype.toBase64)return a.toBase64();let b=[];for(let c=0;c<a.length;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join(""))})(b).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}a.s(["decode",()=>cb,"encode",()=>cc],9634);let cd=Symbol();class ce extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class cf extends ce{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class cg extends ce{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class ch extends ce{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class ci extends ce{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class cj extends ce{static code="ERR_JWE_DECRYPTION_FAILED";code="ERR_JWE_DECRYPTION_FAILED";constructor(a="decryption operation failed",b){super(a,b)}}class ck extends ce{static code="ERR_JWE_INVALID";code="ERR_JWE_INVALID"}class cl extends ce{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class cm extends ce{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class cn extends ce{static code="ERR_JWK_INVALID";code="ERR_JWK_INVALID"}class co extends ce{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class cp extends ce{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(a="no applicable key found in the JSON Web Key Set",b){super(a,b)}}class cq extends ce{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class cr extends ce{static code="ERR_JWKS_TIMEOUT";code="ERR_JWKS_TIMEOUT";constructor(a="request timed out",b){super(a,b)}}class cs extends ce{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}function ct(a){switch(a){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new ci(`Unsupported JWE Algorithm: ${a}`)}}function cu(a,b){if(b.length<<3!==ct(a))throw new ck("Invalid Initialization Vector length")}function cv(a,b){let c=a.byteLength<<3;if(c!==b)throw new ck(`Invalid Content Encryption Key length. Expected ${b} bits, got ${c} bits`)}let cw=(a,b="algorithm.name")=>TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`);function cx(a){return parseInt(a.name.slice(4),10)}function cy(a,b){if(b&&!a.usages.includes(b))throw TypeError(`CryptoKey does not support this operation, its usages must include ${b}.`)}function cz(a,b,c){switch(b){case"A128GCM":case"A192GCM":case"A256GCM":{if("AES-GCM"!==a.algorithm.name)throw cw("AES-GCM");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw cw(c,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if("AES-KW"!==a.algorithm.name)throw cw("AES-KW");let c=parseInt(b.slice(1,4),10);if(a.algorithm.length!==c)throw cw(c,"algorithm.length");break}case"ECDH":switch(a.algorithm.name){case"ECDH":case"X25519":break;default:throw cw("ECDH or X25519")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if("PBKDF2"!==a.algorithm.name)throw cw("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if("RSA-OAEP"!==a.algorithm.name)throw cw("RSA-OAEP");let c=parseInt(b.slice(9),10)||1;if(cx(a.algorithm.hash)!==c)throw cw(`SHA-${c}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}cy(a,c)}function cA(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let cB=(a,...b)=>cA("Key must be ",a,...b),cC=(a,b,...c)=>cA(`Key for the ${a} algorithm must be `,b,...c);function cD(a){if(!cE(a))throw Error("CryptoKey instance expected")}let cE=a=>{if(a?.[Symbol.toStringTag]==="CryptoKey")return!0;try{return a instanceof CryptoKey}catch{return!1}},cF=a=>a?.[Symbol.toStringTag]==="KeyObject",cG=a=>cE(a)||cF(a);async function cH(a,b,c,d,e){if(!(c instanceof Uint8Array))throw TypeError(cB(c,"Uint8Array"));let f=parseInt(a.slice(1,4),10),g=await crypto.subtle.importKey("raw",c.subarray(f>>3),"AES-CBC",!1,["encrypt"]),h=await crypto.subtle.importKey("raw",c.subarray(0,f>>3),{hash:`SHA-${f<<1}`,name:"HMAC"},!1,["sign"]),i=new Uint8Array(await crypto.subtle.encrypt({iv:d,name:"AES-CBC"},g,b)),j=b6(e,d,i,b8(e.length<<3));return{ciphertext:i,tag:new Uint8Array((await crypto.subtle.sign("HMAC",h,j)).slice(0,f>>3)),iv:d}}async function cI(a,b,c,d,e){let f;c instanceof Uint8Array?f=await crypto.subtle.importKey("raw",c,"AES-GCM",!1,["encrypt"]):(cz(c,a,"encrypt"),f=c);let g=new Uint8Array(await crypto.subtle.encrypt({additionalData:e,iv:d,name:"AES-GCM",tagLength:128},f,b)),h=g.slice(-16);return{ciphertext:g.slice(0,-16),tag:h,iv:d}}async function cJ(a,b,c,d,e){if(!cE(c)&&!(c instanceof Uint8Array))throw TypeError(cB(c,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(d)cu(a,d);else d=crypto.getRandomValues(new Uint8Array(ct(a)>>3));switch(a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return c instanceof Uint8Array&&cv(c,parseInt(a.slice(-3),10)),cH(a,b,c,d,e);case"A128GCM":case"A192GCM":case"A256GCM":return c instanceof Uint8Array&&cv(c,parseInt(a.slice(1,4),10)),cI(a,b,c,d,e);default:throw new ci("Unsupported JWE Content Encryption Algorithm")}}function cK(a,b){if(a.algorithm.length!==parseInt(b.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${b}`)}function cL(a,b,c){return a instanceof Uint8Array?crypto.subtle.importKey("raw",a,"AES-KW",!0,[c]):(cz(a,b,c),a)}async function cM(a,b,c){let d=await cL(b,a,"wrapKey");cK(d,a);let e=await crypto.subtle.importKey("raw",c,{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.wrapKey("raw",e,d,"AES-KW"))}async function cN(a,b,c){let d=await cL(b,a,"unwrapKey");cK(d,a);let e=await crypto.subtle.unwrapKey("raw",c,d,"AES-KW",{hash:"SHA-256",name:"HMAC"},!0,["sign"]);return new Uint8Array(await crypto.subtle.exportKey("raw",e))}async function cO(a,b){let c=`SHA-${a.slice(-3)}`;return new Uint8Array(await crypto.subtle.digest(c,b))}function cP(a){return b6(b9(a.length),a)}async function cQ(a,b,c){let d=b>>3,e=Math.ceil(d/32),f=new Uint8Array(32*e);for(let b=1;b<=e;b++){let d=new Uint8Array(4+a.length+c.length);d.set(b9(b),0),d.set(a,4),d.set(c,4+a.length);let e=await cO("sha256",d);f.set(e,(b-1)*32)}return f.slice(0,d)}async function cR(a,b,c,d,e=new Uint8Array,f=new Uint8Array){var g;cz(a,"ECDH"),cz(b,"ECDH","deriveBits");let h=b6(cP(ca(c)),cP(e),cP(f),b9(d),new Uint8Array);return cQ(new Uint8Array(await crypto.subtle.deriveBits({name:a.algorithm.name,public:a},b,"X25519"===(g=a).algorithm.name?256:Math.ceil(parseInt(g.algorithm.namedCurve.slice(-3),10)/8)<<3)),d,h)}function cS(a){switch(a.algorithm.namedCurve){case"P-256":case"P-384":case"P-521":return!0;default:return"X25519"===a.algorithm.name}}async function cT(a,b,c,d){if(!(a instanceof Uint8Array)||a.length<8)throw new ck("PBES2 Salt Input must be 8 or more octets");let e=b6(ca(b),Uint8Array.of(0),a),f=parseInt(b.slice(13,16),10),g={hash:`SHA-${b.slice(8,11)}`,iterations:c,name:"PBKDF2",salt:e},h=await (d instanceof Uint8Array?crypto.subtle.importKey("raw",d,"PBKDF2",!1,["deriveBits"]):(cz(d,b,"deriveBits"),d));return new Uint8Array(await crypto.subtle.deriveBits(g,h,f))}async function cU(a,b,c,d=2048,e=crypto.getRandomValues(new Uint8Array(16))){let f=await cT(e,a,d,b);return{encryptedKey:await cM(a.slice(-6),f,c),p2c:d,p2s:cc(e)}}async function cV(a,b,c,d,e){let f=await cT(e,a,d,b);return cN(a.slice(-6),f,c)}function cW(a,b){if(a.startsWith("RS")||a.startsWith("PS")){let{modulusLength:c}=b.algorithm;if("number"!=typeof c||c<2048)throw TypeError(`${a} requires key modulusLength to be 2048 bits or larger`)}}let cX=a=>{switch(a){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new ci(`alg ${a} is not supported either by JOSE or your javascript runtime`)}};async function cY(a,b,c){return cz(b,a,"encrypt"),cW(a,b),new Uint8Array(await crypto.subtle.encrypt(cX(a),b,c))}async function cZ(a,b,c){return cz(b,a,"decrypt"),cW(a,b),new Uint8Array(await crypto.subtle.decrypt(cX(a),b,c))}function c$(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}let c_=a=>c$(a)&&"string"==typeof a.kty;async function c0(a){if(!a.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:b,keyUsages:c}=function(a){let b,c;switch(a.kty){case"AKP":switch(a.alg){case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":b={name:a.alg},c=a.priv?["sign"]:["verify"];break;default:throw new ci('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"RSA":switch(a.alg){case"PS256":case"PS384":case"PS512":b={name:"RSA-PSS",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":b={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.alg.slice(-3)}`},c=a.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":b={name:"RSA-OAEP",hash:`SHA-${parseInt(a.alg.slice(-3),10)||1}`},c=a.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new ci('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(a.alg){case"ES256":b={name:"ECDSA",namedCurve:"P-256"},c=a.d?["sign"]:["verify"];break;case"ES384":b={name:"ECDSA",namedCurve:"P-384"},c=a.d?["sign"]:["verify"];break;case"ES512":b={name:"ECDSA",namedCurve:"P-521"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:"ECDH",namedCurve:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new ci('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(a.alg){case"Ed25519":case"EdDSA":b={name:"Ed25519"},c=a.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":b={name:a.crv},c=a.d?["deriveBits"]:[];break;default:throw new ci('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new ci('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:b,keyUsages:c}}(a),d={...a};return"AKP"!==d.kty&&delete d.alg,delete d.use,crypto.subtle.importKey("jwk",d,b,a.ext??(!a.d&&!a.priv),a.key_ops??c)}let c1=async(a,c,d,e=!1)=>{let f=(b||=new WeakMap).get(a);if(f?.[d])return f[d];let g=await c0({...c,alg:d});return e&&Object.freeze(a),f?f[d]=g:b.set(a,{[d]:g}),g};async function c2(a,c){if(a instanceof Uint8Array||cE(a))return a;if(cF(a)){if("secret"===a.type)return a.export();if("toCryptoKey"in a&&"function"==typeof a.toCryptoKey)try{return((a,c)=>{let d,e=(b||=new WeakMap).get(a);if(e?.[c])return e[c];let f="public"===a.type,g=!!f;if("x25519"===a.asymmetricKeyType){switch(c){case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}d=a.toCryptoKey(a.asymmetricKeyType,g,f?[]:["deriveBits"])}if("ed25519"===a.asymmetricKeyType){if("EdDSA"!==c&&"Ed25519"!==c)throw TypeError("given KeyObject instance cannot be used for this algorithm");d=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}switch(a.asymmetricKeyType){case"ml-dsa-44":case"ml-dsa-65":case"ml-dsa-87":if(c!==a.asymmetricKeyType.toUpperCase())throw TypeError("given KeyObject instance cannot be used for this algorithm");d=a.toCryptoKey(a.asymmetricKeyType,g,[f?"verify":"sign"])}if("rsa"===a.asymmetricKeyType){let b;switch(c){case"RSA-OAEP":b="SHA-1";break;case"RS256":case"PS256":case"RSA-OAEP-256":b="SHA-256";break;case"RS384":case"PS384":case"RSA-OAEP-384":b="SHA-384";break;case"RS512":case"PS512":case"RSA-OAEP-512":b="SHA-512";break;default:throw TypeError("given KeyObject instance cannot be used for this algorithm")}if(c.startsWith("RSA-OAEP"))return a.toCryptoKey({name:"RSA-OAEP",hash:b},g,f?["encrypt"]:["decrypt"]);d=a.toCryptoKey({name:c.startsWith("PS")?"RSA-PSS":"RSASSA-PKCS1-v1_5",hash:b},g,[f?"verify":"sign"])}if("ec"===a.asymmetricKeyType){let b=new Map([["prime256v1","P-256"],["secp384r1","P-384"],["secp521r1","P-521"]]).get(a.asymmetricKeyDetails?.namedCurve);if(!b)throw TypeError("given KeyObject instance cannot be used for this algorithm");"ES256"===c&&"P-256"===b&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:b},g,[f?"verify":"sign"])),"ES384"===c&&"P-384"===b&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:b},g,[f?"verify":"sign"])),"ES512"===c&&"P-521"===b&&(d=a.toCryptoKey({name:"ECDSA",namedCurve:b},g,[f?"verify":"sign"])),c.startsWith("ECDH-ES")&&(d=a.toCryptoKey({name:"ECDH",namedCurve:b},g,f?[]:["deriveBits"]))}if(!d)throw TypeError("given KeyObject instance cannot be used for this algorithm");return e?e[c]=d:b.set(a,{[c]:d}),d})(a,c)}catch(a){if(a instanceof TypeError)throw a}let d=a.export({format:"jwk"});return c1(a,d,c)}if(c_(a))return a.k?cb(a.k):c1(a,a,c,!0);throw Error("unreachable")}function c3(a){switch(a){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new ci(`Unsupported JWE Algorithm: ${a}`)}}let c4=a=>crypto.getRandomValues(new Uint8Array(c3(a)>>3));async function c5(a){if(cF(a))if("secret"!==a.type)return a.export({format:"jwk"});else a=a.export();if(a instanceof Uint8Array)return{kty:"oct",k:cc(a)};if(!cE(a))throw TypeError(cB(a,"CryptoKey","KeyObject","Uint8Array"));if(!a.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:b,key_ops:c,alg:d,use:e,...f}=await crypto.subtle.exportKey("jwk",a);return"AKP"===f.kty&&(f.alg=d),f}async function c6(a){return c5(a)}async function c7(a,b){if(!(a instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(b instanceof Uint8Array))throw TypeError("Second argument must be a buffer");let c={name:"HMAC",hash:"SHA-256"},d=await crypto.subtle.generateKey(c,!1,["sign"]),e=new Uint8Array(await crypto.subtle.sign(c,d,a)),f=new Uint8Array(await crypto.subtle.sign(c,d,b)),g=0,h=-1;for(;++h<32;)g|=e[h]^f[h];return 0===g}async function c8(a,b,c,d,e,f){let g,h;if(!(b instanceof Uint8Array))throw TypeError(cB(b,"Uint8Array"));let i=parseInt(a.slice(1,4),10),j=await crypto.subtle.importKey("raw",b.subarray(i>>3),"AES-CBC",!1,["decrypt"]),k=await crypto.subtle.importKey("raw",b.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),l=b6(f,d,c,b8(f.length<<3)),m=new Uint8Array((await crypto.subtle.sign("HMAC",k,l)).slice(0,i>>3));try{g=await c7(e,m)}catch{}if(!g)throw new cj;try{h=new Uint8Array(await crypto.subtle.decrypt({iv:d,name:"AES-CBC"},j,c))}catch{}if(!h)throw new cj;return h}async function c9(a,b,c,d,e,f){let g;b instanceof Uint8Array?g=await crypto.subtle.importKey("raw",b,"AES-GCM",!1,["decrypt"]):(cz(b,a,"decrypt"),g=b);try{return new Uint8Array(await crypto.subtle.decrypt({additionalData:f,iv:d,name:"AES-GCM",tagLength:128},g,b6(c,e)))}catch{throw new cj}}async function da(a,b,c,d,e,f){if(!cE(b)&&!(b instanceof Uint8Array))throw TypeError(cB(b,"CryptoKey","KeyObject","Uint8Array","JSON Web Key"));if(!d)throw new ck("JWE Initialization Vector missing");if(!e)throw new ck("JWE Authentication Tag missing");switch(cu(a,d),a){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return b instanceof Uint8Array&&cv(b,parseInt(a.slice(-3),10)),c8(a,b,c,d,e,f);case"A128GCM":case"A192GCM":case"A256GCM":return b instanceof Uint8Array&&cv(b,parseInt(a.slice(1,4),10)),c9(a,b,c,d,e,f);default:throw new ci("Unsupported JWE Content Encryption Algorithm")}}async function db(a,b,c,d){let e=a.slice(0,7),f=await cJ(e,c,b,d,new Uint8Array);return{encryptedKey:f.ciphertext,iv:cc(f.iv),tag:cc(f.tag)}}async function dc(a,b,c,d,e){return da(a.slice(0,7),b,c,d,e,new Uint8Array)}async function dd(a,b,c,d,e={}){let f,g,h;switch(a){case"dir":h=c;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let i;if(cD(c),!cS(c))throw new ci("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:j,apv:k}=e;i=e.epk?await c2(e.epk,a):(await crypto.subtle.generateKey(c.algorithm,!0,["deriveBits"])).privateKey;let{x:l,y:m,crv:n,kty:o}=await c6(i),p=await cR(c,i,"ECDH-ES"===a?b:a,"ECDH-ES"===a?c3(b):parseInt(a.slice(-5,-2),10),j,k);if(g={epk:{x:l,crv:n,kty:o}},"EC"===o&&(g.epk.y=m),j&&(g.apu=cc(j)),k&&(g.apv=cc(k)),"ECDH-ES"===a){h=p;break}h=d||c4(b);let q=a.slice(-6);f=await cM(q,p,h);break}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":h=d||c4(b),cD(c),f=await cY(a,c,h);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{h=d||c4(b);let{p2c:i,p2s:j}=e;({encryptedKey:f,...g}=await cU(a,c,h,i,j));break}case"A128KW":case"A192KW":case"A256KW":h=d||c4(b),f=await cM(a,c,h);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{h=d||c4(b);let{iv:i}=e;({encryptedKey:f,...g}=await db(a,c,h,i));break}default:throw new ci('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:h,encryptedKey:f,parameters:g}}function de(...a){let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0}function df(a,b,c,d,e){let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new ci(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)}let dg=a=>a?.[Symbol.toStringTag],dh=(a,b,c)=>{if(void 0!==b.use){let a;switch(c){case"sign":case"verify":a="sig";break;case"encrypt":case"decrypt":a="enc"}if(b.use!==a)throw TypeError(`Invalid key for this operation, its "use" must be "${a}" when present`)}if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, its "alg" must be "${a}" when present`);if(Array.isArray(b.key_ops)){let d;switch(!0){case"sign"===c||"verify"===c:case"dir"===a:case a.includes("CBC-HS"):d=c;break;case a.startsWith("PBES2"):d="deriveBits";break;case/^A\d{3}(?:GCM)?(?:KW)?$/.test(a):d=!a.includes("GCM")&&a.endsWith("KW")?"encrypt"===c?"wrapKey":"unwrapKey":c;break;case"encrypt"===c&&a.startsWith("RSA"):d="wrapKey";break;case"decrypt"===c:d=a.startsWith("RSA")?"unwrapKey":"deriveBits"}if(d&&b.key_ops?.includes?.(d)===!1)throw TypeError(`Invalid key for this operation, its "key_ops" must include "${d}" when present`)}return!0};function di(a,b,c){switch(a.substring(0,2)){case"A1":case"A2":case"di":case"HS":case"PB":((a,b,c)=>{if(!(b instanceof Uint8Array)){if(c_(b)){if("oct"===b.kty&&"string"==typeof b.k&&dh(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!cG(b))throw TypeError(cC(a,b,"CryptoKey","KeyObject","JSON Web Key","Uint8Array"));if("secret"!==b.type)throw TypeError(`${dg(b)} instances for symmetric algorithms must be of type "secret"`)}})(a,b,c);break;default:((a,b,c)=>{if(c_(b))switch(c){case"decrypt":case"sign":if("oct"!==b.kty&&("AKP"===b.kty&&"string"==typeof b.priv||"string"==typeof b.d)&&dh(a,b,c))return;throw TypeError("JSON Web Key for this operation must be a private JWK");case"encrypt":case"verify":if("oct"!==b.kty&&void 0===b.d&&void 0===b.priv&&dh(a,b,c))return;throw TypeError("JSON Web Key for this operation must be a public JWK")}if(!cG(b))throw TypeError(cC(a,b,"CryptoKey","KeyObject","JSON Web Key"));if("secret"===b.type)throw TypeError(`${dg(b)} instances for asymmetric algorithms must not be of type "secret"`);if("public"===b.type)switch(c){case"sign":throw TypeError(`${dg(b)} instances for asymmetric algorithm signing must be of type "private"`);case"decrypt":throw TypeError(`${dg(b)} instances for asymmetric algorithm decryption must be of type "private"`)}if("private"===b.type)switch(c){case"verify":throw TypeError(`${dg(b)} instances for asymmetric algorithm verifying must be of type "public"`);case"encrypt":throw TypeError(`${dg(b)} instances for asymmetric algorithm encryption must be of type "public"`)}})(a,b,c)}}class dj{#a;#b;#c;#d;#e;#f;#g;#h;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this.#a=a}setKeyManagementParameters(a){if(this.#h)throw TypeError("setKeyManagementParameters can only be called once");return this.#h=a,this}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setSharedUnprotectedHeader(a){if(this.#c)throw TypeError("setSharedUnprotectedHeader can only be called once");return this.#c=a,this}setUnprotectedHeader(a){if(this.#d)throw TypeError("setUnprotectedHeader can only be called once");return this.#d=a,this}setAdditionalAuthenticatedData(a){return this.#e=a,this}setContentEncryptionKey(a){if(this.#f)throw TypeError("setContentEncryptionKey can only be called once");return this.#f=a,this}setInitializationVector(a){if(this.#g)throw TypeError("setInitializationVector can only be called once");return this.#g=a,this}async encrypt(a,b){let c,d,e,f,g,h;if(!this.#b&&!this.#d&&!this.#c)throw new ck("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!de(this.#b,this.#d,this.#c))throw new ck("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let i={...this.#b,...this.#d,...this.#c};if(df(ck,new Map,b?.crit,this.#b,i),void 0!==i.zip)throw new ci('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:j,enc:k}=i;if("string"!=typeof j||!j)throw new ck('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof k||!k)throw new ck('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this.#f&&("dir"===j||"ECDH-ES"===j))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${j}`);di("dir"===j?k:j,a,"encrypt");{let e,f=await c2(a,j);({cek:d,encryptedKey:c,parameters:e}=await dd(j,k,f,this.#f,this.#h)),e&&(b&&cd in b?this.#d?this.#d={...this.#d,...e}:this.setUnprotectedHeader(e):this.#b?this.#b={...this.#b,...e}:this.setProtectedHeader(e))}if(this.#b?g=ca(f=cc(JSON.stringify(this.#b))):(f="",g=new Uint8Array),this.#e){let a=ca(h=cc(this.#e));e=b6(g,ca("."),a)}else e=g;let{ciphertext:l,tag:m,iv:n}=await cJ(k,this.#a,d,this.#g,e),o={ciphertext:cc(l)};return n&&(o.iv=cc(n)),m&&(o.tag=cc(m)),c&&(o.encrypted_key=cc(c)),h&&(o.aad=h),this.#b&&(o.protected=f),this.#c&&(o.unprotected=this.#c),this.#d&&(o.header=this.#d),o}}class dk{#i;constructor(a){this.#i=new dj(a)}setContentEncryptionKey(a){return this.#i.setContentEncryptionKey(a),this}setInitializationVector(a){return this.#i.setInitializationVector(a),this}setProtectedHeader(a){return this.#i.setProtectedHeader(a),this}setKeyManagementParameters(a){return this.#i.setKeyManagementParameters(a),this}async encrypt(a,b){let c=await this.#i.encrypt(a,b);return[c.protected,c.encrypted_key,c.iv,c.ciphertext,c.tag].join(".")}}let dl=a=>Math.floor(a.getTime()/1e3),dm=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i;function dn(a){let b,c=dm.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b}function dp(a,b){if(!Number.isFinite(b))throw TypeError(`Invalid ${a} input`);return b}let dq=a=>a.includes("/")?a.toLowerCase():`application/${a.toLowerCase()}`;function dr(a,b,c={}){var d,e;let f,g;try{f=JSON.parse(b5.decode(b))}catch{}if(!c$(f))throw new cm("JWT Claims Set must be a top-level JSON object");let{typ:h}=c;if(h&&("string"!=typeof a.typ||dq(a.typ)!==dq(h)))throw new cf('unexpected "typ" JWT header value',f,"typ","check_failed");let{requiredClaims:i=[],issuer:j,subject:k,audience:l,maxTokenAge:m}=c,n=[...i];for(let a of(void 0!==m&&n.push("iat"),void 0!==l&&n.push("aud"),void 0!==k&&n.push("sub"),void 0!==j&&n.push("iss"),new Set(n.reverse())))if(!(a in f))throw new cf(`missing required "${a}" claim`,f,a,"missing");if(j&&!(Array.isArray(j)?j:[j]).includes(f.iss))throw new cf('unexpected "iss" claim value',f,"iss","check_failed");if(k&&f.sub!==k)throw new cf('unexpected "sub" claim value',f,"sub","check_failed");if(l&&(d=f.aud,e="string"==typeof l?[l]:l,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new cf('unexpected "aud" claim value',f,"aud","check_failed");switch(typeof c.clockTolerance){case"string":g=dn(c.clockTolerance);break;case"number":g=c.clockTolerance;break;case"undefined":g=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:o}=c,p=dl(o||new Date);if((void 0!==f.iat||m)&&"number"!=typeof f.iat)throw new cf('"iat" claim must be a number',f,"iat","invalid");if(void 0!==f.nbf){if("number"!=typeof f.nbf)throw new cf('"nbf" claim must be a number',f,"nbf","invalid");if(f.nbf>p+g)throw new cf('"nbf" claim timestamp check failed',f,"nbf","check_failed")}if(void 0!==f.exp){if("number"!=typeof f.exp)throw new cf('"exp" claim must be a number',f,"exp","invalid");if(f.exp<=p-g)throw new cg('"exp" claim timestamp check failed',f,"exp","check_failed")}if(m){let a=p-f.iat;if(a-g>("number"==typeof m?m:dn(m)))throw new cg('"iat" claim timestamp check failed (too far in the past)',f,"iat","check_failed");if(a<0-g)throw new cf('"iat" claim timestamp check failed (it should be in the past)',f,"iat","check_failed")}return f}class ds{#j;constructor(a){if(!c$(a))throw TypeError("JWT Claims Set MUST be an object");this.#j=structuredClone(a)}data(){return b4.encode(JSON.stringify(this.#j))}get iss(){return this.#j.iss}set iss(a){this.#j.iss=a}get sub(){return this.#j.sub}set sub(a){this.#j.sub=a}get aud(){return this.#j.aud}set aud(a){this.#j.aud=a}set jti(a){this.#j.jti=a}set nbf(a){"number"==typeof a?this.#j.nbf=dp("setNotBefore",a):a instanceof Date?this.#j.nbf=dp("setNotBefore",dl(a)):this.#j.nbf=dl(new Date)+dn(a)}set exp(a){"number"==typeof a?this.#j.exp=dp("setExpirationTime",a):a instanceof Date?this.#j.exp=dp("setExpirationTime",dl(a)):this.#j.exp=dl(new Date)+dn(a)}set iat(a){void 0===a?this.#j.iat=dl(new Date):a instanceof Date?this.#j.iat=dp("setIssuedAt",dl(a)):"string"==typeof a?this.#j.iat=dp("setIssuedAt",dl(new Date)+dn(a)):this.#j.iat=dp("setIssuedAt",a)}}class dt{#f;#g;#h;#b;#k;#l;#m;#n;constructor(a={}){this.#n=new ds(a)}setIssuer(a){return this.#n.iss=a,this}setSubject(a){return this.#n.sub=a,this}setAudience(a){return this.#n.aud=a,this}setJti(a){return this.#n.jti=a,this}setNotBefore(a){return this.#n.nbf=a,this}setExpirationTime(a){return this.#n.exp=a,this}setIssuedAt(a){return this.#n.iat=a,this}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setKeyManagementParameters(a){if(this.#h)throw TypeError("setKeyManagementParameters can only be called once");return this.#h=a,this}setContentEncryptionKey(a){if(this.#f)throw TypeError("setContentEncryptionKey can only be called once");return this.#f=a,this}setInitializationVector(a){if(this.#g)throw TypeError("setInitializationVector can only be called once");return this.#g=a,this}replicateIssuerAsHeader(){return this.#k=!0,this}replicateSubjectAsHeader(){return this.#l=!0,this}replicateAudienceAsHeader(){return this.#m=!0,this}async encrypt(a,b){let c=new dk(this.#n.data());return this.#b&&(this.#k||this.#l||this.#m)&&(this.#b={...this.#b,iss:this.#k?this.#n.iss:void 0,sub:this.#l?this.#n.sub:void 0,aud:this.#m?this.#n.aud:void 0}),c.setProtectedHeader(this.#b),this.#g&&c.setInitializationVector(this.#g),this.#f&&c.setContentEncryptionKey(this.#f),this.#h&&c.setKeyManagementParameters(this.#h),c.encrypt(a,b)}}function du(a,b){let c=`SHA-${a.slice(-3)}`;switch(a){case"HS256":case"HS384":case"HS512":return{hash:c,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:c,name:"RSA-PSS",saltLength:parseInt(a.slice(-3),10)>>3};case"RS256":case"RS384":case"RS512":return{hash:c,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:c,name:"ECDSA",namedCurve:b.namedCurve};case"Ed25519":case"EdDSA":return{name:"Ed25519"};case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":return{name:a};default:throw new ci(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}async function dv(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(cB(b,"CryptoKey","KeyObject","JSON Web Key"));return crypto.subtle.importKey("raw",b,{hash:`SHA-${a.slice(-3)}`,name:"HMAC"},!1,[c])}return!function(a,b,c){switch(b){case"HS256":case"HS384":case"HS512":{if("HMAC"!==a.algorithm.name)throw cw("HMAC");let c=parseInt(b.slice(2),10);if(cx(a.algorithm.hash)!==c)throw cw(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if("RSASSA-PKCS1-v1_5"!==a.algorithm.name)throw cw("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(cx(a.algorithm.hash)!==c)throw cw(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if("RSA-PSS"!==a.algorithm.name)throw cw("RSA-PSS");let c=parseInt(b.slice(2),10);if(cx(a.algorithm.hash)!==c)throw cw(`SHA-${c}`,"algorithm.hash");break}case"Ed25519":case"EdDSA":if("Ed25519"!==a.algorithm.name)throw cw("Ed25519");break;case"ML-DSA-44":case"ML-DSA-65":case"ML-DSA-87":let d;if(d=a.algorithm,d.name!==b)throw cw(b);break;case"ES256":case"ES384":case"ES512":{if("ECDSA"!==a.algorithm.name)throw cw("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw cw(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}cy(a,c)}(b,a,c),b}async function dw(a,b,c){let d=await dv(a,b,"sign");return cW(a,d),new Uint8Array(await crypto.subtle.sign(du(a,d.algorithm),d,c))}class dx{#j;#b;#d;constructor(a){if(!(a instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this.#j=a}setProtectedHeader(a){if(this.#b)throw TypeError("setProtectedHeader can only be called once");return this.#b=a,this}setUnprotectedHeader(a){if(this.#d)throw TypeError("setUnprotectedHeader can only be called once");return this.#d=a,this}async sign(a,b){let c,d,e,f;if(!this.#b&&!this.#d)throw new cl("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!de(this.#b,this.#d))throw new cl("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...this.#b,...this.#d},h=df(cl,new Map([["b64",!0]]),b?.crit,this.#b,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=this.#b.b64))throw new cl('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new cl('JWS "alg" (Algorithm) Header Parameter missing or invalid');di(j,a,"sign"),i?d=ca(c=cc(this.#j)):(d=this.#j,c=""),this.#b?f=ca(e=cc(JSON.stringify(this.#b))):(e="",f=new Uint8Array);let k=b6(f,ca("."),d),l=await c2(a,j),m={signature:cc(await dw(j,l,k)),payload:c};return this.#d&&(m.header=this.#d),this.#b&&(m.protected=e),m}}class dy{#i;constructor(a){this.#i=new dx(a)}setProtectedHeader(a){return this.#i.setProtectedHeader(a),this}async sign(a,b){let c=await this.#i.sign(a,b);if(void 0===c.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${c.protected}.${c.payload}.${c.signature}`}}class dz{#b;#n;constructor(a={}){this.#n=new ds(a)}setIssuer(a){return this.#n.iss=a,this}setSubject(a){return this.#n.sub=a,this}setAudience(a){return this.#n.aud=a,this}setJti(a){return this.#n.jti=a,this}setNotBefore(a){return this.#n.nbf=a,this}setExpirationTime(a){return this.#n.exp=a,this}setIssuedAt(a){return this.#n.iat=a,this}setProtectedHeader(a){return this.#b=a,this}async sign(a,b){let c=new dy(this.#n.data());if(c.setProtectedHeader(this.#b),Array.isArray(this.#b?.crit)&&this.#b.crit.includes("b64")&&!1===this.#b.b64)throw new cm("JWTs MUST NOT use unencoded payload");return c.sign(a,b)}}var dA=a.i(9634),dA=dA;let dB=(a,b)=>{if("string"!=typeof a||!a)throw new cn(`${b} missing or invalid`)};async function dC(a,b){let c,d;if(c_(a))c=a;else if(cG(a))c=await c6(a);else throw TypeError(cB(a,"CryptoKey","KeyObject","JSON Web Key"));if("sha256"!==(b??="sha256")&&"sha384"!==b&&"sha512"!==b)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(c.kty){case"AKP":dB(c.alg,'"alg" (Algorithm) Parameter'),dB(c.pub,'"pub" (Public key) Parameter'),d={alg:c.alg,kty:c.kty,pub:c.pub};break;case"EC":dB(c.crv,'"crv" (Curve) Parameter'),dB(c.x,'"x" (X Coordinate) Parameter'),dB(c.y,'"y" (Y Coordinate) Parameter'),d={crv:c.crv,kty:c.kty,x:c.x,y:c.y};break;case"OKP":dB(c.crv,'"crv" (Subtype of Key Pair) Parameter'),dB(c.x,'"x" (Public Key) Parameter'),d={crv:c.crv,kty:c.kty,x:c.x};break;case"RSA":dB(c.e,'"e" (Exponent) Parameter'),dB(c.n,'"n" (Modulus) Parameter'),d={e:c.e,kty:c.kty,n:c.n};break;case"oct":dB(c.k,'"k" (Key Value) Parameter'),d={k:c.k,kty:c.kty};break;default:throw new ci('"kty" (Key Type) Parameter missing or unsupported')}let e=ca(JSON.stringify(d));return cc(await cO(b,e))}async function dD(a,b,c){let d;if(!c$(a))throw TypeError("JWK must be an object");switch(b??=a.alg,d??=c?.extractable??a.ext,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return cb(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new ci('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');return c0({...a,alg:b,ext:d});case"AKP":if("string"!=typeof a.alg||!a.alg)throw TypeError('missing "alg" (Algorithm) Parameter value');if(void 0!==b&&b!==a.alg)throw TypeError("JWK alg and alg option value mismatch");return c0({...a,ext:d});case"EC":case"OKP":return c0({...a,alg:b,ext:d});default:throw new ci('Unsupported "kty" (Key Type) Parameter value')}}async function dE(a,b,c,d,e){switch(a){case"dir":if(void 0!==c)throw new ck("Encountered unexpected JWE Encrypted Key");return b;case"ECDH-ES":if(void 0!==c)throw new ck("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e,f;if(!c$(d.epk))throw new ck('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(cD(b),!cS(b))throw new ci("ECDH with the provided key is not allowed or not supported by your javascript runtime");let g=await dD(d.epk,a);if(cD(g),void 0!==d.apu){if("string"!=typeof d.apu)throw new ck('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{e=cb(d.apu)}catch{throw new ck("Failed to base64url decode the apu")}}if(void 0!==d.apv){if("string"!=typeof d.apv)throw new ck('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{f=cb(d.apv)}catch{throw new ck("Failed to base64url decode the apv")}}let h=await cR(g,b,"ECDH-ES"===a?d.enc:a,"ECDH-ES"===a?c3(d.enc):parseInt(a.slice(-5,-2),10),e,f);if("ECDH-ES"===a)return h;if(void 0===c)throw new ck("JWE Encrypted Key missing");return cN(a.slice(-6),h,c)}case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===c)throw new ck("JWE Encrypted Key missing");return cD(b),cZ(a,b,c);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let f;if(void 0===c)throw new ck("JWE Encrypted Key missing");if("number"!=typeof d.p2c)throw new ck('JOSE Header "p2c" (PBES2 Count) missing or invalid');let g=e?.maxPBES2Count||1e4;if(d.p2c>g)throw new ck('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof d.p2s)throw new ck('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{f=cb(d.p2s)}catch{throw new ck("Failed to base64url decode the p2s")}return cV(a,b,c,d.p2c,f)}case"A128KW":case"A192KW":case"A256KW":if(void 0===c)throw new ck("JWE Encrypted Key missing");return cN(a,b,c);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let e,f;if(void 0===c)throw new ck("JWE Encrypted Key missing");if("string"!=typeof d.iv)throw new ck('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof d.tag)throw new ck('JOSE Header "tag" (Authentication Tag) missing or invalid');try{e=cb(d.iv)}catch{throw new ck("Failed to base64url decode the iv")}try{f=cb(d.tag)}catch{throw new ck("Failed to base64url decode the tag")}return dc(a,b,c,e,f)}default:throw new ci('Invalid or unsupported "alg" (JWE Algorithm) header value')}}function dF(a,b){if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)}async function dG(a,b,c){let d,e,f,g,h,i,j;if(!c$(a))throw new ck("Flattened JWE must be an object");if(void 0===a.protected&&void 0===a.header&&void 0===a.unprotected)throw new ck("JOSE Header missing");if(void 0!==a.iv&&"string"!=typeof a.iv)throw new ck("JWE Initialization Vector incorrect type");if("string"!=typeof a.ciphertext)throw new ck("JWE Ciphertext missing or incorrect type");if(void 0!==a.tag&&"string"!=typeof a.tag)throw new ck("JWE Authentication Tag incorrect type");if(void 0!==a.protected&&"string"!=typeof a.protected)throw new ck("JWE Protected Header incorrect type");if(void 0!==a.encrypted_key&&"string"!=typeof a.encrypted_key)throw new ck("JWE Encrypted Key incorrect type");if(void 0!==a.aad&&"string"!=typeof a.aad)throw new ck("JWE AAD incorrect type");if(void 0!==a.header&&!c$(a.header))throw new ck("JWE Shared Unprotected Header incorrect type");if(void 0!==a.unprotected&&!c$(a.unprotected))throw new ck("JWE Per-Recipient Unprotected Header incorrect type");if(a.protected)try{let b=cb(a.protected);d=JSON.parse(b5.decode(b))}catch{throw new ck("JWE Protected Header is invalid")}if(!de(d,a.header,a.unprotected))throw new ck("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let k={...d,...a.header,...a.unprotected};if(df(ck,new Map,c?.crit,d,k),void 0!==k.zip)throw new ci('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:l,enc:m}=k;if("string"!=typeof l||!l)throw new ck("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof m||!m)throw new ck("missing JWE Encryption Algorithm (enc) in JWE Header");let n=c&&dF("keyManagementAlgorithms",c.keyManagementAlgorithms),o=c&&dF("contentEncryptionAlgorithms",c.contentEncryptionAlgorithms);if(n&&!n.has(l)||!n&&l.startsWith("PBES2"))throw new ch('"alg" (Algorithm) Header Parameter value not allowed');if(o&&!o.has(m))throw new ch('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==a.encrypted_key)try{e=cb(a.encrypted_key)}catch{throw new ck("Failed to base64url decode the encrypted_key")}let p=!1;"function"==typeof b&&(b=await b(d,a),p=!0),di("dir"===l?m:l,b,"decrypt");let q=await c2(b,l);try{f=await dE(l,q,e,k,c)}catch(a){if(a instanceof TypeError||a instanceof ck||a instanceof ci)throw a;f=c4(m)}if(void 0!==a.iv)try{g=cb(a.iv)}catch{throw new ck("Failed to base64url decode the iv")}if(void 0!==a.tag)try{h=cb(a.tag)}catch{throw new ck("Failed to base64url decode the tag")}let r=void 0!==a.protected?ca(a.protected):new Uint8Array;i=void 0!==a.aad?b6(r,ca("."),ca(a.aad)):r;try{j=cb(a.ciphertext)}catch{throw new ck("Failed to base64url decode the ciphertext")}let s={plaintext:await da(m,f,j,g,h,i)};if(void 0!==a.protected&&(s.protectedHeader=d),void 0!==a.aad)try{s.additionalAuthenticatedData=cb(a.aad)}catch{throw new ck("Failed to base64url decode the aad")}return(void 0!==a.unprotected&&(s.sharedUnprotectedHeader=a.unprotected),void 0!==a.header&&(s.unprotectedHeader=a.header),p)?{...s,key:q}:s}async function dH(a,b,c){if(a instanceof Uint8Array&&(a=b5.decode(a)),"string"!=typeof a)throw new ck("Compact JWE must be a string or Uint8Array");let{0:d,1:e,2:f,3:g,4:h,length:i}=a.split(".");if(5!==i)throw new ck("Invalid Compact JWE");let j=await dG({ciphertext:g,iv:f||void 0,protected:d,tag:h||void 0,encrypted_key:e||void 0},b,c),k={plaintext:j.plaintext,protectedHeader:j.protectedHeader};return"function"==typeof b?{...k,key:j.key}:k}async function dI(a,b,c){let d=await dH(a,b,c),e=dr(d.protectedHeader,d.plaintext,c),{protectedHeader:f}=d;if(void 0!==f.iss&&f.iss!==e.iss)throw new cf('replicated "iss" claim header parameter mismatch',e,"iss","mismatch");if(void 0!==f.sub&&f.sub!==e.sub)throw new cf('replicated "sub" claim header parameter mismatch',e,"sub","mismatch");if(void 0!==f.aud&&JSON.stringify(f.aud)!==JSON.stringify(e.aud))throw new cf('replicated "aud" claim header parameter mismatch',e,"aud","mismatch");let g={payload:e,protectedHeader:f};return"function"==typeof b?{...g,key:d.key}:g}async function dJ(a,b,c,d){let e=await dv(a,b,"verify");cW(a,e);let f=du(a,e.algorithm);try{return await crypto.subtle.verify(f,e,c,d)}catch{return!1}}async function dK(a,b,c){let d,e;if(!c$(a))throw new cl("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new cl('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new cl("JWS Protected Header incorrect type");if(void 0===a.payload)throw new cl("JWS Payload missing");if("string"!=typeof a.signature)throw new cl("JWS Signature missing or incorrect type");if(void 0!==a.header&&!c$(a.header))throw new cl("JWS Unprotected Header incorrect type");let f={};if(a.protected)try{let b=cb(a.protected);f=JSON.parse(b5.decode(b))}catch{throw new cl("JWS Protected Header is invalid")}if(!de(f,a.header))throw new cl("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let g={...f,...a.header},h=df(cl,new Map([["b64",!0]]),c?.crit,f,g),i=!0;if(h.has("b64")&&"boolean"!=typeof(i=f.b64))throw new cl('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:j}=g;if("string"!=typeof j||!j)throw new cl('JWS "alg" (Algorithm) Header Parameter missing or invalid');let k=c&&dF("algorithms",c.algorithms);if(k&&!k.has(j))throw new ch('"alg" (Algorithm) Header Parameter value not allowed');if(i){if("string"!=typeof a.payload)throw new cl("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new cl("JWS Payload must be a string or an Uint8Array instance");let l=!1;"function"==typeof b&&(b=await b(f,a),l=!0),di(j,b,"verify");let m=b6(void 0!==a.protected?ca(a.protected):new Uint8Array,ca("."),"string"==typeof a.payload?i?ca(a.payload):b4.encode(a.payload):a.payload);try{d=cb(a.signature)}catch{throw new cl("Failed to base64url decode the signature")}let n=await c2(b,j);if(!await dJ(j,n,d,m))throw new cs;if(i)try{e=cb(a.payload)}catch{throw new cl("Failed to base64url decode the payload")}else e="string"==typeof a.payload?b4.encode(a.payload):a.payload;let o={payload:e};return(void 0!==a.protected&&(o.protectedHeader=f),void 0!==a.header&&(o.unprotectedHeader=a.header),l)?{...o,key:n}:o}async function dL(a,b,c){if(a instanceof Uint8Array&&(a=b5.decode(a)),"string"!=typeof a)throw new cl("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:f,length:g}=a.split(".");if(3!==g)throw new cl("Invalid Compact JWS");let h=await dK({payload:e,protected:d,signature:f},b,c),i={payload:h.payload,protectedHeader:h.protectedHeader};return"function"==typeof b?{...i,key:h.key}:i}async function dM(a,b,c){let d=await dL(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new cm("JWTs MUST NOT use unencoded payload");let e={payload:dr(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}async function dN(a,b,c=3600){return await new dz(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime(Math.floor(Date.now()/1e3)+c).sign(new TextEncoder().encode(b))}async function dO(a,b){try{return(await dM(a,new TextEncoder().encode(b))).payload}catch{return null}}let dP=new Uint8Array([66,101,116,116,101,114,65,117,116,104,46,106,115,32,71,101,110,101,114,97,116,101,100,32,69,110,99,114,121,112,116,105,111,110,32,75,101,121]),dQ="A256CBC-HS512";async function dR(a,b,c,d=3600){let e=bO(b3,new TextEncoder().encode(b),new TextEncoder().encode(c),dP,64),f=await dC({kty:"oct",k:dA.encode(e)},"sha256");return await new dt(a).setProtectedHeader({alg:"dir",enc:dQ,kid:f}).setIssuedAt().setExpirationTime((Date.now()/1e3|0)+d).setJti(crypto.randomUUID()).encrypt(e)}async function dS(a,b,c){if(!a)return null;try{let{payload:d}=await dI(a,async({kid:a})=>{let d=bO(b3,new TextEncoder().encode(b),new TextEncoder().encode(c),dP,64);if(void 0===a||a===await dC({kty:"oct",k:dA.encode(d)},"sha256"))return d;throw Error("no matching decryption secret")},{clockTolerance:15,keyManagementAlgorithms:["dir"],contentEncryptionAlgorithms:[dQ,"A256GCM"]});return d}catch{return null}}var dT=a.i(91511);let dU=a=>{if("string"==typeof a&&(a=new TextEncoder().encode(a)),0===a.byteLength)return"";let b=new Uint8Array(a),c="";for(let a of b)c+=a.toString(16).padStart(2,"0");return c};function dV(a,b,c,d){var e;let f,{c:g,dkLen:h,DK:i,PRF:j,PRFSalt:k}=function(a,b,c,d){bw(a);let{c:e,dkLen:f,asyncTick:g}=bJ({dkLen:32,asyncTick:10},d);if(bu(e,"c"),bu(f,"dkLen"),bu(g,"asyncTick"),e<1)throw Error("iterations (c) must be >= 1");let h=bI(b,"password"),i=bI(c,"salt"),j=new Uint8Array(f),k=bL.create(a,h),l=k._cloneInto().update(i);return{c:e,dkLen:f,asyncTick:g,DK:j,PRF:k,PRFSalt:l}}(a,b,c,d),l=new Uint8Array(4),m=bA(l),n=new Uint8Array(j.outputLen);for(let a=1,b=0;b<h;a++,b+=j.outputLen){let c=i.subarray(b,b+j.outputLen);m.setInt32(0,a,!1),(f=k._cloneInto(f)).update(l).digestInto(n),c.set(n.subarray(0,c.length));for(let a=1;a<g;a++){j._cloneInto(f).update(n).digestInto(n);for(let a=0;a<c.length;a++)c[a]^=n[a]}}return e=f,j.destroy(),k.destroy(),e&&e.destroy(),bz(n),i}function dW(a,b,c,d,e,f){let g=a[b++]^c[d++],h=a[b++]^c[d++],i=a[b++]^c[d++],j=a[b++]^c[d++],k=a[b++]^c[d++],l=a[b++]^c[d++],m=a[b++]^c[d++],n=a[b++]^c[d++],o=a[b++]^c[d++],p=a[b++]^c[d++],q=a[b++]^c[d++],r=a[b++]^c[d++],s=a[b++]^c[d++],t=a[b++]^c[d++],u=a[b++]^c[d++],v=a[b++]^c[d++],w=g,x=h,y=i,z=j,A=k,B=l,C=m,D=n,E=o,F=p,G=q,H=r,I=s,J=t,K=u,L=v;for(let a=0;a<8;a+=2)A^=bC(w+I|0,7),E^=bC(A+w|0,9),I^=bC(E+A|0,13),w^=bC(I+E|0,18),F^=bC(B+x|0,7),J^=bC(F+B|0,9),x^=bC(J+F|0,13),B^=bC(x+J|0,18),K^=bC(G+C|0,7),y^=bC(K+G|0,9),C^=bC(y+K|0,13),G^=bC(C+y|0,18),z^=bC(L+H|0,7),D^=bC(z+L|0,9),H^=bC(D+z|0,13),L^=bC(H+D|0,18),x^=bC(w+z|0,7),y^=bC(x+w|0,9),z^=bC(y+x|0,13),w^=bC(z+y|0,18),C^=bC(B+A|0,7),D^=bC(C+B|0,9),A^=bC(D+C|0,13),B^=bC(A+D|0,18),H^=bC(G+F|0,7),E^=bC(H+G|0,9),F^=bC(E+H|0,13),G^=bC(F+E|0,18),I^=bC(L+K|0,7),J^=bC(I+L|0,9),K^=bC(J+I|0,13),L^=bC(K+J|0,18);e[f++]=g+w|0,e[f++]=h+x|0,e[f++]=i+y|0,e[f++]=j+z|0,e[f++]=k+A|0,e[f++]=l+B|0,e[f++]=m+C|0,e[f++]=n+D|0,e[f++]=o+E|0,e[f++]=p+F|0,e[f++]=q+G|0,e[f++]=r+H|0,e[f++]=s+I|0,e[f++]=t+J|0,e[f++]=u+K|0,e[f++]=v+L|0}function dX(a,b,c,d,e){let f=d+0,g=d+16*e;for(let d=0;d<16;d++)c[g+d]=a[b+(2*e-1)*16+d];for(let d=0;d<e;d++,f+=16,b+=16)dW(c,g,a,b,c,f),d>0&&(g+=16),dW(c,f,a,b+=16,c,g)}async function dY(a,b,c){let d,{N:e,r:f,p:g,dkLen:h,blockSize32:i,V:j,B32:k,B:l,tmp:m,blockMixCb:n,asyncTick:o}=function(a,b,c){let{N:d,r:e,p:f,dkLen:g,asyncTick:h,maxmem:i,onProgress:j}=bJ({dkLen:32,asyncTick:10,maxmem:0x40000400},c);if(bu(d,"N"),bu(e,"r"),bu(f,"p"),bu(g,"dkLen"),bu(h,"asyncTick"),bu(i,"maxmem"),void 0!==j&&"function"!=typeof j)throw Error("progressCb must be a function");let k=128*e,l=k/4;if(d<=1||(d&d-1)!=0||d>0x100000000)throw Error('"N" expected a power of 2, and 2^1 <= N <= 2^32');if(f<1||f>0x1fffffffe0/k)throw Error('"p" expected integer 1..((2^32 - 1) * 32) / (128 * r)');if(g<1||g>0x1fffffffe0)throw Error('"dkLen" expected integer 1..(2^32 - 1) * 32');if(k*(d+f)>i)throw Error('"maxmem" limit was hit, expected 128*r*(N+p) <= "maxmem"='+i);let m=dV(b3,a,b,{c:1,dkLen:k*f}),n=by(m),o=by(new Uint8Array(k*d)),p=by(new Uint8Array(k)),q=()=>{};if(j){let a=2*d*f,b=Math.max(Math.floor(a/1e4),1),c=0;q=()=>{c++,j&&(!(c%b)||c===a)&&j(c/a)}}return{N:d,r:e,p:f,dkLen:g,blockSize32:l,V:o,B32:n,B:m,tmp:p,blockMixCb:q,asyncTick:h}}(a,b,c);bD(k);for(let a=0;a<g;a++){let b=i*a;for(let a=0;a<i;a++)j[a]=k[b+a];let c=0;await bH(e-1,o,()=>{dX(j,c,j,c+=i,f),n()}),dX(j,(e-1)*i,k,b,f),n(),await bH(e,o,()=>{let a=(k[b+i-16]&e-1)>>>0;for(let c=0;c<i;c++)m[c]=k[b+c]^j[a*i+c];dX(m,0,k,b,f),n()})}return bD(k),d=dV(b3,a,l,{c:1,dkLen:h}),bz(l,j,m),d}async function dZ(a,b){return await dY(a.normalize("NFKC"),b,{N:16384,p:1,r:16,dkLen:64,maxmem:0x4000000})}let d$=async a=>{let b=dU(crypto.getRandomValues(new Uint8Array(16))),c=await dZ(a,b);return`${b}:${dU(c)}`},d_=async({hash:a,password:b})=>{let[c,d]=a.split(":");if(!c||!d)throw new dT.BetterAuthError("Invalid password hash");return function(a,b){"string"==typeof a&&(a=new TextEncoder().encode(a)),"string"==typeof b&&(b=new TextEncoder().encode(b));let c=new Uint8Array(a),d=new Uint8Array(b),e=c.length^d.length,f=Math.max(c.length,d.length);for(let a=0;a<f;a++)e|=(a<c.length?c[a]:0)^(a<d.length?d[a]:0);return 0===e}(await dZ(b,c),function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(bE)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=bF(a.charCodeAt(e)),f=bF(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(d))};function d0(){let a="u">typeof globalThis&&globalThis.crypto;if(a&&"object"==typeof a.subtle&&null!=a.subtle)return a.subtle;throw Error("crypto.subtle must be defined")}function d1(a){return a?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}function d2(a,b,c){let d="",e=0,f=0;for(let c of a)for(e=e<<8|c,f+=8;f>=6;)f-=6,d+=b[e>>f&63];if(f>0&&(d+=b[e<<6-f&63]),c){let a=(4-d.length%4)%4;d+="=".repeat(a)}return d}function d3(a,b){let c=new Map;for(let a=0;a<b.length;a++)c.set(b[a],a);let d=[],e=0,f=0;for(let b of a){if("="===b)break;let a=c.get(b);if(void 0===a)throw Error(`Invalid Base64 character: ${b}`);e=e<<6|a,(f+=6)>=8&&(f-=8,d.push(e>>f&255))}return Uint8Array.from(d)}let d4={encode(a,b={}){let c=d1(!1);return d2("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){"string"!=typeof a&&(a=new TextDecoder().decode(a));let b=d1(a.includes("-")||a.includes("_"));return d3(a,b)}},d5={encode(a,b={}){let c=d1(!0);return d2("string"==typeof a?new TextEncoder().encode(a):new Uint8Array(a),c,b.padding??!0)},decode(a){let b=d1(a.includes("-")||a.includes("_"));return d3(a,b)}};function d6(a,b){return{digest:async c=>{let d=new TextEncoder,e="string"==typeof c?d.encode(c):c,f=await d0().digest(a,e);return"hex"===b?Array.from(new Uint8Array(f)).map(a=>a.toString(16).padStart(2,"0")).join(""):"base64"===b||"base64url"===b||"base64urlnopad"===b?b.includes("url")?d5.encode(f,{padding:"base64urlnopad"!==b}):d4.encode(f):f}}}function d7(a){if("boolean"!=typeof a)throw Error(`boolean expected, not ${a}`)}function d8(a){if(!Number.isSafeInteger(a)||a<0)throw Error("positive integer expected, got "+a)}function d9(a,b,c=""){let d=a instanceof Uint8Array||ArrayBuffer.isView(a)&&"Uint8Array"===a.constructor.name,e=a?.length,f=void 0!==b;if(!d||f&&e!==b)throw Error((c&&`"${c}" `)+"expected Uint8Array"+(f?` of length ${b}`:"")+", got "+(d?`length=${e}`:`type=${typeof a}`));return a}function ea(a,b=!0){if(a.destroyed)throw Error("Hash instance has been destroyed");if(b&&a.finished)throw Error("Hash#digest() has already been called")}function eb(a){return new Uint32Array(a.buffer,a.byteOffset,Math.floor(a.byteLength/4))}function ec(...a){for(let b=0;b<a.length;b++)a[b].fill(0)}let ed=68===new Uint8Array(new Uint32Array([0x11223344]).buffer)[0],ee="function"==typeof Uint8Array.from([]).toHex&&"function"==typeof Uint8Array.fromHex,ef=Array.from({length:256},(a,b)=>b.toString(16).padStart(2,"0"));function eg(a){return a>=48&&a<=57?a-48:a>=65&&a<=70?a-55:a>=97&&a<=102?a-87:void 0}function eh(a,b,c=!0){if(void 0===b)return new Uint8Array(a);if(b.length!==a)throw Error('"output" expected Uint8Array of length '+a+", got: "+b.length);if(c&&b.byteOffset%4!=0)throw Error("invalid output, must be aligned");return b}function ei(a){return Uint8Array.from(a)}function ej(a=32){let b="object"==typeof globalThis?globalThis.crypto:null;if("function"!=typeof b?.getRandomValues)throw Error("crypto.getRandomValues must be defined");return b.getRandomValues(new Uint8Array(a))}function ek(a,b=ej){let{nonceLength:c}=a;d8(c);let d=(a,b)=>{let c=function(...a){let b=0;for(let c=0;c<a.length;c++){let d=a[c];d9(d),b+=d.length}let c=new Uint8Array(b);for(let b=0,d=0;b<a.length;b++){let e=a[b];c.set(e,d),d+=e.length}return c}(a,b);return b.fill(0),c};return(e,...f)=>({encrypt(g){d9(g);let h=b(c),i=a(e,h,...f).encrypt(g);return i instanceof Promise?i.then(a=>d(h,a)):d(h,i)},decrypt(b){d9(b);let d=b.subarray(0,c),g=b.subarray(c);return a(e,d,...f).decrypt(g)}})}let el=a=>Uint8Array.from(a.split(""),a=>a.charCodeAt(0)),em=el("expand 16-byte k"),en=el("expand 32-byte k"),eo=eb(em),ep=eb(en);function eq(a,b){return a<<b|a>>>32-b}function er(a){return a.byteOffset%4==0}let es=0x100000000-1,et=Uint32Array.of();function eu(a,b){let{allowShortKeys:c,extendNonceFn:d,counterLength:e,counterRight:f,rounds:g}=function(a,b){if(null==b||"object"!=typeof b)throw Error("options must be defined");return Object.assign(a,b)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},b);if("function"!=typeof a)throw Error("core must be a function");return d8(e),d8(g),d7(f),d7(c),(b,h,i,j,k=0)=>{let l,m;d9(b,void 0,"key"),d9(h,void 0,"nonce"),d9(i,void 0,"data");let n=i.length;if(void 0===j&&(j=new Uint8Array(n)),d9(j,void 0,"output"),d8(k),k<0||k>=es)throw Error("arx: counter overflow");if(j.length<n)throw Error(`arx: output (${j.length}) is shorter than data (${n})`);let o=[],p=b.length;if(32===p)o.push(l=ei(b)),m=ep;else if(16===p&&c)(l=new Uint8Array(32)).set(b),l.set(b,16),m=eo,o.push(l);else throw d9(b,32,"arx key"),Error("invalid key size");er(h)||o.push(h=ei(h));let q=eb(l);if(d){if(24!==h.length)throw Error("arx: extended nonce must be 24 bytes");d(m,q,eb(h.subarray(0,16)),q),h=h.subarray(16)}let r=16-e;if(r!==h.length)throw Error(`arx: nonce must be ${r} or 16 bytes`);if(12!==r){let a=new Uint8Array(12);a.set(h,f?0:12-h.length),h=a,o.push(h)}return!function(a,b,c,d,e,f,g,h){let i=e.length,j=new Uint8Array(64),k=eb(j),l=er(e)&&er(f),m=l?eb(e):et,n=l?eb(f):et;for(let o=0;o<i;g++){if(a(b,c,d,k,g,h),g>=es)throw Error("arx: counter overflow");let p=Math.min(64,i-o);if(l&&64===p){let a=o/4;if(o%4!=0)throw Error("arx: invalid block position");for(let b=0,c;b<16;b++)n[c=a+b]=m[c]^k[b];o+=64;continue}for(let a=0,b;a<p;a++)f[b=o+a]=e[b]^j[a];o+=p}}(a,m,q,eb(h),i,j,k,g),ec(...o),j}}function ev(a,b){return 255&a[b++]|(255&a[b++])<<8}class ew{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(a){const b=ev(a=ei(d9(a,32,"key")),0),c=ev(a,2),d=ev(a,4),e=ev(a,6),f=ev(a,8),g=ev(a,10),h=ev(a,12),i=ev(a,14);this.r[0]=8191&b,this.r[1]=(b>>>13|c<<3)&8191,this.r[2]=(c>>>10|d<<6)&7939,this.r[3]=(d>>>7|e<<9)&8191,this.r[4]=(e>>>4|f<<12)&255,this.r[5]=f>>>1&8190,this.r[6]=(f>>>14|g<<2)&8191,this.r[7]=(g>>>11|h<<5)&8065,this.r[8]=(h>>>8|i<<8)&8191,this.r[9]=i>>>5&127;for(let b=0;b<8;b++)this.pad[b]=ev(a,16+2*b)}process(a,b,c=!1){let{h:d,r:e}=this,f=e[0],g=e[1],h=e[2],i=e[3],j=e[4],k=e[5],l=e[6],m=e[7],n=e[8],o=e[9],p=ev(a,b+0),q=ev(a,b+2),r=ev(a,b+4),s=ev(a,b+6),t=ev(a,b+8),u=ev(a,b+10),v=ev(a,b+12),w=ev(a,b+14),x=d[0]+(8191&p),y=d[1]+((p>>>13|q<<3)&8191),z=d[2]+((q>>>10|r<<6)&8191),A=d[3]+((r>>>7|s<<9)&8191),B=d[4]+((s>>>4|t<<12)&8191),C=d[5]+(t>>>1&8191),D=d[6]+((t>>>14|u<<2)&8191),E=d[7]+((u>>>11|v<<5)&8191),F=d[8]+((v>>>8|w<<8)&8191),G=d[9]+(w>>>5|2048*!c),H=0,I=0+x*f+5*o*y+5*n*z+5*m*A+5*l*B;H=I>>>13,I&=8191,I+=5*k*C+5*j*D+5*i*E+5*h*F+5*g*G,H+=I>>>13,I&=8191;let J=H+x*g+y*f+5*o*z+5*n*A+5*m*B;H=J>>>13,J&=8191,J+=5*l*C+5*k*D+5*j*E+5*i*F+5*h*G,H+=J>>>13,J&=8191;let K=H+x*h+y*g+z*f+5*o*A+5*n*B;H=K>>>13,K&=8191,K+=5*m*C+5*l*D+5*k*E+5*j*F+5*i*G,H+=K>>>13,K&=8191;let L=H+x*i+y*h+z*g+A*f+5*o*B;H=L>>>13,L&=8191,L+=5*n*C+5*m*D+5*l*E+5*k*F+5*j*G,H+=L>>>13,L&=8191;let M=H+x*j+y*i+z*h+A*g+B*f;H=M>>>13,M&=8191,M+=5*o*C+5*n*D+5*m*E+5*l*F+5*k*G,H+=M>>>13,M&=8191;let N=H+x*k+y*j+z*i+A*h+B*g;H=N>>>13,N&=8191,N+=C*f+5*o*D+5*n*E+5*m*F+5*l*G,H+=N>>>13,N&=8191;let O=H+x*l+y*k+z*j+A*i+B*h;H=O>>>13,O&=8191,O+=C*g+D*f+5*o*E+5*n*F+5*m*G,H+=O>>>13,O&=8191;let P=H+x*m+y*l+z*k+A*j+B*i;H=P>>>13,P&=8191,P+=C*h+D*g+E*f+5*o*F+5*n*G,H+=P>>>13,P&=8191;let Q=H+x*n+y*m+z*l+A*k+B*j;H=Q>>>13,Q&=8191,Q+=C*i+D*h+E*g+F*f+5*o*G,H+=Q>>>13,Q&=8191;let R=H+x*o+y*n+z*m+A*l+B*k;H=R>>>13,R&=8191,R+=C*j+D*i+E*h+F*g+G*f,H+=R>>>13,R&=8191,I=8191&(H=(H=(H<<2)+H|0)+I|0),H>>>=13,J+=H,d[0]=I,d[1]=J,d[2]=K,d[3]=L,d[4]=M,d[5]=N,d[6]=O,d[7]=P,d[8]=Q,d[9]=R}finalize(){let{h:a,pad:b}=this,c=new Uint16Array(10),d=a[1]>>>13;a[1]&=8191;for(let b=2;b<10;b++)a[b]+=d,d=a[b]>>>13,a[b]&=8191;a[0]+=5*d,d=a[0]>>>13,a[0]&=8191,a[1]+=d,d=a[1]>>>13,a[1]&=8191,a[2]+=d,c[0]=a[0]+5,d=c[0]>>>13,c[0]&=8191;for(let b=1;b<10;b++)c[b]=a[b]+d,d=c[b]>>>13,c[b]&=8191;c[9]-=8192;let e=(1^d)-1;for(let a=0;a<10;a++)c[a]&=e;e=~e;for(let b=0;b<10;b++)a[b]=a[b]&e|c[b];a[0]=(a[0]|a[1]<<13)&65535,a[1]=(a[1]>>>3|a[2]<<10)&65535,a[2]=(a[2]>>>6|a[3]<<7)&65535,a[3]=(a[3]>>>9|a[4]<<4)&65535,a[4]=(a[4]>>>12|a[5]<<1|a[6]<<14)&65535,a[5]=(a[6]>>>2|a[7]<<11)&65535,a[6]=(a[7]>>>5|a[8]<<8)&65535,a[7]=(a[8]>>>8|a[9]<<5)&65535;let f=a[0]+b[0];a[0]=65535&f;for(let c=1;c<8;c++)f=(a[c]+b[c]|0)+(f>>>16)|0,a[c]=65535&f;ec(c)}update(a){ea(this),d9(a);let{buffer:b,blockLen:c}=this,d=(a=ei(a)).length;for(let e=0;e<d;){let f=Math.min(c-this.pos,d-e);if(f===c){for(;c<=d-e;e+=c)this.process(a,e);continue}b.set(a.subarray(e,e+f),this.pos),this.pos+=f,e+=f,this.pos===c&&(this.process(b,0,!1),this.pos=0)}return this}destroy(){ec(this.h,this.r,this.buffer,this.pad)}digestInto(a){ea(this);d9(a,void 0,"output");let b=this.outputLen;if(a.length<b)throw Error("digestInto() expects output buffer of length at least "+b);this.finished=!0;let{buffer:c,h:d}=this,{pos:e}=this;if(e){for(c[e++]=1;e<16;e++)c[e]=0;this.process(c,0,!0)}this.finalize();let f=0;for(let b=0;b<8;b++)a[f++]=d[b]>>>0,a[f++]=d[b]>>>8;return a}digest(){let{buffer:a,outputLen:b}=this;this.digestInto(a);let c=a.slice(0,b);return this.destroy(),c}}let ex=(m=a=>new ew(a),(g=(a,b)=>m(b).update(a).digest()).outputLen=(h=m(new Uint8Array(32))).outputLen,g.blockLen=h.blockLen,g.create=a=>m(a),g);function ey(a,b,c,d,e,f=20){let g=a[0],h=a[1],i=a[2],j=a[3],k=b[0],l=b[1],m=b[2],n=b[3],o=b[4],p=b[5],q=b[6],r=b[7],s=c[0],t=c[1],u=c[2],v=g,w=h,x=i,y=j,z=k,A=l,B=m,C=n,D=o,E=p,F=q,G=r,H=e,I=s,J=t,K=u;for(let a=0;a<f;a+=2)D=D+(H=eq(H^(v=v+z|0),16))|0,v=v+(z=eq(z^D,12))|0,D=D+(H=eq(H^v,8))|0,z=eq(z^D,7),E=E+(I=eq(I^(w=w+A|0),16))|0,w=w+(A=eq(A^E,12))|0,E=E+(I=eq(I^w,8))|0,A=eq(A^E,7),F=F+(J=eq(J^(x=x+B|0),16))|0,x=x+(B=eq(B^F,12))|0,F=F+(J=eq(J^x,8))|0,B=eq(B^F,7),G=G+(K=eq(K^(y=y+C|0),16))|0,y=y+(C=eq(C^G,12))|0,G=G+(K=eq(K^y,8))|0,C=eq(C^G,7),F=F+(K=eq(K^(v=v+A|0),16))|0,v=v+(A=eq(A^F,12))|0,F=F+(K=eq(K^v,8))|0,A=eq(A^F,7),G=G+(H=eq(H^(w=w+B|0),16))|0,w=w+(B=eq(B^G,12))|0,G=G+(H=eq(H^w,8))|0,B=eq(B^G,7),D=D+(I=eq(I^(x=x+C|0),16))|0,x=x+(C=eq(C^D,12))|0,D=D+(I=eq(I^x,8))|0,C=eq(C^D,7),E=E+(J=eq(J^(y=y+z|0),16))|0,y=y+(z=eq(z^E,12))|0,E=E+(J=eq(J^y,8))|0,z=eq(z^E,7);let L=0;d[L++]=g+v|0,d[L++]=h+w|0,d[L++]=i+x|0,d[L++]=j+y|0,d[L++]=k+z|0,d[L++]=l+A|0,d[L++]=m+B|0,d[L++]=n+C|0,d[L++]=o+D|0,d[L++]=p+E|0,d[L++]=q+F|0,d[L++]=r+G|0,d[L++]=e+H|0,d[L++]=s+I|0,d[L++]=t+J|0,d[L++]=u+K|0}let ez=eu(ey,{counterRight:!1,counterLength:4,allowShortKeys:!1}),eA=eu(ey,{counterRight:!1,counterLength:8,extendNonceFn:function(a,b,c,d){let e=a[0],f=a[1],g=a[2],h=a[3],i=b[0],j=b[1],k=b[2],l=b[3],m=b[4],n=b[5],o=b[6],p=b[7],q=c[0],r=c[1],s=c[2],t=c[3];for(let a=0;a<20;a+=2)m=m+(q=eq(q^(e=e+i|0),16))|0,e=e+(i=eq(i^m,12))|0,m=m+(q=eq(q^e,8))|0,i=eq(i^m,7),n=n+(r=eq(r^(f=f+j|0),16))|0,f=f+(j=eq(j^n,12))|0,n=n+(r=eq(r^f,8))|0,j=eq(j^n,7),o=o+(s=eq(s^(g=g+k|0),16))|0,g=g+(k=eq(k^o,12))|0,o=o+(s=eq(s^g,8))|0,k=eq(k^o,7),p=p+(t=eq(t^(h=h+l|0),16))|0,h=h+(l=eq(l^p,12))|0,p=p+(t=eq(t^h,8))|0,l=eq(l^p,7),o=o+(t=eq(t^(e=e+j|0),16))|0,e=e+(j=eq(j^o,12))|0,o=o+(t=eq(t^e,8))|0,j=eq(j^o,7),p=p+(q=eq(q^(f=f+k|0),16))|0,f=f+(k=eq(k^p,12))|0,p=p+(q=eq(q^f,8))|0,k=eq(k^p,7),m=m+(r=eq(r^(g=g+l|0),16))|0,g=g+(l=eq(l^m,12))|0,m=m+(r=eq(r^g,8))|0,l=eq(l^m,7),n=n+(s=eq(s^(h=h+i|0),16))|0,h=h+(i=eq(i^n,12))|0,n=n+(s=eq(s^h,8))|0,i=eq(i^n,7);let u=0;d[u++]=e,d[u++]=f,d[u++]=g,d[u++]=h,d[u++]=q,d[u++]=r,d[u++]=s,d[u++]=t},allowShortKeys:!1}),eB=new Uint8Array(16),eC=(a,b)=>{a.update(b);let c=b.length%16;c&&a.update(eB.subarray(c))},eD=new Uint8Array(32);function eE(a,b,c,d,e){var f,g;let h,i;void 0!==e&&d9(e,void 0,"AAD");let j=a(b,c,eD),k=(f=d.length,g=e?e.length:0,d7(!0),(i=new DataView((h=new Uint8Array(16)).buffer,h.byteOffset,h.byteLength)).setBigUint64(0,BigInt(g),!0),i.setBigUint64(8,BigInt(f),!0),h),l=ex.create(j);e&&eC(l,e),eC(l,d),l.update(k);let m=l.digest();return ec(j,k),m}let eF=a=>(b,c,d)=>({encrypt(e,f){let g=e.length;(f=eh(g+16,f,!1)).set(e);let h=f.subarray(0,-16);a(b,c,h,h,1);let i=eE(a,b,c,h,d);return f.set(i,g),ec(i),f},decrypt(e,f){f=eh(e.length-16,f,!1);let g=e.subarray(0,-16),h=e.subarray(-16),i=eE(a,b,c,g,d);if(!function(a,b){if(a.length!==b.length)return!1;let c=0;for(let d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c}(h,i))throw Error("invalid tag");return f.set(e.subarray(0,-16)),a(b,c,f,f,1),ec(i),f}});eF(ez);let eG=((a,b)=>{function c(d,...e){if(d9(d,void 0,"key"),!ed)throw Error("Non little-endian hardware is not yet supported");void 0!==a.nonceLength&&d9(e[0],a.varSizeNonce?void 0:a.nonceLength,"nonce");let f=a.tagLength;f&&void 0!==e[1]&&d9(e[1],void 0,"AAD");let g=b(d,...e),h=(a,b)=>{if(void 0!==b){if(2!==a)throw Error("cipher output not supported");d9(b,void 0,"output")}},i=!1;return{encrypt(a,b){if(i)throw Error("cannot encrypt() twice with same key + nonce");return i=!0,d9(a),h(g.encrypt.length,b),g.encrypt(a,b)},decrypt(a,b){if(d9(a),f&&a.length<f)throw Error('"ciphertext" expected length bigger than tagLength='+f);return h(g.decrypt.length,b),g.decrypt(a,b)}}}return Object.assign(c,a),c})({blockSize:64,nonceLength:24,tagLength:16},eF(eA)),eH=async({key:a,data:b})=>{let c=await d6("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("string expected");return new Uint8Array(new TextEncoder().encode(a))}(b);var e=ek(eG)(new Uint8Array(c)).encrypt(d);if(d9(e),ee)return e.toHex();let f="";for(let a=0;a<e.length;a++)f+=ef[e[a]];return f},eI=async({key:a,data:b})=>{let c=await d6("SHA-256").digest(a),d=function(a){if("string"!=typeof a)throw Error("hex string expected, got "+typeof a);if(ee)return Uint8Array.fromHex(a);let b=a.length,c=b/2;if(b%2)throw Error("hex string expected, got unpadded hex of length "+b);let d=new Uint8Array(c);for(let b=0,e=0;b<c;b++,e+=2){let c=eg(a.charCodeAt(e)),f=eg(a.charCodeAt(e+1));if(void 0===c||void 0===f)throw Error('hex string expected, got non-hex character "'+(a[e]+a[e+1])+'" at index '+e);d[b]=16*c+f}return d}(b),e=ek(eG)(new Uint8Array(c));return new TextDecoder().decode(e.decrypt(d))},eJ=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a));var eK=a.i(27958),eL=a.i(94219);let eM=eL.object({id:eL.string(),createdAt:eL.date().default(()=>new Date),updatedAt:eL.date().default(()=>new Date)});a.i(38005),a.i(88476);var eN=a.i(75160),eO=a.i(73590),eP=a.i(85679);let eQ={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function eR(a){eP.config({customError:a})}function eS(){return eP.config().customError}Q||(Q={}),a.s(["ZodFirstPartyTypeKind",()=>Q,"ZodIssueCode",0,eQ,"getErrorMap",()=>eS,"setErrorMap",()=>eR],58277);var eT=a.i(88339),eU=a.i(22372),eV=a.i(64166),eW=a.i(63571);a.s(["endsWith",()=>eW._endsWith,"gt",()=>eW._gt,"gte",()=>eW._gte,"includes",()=>eW._includes,"length",()=>eW._length,"lowercase",()=>eW._lowercase,"lt",()=>eW._lt,"lte",()=>eW._lte,"maxLength",()=>eW._maxLength,"maxSize",()=>eW._maxSize,"mime",()=>eW._mime,"minLength",()=>eW._minLength,"minSize",()=>eW._minSize,"multipleOf",()=>eW._multipleOf,"negative",()=>eW._negative,"nonnegative",()=>eW._nonnegative,"nonpositive",()=>eW._nonpositive,"normalize",()=>eW._normalize,"overwrite",()=>eW._overwrite,"positive",()=>eW._positive,"property",()=>eW._property,"regex",()=>eW._regex,"size",()=>eW._size,"slugify",()=>eW._slugify,"startsWith",()=>eW._startsWith,"toLowerCase",()=>eW._toLowerCase,"toUpperCase",()=>eW._toUpperCase,"trim",()=>eW._trim,"uppercase",()=>eW._uppercase],54375);var eX=a.i(54375),eY=a.i(18850);let eZ={...eL,...eX,iso:eY},e$=new Set(["$schema","$ref","$defs","definitions","$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor","type","enum","const","anyOf","oneOf","allOf","not","properties","required","additionalProperties","patternProperties","propertyNames","minProperties","maxProperties","items","prefixItems","additionalItems","minItems","maxItems","uniqueItems","contains","minContains","maxContains","minLength","maxLength","pattern","format","minimum","maximum","exclusiveMinimum","exclusiveMaximum","multipleOf","description","default","contentEncoding","contentMediaType","contentSchema","unevaluatedItems","unevaluatedProperties","if","then","else","dependentSchemas","dependentRequired","nullable","readOnly"]);function e_(a,b){var c;let d;if("boolean"==typeof a)return a?eZ.any():eZ.never();let e={version:(c=b?.defaultTarget,"https://json-schema.org/draft/2020-12/schema"===(d=a.$schema)?"draft-2020-12":"http://json-schema.org/draft-07/schema#"===d?"draft-7":"http://json-schema.org/draft-04/schema#"===d?"draft-4":c??"draft-2020-12"),defs:a.$defs||a.definitions||{},refs:new Map,processing:new Set,rootSchema:a,registry:b?.registry??eV.globalRegistry};return function a(b,c){if("boolean"==typeof b)return b?eZ.any():eZ.never();let d=function b(c,d){let e;if(void 0!==c.not){if("object"==typeof c.not&&0===Object.keys(c.not).length)return eZ.never();throw Error("not is not supported in Zod (except { not: {} } for never)")}if(void 0!==c.unevaluatedItems)throw Error("unevaluatedItems is not supported");if(void 0!==c.unevaluatedProperties)throw Error("unevaluatedProperties is not supported");if(void 0!==c.if||void 0!==c.then||void 0!==c.else)throw Error("Conditional schemas (if/then/else) are not supported");if(void 0!==c.dependentSchemas||void 0!==c.dependentRequired)throw Error("dependentSchemas and dependentRequired are not supported");if(c.$ref){let b=c.$ref;if(d.refs.has(b))return d.refs.get(b);if(d.processing.has(b))return eZ.lazy(()=>{if(!d.refs.has(b))throw Error(`Circular reference not resolved: ${b}`);return d.refs.get(b)});d.processing.add(b);let e=a(function(a,b){if(!a.startsWith("#"))throw Error("External $ref is not supported, only local refs (#/...) are allowed");let c=a.slice(1).split("/").filter(Boolean);if(0===c.length)return b.rootSchema;let d="draft-2020-12"===b.version?"$defs":"definitions";if(c[0]===d){let d=c[1];if(!d||!b.defs[d])throw Error(`Reference not found: ${a}`);return b.defs[d]}throw Error(`Reference not found: ${a}`)}(b,d),d);return d.refs.set(b,e),d.processing.delete(b),e}if(void 0!==c.enum){let a=c.enum;if("openapi-3.0"===d.version&&!0===c.nullable&&1===a.length&&null===a[0])return eZ.null();if(0===a.length)return eZ.never();if(1===a.length)return eZ.literal(a[0]);if(a.every(a=>"string"==typeof a))return eZ.enum(a);let b=a.map(a=>eZ.literal(a));return b.length<2?b[0]:eZ.union([b[0],b[1],...b.slice(2)])}if(void 0!==c.const)return eZ.literal(c.const);let f=c.type;if(Array.isArray(f)){let a=f.map(a=>b({...c,type:a},d));return 0===a.length?eZ.never():1===a.length?a[0]:eZ.union(a)}if(!f)return eZ.any();switch(f){case"string":{let a=eZ.string();if(c.format){let b=c.format;"email"===b?a=a.check(eZ.email()):"uri"===b||"uri-reference"===b?a=a.check(eZ.url()):"uuid"===b||"guid"===b?a=a.check(eZ.uuid()):"date-time"===b?a=a.check(eZ.iso.datetime()):"date"===b?a=a.check(eZ.iso.date()):"time"===b?a=a.check(eZ.iso.time()):"duration"===b?a=a.check(eZ.iso.duration()):"ipv4"===b?a=a.check(eZ.ipv4()):"ipv6"===b?a=a.check(eZ.ipv6()):"mac"===b?a=a.check(eZ.mac()):"cidr"===b?a=a.check(eZ.cidrv4()):"cidr-v6"===b?a=a.check(eZ.cidrv6()):"base64"===b?a=a.check(eZ.base64()):"base64url"===b?a=a.check(eZ.base64url()):"e164"===b?a=a.check(eZ.e164()):"jwt"===b?a=a.check(eZ.jwt()):"emoji"===b?a=a.check(eZ.emoji()):"nanoid"===b?a=a.check(eZ.nanoid()):"cuid"===b?a=a.check(eZ.cuid()):"cuid2"===b?a=a.check(eZ.cuid2()):"ulid"===b?a=a.check(eZ.ulid()):"xid"===b?a=a.check(eZ.xid()):"ksuid"===b&&(a=a.check(eZ.ksuid()))}"number"==typeof c.minLength&&(a=a.min(c.minLength)),"number"==typeof c.maxLength&&(a=a.max(c.maxLength)),c.pattern&&(a=a.regex(new RegExp(c.pattern))),e=a;break}case"number":case"integer":{let a="integer"===f?eZ.number().int():eZ.number();"number"==typeof c.minimum&&(a=a.min(c.minimum)),"number"==typeof c.maximum&&(a=a.max(c.maximum)),"number"==typeof c.exclusiveMinimum?a=a.gt(c.exclusiveMinimum):!0===c.exclusiveMinimum&&"number"==typeof c.minimum&&(a=a.gt(c.minimum)),"number"==typeof c.exclusiveMaximum?a=a.lt(c.exclusiveMaximum):!0===c.exclusiveMaximum&&"number"==typeof c.maximum&&(a=a.lt(c.maximum)),"number"==typeof c.multipleOf&&(a=a.multipleOf(c.multipleOf)),e=a;break}case"boolean":e=eZ.boolean();break;case"null":e=eZ.null();break;case"object":{let b={},f=c.properties||{},g=new Set(c.required||[]);for(let[c,e]of Object.entries(f)){let f=a(e,d);b[c]=g.has(c)?f:f.optional()}if(c.propertyNames){let f=a(c.propertyNames,d),g=c.additionalProperties&&"object"==typeof c.additionalProperties?a(c.additionalProperties,d):eZ.any();if(0===Object.keys(b).length){e=eZ.record(f,g);break}let h=eZ.object(b).passthrough(),i=eZ.looseRecord(f,g);e=eZ.intersection(h,i);break}if(c.patternProperties){let f=c.patternProperties,g=Object.keys(f),h=[];for(let b of g){let c=a(f[b],d),e=eZ.string().regex(new RegExp(b));h.push(eZ.looseRecord(e,c))}let i=[];if(Object.keys(b).length>0&&i.push(eZ.object(b).passthrough()),i.push(...h),0===i.length)e=eZ.object({}).passthrough();else if(1===i.length)e=i[0];else{let a=eZ.intersection(i[0],i[1]);for(let b=2;b<i.length;b++)a=eZ.intersection(a,i[b]);e=a}break}let h=eZ.object(b);e=!1===c.additionalProperties?h.strict():"object"==typeof c.additionalProperties?h.catchall(a(c.additionalProperties,d)):h.passthrough();break}case"array":{let b=c.prefixItems,f=c.items;if(b&&Array.isArray(b)){let g=b.map(b=>a(b,d)),h=f&&"object"==typeof f&&!Array.isArray(f)?a(f,d):void 0;e=h?eZ.tuple(g).rest(h):eZ.tuple(g),"number"==typeof c.minItems&&(e=e.check(eZ.minLength(c.minItems))),"number"==typeof c.maxItems&&(e=e.check(eZ.maxLength(c.maxItems)))}else if(Array.isArray(f)){let b=f.map(b=>a(b,d)),g=c.additionalItems&&"object"==typeof c.additionalItems?a(c.additionalItems,d):void 0;e=g?eZ.tuple(b).rest(g):eZ.tuple(b),"number"==typeof c.minItems&&(e=e.check(eZ.minLength(c.minItems))),"number"==typeof c.maxItems&&(e=e.check(eZ.maxLength(c.maxItems)))}else if(void 0!==f){let b=a(f,d),g=eZ.array(b);"number"==typeof c.minItems&&(g=g.min(c.minItems)),"number"==typeof c.maxItems&&(g=g.max(c.maxItems)),e=g}else e=eZ.array(eZ.any());break}default:throw Error(`Unsupported type: ${f}`)}return c.description&&(e=e.describe(c.description)),void 0!==c.default&&(e=e.default(c.default)),e}(b,c),e=b.type||void 0!==b.enum||void 0!==b.const;if(b.anyOf&&Array.isArray(b.anyOf)){let f=b.anyOf.map(b=>a(b,c)),g=eZ.union(f);d=e?eZ.intersection(d,g):g}if(b.oneOf&&Array.isArray(b.oneOf)){let f=b.oneOf.map(b=>a(b,c)),g=eZ.xor(f);d=e?eZ.intersection(d,g):g}if(b.allOf&&Array.isArray(b.allOf))if(0===b.allOf.length)d=e?d:eZ.any();else{let f=e?d:a(b.allOf[0],c),g=+!e;for(let d=g;d<b.allOf.length;d++)f=eZ.intersection(f,a(b.allOf[d],c));d=f}!0===b.nullable&&"openapi-3.0"===c.version&&(d=eZ.nullable(d)),!0===b.readOnly&&(d=eZ.readonly(d));let f={};for(let a of["$id","id","$comment","$anchor","$vocabulary","$dynamicRef","$dynamicAnchor"])a in b&&(f[a]=b[a]);for(let a of["contentEncoding","contentMediaType","contentSchema"])a in b&&(f[a]=b[a]);for(let a of Object.keys(b))e$.has(a)||(f[a]=b[a]);return Object.keys(f).length>0&&c.registry.add(d,f),d}(a,e)}function e0(a){return eW._coercedString(eL.ZodString,a)}function e1(a){return eW._coercedNumber(eL.ZodNumber,a)}function e2(a){return eW._coercedBoolean(eL.ZodBoolean,a)}function e3(a){return eW._coercedBigint(eL.ZodBigInt,a)}function e4(a){return eW._coercedDate(eL.ZodDate,a)}a.i(94551),a.s(["bigint",()=>e3,"boolean",()=>e2,"date",()=>e4,"number",()=>e1,"string",()=>e0],58483),(0,eP.config)((0,eT.default)()),a.s([],22157),a.i(22157);var e5=a.i(51152),e6=a.i(13399),e7=a.i(9419),e8=a.i(61802),e9=a.i(72385),fa=a.i(49660),fb=a.i(20559),fc=a.i(61562),fd=a.i(74886),fe=a.i(66352),ff=a.i(3766),fg=a.i(10537),fh=a.i(41639),fi=a.i(16826),fj=a.i(18103),fk=a.i(75751),fl=a.i(26530),fm=a.i(4385),fn=a.i(46710),fo=a.i(3653),fp=a.i(72112),fq=a.i(9593),fr=a.i(7022),fs=a.i(86745),ft=a.i(19500),fu=a.i(32233),fv=a.i(4138),fw=a.i(12028),fx=a.i(70670),fy=a.i(61592),fz=a.i(19330),fA=a.i(84685),fB=a.i(54041),fC=a.i(57563),fD=a.i(72179),fE=a.i(53339),fF=a.i(57551),fG=a.i(65014),fH=a.i(7591),fI=a.i(93606),fJ=a.i(3254),fK=a.i(20285),fL=a.i(53324),fM=a.i(26798),fN=a.i(17179),fO=a.i(84878),fP=a.i(8806),fQ=a.i(95574),fR=a.i(6887),fS=a.i(42005),fT=a.i(31686),fU=a.i(79702),fV=a.i(54784),fW=a.i(81644),fX=a.i(5952);a.s(["ar",()=>fc.default,"az",()=>fd.default,"be",()=>fe.default,"bg",()=>ff.default,"ca",()=>fg.default,"cs",()=>fh.default,"da",()=>fi.default,"de",()=>fj.default,"en",()=>eT.default,"eo",()=>fk.default,"es",()=>fl.default,"fa",()=>fm.default,"fi",()=>fn.default,"fr",()=>fo.default,"frCA",()=>fp.default,"he",()=>fq.default,"hu",()=>fr.default,"hy",()=>fs.default,"id",()=>ft.default,"is",()=>fu.default,"it",()=>fv.default,"ja",()=>fw.default,"ka",()=>fx.default,"kh",()=>fy.default,"km",()=>fz.default,"ko",()=>fA.default,"lt",()=>fB.default,"mk",()=>fC.default,"ms",()=>fD.default,"nl",()=>fE.default,"no",()=>fF.default,"ota",()=>fG.default,"pl",()=>fI.default,"ps",()=>fH.default,"pt",()=>fJ.default,"ru",()=>fK.default,"sl",()=>fL.default,"sv",()=>fM.default,"ta",()=>fN.default,"th",()=>fO.default,"tr",()=>fP.default,"ua",()=>fQ.default,"uk",()=>fR.default,"ur",()=>fS.default,"uz",()=>fT.default,"vi",()=>fU.default,"yo",()=>fX.default,"zhCN",()=>fV.default,"zhTW",()=>fW.default],31238);var fY=a.i(31238),fZ=a.i(66004),f$=a.i(76403),f_=a.i(6430),f0=a.i(95288);a.s(["$ZodAny",()=>e7.$ZodAny,"$ZodArray",()=>e7.$ZodArray,"$ZodAsyncError",()=>eP.$ZodAsyncError,"$ZodBase64",()=>e7.$ZodBase64,"$ZodBase64URL",()=>e7.$ZodBase64URL,"$ZodBigInt",()=>e7.$ZodBigInt,"$ZodBigIntFormat",()=>e7.$ZodBigIntFormat,"$ZodBoolean",()=>e7.$ZodBoolean,"$ZodCIDRv4",()=>e7.$ZodCIDRv4,"$ZodCIDRv6",()=>e7.$ZodCIDRv6,"$ZodCUID",()=>e7.$ZodCUID,"$ZodCUID2",()=>e7.$ZodCUID2,"$ZodCatch",()=>e7.$ZodCatch,"$ZodCheck",()=>e8.$ZodCheck,"$ZodCheckBigIntFormat",()=>e8.$ZodCheckBigIntFormat,"$ZodCheckEndsWith",()=>e8.$ZodCheckEndsWith,"$ZodCheckGreaterThan",()=>e8.$ZodCheckGreaterThan,"$ZodCheckIncludes",()=>e8.$ZodCheckIncludes,"$ZodCheckLengthEquals",()=>e8.$ZodCheckLengthEquals,"$ZodCheckLessThan",()=>e8.$ZodCheckLessThan,"$ZodCheckLowerCase",()=>e8.$ZodCheckLowerCase,"$ZodCheckMaxLength",()=>e8.$ZodCheckMaxLength,"$ZodCheckMaxSize",()=>e8.$ZodCheckMaxSize,"$ZodCheckMimeType",()=>e8.$ZodCheckMimeType,"$ZodCheckMinLength",()=>e8.$ZodCheckMinLength,"$ZodCheckMinSize",()=>e8.$ZodCheckMinSize,"$ZodCheckMultipleOf",()=>e8.$ZodCheckMultipleOf,"$ZodCheckNumberFormat",()=>e8.$ZodCheckNumberFormat,"$ZodCheckOverwrite",()=>e8.$ZodCheckOverwrite,"$ZodCheckProperty",()=>e8.$ZodCheckProperty,"$ZodCheckRegex",()=>e8.$ZodCheckRegex,"$ZodCheckSizeEquals",()=>e8.$ZodCheckSizeEquals,"$ZodCheckStartsWith",()=>e8.$ZodCheckStartsWith,"$ZodCheckStringFormat",()=>e8.$ZodCheckStringFormat,"$ZodCheckUpperCase",()=>e8.$ZodCheckUpperCase,"$ZodCodec",()=>e7.$ZodCodec,"$ZodCustom",()=>e7.$ZodCustom,"$ZodCustomStringFormat",()=>e7.$ZodCustomStringFormat,"$ZodDate",()=>e7.$ZodDate,"$ZodDefault",()=>e7.$ZodDefault,"$ZodDiscriminatedUnion",()=>e7.$ZodDiscriminatedUnion,"$ZodE164",()=>e7.$ZodE164,"$ZodEmail",()=>e7.$ZodEmail,"$ZodEmoji",()=>e7.$ZodEmoji,"$ZodEncodeError",()=>eP.$ZodEncodeError,"$ZodEnum",()=>e7.$ZodEnum,"$ZodError",()=>e6.$ZodError,"$ZodExactOptional",()=>e7.$ZodExactOptional,"$ZodFile",()=>e7.$ZodFile,"$ZodFunction",()=>e7.$ZodFunction,"$ZodGUID",()=>e7.$ZodGUID,"$ZodIPv4",()=>e7.$ZodIPv4,"$ZodIPv6",()=>e7.$ZodIPv6,"$ZodISODate",()=>e7.$ZodISODate,"$ZodISODateTime",()=>e7.$ZodISODateTime,"$ZodISODuration",()=>e7.$ZodISODuration,"$ZodISOTime",()=>e7.$ZodISOTime,"$ZodIntersection",()=>e7.$ZodIntersection,"$ZodJWT",()=>e7.$ZodJWT,"$ZodKSUID",()=>e7.$ZodKSUID,"$ZodLazy",()=>e7.$ZodLazy,"$ZodLiteral",()=>e7.$ZodLiteral,"$ZodMAC",()=>e7.$ZodMAC,"$ZodMap",()=>e7.$ZodMap,"$ZodNaN",()=>e7.$ZodNaN,"$ZodNanoID",()=>e7.$ZodNanoID,"$ZodNever",()=>e7.$ZodNever,"$ZodNonOptional",()=>e7.$ZodNonOptional,"$ZodNull",()=>e7.$ZodNull,"$ZodNullable",()=>e7.$ZodNullable,"$ZodNumber",()=>e7.$ZodNumber,"$ZodNumberFormat",()=>e7.$ZodNumberFormat,"$ZodObject",()=>e7.$ZodObject,"$ZodObjectJIT",()=>e7.$ZodObjectJIT,"$ZodOptional",()=>e7.$ZodOptional,"$ZodPipe",()=>e7.$ZodPipe,"$ZodPrefault",()=>e7.$ZodPrefault,"$ZodPromise",()=>e7.$ZodPromise,"$ZodReadonly",()=>e7.$ZodReadonly,"$ZodRealError",()=>e6.$ZodRealError,"$ZodRecord",()=>e7.$ZodRecord,"$ZodRegistry",()=>eV.$ZodRegistry,"$ZodSet",()=>e7.$ZodSet,"$ZodString",()=>e7.$ZodString,"$ZodStringFormat",()=>e7.$ZodStringFormat,"$ZodSuccess",()=>e7.$ZodSuccess,"$ZodSymbol",()=>e7.$ZodSymbol,"$ZodTemplateLiteral",()=>e7.$ZodTemplateLiteral,"$ZodTransform",()=>e7.$ZodTransform,"$ZodTuple",()=>e7.$ZodTuple,"$ZodType",()=>e7.$ZodType,"$ZodULID",()=>e7.$ZodULID,"$ZodURL",()=>e7.$ZodURL,"$ZodUUID",()=>e7.$ZodUUID,"$ZodUndefined",()=>e7.$ZodUndefined,"$ZodUnion",()=>e7.$ZodUnion,"$ZodUnknown",()=>e7.$ZodUnknown,"$ZodVoid",()=>e7.$ZodVoid,"$ZodXID",()=>e7.$ZodXID,"$ZodXor",()=>e7.$ZodXor,"$brand",()=>eP.$brand,"$constructor",()=>eP.$constructor,"$input",()=>eV.$input,"$output",()=>eV.$output,"Doc",()=>fZ.Doc,"JSONSchema",0,f0,"JSONSchemaGenerator",()=>f_.JSONSchemaGenerator,"NEVER",()=>eP.NEVER,"TimePrecision",()=>eW.TimePrecision,"_any",()=>eW._any,"_array",()=>eW._array,"_base64",()=>eW._base64,"_base64url",()=>eW._base64url,"_bigint",()=>eW._bigint,"_boolean",()=>eW._boolean,"_catch",()=>eW._catch,"_check",()=>eW._check,"_cidrv4",()=>eW._cidrv4,"_cidrv6",()=>eW._cidrv6,"_coercedBigint",()=>eW._coercedBigint,"_coercedBoolean",()=>eW._coercedBoolean,"_coercedDate",()=>eW._coercedDate,"_coercedNumber",()=>eW._coercedNumber,"_coercedString",()=>eW._coercedString,"_cuid",()=>eW._cuid,"_cuid2",()=>eW._cuid2,"_custom",()=>eW._custom,"_date",()=>eW._date,"_decode",()=>e5._decode,"_decodeAsync",()=>e5._decodeAsync,"_default",()=>eW._default,"_discriminatedUnion",()=>eW._discriminatedUnion,"_e164",()=>eW._e164,"_email",()=>eW._email,"_emoji",()=>eW._emoji,"_encode",()=>e5._encode,"_encodeAsync",()=>e5._encodeAsync,"_endsWith",()=>eW._endsWith,"_enum",()=>eW._enum,"_file",()=>eW._file,"_float32",()=>eW._float32,"_float64",()=>eW._float64,"_gt",()=>eW._gt,"_gte",()=>eW._gte,"_guid",()=>eW._guid,"_includes",()=>eW._includes,"_int",()=>eW._int,"_int32",()=>eW._int32,"_int64",()=>eW._int64,"_intersection",()=>eW._intersection,"_ipv4",()=>eW._ipv4,"_ipv6",()=>eW._ipv6,"_isoDate",()=>eW._isoDate,"_isoDateTime",()=>eW._isoDateTime,"_isoDuration",()=>eW._isoDuration,"_isoTime",()=>eW._isoTime,"_jwt",()=>eW._jwt,"_ksuid",()=>eW._ksuid,"_lazy",()=>eW._lazy,"_length",()=>eW._length,"_literal",()=>eW._literal,"_lowercase",()=>eW._lowercase,"_lt",()=>eW._lt,"_lte",()=>eW._lte,"_mac",()=>eW._mac,"_map",()=>eW._map,"_max",()=>eW._max,"_maxLength",()=>eW._maxLength,"_maxSize",()=>eW._maxSize,"_mime",()=>eW._mime,"_min",()=>eW._min,"_minLength",()=>eW._minLength,"_minSize",()=>eW._minSize,"_multipleOf",()=>eW._multipleOf,"_nan",()=>eW._nan,"_nanoid",()=>eW._nanoid,"_nativeEnum",()=>eW._nativeEnum,"_negative",()=>eW._negative,"_never",()=>eW._never,"_nonnegative",()=>eW._nonnegative,"_nonoptional",()=>eW._nonoptional,"_nonpositive",()=>eW._nonpositive,"_normalize",()=>eW._normalize,"_null",()=>eW._null,"_nullable",()=>eW._nullable,"_number",()=>eW._number,"_optional",()=>eW._optional,"_overwrite",()=>eW._overwrite,"_parse",()=>e5._parse,"_parseAsync",()=>e5._parseAsync,"_pipe",()=>eW._pipe,"_positive",()=>eW._positive,"_promise",()=>eW._promise,"_property",()=>eW._property,"_readonly",()=>eW._readonly,"_record",()=>eW._record,"_refine",()=>eW._refine,"_regex",()=>eW._regex,"_safeDecode",()=>e5._safeDecode,"_safeDecodeAsync",()=>e5._safeDecodeAsync,"_safeEncode",()=>e5._safeEncode,"_safeEncodeAsync",()=>e5._safeEncodeAsync,"_safeParse",()=>e5._safeParse,"_safeParseAsync",()=>e5._safeParseAsync,"_set",()=>eW._set,"_size",()=>eW._size,"_slugify",()=>eW._slugify,"_startsWith",()=>eW._startsWith,"_string",()=>eW._string,"_stringFormat",()=>eW._stringFormat,"_stringbool",()=>eW._stringbool,"_success",()=>eW._success,"_superRefine",()=>eW._superRefine,"_symbol",()=>eW._symbol,"_templateLiteral",()=>eW._templateLiteral,"_toLowerCase",()=>eW._toLowerCase,"_toUpperCase",()=>eW._toUpperCase,"_transform",()=>eW._transform,"_trim",()=>eW._trim,"_tuple",()=>eW._tuple,"_uint32",()=>eW._uint32,"_uint64",()=>eW._uint64,"_ulid",()=>eW._ulid,"_undefined",()=>eW._undefined,"_union",()=>eW._union,"_unknown",()=>eW._unknown,"_uppercase",()=>eW._uppercase,"_url",()=>eW._url,"_uuid",()=>eW._uuid,"_uuidv4",()=>eW._uuidv4,"_uuidv6",()=>eW._uuidv6,"_uuidv7",()=>eW._uuidv7,"_void",()=>eW._void,"_xid",()=>eW._xid,"_xor",()=>eW._xor,"clone",()=>e7.clone,"config",()=>eP.config,"createStandardJSONSchemaMethod",()=>f$.createStandardJSONSchemaMethod,"createToJSONSchemaMethod",()=>f$.createToJSONSchemaMethod,"decode",()=>e5.decode,"decodeAsync",()=>e5.decodeAsync,"describe",()=>eW.describe,"encode",()=>e5.encode,"encodeAsync",()=>e5.encodeAsync,"extractDefs",()=>f$.extractDefs,"finalize",()=>f$.finalize,"flattenError",()=>e6.flattenError,"formatError",()=>e6.formatError,"globalConfig",()=>eP.globalConfig,"globalRegistry",()=>eV.globalRegistry,"initializeContext",()=>f$.initializeContext,"isValidBase64",()=>e7.isValidBase64,"isValidBase64URL",()=>e7.isValidBase64URL,"isValidJWT",()=>e7.isValidJWT,"locales",0,fY,"meta",()=>eW.meta,"parse",()=>e5.parse,"parseAsync",()=>e5.parseAsync,"prettifyError",()=>e6.prettifyError,"process",()=>f$.process,"regexes",0,fb,"registry",()=>eV.registry,"safeDecode",()=>e5.safeDecode,"safeDecodeAsync",()=>e5.safeDecodeAsync,"safeEncode",()=>e5.safeEncode,"safeEncodeAsync",()=>e5.safeEncodeAsync,"safeParse",()=>e5.safeParse,"safeParseAsync",()=>e5.safeParseAsync,"toDotPath",()=>e6.toDotPath,"toJSONSchema",()=>eU.toJSONSchema,"treeifyError",()=>e6.treeifyError,"util",0,fa,"version",()=>e9.version],29642);var f1=a.i(29642);a.i(58277),a.s(["$brand",()=>eP.$brand,"ZodFirstPartyTypeKind",()=>Q,"ZodIssueCode",0,eQ,"config",()=>eP.config,"getErrorMap",()=>eS,"setErrorMap",()=>eR],29126),a.i(29126);var f2=a.i(43393),f3=a.i(63571),f4=a.i(22066),f5=a.i(58483);a.s(["$brand",()=>eP.$brand,"$input",()=>eV.$input,"$output",()=>eV.$output,"NEVER",()=>eP.NEVER,"TimePrecision",()=>f3.TimePrecision,"ZodAny",()=>eL.ZodAny,"ZodArray",()=>eL.ZodArray,"ZodBase64",()=>eL.ZodBase64,"ZodBase64URL",()=>eL.ZodBase64URL,"ZodBigInt",()=>eL.ZodBigInt,"ZodBigIntFormat",()=>eL.ZodBigIntFormat,"ZodBoolean",()=>eL.ZodBoolean,"ZodCIDRv4",()=>eL.ZodCIDRv4,"ZodCIDRv6",()=>eL.ZodCIDRv6,"ZodCUID",()=>eL.ZodCUID,"ZodCUID2",()=>eL.ZodCUID2,"ZodCatch",()=>eL.ZodCatch,"ZodCodec",()=>eL.ZodCodec,"ZodCustom",()=>eL.ZodCustom,"ZodCustomStringFormat",()=>eL.ZodCustomStringFormat,"ZodDate",()=>eL.ZodDate,"ZodDefault",()=>eL.ZodDefault,"ZodDiscriminatedUnion",()=>eL.ZodDiscriminatedUnion,"ZodE164",()=>eL.ZodE164,"ZodEmail",()=>eL.ZodEmail,"ZodEmoji",()=>eL.ZodEmoji,"ZodEnum",()=>eL.ZodEnum,"ZodError",()=>eN.ZodError,"ZodExactOptional",()=>eL.ZodExactOptional,"ZodFile",()=>eL.ZodFile,"ZodFirstPartyTypeKind",()=>Q,"ZodFunction",()=>eL.ZodFunction,"ZodGUID",()=>eL.ZodGUID,"ZodIPv4",()=>eL.ZodIPv4,"ZodIPv6",()=>eL.ZodIPv6,"ZodISODate",()=>eY.ZodISODate,"ZodISODateTime",()=>eY.ZodISODateTime,"ZodISODuration",()=>eY.ZodISODuration,"ZodISOTime",()=>eY.ZodISOTime,"ZodIntersection",()=>eL.ZodIntersection,"ZodIssueCode",0,eQ,"ZodJWT",()=>eL.ZodJWT,"ZodKSUID",()=>eL.ZodKSUID,"ZodLazy",()=>eL.ZodLazy,"ZodLiteral",()=>eL.ZodLiteral,"ZodMAC",()=>eL.ZodMAC,"ZodMap",()=>eL.ZodMap,"ZodNaN",()=>eL.ZodNaN,"ZodNanoID",()=>eL.ZodNanoID,"ZodNever",()=>eL.ZodNever,"ZodNonOptional",()=>eL.ZodNonOptional,"ZodNull",()=>eL.ZodNull,"ZodNullable",()=>eL.ZodNullable,"ZodNumber",()=>eL.ZodNumber,"ZodNumberFormat",()=>eL.ZodNumberFormat,"ZodObject",()=>eL.ZodObject,"ZodOptional",()=>eL.ZodOptional,"ZodPipe",()=>eL.ZodPipe,"ZodPrefault",()=>eL.ZodPrefault,"ZodPromise",()=>eL.ZodPromise,"ZodReadonly",()=>eL.ZodReadonly,"ZodRealError",()=>eN.ZodRealError,"ZodRecord",()=>eL.ZodRecord,"ZodSet",()=>eL.ZodSet,"ZodString",()=>eL.ZodString,"ZodStringFormat",()=>eL.ZodStringFormat,"ZodSuccess",()=>eL.ZodSuccess,"ZodSymbol",()=>eL.ZodSymbol,"ZodTemplateLiteral",()=>eL.ZodTemplateLiteral,"ZodTransform",()=>eL.ZodTransform,"ZodTuple",()=>eL.ZodTuple,"ZodType",()=>eL.ZodType,"ZodULID",()=>eL.ZodULID,"ZodURL",()=>eL.ZodURL,"ZodUUID",()=>eL.ZodUUID,"ZodUndefined",()=>eL.ZodUndefined,"ZodUnion",()=>eL.ZodUnion,"ZodUnknown",()=>eL.ZodUnknown,"ZodVoid",()=>eL.ZodVoid,"ZodXID",()=>eL.ZodXID,"ZodXor",()=>eL.ZodXor,"_ZodString",()=>eL._ZodString,"_default",()=>eL._default,"_function",()=>eL._function,"any",()=>eL.any,"array",()=>eL.array,"base64",()=>eL.base64,"base64url",()=>eL.base64url,"bigint",()=>eL.bigint,"boolean",()=>eL.boolean,"catch",()=>eL.catch,"check",()=>eL.check,"cidrv4",()=>eL.cidrv4,"cidrv6",()=>eL.cidrv6,"clone",()=>e7.clone,"codec",()=>eL.codec,"coerce",0,f5,"config",()=>eP.config,"core",0,f1,"cuid",()=>eL.cuid,"cuid2",()=>eL.cuid2,"custom",()=>eL.custom,"date",()=>eL.date,"decode",()=>eO.decode,"decodeAsync",()=>eO.decodeAsync,"describe",()=>eL.describe,"discriminatedUnion",()=>eL.discriminatedUnion,"e164",()=>eL.e164,"email",()=>eL.email,"emoji",()=>eL.emoji,"encode",()=>eO.encode,"encodeAsync",()=>eO.encodeAsync,"endsWith",()=>eW._endsWith,"enum",()=>eL.enum,"exactOptional",()=>eL.exactOptional,"file",()=>eL.file,"flattenError",()=>e6.flattenError,"float32",()=>eL.float32,"float64",()=>eL.float64,"formatError",()=>e6.formatError,"fromJSONSchema",()=>e_,"function",()=>eL.function,"getErrorMap",()=>eS,"globalRegistry",()=>eV.globalRegistry,"gt",()=>eW._gt,"gte",()=>eW._gte,"guid",()=>eL.guid,"hash",()=>eL.hash,"hex",()=>eL.hex,"hostname",()=>eL.hostname,"httpUrl",()=>eL.httpUrl,"includes",()=>eW._includes,"instanceof",()=>eL.instanceof,"int",()=>eL.int,"int32",()=>eL.int32,"int64",()=>eL.int64,"intersection",()=>eL.intersection,"ipv4",()=>eL.ipv4,"ipv6",()=>eL.ipv6,"iso",0,eY,"json",()=>eL.json,"jwt",()=>eL.jwt,"keyof",()=>eL.keyof,"ksuid",()=>eL.ksuid,"lazy",()=>eL.lazy,"length",()=>eW._length,"literal",()=>eL.literal,"locales",0,fY,"looseObject",()=>eL.looseObject,"looseRecord",()=>eL.looseRecord,"lowercase",()=>eW._lowercase,"lt",()=>eW._lt,"lte",()=>eW._lte,"mac",()=>eL.mac,"map",()=>eL.map,"maxLength",()=>eW._maxLength,"maxSize",()=>eW._maxSize,"meta",()=>eL.meta,"mime",()=>eW._mime,"minLength",()=>eW._minLength,"minSize",()=>eW._minSize,"multipleOf",()=>eW._multipleOf,"nan",()=>eL.nan,"nanoid",()=>eL.nanoid,"nativeEnum",()=>eL.nativeEnum,"negative",()=>eW._negative,"never",()=>eL.never,"nonnegative",()=>eW._nonnegative,"nonoptional",()=>eL.nonoptional,"nonpositive",()=>eW._nonpositive,"normalize",()=>eW._normalize,"null",()=>eL.null,"nullable",()=>eL.nullable,"nullish",()=>eL.nullish,"number",()=>eL.number,"object",()=>eL.object,"optional",()=>eL.optional,"overwrite",()=>eW._overwrite,"parse",()=>eO.parse,"parseAsync",()=>eO.parseAsync,"partialRecord",()=>eL.partialRecord,"pipe",()=>eL.pipe,"positive",()=>eW._positive,"prefault",()=>eL.prefault,"preprocess",()=>eL.preprocess,"prettifyError",()=>e6.prettifyError,"promise",()=>eL.promise,"property",()=>eW._property,"readonly",()=>eL.readonly,"record",()=>eL.record,"refine",()=>eL.refine,"regex",()=>eW._regex,"regexes",()=>f2.regexes,"registry",()=>eV.registry,"safeDecode",()=>eO.safeDecode,"safeDecodeAsync",()=>eO.safeDecodeAsync,"safeEncode",()=>eO.safeEncode,"safeEncodeAsync",()=>eO.safeEncodeAsync,"safeParse",()=>eO.safeParse,"safeParseAsync",()=>eO.safeParseAsync,"set",()=>eL.set,"setErrorMap",()=>eR,"size",()=>eW._size,"slugify",()=>eW._slugify,"startsWith",()=>eW._startsWith,"strictObject",()=>eL.strictObject,"string",()=>eL.string,"stringFormat",()=>eL.stringFormat,"stringbool",()=>eL.stringbool,"success",()=>eL.success,"superRefine",()=>eL.superRefine,"symbol",()=>eL.symbol,"templateLiteral",()=>eL.templateLiteral,"toJSONSchema",()=>eU.toJSONSchema,"toLowerCase",()=>eW._toLowerCase,"toUpperCase",()=>eW._toUpperCase,"transform",()=>eL.transform,"treeifyError",()=>e6.treeifyError,"trim",()=>eW._trim,"tuple",()=>eL.tuple,"uint32",()=>eL.uint32,"uint64",()=>eL.uint64,"ulid",()=>eL.ulid,"undefined",()=>eL.undefined,"union",()=>eL.union,"unknown",()=>eL.unknown,"uppercase",()=>eW._uppercase,"url",()=>eL.url,"util",()=>f4.util,"uuid",()=>eL.uuid,"uuidv4",()=>eL.uuidv4,"uuidv6",()=>eL.uuidv6,"uuidv7",()=>eL.uuidv7,"void",()=>eL.void,"xid",()=>eL.xid,"xor",()=>eL.xor],54757);var f5=f5;let f6=eM.extend({providerId:eL.string(),accountId:eL.string(),userId:f5.string(),accessToken:eL.string().nullish(),refreshToken:eL.string().nullish(),idToken:eL.string().nullish(),accessTokenExpiresAt:eL.date().nullish(),refreshTokenExpiresAt:eL.date().nullish(),scope:eL.string().nullish(),password:eL.string().nullish()}),f7=eL.object({key:eL.string(),count:eL.number(),lastRequest:eL.number()});var f5=f5;let f8=eM.extend({userId:f5.string(),expiresAt:eL.date(),token:eL.string(),ipAddress:eL.string().nullish(),userAgent:eL.string().nullish()}),f9=eM.extend({email:eL.string().transform(a=>a.toLowerCase()),emailVerified:eL.boolean().default(!1),name:eL.string(),image:eL.string().nullish()}),ga=eM.extend({value:eL.string(),expiresAt:eL.date(),identifier:eL.string()});a.s([],21190);let gb={OK:200,CREATED:201,ACCEPTED:202,NO_CONTENT:204,MULTIPLE_CHOICES:300,MOVED_PERMANENTLY:301,FOUND:302,SEE_OTHER:303,NOT_MODIFIED:304,TEMPORARY_REDIRECT:307,BAD_REQUEST:400,UNAUTHORIZED:401,PAYMENT_REQUIRED:402,FORBIDDEN:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,NOT_ACCEPTABLE:406,PROXY_AUTHENTICATION_REQUIRED:407,REQUEST_TIMEOUT:408,CONFLICT:409,GONE:410,LENGTH_REQUIRED:411,PRECONDITION_FAILED:412,PAYLOAD_TOO_LARGE:413,URI_TOO_LONG:414,UNSUPPORTED_MEDIA_TYPE:415,RANGE_NOT_SATISFIABLE:416,EXPECTATION_FAILED:417,"I'M_A_TEAPOT":418,MISDIRECTED_REQUEST:421,UNPROCESSABLE_ENTITY:422,LOCKED:423,FAILED_DEPENDENCY:424,TOO_EARLY:425,UPGRADE_REQUIRED:426,PRECONDITION_REQUIRED:428,TOO_MANY_REQUESTS:429,REQUEST_HEADER_FIELDS_TOO_LARGE:431,UNAVAILABLE_FOR_LEGAL_REASONS:451,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,HTTP_VERSION_NOT_SUPPORTED:505,VARIANT_ALSO_NEGOTIATES:506,INSUFFICIENT_STORAGE:507,LOOP_DETECTED:508,NOT_EXTENDED:510,NETWORK_AUTHENTICATION_REQUIRED:511};var gc=class extends Error{constructor(a="INTERNAL_SERVER_ERROR",b,c={},d="number"==typeof a?a:gb[a]){super(b?.message,b?.cause?{cause:b.cause}:void 0),this.status=a,this.body=b,this.headers=c,this.statusCode=d,this.name="APIError",this.status=a,this.headers=c,this.statusCode=d,this.body=b?{code:b?.message?.toUpperCase().replace(/ /g,"_").replace(/[^A-Z0-9_]/g,""),...b}:void 0}},gd=class extends gc{constructor(a,b){super(400,{message:a,code:"VALIDATION_ERROR"}),this.message=a,this.issues=b,this.issues=b}},ge=class extends Error{constructor(a){super(a),this.name="BetterCallError"}};let gf=function(a,b){class c extends a{#o;constructor(...a){if(function(){let a=Object.getOwnPropertyDescriptor(Error,"stackTraceLimit");return void 0===a?Object.isExtensible(Error):Object.prototype.hasOwnProperty.call(a,"writable")?a.writable:void 0!==a.set}()){const b=Error.stackTraceLimit;Error.stackTraceLimit=0,super(...a),Error.stackTraceLimit=b}else super(...a);const b=Error().stack;b&&(this.#o=function(a){let b=a.split("\n    at ");return b.length<=1?a:(b.splice(1,1),b.join("\n    at "))}(b.replace(/^Error/,this.name)))}get errorStack(){return this.#o}}return Object.defineProperty(c.prototype,"constructor",{get:()=>b,enumerable:!1,configurable:!0}),c}(gc,Error),gg=/^application\/([a-z0-9.+-]*\+)?json/i;async function gh(a,b){let c=a.headers.get("content-type")||"",d=c.toLowerCase();if(a.body){if(b&&b.length>0&&!b.some(a=>{let b=d.split(";")[0].trim(),c=a.toLowerCase().trim();return b===c||b.includes(c)})){if(!d)throw new gf(415,{message:`Content-Type is required. Allowed types: ${b.join(", ")}`,code:"UNSUPPORTED_MEDIA_TYPE"});throw new gf(415,{message:`Content-Type "${c}" is not allowed. Allowed types: ${b.join(", ")}`,code:"UNSUPPORTED_MEDIA_TYPE"})}if(gg.test(d))return await a.json();if(d.includes("application/x-www-form-urlencoded")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a.toString()}),c}if(d.includes("multipart/form-data")){let b=await a.formData(),c={};return b.forEach((a,b)=>{c[b]=a}),c}return d.includes("text/plain")?await a.text():d.includes("application/octet-stream")?await a.arrayBuffer():d.includes("application/pdf")||d.includes("image/")||d.includes("video/")?await a.blob():d.includes("application/stream")||a.body instanceof ReadableStream?a.body:await a.text()}}function gi(a){return a instanceof gf||a?.name==="APIError"}async function gj(a){try{return{data:await a,error:null}}catch(a){return{data:null,error:a}}}function gk(a){return a instanceof Request||"[object Request]"===Object.prototype.toString.call(a)}function gl(a,b){if(a instanceof Response)return b?.headers instanceof Headers&&b.headers.forEach((b,c)=>{a.headers.set(c,b)}),a;if(a&&"object"==typeof a&&"_flag"in a&&"json"===a._flag){let c=a.body,d=a.routerResponse;if(d instanceof Response)return d;let e=new Headers;if(d?.headers){let a=new Headers(d.headers);for(let[b,c]of a.entries())a.set(b,c)}if(a.headers)for(let[b,c]of new Headers(a.headers).entries())e.set(b,c);if(b?.headers)for(let[a,c]of new Headers(b.headers).entries())e.set(a,c);return e.set("Content-Type","application/json"),new Response(JSON.stringify(c),{...d,headers:e,status:a.status??b?.status??d?.status,statusText:b?.statusText??d?.statusText})}if(gi(a))return gl(a.body,{status:b?.status??a.statusCode,statusText:a.status.toString(),headers:b?.headers||a.headers});let c=a,d=new Headers(b?.headers);if(a){if("string"==typeof a)c=a,d.set("Content-Type","text/plain");else if(a instanceof ArrayBuffer||ArrayBuffer.isView(a))c=a,d.set("Content-Type","application/octet-stream");else if(a instanceof Blob)c=a,d.set("Content-Type",a.type||"application/octet-stream");else if(a instanceof FormData)c=a;else if(a instanceof URLSearchParams)c=a,d.set("Content-Type","application/x-www-form-urlencoded");else if(a instanceof ReadableStream)c=a,d.set("Content-Type","application/octet-stream");else if(function(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}(a)){let b,e;b=0,e=new WeakMap,c=JSON.stringify(a,(a,c)=>{if("bigint"==typeof c)return c.toString();if("object"==typeof c&&null!==c){if(e.has(c))return`[Circular ref-${e.get(c)}]`;e.set(c,b++)}return c},void 0),d.set("Content-Type","application/json")}}else null===a&&(c=JSON.stringify(null)),d.set("content-type","application/json");return new Response(c,{...b,headers:d})}let gm={name:"HMAC",hash:"SHA-256"},gn=async a=>{let b="string"==typeof a?new TextEncoder().encode(a):a;return await d0().importKey("raw",b,gm,!1,["sign","verify"])},go=async(a,b,c)=>{try{let d=atob(a),e=new Uint8Array(d.length);for(let a=0,b=d.length;a<b;a++)e[a]=d.charCodeAt(a);return await d0().verify(gm,c,e,new TextEncoder().encode(b))}catch(a){return!1}},gp=async(a,b)=>{let c=await gn(b);return btoa(String.fromCharCode(...new Uint8Array(await d0().sign(gm.name,c,new TextEncoder().encode(a)))))},gq=async(a,b)=>{let c=await gp(a,b);return encodeURIComponent(a=`${a}.${c}`)},gr=(a,b)=>{let c=a;if(b)if("secure"===b)c="__Secure-"+a;else{if("host"!==b)return;c="__Host-"+a}return c},gs=(a,b,c={})=>{let d;if(d=c?.prefix==="secure"?`__Secure-${a}=${b}`:c?.prefix==="host"?`__Host-${a}=${b}`:`${a}=${b}`,a.startsWith("__Secure-")&&!c.secure&&(c.secure=!0),a.startsWith("__Host-")&&(c.secure||(c.secure=!0),"/"!==c.path&&(c.path="/"),c.domain&&(c.domain=void 0)),c&&"number"==typeof c.maxAge&&c.maxAge>=0){if(c.maxAge>3456e4)throw Error("Cookies Max-Age SHOULD NOT be greater than 400 days (34560000 seconds) in duration.");d+=`; Max-Age=${Math.floor(c.maxAge)}`}if(c.domain&&"host"!==c.prefix&&(d+=`; Domain=${c.domain}`),c.path&&(d+=`; Path=${c.path}`),c.expires){if(c.expires.getTime()-Date.now()>3456e7)throw Error("Cookies Expires SHOULD NOT be greater than 400 days (34560000 seconds) in the future.");d+=`; Expires=${c.expires.toUTCString()}`}return c.httpOnly&&(d+="; HttpOnly"),c.secure&&(d+="; Secure"),c.sameSite&&(d+=`; SameSite=${c.sameSite.charAt(0).toUpperCase()+c.sameSite.slice(1)}`),c.partitioned&&(c.secure||(c.secure=!0),d+="; Partitioned"),d},gt=async(a,b,c,d)=>gs(a,b=await gq(b,c),d);async function gu(a,b={}){let c={body:b.body,query:b.query};if(a.body){let d=await a.body["~standard"].validate(b.body);if(d.issues)return{data:null,error:gv(d.issues,"body")};c.body=d.value}if(a.query){let d=await a.query["~standard"].validate(b.query);if(d.issues)return{data:null,error:gv(d.issues,"query")};c.query=d.value}return a.requireHeaders&&!b.headers?{data:null,error:{message:"Headers is required",issues:[]}}:a.requireRequest&&!b.request?{data:null,error:{message:"Request is required",issues:[]}}:{data:c,error:null}}function gv(a,b){return{message:a.map(a=>`[${a.path?.length?`${b}.`+a.path.map(a=>"object"==typeof a?a.key:a).join("."):b}] ${a.message}`).join("; "),issues:a}}let gw=async(a,{options:b,path:c})=>{let d,e=new Headers,{data:f,error:g}=await gu(b,a);if(g)throw new gd(g.message,g.issues);let h="headers"in a?a.headers instanceof Headers?a.headers:new Headers(a.headers):"request"in a&&gk(a.request)?a.request.headers:null,i=h?.get("cookie"),j=i?function(a){if("string"!=typeof a)throw TypeError("argument str must be a string");let b=new Map,c=0;for(;c<a.length;){let d=a.indexOf("=",c);if(-1===d)break;let e=a.indexOf(";",c);if(-1===e)e=a.length;else if(e<d){c=a.lastIndexOf(";",d-1)+1;continue}let f=a.slice(c,d).trim();if(!b.has(f)){let c=a.slice(d+1,e).trim();34===c.codePointAt(0)&&(c=c.slice(1,-1)),b.set(f,function(a){try{return a.includes("%")?decodeURIComponent(a):a}catch{return a}}(c))}c=e+1}return b}(i):void 0,k={...a,body:f.body,query:f.query,path:a.path||c||"virtual:",context:"context"in a&&a.context?a.context:{},returned:void 0,headers:a?.headers,request:a?.request,params:"params"in a?a.params:void 0,method:a.method??(Array.isArray(b.method)?b.method[0]:"*"===b.method?"GET":b.method),setHeader:(a,b)=>{e.set(a,b)},getHeader:a=>h?h.get(a):null,getCookie:(a,b)=>{let c=gr(a,b);return c&&j?.get(c)||null},getSignedCookie:async(a,b,c)=>{let d=gr(a,c);if(!d)return null;let e=j?.get(d);if(!e)return null;let f=e.lastIndexOf(".");if(f<1)return null;let g=e.substring(0,f),h=e.substring(f+1);return 44===h.length&&h.endsWith("=")?!!await go(h,g,await gn(b))&&g:null},setCookie:(a,b,c)=>{var d;let f=gs(a,d=encodeURIComponent(d=b),c);return e.append("set-cookie",f),f},setSignedCookie:async(a,b,c,d)=>{let f=await gt(a,b,c,d);return e.append("set-cookie",f),f},redirect:a=>(e.set("location",a),new gf("FOUND",void 0,e)),error:(a,b,c)=>new gf(a,b,c),setStatus:a=>{d=a},json:(b,c)=>a.asResponse?{body:c?.body||b,routerResponse:c,_flag:"json"}:b,responseHeaders:e,get responseStatus(){return d}};for(let a of b.use||[]){let b=await a({...k,returnHeaders:!0,asResponse:!1});b.response&&Object.assign(k.context,b.response),b.headers&&b.headers.forEach((a,b)=>{k.responseHeaders.set(b,a)})}return k};function gx(a,b,c){let d="string"==typeof a?a:void 0,e="object"==typeof b?b:a,f="function"==typeof b?b:c;if(("GET"===e.method||"HEAD"===e.method)&&e.body)throw new ge("Body is not allowed with GET or HEAD methods");if(d&&/\/{2,}/.test(d))throw new ge("Path cannot contain consecutive slashes");let g=async(...a)=>{let b=a[0]||{},{data:c,error:g}=await gj(gw(b,{options:e,path:d}));if(g){if(!(g instanceof gd))throw g;throw e.onValidationError&&await e.onValidationError({message:g.message,issues:g.issues}),new gf(400,{message:g.message,code:"VALIDATION_ERROR"})}let h=await f(c).catch(async a=>{if(gi(a)){let c=e.onAPIError;if(c&&await c(a),b.asResponse)return a}throw a}),i=c.responseHeaders,j=c.responseStatus;return b.asResponse?gl(h,{headers:i,status:j}):b.returnHeaders?b.returnStatus?{headers:i,response:h,status:j}:{headers:i,response:h}:b.returnStatus?{response:h,status:j}:h};return g.options=e,g.path=d,g}function gy(a,b){let c=async c=>{let d="function"==typeof a?a:b,e=await gw(c,{options:"function"==typeof a?{}:a,path:"/"});if(!d)throw Error("handler must be defined");let f=await d(e),g=e.responseHeaders;return c.returnHeaders?{headers:g,response:f}:f};return c.options="function"==typeof a?{}:a,c}gx.create=a=>(b,c,d)=>gx(b,{...c,use:[...c?.use||[],...a?.use||[]]},d),gy.create=a=>function(b,c){if("function"==typeof b)return gy({use:a?.use},b);if(!c)throw Error("Middleware handler is required");return gy({...b,method:"*",use:[...a?.use||[],...b.use||[]]},c)};let gz={};function gA(a){switch(a.constructor.name){case"ZodString":default:return"string";case"ZodNumber":return"number";case"ZodBoolean":return"boolean";case"ZodObject":return"object";case"ZodArray":return"array"}}function gB(a){let b=[];return a.metadata?.openapi?.parameters?b.push(...a.metadata.openapi.parameters):a.query instanceof eL.ZodObject&&Object.entries(a.query.shape).forEach(([a,c])=>{c instanceof eL.ZodObject&&b.push({name:a,in:"query",schema:{type:gA(c),..."minLength"in c&&c.minLength?{minLength:c.minLength}:{},description:c.description}})}),b}function gC(a){return{400:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Bad Request. Usually due to missing parameters, or invalid parameters."},401:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}},required:["message"]}}},description:"Unauthorized. Due to missing or invalid authentication."},403:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Forbidden. You do not have permission to access this resource or to perform this action."},404:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Not Found. The requested resource was not found."},429:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Too Many Requests. You have exceeded the rate limit. Try again later."},500:{content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}},description:"Internal Server Error. This is a problem with the server that you cannot fix."},...a}}async function gD(a,b){return Object.entries(a).forEach(([a,b])=>{let c=b.options;if(!(!b.path||c.metadata?.SERVER_ONLY)&&("GET"===c.method&&(gz[b.path]={get:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:gB(c),responses:gC(c.metadata?.openapi?.responses)}}),"POST"===c.method)){let a=function(a){if(a.metadata?.openapi?.requestBody)return a.metadata.openapi.requestBody;if(a.body&&(a.body instanceof eL.ZodObject||a.body instanceof eL.ZodOptional)){let b=a.body.shape;if(!b)return;let c={},d=[];return Object.entries(b).forEach(([a,b])=>{b instanceof eL.ZodObject&&(c[a]={type:gA(b),description:b.description},b instanceof eL.ZodOptional||d.push(a))}),{required:!(a.body instanceof eL.ZodOptional)&&!!a.body,content:{"application/json":{schema:{type:"object",properties:c,required:d}}}}}}(c);gz[b.path]={post:{tags:["Default",...c.metadata?.openapi?.tags||[]],description:c.metadata?.openapi?.description,operationId:c.metadata?.openapi?.operationId,security:[{bearerAuth:[]}],parameters:gB(c),...a?{requestBody:a}:{requestBody:{content:{"application/json":{schema:{type:"object",properties:{}}}}}},responses:gC(c.metadata?.openapi?.responses)}}}}),{openapi:"3.1.1",info:{title:"Better Auth",description:"API Reference for your Better Auth Instance",version:"1.1.0"},components:{schemas:{}},security:[{apiKeyCookie:[]}],servers:[{url:b?.url}],tags:[{name:"Default",description:"Default endpoints that are included with Better Auth by default. These endpoints are not part of any plugin."}],paths:gz}}let gE=((i=function(){}).prototype=Object.create(null),Object.freeze(i.prototype),i);function gF(){return{root:{key:""},static:new gE}}function gG(a){let[b,...c]=a.split("/");return""===c[c.length-1]?c.slice(0,-1):c}function gH(a,b){let c=new gE;for(let[d,e]of b){let b=d<0?a.slice(-(d+1)).join("/"):a[d];if("string"==typeof e)c[e]=b;else{let a=b.match(e);if(a)for(let b in a.groups)c[b]=a.groups[b]}}return c}function gI(a,b="",c,d){b=b.toUpperCase(),47!==c.charCodeAt(0)&&(c=`/${c}`);let e=gG(c=c.replace(/\\:/g,"%3A")),f=a.root,g=0,h=[],i=[];for(let a=0;a<e.length;a++){let b=e[a];if(b.startsWith("**")){f.wildcard||(f.wildcard={key:"**"}),f=f.wildcard,h.push([-(a+1),b.split(":")[1]||"_",2===b.length]);break}if("*"===b||b.includes(":")){if(f.param||(f.param={key:"*"}),f=f.param,"*"===b)h.push([a,`_${g++}`,!0]);else if(b.includes(":",1)){let c=function(a){let b=a.replace(/:(\w+)/g,(a,b)=>`(?<${b}>[^/]+)`).replace(/\./g,"\\.");return RegExp(`^${b}$`)}(b);i[a]=c,f.hasRegexParam=!0,h.push([a,c,!1])}else h.push([a,b.slice(1),!1]);continue}"\\*"===b?b=e[a]="*":"\\*\\*"===b&&(b=e[a]="**");let c=f.static?.[b];if(c)f=c;else{let a={key:b};f.static||(f.static=new gE),f.static[b]=a,f=a}}let j=h.length>0;f.methods||(f.methods=new gE),f.methods[b]??=[],f.methods[b].push({data:d||null,paramsRegexp:i,paramsMap:j?h:void 0}),j||(a.static["/"+e.join("/")]=f)}let gJ=new WeakMap;function gK(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}(!1!==e.returned||"id"===b)&&(d[b]=a[b])}return d}function gL(a,b,c){let d=`${b}:${c}`;gJ.has(a)||gJ.set(a,new Map);let e=gJ.get(a);if(e.has(d))return e.get(d);let f="output"===c?(0,eK.getAuthTables)(a)[b]?.fields??{}:{},g="user"===b||"session"===b||"account"===b?a[b]?.additionalFields:void 0,h={...f,...g??{}};for(let c of a.plugins||[])c.schema&&c.schema[b]&&(h={...h,...c.schema[b].fields});return e.set(d,h),h}function gM(a,b){return gK(b,{fields:gL(a,"user","output")})}function gN(a,b){return gK(b,{fields:gL(a,"session","output")})}function gO(a,b){let{accessToken:c,refreshToken:d,idToken:e,accessTokenExpiresAt:f,refreshTokenExpiresAt:g,password:h,...i}=gK(b,{fields:gL(a,"account","output")});return i}function gP(a,b){let c=b.action||"create",d=b.fields,e=Object.assign(Object.create(null),null);for(let b in d){if(b in a){if(!1===d[b].input){if(void 0!==d[b].defaultValue&&"update"!==c){e[b]=d[b].defaultValue;continue}if(a[b])throw new gf("BAD_REQUEST",{message:`${b} is not allowed to be set`});continue}if(d[b].validator?.input&&void 0!==a[b]){let c=d[b].validator.input["~standard"].validate(a[b]);if(c instanceof Promise)throw new gf("INTERNAL_SERVER_ERROR",{message:"Async validation is not supported for additional fields"});if("issues"in c&&c.issues)throw new gf("BAD_REQUEST",{message:c.issues[0]?.message||"Validation Error"});e[b]=c.value;continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(void 0!==d[b].defaultValue&&"create"===c){if("function"==typeof d[b].defaultValue){e[b]=d[b].defaultValue();continue}e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new gf("BAD_REQUEST",{message:`${b} is required`})}return e}function gQ(a,b={},c){return gP(b,{fields:gL(a,"user","input"),action:c})}function gR(a,b){return gP(b||{},{fields:gL(a,"user","input")})}function gS(a,b){return gP(b,{fields:gL(a,"account","input")})}function gT(a,b){return gP(b,{fields:gL(a,"session","input")})}function gU(a,b){if(!b)return a;for(let c in b){let d=b[c]?.modelName;for(let e in d&&(a[c].modelName=d),a[c].fields){let d=b[c]?.fields?.[e];d&&(a[c].fields[e].fieldName=d)}}return a}a.i(12793);var gV=a.i(72224),f5=f5;function gW(a){let b=a.split("."),c=parseInt(b[b.length-1]||"0",10);return isNaN(c)?0:c}function gX(a,b){let c={};for(let d in a)c[d]={name:d,value:"",attributes:{...b,maxAge:0}};return c}let gY=a=>(b,c,d)=>{let e=function(a,b){let c={};for(let[d,e]of Object.entries(function(a){let b=a.headers?.get("cookie");if(!b)return{};let c={};for(let a of b.split("; ")){let[b,...d]=a.split("=");b&&d.length>0&&(c[b]=d.join("="))}return c}(b)))d.startsWith(a)&&(c[d]=e);return c}(b,d),f=d.context.logger;return{getValue:()=>Object.keys(e).sort((a,b)=>gW(a)-gW(b)).map(a=>e[a]).join(""),hasChunks:()=>Object.keys(e).length>0,chunk(d,g){let h=gX(e,c);for(let a in e)delete e[a];for(let i of function(a,b,c,d){let e=Math.ceil(b.value.length/3896);if(1===e)return c[b.name]=b.value,[b];let f=[];for(let a=0;a<e;a++){let d=`${b.name}.${a}`,e=3896*a,g=b.value.substring(e,e+3896);f.push({...b,name:d,value:g}),c[d]=g}return d.debug(`CHUNKING_${a.toUpperCase()}_COOKIE`,{message:`${a} cookie exceeds allowed 4096 bytes.`,emptyCookieSize:200,valueSize:b.value.length,chunkCount:e,chunks:f.map(a=>a.value.length+200)}),f}(a,{name:b,value:d,attributes:{...c,...g}},e,f))h[i.name]=i;return Object.values(h)},clean(){let a=gX(e,c);for(let a in e)delete e[a];return Object.values(a)},setCookies(a){for(let b of a)d.setCookie(b.name,b.value,b.attributes)}}},gZ=gY("Session"),g$=gY("Account");function g_(a,b){let c=a.getCookie(b);if(c)return c;let d=[],e=a.headers?.get("cookie");if(!e)return null;let f={};for(let a of e.split("; ")){let[b,...c]=a.split("=");b&&c.length>0&&(f[b]=c.join("="))}for(let[a,c]of Object.entries(f))if(a.startsWith(b+".")){let b=parseInt(a.split(".").at(-1)||"0",10);isNaN(b)||d.push({index:b,value:c})}return d.length>0?(d.sort((a,b)=>a.index-b.index),d.map(a=>a.value).join("")):null}async function g0(a,b){let c=a.context.authCookies.accountData,d={maxAge:300,...c.attributes},e=await dR(b,a.context.secret,"better-auth-account",d.maxAge);if(e.length>4096){let b=g$(c.name,d,a),f=b.chunk(e,d);b.setCookies(f)}else{let b=g$(c.name,d,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(c.name,e,d)}}async function g1(a){let b=g_(a,a.context.authCookies.accountData.name);if(b){let c=(0,gV.safeJSONParse)(await dS(b,a.context.secret,"better-auth-account"));if(c)return c}return null}let g2=eL.optional(eL.object({disableCookieCache:f5.boolean().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:f5.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));function g3(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}let g4=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)(?: (ago|from now))?$/i;a.i(18129);var g5=a.i(85030),g6=a.i(9413);let g7=new Map,g8={decode:(a,b="utf-8")=>(g7.has(b)||g7.set(b,new TextDecoder(b)),g7.get(b).decode(a)),encode:new TextEncoder().encode},g9=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>d0().importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,d)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let e=await d0().sign("HMAC",a,"string"==typeof d?new TextEncoder().encode(d):d);return"hex"===b?dU(e):"base64"===b||"base64url"===b||"base64urlnopad"===b?d5.encode(e,{padding:"base64urlnopad"!==b}):e},verify:async(a,d,e)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(e=(a=>{if(!a)return"";if("string"==typeof a){if(a.length%2!=0||!RegExp("^[0123456789abcdef]+$").test(a))throw Error("Invalid hexadecimal string");let b=new Uint8Array(a.length/2);for(let c=0;c<a.length;c+=2)b[c/2]=parseInt(a.slice(c,c+2),16);return new TextDecoder().decode(b)}return new TextDecoder().decode(a)})(e)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(e=await d4.decode(e)),d0().verify("HMAC",a,"string"==typeof e?new TextEncoder().encode(e):e,"string"==typeof d?new TextEncoder().encode(d):d))};return c};function ha(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:a.baseURL?!!a.baseURL.startsWith("https://"):g5.isProduction)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,d=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!d)throw new dT.BetterAuthError("baseURL is required when crossSubdomainCookies are enabled");return function(e,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[e]?.name||`${g}.${e}`,i=a.advanced?.cookies?.[e]?.attributes,j={secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:d}:{},...a.advanced?.defaultCookieAttributes,...f,...i};return{name:`${b}${h}`,attributes:j,options:j}}}async function hb(a,b,c){let d;if(!a.context.options.session?.cookieCache?.enabled)return;let e=(0,g6.filterOutputFields)(b.session,a.context.options.session?.additionalFields),f=gM(a.context.options,b.user),g=a.context.options.session?.cookieCache?.version,h="1";if(g){if("string"==typeof g)h=g;else if("function"==typeof g){let a=g(b.session,b.user);h=g3(a)?await a:a}}let i={session:e,user:f,updatedAt:Date.now(),version:h},j={...a.context.authCookies.sessionData.attributes,maxAge:c?void 0:a.context.authCookies.sessionData.attributes.maxAge},k=eJ(j.maxAge||60,"sec").getTime(),l=a.context.options.session?.cookieCache?.strategy||"compact";if((d="jwe"===l?await dR(i,a.context.secret,"better-auth-session",j.maxAge||300):"jwt"===l?await dN(i,a.context.secret,j.maxAge||300):d5.encode(JSON.stringify({session:i,expiresAt:k,signature:await g9("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...i,expiresAt:k}))}),{padding:!1})).length>4093){let b=gZ(a.context.authCookies.sessionData.name,j,a),c=b.chunk(d,j);b.setCookies(c)}else{let b=gZ(a.context.authCookies.sessionData.name,j,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(a.context.authCookies.sessionData.name,d,j)}if(a.context.options.account?.storeAccountCookie){let b=await g1(a);b&&await g0(a,b)}}async function hc(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.attributes,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.attributes),await hb(a,b,c),a.context.setNewSession(b)}function hd(a,b){a.setCookie(b.name,"",{...b.attributes,maxAge:0})}function he(a,b){if(hd(a,a.context.authCookies.sessionToken),hd(a,a.context.authCookies.sessionData),a.context.options.account?.storeAccountCookie){hd(a,a.context.authCookies.accountData);let b=g$(a.context.authCookies.accountData.name,a.context.authCookies.accountData.attributes,a),c=b.clean();b.setCookies(c)}"cookie"===a.context.oauthConfig.storeStateStrategy&&hd(a,a.context.createAuthCookie("oauth_state"));let c=gZ(a.context.authCookies.sessionData.name,a.context.authCookies.sessionData.attributes,a),d=c.clean();c.setCookies(d),b||hd(a,a.context.authCookies.dontRememberToken)}var hf=dT,f5=f5;let hg=eL.looseObject({callbackURL:eL.string(),codeVerifier:eL.string(),errorURL:eL.string().optional(),newUserURL:eL.string().optional(),expiresAt:eL.number(),link:eL.object({email:eL.string(),userId:f5.string()}).optional(),requestSignUp:eL.boolean().optional()});var hh=class extends hf.BetterAuthError{code;details;constructor(a,b){super(a,b),this.code=b.code,this.details=b.details}};async function hi(a,b,c){let d=bt(32);if("cookie"===a.context.oauthConfig.storeStateStrategy){let e=await eH({key:a.context.secret,data:JSON.stringify(b)}),f=a.context.createAuthCookie(c?.cookieName??"oauth_state",{maxAge:600});return a.setCookie(f.name,e,f.attributes),{state:d,codeVerifier:b.codeVerifier}}let e=a.context.createAuthCookie(c?.cookieName??"state",{maxAge:300});await a.setSignedCookie(e.name,d,a.context.secret,e.attributes);let f=new Date;f.setMinutes(f.getMinutes()+10);let g=await a.context.internalAdapter.createVerificationValue({value:JSON.stringify(b),identifier:d,expiresAt:f});if(!g)throw new hh("Unable to create verification. Make sure the database adapter is properly working and there is a verification table in the database",{code:"state_generation_error"});return{state:g.identifier,codeVerifier:b.codeVerifier}}async function hj(a,b,c){let d;if("cookie"===a.context.oauthConfig.storeStateStrategy){let e=a.context.createAuthCookie(c?.cookieName??"oauth_state"),f=a.getCookie(e.name);if(!f)throw new hh("State mismatch: auth state cookie not found",{code:"state_mismatch",details:{state:b}});try{let b=await eI({key:a.context.secret,data:f});d=hg.parse(JSON.parse(b))}catch(a){throw new hh("State invalid: Failed to decrypt or parse auth state",{code:"state_invalid",details:{state:b},cause:a})}hd(a,e)}else{let e=await a.context.internalAdapter.findVerificationValue(b);if(!e)throw new hh("State mismatch: verification not found",{code:"state_mismatch",details:{state:b}});d=hg.parse(JSON.parse(e.value));let f=a.context.createAuthCookie(c?.cookieName??"state"),g=await a.getSignedCookie(f.name,a.context.secret);if(!a.context.oauthConfig.skipStateCookieCheck&&(!g||g!==b))throw new hh("State mismatch: State not persisted correctly",{code:"state_security_mismatch",details:{state:b}});hd(a,f),await a.context.internalAdapter.deleteVerificationValue(e.id)}if(d.expiresAt<Date.now())throw new hh("Invalid state: request expired",{code:"state_mismatch",details:{expiresAt:d.expiresAt}});return d}let hk=Symbol.for("better-auth:global"),hl=null,hm={},hn="1.4.20";function ho(){return globalThis[hk]||(globalThis[hk]={version:hn,epoch:1,context:hm},hl=globalThis[hk]),(hl=globalThis[hk]).version!==hn&&(hl.version=hn,hl.epoch++),globalThis[hk]}let hp=import("node:async_hooks").then(a=>a.AsyncLocalStorage).catch(a=>{if("AsyncLocalStorage"in globalThis)return globalThis.AsyncLocalStorage;throw console.warn("[better-auth] Warning: AsyncLocalStorage is not available in this environment. Some features may not work as expected."),console.warn("[better-auth] Please read more about this warning at https://better-auth.com/docs/installation#mount-handler"),console.warn("[better-auth] If you are using Cloudflare Workers, please see: https://developers.cloudflare.com/workers/configuration/compatibility-flags/#nodejs-compatibility-flag"),a});async function hq(){let a=await hp;if(null!==a)return a;throw Error("getAsyncLocalStorage is only available in server code")}let hr=async()=>{let a=ho();if(!a.context.endpointContextAsyncStorage){let b=await hq();a.context.endpointContextAsyncStorage=new b}return a.context.endpointContextAsyncStorage};async function hs(){let a=(await hr()).getStore();if(!a)throw Error("No auth context found. Please make sure you are calling this function within a `runWithEndpointContext` callback.");return a}async function ht(a,b){return(await hr()).run(a,b)}let hu=async()=>{let a=ho();if(!a.context.requestStateAsyncStorage){let b=await hq();a.context.requestStateAsyncStorage=new b}return a.context.requestStateAsyncStorage};async function hv(){return void 0!==(await hu()).getStore()}async function hw(){let a=(await hu()).getStore();if(!a)throw Error("No request state found. Please make sure you are calling this function within a `runWithRequestState` callback.");return a}async function hx(a,b){return(await hu()).run(a,b)}let hy=async()=>{let a=ho();if(!a.context.adapterAsyncStorage){let b=await hq();a.context.adapterAsyncStorage=new b}return a.context.adapterAsyncStorage},hz=async a=>hy().then(b=>b.getStore()||a).catch(()=>a),hA=async(a,b)=>hy().then(c=>c.run(a,b)).catch(a=>{throw a}),hB=async(a,b)=>hy().then(c=>a.transaction(async a=>c.run(a,b))).catch(a=>{throw a}),{get:hC,set:hD}=(n=()=>null,j=Object.freeze({}),{get ref(){return j},async get(){let a=await hw();if(!a.has(j)){let b=await n();return a.set(j,b),b}return a.get(j)},async set(a){(await hw()).set(j,a)}});async function hE(a,b,c){let d=a.body?.callbackURL||a.context.options.baseURL;if(!d)throw new gf("BAD_REQUEST",{message:"callbackURL is required"});let e=bt(128),f={...c||{},callbackURL:d,codeVerifier:e,errorURL:a.body?.errorCallbackURL,newUserURL:a.body?.newUserCallbackURL,link:b,expiresAt:Date.now()+6e5,requestSignUp:a.body?.requestSignUp};await hD(f);try{return hi(a,f)}catch(b){throw a.context.logger.error("Failed to create verification",b),new gf("INTERNAL_SERVER_ERROR",{message:"Unable to create verification",cause:b})}}async function hF(a){let b,c=a.query.state||a.body.state,d=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;try{b=await hj(a,c)}catch(b){if(a.context.logger.error("Failed to parse state",b),b instanceof hh&&"state_security_mismatch"===b.code)throw a.redirect(`${d}?error=state_mismatch`);throw a.redirect(`${d}?error=please_restart_the_process`)}return b.errorURL||(b.errorURL=d),b&&await hD(b),b}let hG={scope:"server"};var hH=a.i(39449),hI=a.i(5555);function hJ(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let d="get"in c?c.get(a):c[a];if("string"==typeof d){let a=d.split(",")[0].trim();if((0,hI.isValidIP)(a))return(0,hI.normalizeIP)(a,{ipv6Subnet:b.advanced?.ipAddress?.ipv6Subnet})}}return(0,g5.isTest)()||(0,g5.isDevelopment)()?"127.0.0.1":null}function hK(a,b="/api/auth"){try{let b=new URL(a);if("http:"!==b.protocol&&"https:"!==b.protocol)throw new dT.BetterAuthError(`Invalid base URL: ${a}. URL must include 'http://' or 'https://'`)}catch(b){if(b instanceof dT.BetterAuthError)throw b;throw new dT.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`,{cause:b})}if(function(a){try{return"/"!==(new URL(a).pathname.replace(/\/+$/,"")||"/")}catch{throw new dT.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a))return a;let c=a.replace(/\/+$/,"");return b&&"/"!==b?(b=b.startsWith("/")?b:`/${b}`,`${c}${b}`):c}function hL(a,b){return!!a&&""!==a.trim()&&("proto"===b?"http"===a||"https"===a:"host"===b&&![/\.\./,/\0/,/[\s]/,/^[.]/,/[<>'"]/,/javascript:/i,/file:/i,/data:/i].some(b=>b.test(a))&&(/^[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*(:[0-9]{1,5})?$/.test(a)||/^(\d{1,3}\.){3}\d{1,3}(:[0-9]{1,5})?$/.test(a)||/^\[[0-9a-fA-F:]+\](:[0-9]{1,5})?$/.test(a)||/^localhost(:[0-9]{1,5})?$/i.test(a)))}function hM(a,b,c,d,e){if(a)return hK(a,b);if(!1!==d){let a=g5.env.BETTER_AUTH_URL||g5.env.NEXT_PUBLIC_BETTER_AUTH_URL||g5.env.PUBLIC_BETTER_AUTH_URL||g5.env.NUXT_PUBLIC_BETTER_AUTH_URL||g5.env.NUXT_PUBLIC_AUTH_URL||("/"!==g5.env.BASE_URL?g5.env.BASE_URL:void 0);if(a)return hK(a,b)}let f=c?.headers.get("x-forwarded-host"),g=c?.headers.get("x-forwarded-proto");if(f&&g&&e&&hL(g,"proto")&&hL(f,"host"))try{return hK(`${g}://${f}`,b)}catch(a){}if(c){let a=hN(c.url);if(!a)throw new dT.BetterAuthError("Could not get origin from request. Please provide a valid base URL.");return hK(a,b)}}function hN(a){try{let b=new URL(a);return"null"===b.origin?null:b.origin}catch{return null}}function hO(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function hP(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function hQ(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b))return`(?:${b.map(b=>`^${a(b,c)}$`).join("|")})`;let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=hO(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=hO(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=hO(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=hP.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}let hR=(a,b,c)=>{if(a.startsWith("/"))return!!c?.allowRelativePaths&&a.startsWith("/")&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a);if(b.includes("*")||b.includes("?")){if(b.includes("://"))return hQ(b)(hN(a)||a);let c=function(a){try{return new URL(a).host}catch{return null}}(a);return!!c&&hQ(b)(c)}let d=function(a){try{return new URL(a).protocol}catch{return null}}(a);return"http:"!==d&&"https:"!==d&&d?a.startsWith(b):b===hN(a)};var hS=a.i(33407),hT=a.i(91709),hU=a.i(12281);let hV=gy(async()=>({})),hW=gy.create({use:[hV,gy(async()=>({}))]}),hX=[hV];function hY(a,b,c){let d="string"==typeof a?a:void 0,e="object"==typeof b?b:a,f="function"==typeof b?b:c;return d?gx(d,{...e,use:[...e?.use||[],...hX]},async a=>ht(a,()=>f(a))):gx({...e,use:[...e?.use||[],...hX]},async a=>ht(a,()=>f(a)))}function hZ(a){return!0===a.context.skipOriginCheck&&a.context.options.advanced?.disableCSRFCheck===void 0}let h$=(0,hT.deprecate)(function(){},"disableOriginCheck: true currently also disables CSRF checks. In a future version, disableOriginCheck will ONLY disable URL validation. To keep CSRF disabled, add disableCSRFCheck: true to your config."),h_=hW(async a=>{if(a.request?.method==="GET"||a.request?.method==="OPTIONS"||a.request?.method==="HEAD"||!a.request||(await h1(a),a.context.skipOriginCheck))return;let{body:b,query:c}=a,d=b?.callbackURL||c?.callbackURL,e=b?.redirectTo,f=b?.errorCallbackURL,g=b?.newUserCallbackURL,h=(b,c)=>{if(b&&!a.context.isTrustedOrigin(b,{allowRelativePaths:"origin"!==c}))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${a.context.trustedOrigins}`),new gf("FORBIDDEN",{message:`Invalid ${c}`})};d&&h(d,"callbackURL"),e&&h(e,"redirectURL"),f&&h(f,"errorCallbackURL"),g&&h(g,"newUserCallbackURL")}),h0=a=>hW(async b=>{if(!b.request||b.context.skipOriginCheck)return;let c=a(b),d=(a,c)=>{if(a&&!b.context.isTrustedOrigin(a,{allowRelativePaths:"origin"!==c}))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${b.context.trustedOrigins}`),new gf("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(c)?c:[c])d(a,"callbackURL")});async function h1(a,b=!1){let c=a.request?.headers;if(!c||!a.request)return;let d=c.get("origin")||c.get("referer")||"",e=c.has("cookie");if(a.context.skipCSRFCheck)return;if(hZ(a)){a.context.options.advanced?.disableOriginCheck===!0&&h$();return}let f=a.context.skipOriginCheck;if(Array.isArray(f))try{let b=new URL(a.context.baseURL).pathname,c=(0,hU.normalizePathname)(a.request.url,b);if(f.some(a=>c.startsWith(a)))return}catch{}if(!(b||e))return;if(!d||"null"===d)throw new gf("FORBIDDEN",{message:hS.BASE_ERROR_CODES.MISSING_OR_NULL_ORIGIN});let g=Array.isArray(a.context.options.trustedOrigins)?a.context.trustedOrigins:[...a.context.trustedOrigins,...(await a.context.options.trustedOrigins?.(a.request))?.filter(a=>!!a)||[]];if(!g.some(a=>hR(d,a)))throw a.context.logger.error(`Invalid origin: ${d}`),a.context.logger.info(`If it's a valid URL, please add ${d} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${g}`),new gf("FORBIDDEN",{message:"Invalid origin"})}let h2=hW(async a=>{a.request&&await h3(a)});async function h3(a){let b=a.request;if(!b||a.context.skipCSRFCheck||hZ(a))return;let c=b.headers;if(c.has("cookie"))return await h1(a);let d=c.get("Sec-Fetch-Site"),e=c.get("Sec-Fetch-Mode"),f=c.get("Sec-Fetch-Dest");if(d&&d.trim()||e&&e.trim()||f&&f.trim()){if("cross-site"===d&&"navigate"===e)throw a.context.logger.error("Blocked cross-site navigation login attempt (CSRF protection)",{secFetchSite:d,secFetchMode:e,secFetchDest:f}),new gf("FORBIDDEN",{message:hS.BASE_ERROR_CODES.CROSS_SITE_NAVIGATION_LOGIN_BLOCKED});return await h1(a,!0)}}let h4=new Map;async function h5(a,b){if(!b.rateLimit.enabled)return;let c=new URL(b.baseURL).pathname,d=(0,hU.normalizePathname)(a.url,c),e=b.rateLimit.window,f=b.rateLimit.max,g=hJ(a,b.options);if(!g)return;let h=(0,hI.createRateLimitKey)(g,d),i=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(d));for(let a of(i&&(e=i.window,f=i.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(d));if(b){e=b.window,f=b.max;break}}if(b.rateLimit.customRules){let c=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?hQ(a)(d):a===d);if(c){let d=b.rateLimit.customRules[c],g="function"==typeof d?await d(a,{window:e,max:f}):d;if(g&&(e=g.window,f=g.max),!1===g)return}}let j=function(a,b){let c,d;if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;let e=a.rateLimit.storage;return"secondary-storage"===e?{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?(0,gV.safeJSONParse)(c):null},set:async(c,d,e)=>{let f=b?.window??a.options.rateLimit?.window??10;await a.options.secondaryStorage?.set?.(c,JSON.stringify(d),f)}}:"memory"===e?{async get(a){let b=h4.get(a);return b?Date.now()>=b.expiresAt?(h4.delete(a),null):b.data:null},async set(c,d,e){let f=b?.window??a.options.rateLimit?.window??10,g=Date.now()+1e3*f;h4.set(c,{data:d,expiresAt:g})}}:(c="rateLimit",d=a.adapter,{get:async a=>{let b=(await d.findMany({model:c,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof b?.lastRequest&&(b.lastRequest=Number(b.lastRequest)),b},set:async(b,e,f)=>{try{f?await d.updateMany({model:c,where:[{field:"key",value:b}],update:{count:e.count,lastRequest:e.lastRequest}}):await d.create({model:c,data:{key:b,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}})}(b,{window:e}),k=await j.get(h),l=Date.now();if(k){var m,n,o;let a=l-k.lastRequest;if(m=f,n=e,Date.now()-k.lastRequest<1e3*n&&k.count>=m)return o=Math.ceil((k.lastRequest+1e3*e-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":o.toString()}});a>1e3*e?await j.set(h,{...k,count:1,lastRequest:l},!0):await j.set(h,{...k,count:k.count+1,lastRequest:l},!0)}else await j.set(h,{key:h,count:1,lastRequest:l})}var h6=Object.defineProperty,h7=Object.getOwnPropertyDescriptor,h8=Object.getOwnPropertyNames,h9=Object.prototype.hasOwnProperty,ia=(a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(var e,f=h8(b),g=0,h=f.length;g<h;g++)e=f[g],h9.call(a,e)||e===c||h6(a,e,{get:(a=>b[a]).bind(null,e),enumerable:!(d=h7(b,e))||d.enumerable});return a},ib=a.i(37839);async function ic(b,c){let d;if(b.database)d="function"==typeof b.database?b.database(b):await c(b);else{let c=Object.keys((0,eK.getAuthTables)(b)).reduce((a,b)=>(a[b]=[],a),{}),{memoryAdapter:e}=await a.A(88010);d=e(c)(b)}return d.transaction||(ib.logger.warn("Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation."),d.transaction=async a=>a(d)),d}async function id(b){return ic(b,async b=>{let{createKyselyAdapter:c}=await a.A(60484),{kysely:d,databaseType:e,transaction:f}=await c(b);if(!d)throw new dT.BetterAuthError("Failed to initialize database adapter");let{kyselyAdapter:g}=await a.A(60484);return g(d,{type:e||"sqlite",debugLogs:!!b.database&&"debugLogs"in b.database&&b.database.debugLogs,transaction:f})(b)})}let ie=(a,b)=>({type:a,...b});function ig(a,b){let c=b.id?{id:b.id}:{};for(let d in a){let e=a[d],f=b[d];void 0!==f&&(c[e.fieldName||d]=f)}return c}function ih(a,b){if(!b)return null;let c={id:b.id};for(let[d,e]of Object.entries(a))c[d]=b[e.fieldName||d];return c}function ii(a,b){let c=b.hooks;return{createWithHooks:async function(b,d,e){let f=await hs().catch(()=>null),g=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(g,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(g={...g,...a.data})}}let h=e?await e.fn(g):null,i=!e||e.executeMainFn?await (await hz(a)).create({model:d,data:g,forceAllowId:!0}):h;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(i,f)}return i},updateWithHooks:async function(b,d,e,f){let g=await hs().catch(()=>null),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await hz(a)).update({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},updateManyWithHooks:async function(b,d,e,f){let g=await hs().catch(()=>null),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await hz(a)).updateMany({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},deleteWithHooks:async function(b,d,e){let f=await hs().catch(()=>null),g=null;try{g=(await (await hz(a)).findMany({model:d,where:b,limit:1}))[0]||null}catch{}if(g)for(let a of c||[]){let b=a[d]?.delete?.before;if(b&&await b(g,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await hz(a)).delete({model:d,where:b}):h;if(g)for(let a of c||[]){let b=a[d]?.delete?.after;b&&await b(g,f)}return i},deleteManyWithHooks:async function(b,d,e){let f=await hs().catch(()=>null),g=[];try{g=await (await hz(a)).findMany({model:d,where:b})}catch{}for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.before;if(c&&await c(a,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await hz(a)).deleteMany({model:d,where:b}):h;for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.after;c&&await c(a,f)}return i}}}let ij=(a,b)=>{let c=b.logger,d=b.options,e=d.secondaryStorage,f=d.session?.expiresIn||604800,{createWithHooks:g,updateWithHooks:h,updateManyWithHooks:i,deleteWithHooks:j,deleteManyWithHooks:k}=ii(a,b);async function l(a){if(!e)return;let b=await e.get(`active-sessions-${a.id}`);if(!b)return;let c=Date.now(),d=((0,gV.safeJSONParse)(b)||[]).filter(a=>a.expiresAt>c);await Promise.all(d.map(async({token:b})=>{let d=await e.get(b);if(!d)return;let f=(0,gV.safeJSONParse)(d);if(!f)return;let g=Math.max(Math.floor(new Date(f.session.expiresAt).getTime()-c)/1e3,0);await e.set(b,JSON.stringify({session:f.session,user:a}),Math.floor(g))}))}return{createOAuthUser:async(b,c)=>hB(a,async()=>{let a=await g({createdAt:new Date,updatedAt:new Date,...b},"user",void 0);return{user:a,account:await g({...c,userId:a.id,createdAt:new Date,updatedAt:new Date},"account",void 0)}}),createUser:async a=>await g({createdAt:new Date,updatedAt:new Date,...a,email:a.email?.toLowerCase()},"user",void 0),createAccount:async a=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),listSessions:async c=>{if(e){let a=await e.get(`active-sessions-${c}`);if(!a)return[];let d=(0,gV.safeJSONParse)(a)||[],f=Date.now(),g=new Set,h=[];for(let{token:a,expiresAt:c}of d){if(c<=f||g.has(a))continue;g.add(a);let d=await e.get(a);if(d)try{let a="string"==typeof d?JSON.parse(d):d;if(!a?.session)continue;h.push(gN(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)}))}catch{continue}}return h}return await (await hz(a)).findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e)=>await (await hz(a)).findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async b=>{let c=await (await hz(a)).count({model:"user",where:b});return"string"==typeof c?parseInt(c):c},deleteUser:async a=>{(!e||d.session?.storeSessionInDatabase)&&await k([{field:"userId",value:a}],"session",void 0),await k([{field:"userId",value:a}],"account",void 0),await j([{field:"id",value:a}],"user",void 0)},createSession:async(b,c,h,i)=>{let j=await hs().catch(()=>null),k=j?.headers||j?.request?.headers,{id:l,...m}=h||{},n=gT(j?.context.options??d,{}),o={ipAddress:(j?.request||j?.headers)&&hJ(j?.request||j?.headers,j?.context.options)||"",userAgent:k?.get("user-agent")||"",...m,expiresAt:c?eJ(86400,"sec"):eJ(f,"sec"),userId:b,token:(0,hH.generateId)(32),createdAt:new Date,updatedAt:new Date,...n,...i?m:{}};return await g(o,"session",e?{fn:async c=>{let d=await e.get(`active-sessions-${b}`),f=[],g=Date.now();d&&(f=(f=(0,gV.safeJSONParse)(d)||[]).filter(a=>a.expiresAt>g&&a.token!==o.token));let h=[...f,{token:o.token,expiresAt:o.expiresAt.getTime()}].sort((a,b)=>a.expiresAt-b.expiresAt),i=Math.max(Math.floor(((h.at(-1)?.expiresAt??o.expiresAt.getTime())-g)/1e3),0);i>0&&await e.set(`active-sessions-${b}`,JSON.stringify(h),i);let j=await (await hz(a)).findOne({model:"user",where:[{field:"id",value:b}]}),k=Math.max(Math.floor((o.expiresAt.getTime()-g)/1e3),0);return k>0&&await e.set(o.token,JSON.stringify({session:c,user:j}),k),c},executeMainFn:d.session?.storeSessionInDatabase}:void 0)},findSession:async c=>{if(e){let a=await e.get(c);if(!a&&!d.session?.storeSessionInDatabase)return null;if(a){let c=(0,gV.safeJSONParse)(a);return c?{session:gN(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:gM(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}:null}}let f=await (await hz(a)).findOne({model:"session",where:[{value:c,field:"token"}],join:{user:!0}});if(!f)return null;let{user:g,...h}=f;return g?{session:gN(b.options,h),user:gM(b.options,g)}:null},findSessions:async b=>{if(e){let a=[];for(let c of b){let b=await e.get(c);if(b)try{let c="string"==typeof b?JSON.parse(b):b;if(!c?.session)continue;let d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}catch{continue}}return a}let c=await (await hz(a)).findMany({model:"session",where:[{field:"token",value:b,operator:"in"}],join:{user:!0}});return!c.length||c.some(a=>!a.user)?[]:c.map(a=>{let{user:b,...c}=a;return{session:c,user:b}})},updateSession:async(a,c)=>await h(c,[{field:"token",value:a}],"session",e?{async fn(c){let d=await e.get(a);if(!d)return null;let f=(0,gV.safeJSONParse)(d);if(!f)return null;let g={...f.session,...c,expiresAt:new Date(c.expiresAt??f.session.expiresAt),createdAt:new Date(f.session.createdAt),updatedAt:new Date(c.updatedAt??f.session.updatedAt)},h=gN(b.options,g),i=Date.now(),j=new Date(h.expiresAt).getTime(),k=Math.max(Math.floor((j-i)/1e3),0);if(k>0){await e.set(a,JSON.stringify({session:h,user:f.user}),k);let b=`active-sessions-${h.userId}`,c=await e.get(b),d=(c&&(0,gV.safeJSONParse)(c)||[]).filter(b=>b.token!==a&&b.expiresAt>i).concat([{token:a,expiresAt:j}]).sort((a,b)=>a.expiresAt-b.expiresAt),g=d.at(-1)?.expiresAt;g&&g>i?await e.set(b,JSON.stringify(d),Math.floor((g-i)/1e3)):await e.delete(b)}return h},executeMainFn:d.session?.storeSessionInDatabase}:void 0),deleteSession:async a=>{if(e){let f=await e.get(a);if(f){let{session:b}=(0,gV.safeJSONParse)(f)??{};if(!b)return void c.error("Session not found in secondary storage");let d=b.userId,g=await e.get(`active-sessions-${d}`);if(g){let b=(0,gV.safeJSONParse)(g)||[],c=Date.now(),f=b.filter(b=>b.expiresAt>c&&b.token!==a),h=f.sort((a,b)=>a.expiresAt-b.expiresAt).at(-1)?.expiresAt;f.length>0&&h&&h>Date.now()?await e.set(`active-sessions-${d}`,JSON.stringify(f),Math.floor((h-c)/1e3)):await e.delete(`active-sessions-${d}`)}else c.error("Active sessions list not found in secondary storage")}if(await e.delete(a),!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await j([{field:"token",value:a}],"session",void 0)},deleteAccounts:async a=>{await k([{field:"userId",value:a}],"account",void 0)},deleteAccount:async a=>{await j([{field:"id",value:a}],"account",void 0)},deleteSessions:async a=>{if(e){if("string"==typeof a){let b=await e.get(`active-sessions-${a}`),c=b?(0,gV.safeJSONParse)(b):[];if(!c)return;for(let a of c)await e.delete(a.token);await e.delete(`active-sessions-${a}`)}else for(let b of a)await e.get(b)&&await e.delete(b);if(!d.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await k([{field:Array.isArray(a)?"token":"userId",value:a,operator:Array.isArray(a)?"in":void 0}],"session",void 0)},findOAuthUser:async(b,c,d)=>{let e=await (await hz(a)).findOne({model:"account",where:[{value:c,field:"accountId"},{value:d,field:"providerId"}],join:{user:!0}});if(e)if(e.user)return{user:e.user,linkedAccount:e,accounts:[e]};else{let c=await (await hz(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,linkedAccount:e,accounts:[e]}:null}{let c=await (await hz(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,linkedAccount:null,accounts:await (await hz(a)).findMany({model:"account",where:[{value:c.id,field:"userId"}]})||[]}:null}},findUserByEmail:async(b,c)=>{let d=await (await hz(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}],join:{...c?.includeAccounts?{account:!0}:{}}});if(!d)return null;let{account:e,...f}=d;return{user:f,accounts:e??[]}},findUserById:async b=>b?await (await hz(a)).findOne({model:"user",where:[{field:"id",value:b}]}):null,linkAccount:async a=>await g({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),updateUser:async(a,b)=>{let c=await h(b,[{field:"id",value:a}],"user",void 0);return await l(c),c},updateUserByEmail:async(a,b)=>{let c=await h(b,[{field:"email",value:a.toLowerCase()}],"user",void 0);return await l(c),c},updatePassword:async(a,b)=>{await i({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0)},findAccounts:async b=>await (await hz(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async b=>await (await hz(a)).findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c)=>await (await hz(a)).findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async b=>await (await hz(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b)=>await h(b,[{field:"id",value:a}],"account",void 0),createVerificationValue:async a=>await g({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0),findVerificationValue:async b=>{let c=await (await hz(a)).findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return d.verification?.disableCleanup||await k([{field:"expiresAt",value:new Date,operator:"lt"}],"verification",void 0),c[0]},deleteVerificationValue:async a=>{await j([{field:"id",value:a}],"verification",void 0)},deleteVerificationByIdentifier:async a=>{await j([{field:"identifier",value:a}],"verification",void 0)},updateVerificationValue:async(a,b)=>await h(b,[{field:"id",value:a}],"verification",void 0)}};var ik=a.i(54757);a.s(["default",0,ik],68075),a.i(68075),a.s(["$brand",()=>eP.$brand,"$input",()=>eV.$input,"$output",()=>eV.$output,"NEVER",()=>eP.NEVER,"TimePrecision",()=>__TURBOPACK__imported__module__63571__.TimePrecision,"ZodAny",()=>eL.ZodAny,"ZodArray",()=>eL.ZodArray,"ZodBase64",()=>eL.ZodBase64,"ZodBase64URL",()=>eL.ZodBase64URL,"ZodBigInt",()=>eL.ZodBigInt,"ZodBigIntFormat",()=>eL.ZodBigIntFormat,"ZodBoolean",()=>eL.ZodBoolean,"ZodCIDRv4",()=>eL.ZodCIDRv4,"ZodCIDRv6",()=>eL.ZodCIDRv6,"ZodCUID",()=>eL.ZodCUID,"ZodCUID2",()=>eL.ZodCUID2,"ZodCatch",()=>eL.ZodCatch,"ZodCodec",()=>eL.ZodCodec,"ZodCustom",()=>eL.ZodCustom,"ZodCustomStringFormat",()=>eL.ZodCustomStringFormat,"ZodDate",()=>eL.ZodDate,"ZodDefault",()=>eL.ZodDefault,"ZodDiscriminatedUnion",()=>eL.ZodDiscriminatedUnion,"ZodE164",()=>eL.ZodE164,"ZodEmail",()=>eL.ZodEmail,"ZodEmoji",()=>eL.ZodEmoji,"ZodEnum",()=>eL.ZodEnum,"ZodError",()=>eN.ZodError,"ZodExactOptional",()=>eL.ZodExactOptional,"ZodFile",()=>eL.ZodFile,"ZodFirstPartyTypeKind",()=>Q,"ZodFunction",()=>eL.ZodFunction,"ZodGUID",()=>eL.ZodGUID,"ZodIPv4",()=>eL.ZodIPv4,"ZodIPv6",()=>eL.ZodIPv6,"ZodISODate",()=>eY.ZodISODate,"ZodISODateTime",()=>eY.ZodISODateTime,"ZodISODuration",()=>eY.ZodISODuration,"ZodISOTime",()=>eY.ZodISOTime,"ZodIntersection",()=>eL.ZodIntersection,"ZodIssueCode",0,eQ,"ZodJWT",()=>eL.ZodJWT,"ZodKSUID",()=>eL.ZodKSUID,"ZodLazy",()=>eL.ZodLazy,"ZodLiteral",()=>eL.ZodLiteral,"ZodMAC",()=>eL.ZodMAC,"ZodMap",()=>eL.ZodMap,"ZodNaN",()=>eL.ZodNaN,"ZodNanoID",()=>eL.ZodNanoID,"ZodNever",()=>eL.ZodNever,"ZodNonOptional",()=>eL.ZodNonOptional,"ZodNull",()=>eL.ZodNull,"ZodNullable",()=>eL.ZodNullable,"ZodNumber",()=>eL.ZodNumber,"ZodNumberFormat",()=>eL.ZodNumberFormat,"ZodObject",()=>eL.ZodObject,"ZodOptional",()=>eL.ZodOptional,"ZodPipe",()=>eL.ZodPipe,"ZodPrefault",()=>eL.ZodPrefault,"ZodPromise",()=>eL.ZodPromise,"ZodReadonly",()=>eL.ZodReadonly,"ZodRealError",()=>eN.ZodRealError,"ZodRecord",()=>eL.ZodRecord,"ZodSet",()=>eL.ZodSet,"ZodString",()=>eL.ZodString,"ZodStringFormat",()=>eL.ZodStringFormat,"ZodSuccess",()=>eL.ZodSuccess,"ZodSymbol",()=>eL.ZodSymbol,"ZodTemplateLiteral",()=>eL.ZodTemplateLiteral,"ZodTransform",()=>eL.ZodTransform,"ZodTuple",()=>eL.ZodTuple,"ZodType",()=>eL.ZodType,"ZodULID",()=>eL.ZodULID,"ZodURL",()=>eL.ZodURL,"ZodUUID",()=>eL.ZodUUID,"ZodUndefined",()=>eL.ZodUndefined,"ZodUnion",()=>eL.ZodUnion,"ZodUnknown",()=>eL.ZodUnknown,"ZodVoid",()=>eL.ZodVoid,"ZodXID",()=>eL.ZodXID,"ZodXor",()=>eL.ZodXor,"_ZodString",()=>eL._ZodString,"_default",()=>eL._default,"_function",()=>eL._function,"any",()=>eL.any,"array",()=>eL.array,"base64",()=>eL.base64,"base64url",()=>eL.base64url,"bigint",()=>eL.bigint,"boolean",()=>eL.boolean,"catch",()=>eL.catch,"check",()=>eL.check,"cidrv4",()=>eL.cidrv4,"cidrv6",()=>eL.cidrv6,"clone",()=>e7.clone,"codec",()=>eL.codec,"coerce",()=>f5,"config",()=>eP.config,"core",()=>f1,"cuid",()=>eL.cuid,"cuid2",()=>eL.cuid2,"custom",()=>eL.custom,"date",()=>eL.date,"decode",()=>eO.decode,"decodeAsync",()=>eO.decodeAsync,"default",0,ik,"describe",()=>eL.describe,"discriminatedUnion",()=>eL.discriminatedUnion,"e164",()=>eL.e164,"email",()=>eL.email,"emoji",()=>eL.emoji,"encode",()=>eO.encode,"encodeAsync",()=>eO.encodeAsync,"endsWith",()=>eW._endsWith,"enum",()=>eL.enum,"exactOptional",()=>eL.exactOptional,"file",()=>eL.file,"flattenError",()=>e6.flattenError,"float32",()=>eL.float32,"float64",()=>eL.float64,"formatError",()=>e6.formatError,"fromJSONSchema",()=>e_,"function",()=>eL.function,"getErrorMap",()=>eS,"globalRegistry",()=>eV.globalRegistry,"gt",()=>eW._gt,"gte",()=>eW._gte,"guid",()=>eL.guid,"hash",()=>eL.hash,"hex",()=>eL.hex,"hostname",()=>eL.hostname,"httpUrl",()=>eL.httpUrl,"includes",()=>eW._includes,"instanceof",()=>eL.instanceof,"int",()=>eL.int,"int32",()=>eL.int32,"int64",()=>eL.int64,"intersection",()=>eL.intersection,"ipv4",()=>eL.ipv4,"ipv6",()=>eL.ipv6,"iso",()=>eY,"json",()=>eL.json,"jwt",()=>eL.jwt,"keyof",()=>eL.keyof,"ksuid",()=>eL.ksuid,"lazy",()=>eL.lazy,"length",()=>eW._length,"literal",()=>eL.literal,"locales",()=>fY,"looseObject",()=>eL.looseObject,"looseRecord",()=>eL.looseRecord,"lowercase",()=>eW._lowercase,"lt",()=>eW._lt,"lte",()=>eW._lte,"mac",()=>eL.mac,"map",()=>eL.map,"maxLength",()=>eW._maxLength,"maxSize",()=>eW._maxSize,"meta",()=>eL.meta,"mime",()=>eW._mime,"minLength",()=>eW._minLength,"minSize",()=>eW._minSize,"multipleOf",()=>eW._multipleOf,"nan",()=>eL.nan,"nanoid",()=>eL.nanoid,"nativeEnum",()=>eL.nativeEnum,"negative",()=>eW._negative,"never",()=>eL.never,"nonnegative",()=>eW._nonnegative,"nonoptional",()=>eL.nonoptional,"nonpositive",()=>eW._nonpositive,"normalize",()=>eW._normalize,"null",()=>eL.null,"nullable",()=>eL.nullable,"nullish",()=>eL.nullish,"number",()=>eL.number,"object",()=>eL.object,"optional",()=>eL.optional,"overwrite",()=>eW._overwrite,"parse",()=>eO.parse,"parseAsync",()=>eO.parseAsync,"partialRecord",()=>eL.partialRecord,"pipe",()=>eL.pipe,"positive",()=>eW._positive,"prefault",()=>eL.prefault,"preprocess",()=>eL.preprocess,"prettifyError",()=>e6.prettifyError,"promise",()=>eL.promise,"property",()=>eW._property,"readonly",()=>eL.readonly,"record",()=>eL.record,"refine",()=>eL.refine,"regex",()=>eW._regex,"regexes",()=>f2.regexes,"registry",()=>eV.registry,"safeDecode",()=>eO.safeDecode,"safeDecodeAsync",()=>eO.safeDecodeAsync,"safeEncode",()=>eO.safeEncode,"safeEncodeAsync",()=>eO.safeEncodeAsync,"safeParse",()=>eO.safeParse,"safeParseAsync",()=>eO.safeParseAsync,"set",()=>eL.set,"setErrorMap",()=>eR,"size",()=>eW._size,"slugify",()=>eW._slugify,"startsWith",()=>eW._startsWith,"strictObject",()=>eL.strictObject,"string",()=>eL.string,"stringFormat",()=>eL.stringFormat,"stringbool",()=>eL.stringbool,"success",()=>eL.success,"superRefine",()=>eL.superRefine,"symbol",()=>eL.symbol,"templateLiteral",()=>eL.templateLiteral,"toJSONSchema",()=>eU.toJSONSchema,"toLowerCase",()=>eW._toLowerCase,"toUpperCase",()=>eW._toUpperCase,"transform",()=>eL.transform,"treeifyError",()=>e6.treeifyError,"trim",()=>eW._trim,"tuple",()=>eL.tuple,"uint32",()=>eL.uint32,"uint64",()=>eL.uint64,"ulid",()=>eL.ulid,"undefined",()=>eL.undefined,"union",()=>eL.union,"unknown",()=>eL.unknown,"uppercase",()=>eW._uppercase,"url",()=>eL.url,"util",()=>f4.util,"uuid",()=>eL.uuid,"uuidv4",()=>eL.uuidv4,"uuidv6",()=>eL.uuidv6,"uuidv7",()=>eL.uuidv7,"void",()=>eL.void,"xid",()=>eL.xid,"xor",()=>eL.xor,"z",0,ik],44532);var il=a.i(44532);function im({fields:a,isClientSide:b}){let c=Object.keys(a).reduce((c,d)=>{let e,f=a[d];return!f||b&&!1===f.input?c:(e="json"===f.type?il.json?il.json():il.any():"string[]"===f.type||"number[]"===f.type?il.array("string[]"===f.type?il.string():il.number()):Array.isArray(f.type)?il.any():il[f.type](),f?.required===!1&&(e=e.optional()),b||f?.returned!==!1)?{...c,[d]:e}:c},{});return il.object(c)}function io(a){let b=(0,iy.getAuthTables)(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={...c.references,model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}var ip=a.i(97251),iq=a.i(19560);a.i(6592);var ir=a.i(5553),is=a.i(15945);let it={postgres:{string:["character varying","varchar","text","uuid"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text","uuid"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar","uniqueidentifier"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]}};function iu(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=it[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}async function iv(a){try{let b=await iq.sql`SHOW search_path`.execute(a);if(b.rows[0]?.search_path)return b.rows[0].search_path.split(",").map(a=>a.trim()).map(a=>a.replace(/^["']|["']$/g,"")).filter(a=>!a.startsWith("$"))[0]||"public"}catch{}return"public"}async function iw(a){let b=io(a),c=(0,ib.createLogger)(a.logger),{kysely:d,databaseType:e}=await (0,ip.createKyselyAdapter)(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f="public";if("postgres"===e){f=await iv(d),c.debug(`PostgreSQL migration: Using schema '${f}' (from search_path)`);try{(await iq.sql`
				SELECT schema_name 
				FROM information_schema.schemata 
				WHERE schema_name = ${f}
			`.execute(d)).rows[0]||c.warn(`Schema '${f}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`)}catch(a){c.debug(`Could not verify schema existence: ${a instanceof Error?a.message:String(a)}`)}}let g=await d.introspection.getTables(),h=g;if("postgres"===e)try{let a=await iq.sql`
				SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = ${f}
				AND table_type = 'BASE TABLE'
			`.execute(d),b=new Set(a.rows.map(a=>a.table_name));h=g.filter(a=>a.schema===f&&b.has(a.name)),c.debug(`Found ${h.length} table(s) in schema '${f}': ${h.map(a=>a.name).join(", ")||"(none)"}`)}catch(a){c.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${a instanceof Error?a.message:String(a)}`)}let i=[],j=[];for(let[a,d]of Object.entries(b)){let b=h.find(b=>b.name===a);if(!b){let b=i.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=i.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?i.push(c):i[b].fields={...i[b].fields,...d.fields}:i.splice(e,0,c);continue}let f={};for(let[g,h]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===g);if(!d){f[g]=h;continue}iu(d.dataType,h.type,e)||c.warn(`Field ${g} in table ${a} has a different type in the database. Expected ${h.type} but got ${d.dataType}.`)}Object.keys(f).length>0&&j.push({table:a,fields:f,order:d.order||1/0})}let k=[],l=a.advanced?.database?.generateId==="uuid",m=a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial";function n(a,b){let c=a.type,d=e||"sqlite",f={string:{sqlite:"text",postgres:"text",mysql:a.unique?"varchar(255)":a.references?"varchar(36)":a.sortable||a.index?"varchar(255)":"text",mssql:a.unique||a.sortable?"varchar(255)":a.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:a.bigint?"bigint":"integer",postgres:a.bigint?"bigint":"integer",mysql:a.bigint?"bigint":"integer",mssql:a.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:iq.sql`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:m?iq.sql`integer GENERATED BY DEFAULT AS IDENTITY`:l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"},foreignKeyId:{postgres:m?"integer":l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"},"string[]":{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},"number[]":{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"}};if("id"===b||a.references?.field==="id")return"id"===b?f.id[d]:f.foreignKeyId[d];if(Array.isArray(c))return"text";if(!(c in f))throw Error(`Unsupported field type '${String(c)}' for field '${b}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: "string") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);return f[c][d]}let o=(0,is.initGetModelName)({schema:(0,eK.getAuthTables)(a),usePlural:!1}),p=(0,ir.initGetFieldName)({schema:(0,eK.getAuthTables)(a),usePlural:!1});function q(a,b){try{return`${o(a)}.${p({model:a,field:b})}`}catch{return`${a}.${b}`}}if(j.length)for(let a of j)for(let[b,c]of Object.entries(a.fields)){let f=n(c,b),g=d.schema.alterTable(a.table);if(c.index){let c=d.schema.alterTable(a.table).addIndex(`${a.table}_${b}_idx`);k.push(c)}let h=g.addColumn(b,f,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(q(c.references.model,c.references.field)).onDelete(c.references.onDelete||"cascade")),c.unique&&(a=a.unique()),"date"===c.type&&"function"==typeof c.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(iq.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(iq.sql`CURRENT_TIMESTAMP`)),a));k.push(h)}let r=[];if(a.advanced?.database?.useNumberId&&c.warn("`useNumberId` is deprecated. Please use `generateId` with `serial` instead."),i.length)for(let a of i){let b=n({type:m?"number":"string"},"id"),c=d.schema.createTable(a.table).addColumn("id",b,a=>{if(m)return"postgres"===e?a.primaryKey().notNull():"sqlite"===e?a.primaryKey().notNull():"mssql"===e?a.identity().primaryKey().notNull():a.autoIncrement().primaryKey().notNull();return l&&"postgres"===e?a.primaryKey().defaultTo(iq.sql`pg_catalog.gen_random_uuid()`).notNull():a.primaryKey().notNull()});for(let[b,f]of Object.entries(a.fields)){let g=n(f,b);if(c=c.addColumn(b,g,a=>(a=!1!==f.required?a.notNull():a,f.references&&(a=a.references(q(f.references.model,f.references.field)).onDelete(f.references.onDelete||"cascade")),f.unique&&(a=a.unique()),"date"===f.type&&"function"==typeof f.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(iq.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(iq.sql`CURRENT_TIMESTAMP`)),a)),f.index){let c=d.schema.createIndex(`${a.table}_${b}_${f.unique?"uidx":"idx"}`).on(a.table).columns([b]);r.push(f.unique?c.unique():c)}}k.push(c)}if(r.length)for(let a of r)k.push(a);return{toBeCreated:i,toBeAdded:j,runMigrations:async function(){for(let a of k)await a.execute()},compileMigrations:async function(){return k.map(a=>a.compile().sql).join(";\n\n")+";"}}}a.i(21190),a.s(["accountSchema",()=>f6,"coreSchema",()=>eM,"getAuthTables",()=>eK.getAuthTables,"rateLimitSchema",()=>f7,"sessionSchema",()=>f8,"userSchema",()=>f9,"verificationSchema",()=>ga],53277);var ix=a.i(53277),iy=((a,b)=>{let c={};for(var d in a)h6(c,d,{get:a[d],enumerable:!0});return b&&h6(c,Symbol.toStringTag,{value:"Module"}),c})({convertFromDB:()=>ih,convertToDB:()=>ig,createFieldAttribute:()=>ie,createInternalAdapter:()=>ij,getAdapter:()=>id,getBaseAdapter:()=>ic,getMigrations:()=>iw,getSchema:()=>io,getWithHooks:()=>ii,matchType:()=>iu,mergeSchema:()=>gU,parseAccountInput:()=>gS,parseAccountOutput:()=>gO,parseAdditionalUserInput:()=>gR,parseInputData:()=>gP,parseSessionInput:()=>gT,parseSessionOutput:()=>gN,parseUserInput:()=>gQ,parseUserOutput:()=>gM,toZodSchema:()=>im});p&&(h6(iy,Symbol.toStringTag,{value:"Module"}),o&&h6(o,Symbol.toStringTag,{value:"Module"})),ia(iy,ix,"default"),o&&ia(o,ix,"default");let iz=()=>hY("/get-session",{method:"GET",operationId:"getSession",query:g2,requireHeaders:!0,metadata:{openapi:{operationId:"getSession",description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",nullable:!0,properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=g_(a,a.context.authCookies.sessionData.name),d=null;if(c){let b=a.context.options.session?.cookieCache?.strategy||"compact";if("jwe"===b){let b=await dS(c,a.context.secret,"better-auth-session");if(!b||!b.session||!b.user)return hd(a,a.context.authCookies.sessionData),a.json(null);d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()}}else if("jwt"===b){let b=await dO(c,a.context.secret);if(!b||!b.session||!b.user)return hd(a,a.context.authCookies.sessionData),a.json(null);d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()}}else{let b=(0,gV.safeJSONParse)(g8.decode(d5.decode(c)));if(b)if(!await g9("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...b.session,expiresAt:b.expiresAt}),b.signature))return hd(a,a.context.authCookies.sessionData),a.json(null);else d=b}}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session,c=a.context.options.session?.cookieCache?.version,e="1";if(c){if("string"==typeof c)e=c;else if("function"==typeof c){let a=c(b.session,b.user);e=a instanceof Promise?await a:a}}if((b.version||"1")!==e)hd(a,a.context.authCookies.sessionData);else{let c=new Date(b.session.expiresAt);if(d.expiresAt<Date.now()||c<new Date)hd(a,a.context.authCookies.sessionData);else{let c=a.context.sessionConfig.cookieRefreshCache;if(!1===c){a.context.session=b;let c=gN(a.context.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),d=gM(a.context.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return a.json({session:c,user:d})}if(d.expiresAt-Date.now()<1e3*c.updateAge){let c=eJ(a.context.options.session?.cookieCache?.maxAge||300,"sec"),d={session:{...b.session,expiresAt:c},user:b.user,updatedAt:Date.now()};await hb(a,d,!1);let e=gN(a.context.options,{...d.session,expiresAt:new Date(d.session.expiresAt),createdAt:new Date(d.session.createdAt),updatedAt:new Date(d.session.updatedAt)}),f=gM(a.context.options,{...d.user,createdAt:new Date(d.user.createdAt),updatedAt:new Date(d.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}let e=gN(a.context.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),f=gM(a.context.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return he(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh){let b=gN(a.context.options,f.session),c=gM(a.context.options,f.user);return a.json({session:b,user:c})}let g=a.context.sessionConfig.expiresIn,h=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*h<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:eJ(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return he(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;await hc(a,{session:b,user:f.user},!1,{maxAge:c});let d=gN(a.context.options,b),e=gM(a.context.options,f.user);return a.json({session:d,user:e})}await hb(a,f,!!e);let i=gN(a.context.options,f.session),j=gM(a.context.options,f.user);return a.json({session:i,user:j})}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new gf("INTERNAL_SERVER_ERROR",{message:hS.BASE_ERROR_CODES.FAILED_TO_GET_SESSION})}}),iA=async(a,b)=>{if(a.context.session)return a.context.session;let c=await iz()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,returnStatus:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},iB=hW(async a=>{let b=await iA(a);if(!b?.session)throw new gf("UNAUTHORIZED");return{session:b}}),iC=hW(async a=>{let b=await iA(a,{disableCookieCache:!0});if(!b?.session)throw new gf("UNAUTHORIZED");return{session:b}});hW(async a=>{let b=await iA(a);if(!b?.session&&(a.request||a.headers))throw new gf("UNAUTHORIZED");return{session:b}});let iD=hW(async a=>{let b=await iA(a);if(!b?.session)throw new gf("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=new Date(b.session.updatedAt||b.session.createdAt).getTime();if(!(Date.now()-d<1e3*c))throw new gf("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),iE=hY("/revoke-session",{method:"POST",body:eL.object({token:eL.string().meta({description:"The token to revoke"})}),use:[iC],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token;if((await a.context.internalAdapter.findSession(b))?.session.userId===a.context.session.user.id)try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new gf("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),iF=hY("/revoke-sessions",{method:"POST",use:[iC],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new gf("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),iG=hY("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[iC],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new gf("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});function iH(a,b){return a&&b.options.account?.encryptOAuthTokens?eI({key:b.secret,data:a}):a}function iI(a,b){return b.options.account?.encryptOAuthTokens&&a?eH({key:b.secret,data:a}):a}function iJ(a){let b=a=>new Date(new Date().getTime()+1e3*a);return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?b(a.expires_in):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?b(a.refresh_token_expires_in):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token,raw:a}}async function iK(a){let b=new TextEncoder().encode(a),c=await crypto.subtle.digest("SHA-256",b);return d5.encode(new Uint8Array(c),{padding:!1})}async function iL({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(b.authorizationEndpoint||c);s.searchParams.set("response_type",l||"code");let t=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;if(s.searchParams.set("client_id",t),s.searchParams.set("state",d),f&&s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await iK(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}var iM=Object.defineProperty,iN=Object.defineProperties,iO=Object.getOwnPropertyDescriptors,iP=Object.getOwnPropertySymbols,iQ=Object.prototype.hasOwnProperty,iR=Object.prototype.propertyIsEnumerable,iS=(a,b,c)=>b in a?iM(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,iT=(a,b)=>{for(var c in b||(b={}))iQ.call(b,c)&&iS(a,c,b[c]);if(iP)for(var c of iP(b))iR.call(b,c)&&iS(a,c,b[c]);return a},iU=(a,b)=>iN(a,iO(b)),iV=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c,Error.captureStackTrace(this,this.constructor)}},iW=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},iX=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},iY=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},iZ=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let[d,e]=await Promise.all([c(a.auth.username),c(a.auth.password)]);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let[d,e]=await Promise.all([c(a.auth.prefix),c(a.auth.value)]);if(!e)return b;b.authorization=`${null!=d?d:""} ${e}`}}return b},i$=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function i_(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function i0(a){try{return JSON.parse(a)}catch(b){return a}}async function i1(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await iZ(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=i_(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var i2=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function i3(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new i2(c.issues);return c.value}var i4=["get","post","put","patch","delete"],i5=async(a,b)=>{var c,d,e,f,g,h,i,j;let k,{hooks:l,url:m,options:n}=await iW(a,b),o=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("u">typeof globalThis&&"function"==typeof globalThis.fetch)return globalThis.fetch;throw Error("No fetch implementation found")}(n),p=new AbortController,q=null!=(c=n.signal)?c:p.signal,r=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];i4.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{})){let c;if(null!=b){if("string"==typeof b)c=b;else if(Array.isArray(b)){for(let c of b)i.append(a,c);continue}else c=JSON.stringify(b);i.set(a,c)}}if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(m,n),s=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(i_(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return b.has("content-type")&&"application/x-www-form-urlencoded"===b.get("content-type")&&i_(a.body)?new URLSearchParams(a.body).toString():a.body}(n),t=await i1(n),u=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return i4.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(m,n),v=iU(iT({},n),{url:r,headers:t,body:s,method:u,signal:q});for(let a of l.onRequest)if(a){let b=await a(v);"object"==typeof b&&null!==b&&(v=b)}("pipeTo"in v&&"function"==typeof v.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in v)&&(v.duplex="half");let{clearTimeout:w}=(!(null==n?void 0:n.signal)&&(null==n?void 0:n.timeout)&&(k=setTimeout(()=>null==p?void 0:p.abort(),null==n?void 0:n.timeout)),{abortTimeout:k,clearTimeout:()=>{k&&clearTimeout(k)}}),x=await o(v.url,v);w();let y={response:x,request:v};for(let a of l.onResponse)if(a){let c=await a(iU(iT({},y),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?x.clone():x}));c instanceof Response?x=c:"object"==typeof c&&null!==c&&(x=c.response)}if(x.ok){if("HEAD"===v.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return i$.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(x),c={data:null,response:x,request:v};if("json"===a||"text"===a){let a=await x.text(),b=null!=(f=v.jsonParser)?f:i0;c.data=await b(a)}else c.data=await x[a]();for(let a of((null==v?void 0:v.output)&&v.output&&!v.disableValidation&&(c.data=await i3(v.output,c.data)),l.onSuccess))a&&await a(iU(iT({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?x.clone():x}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let z=null!=(h=null==b?void 0:b.jsonParser)?h:i0,A=await x.text(),B=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(A),C=B?await z(A):null,D={response:x,responseText:A,request:v,error:iU(iT({},C),{status:x.status,statusText:x.statusText})};for(let a of l.onError)a&&await a(iU(iT({},D),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?x.clone():x}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new iX({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new iX(a);case"exponential":return new iY(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,x)){for(let a of l.onRetry)a&&await a(y);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await i5(a,iU(iT({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new iV(x.status,x.statusText,B?C:A);return{data:null,error:iU(iT({},C),{status:x.status,statusText:x.statusText})}};async function i6({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e}){let{body:f,headers:g}=function({refreshToken:a,options:b,authentication:c,extraParams:d,resource:e}){let f=new URLSearchParams,g={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(f.set("grant_type","refresh_token"),f.set("refresh_token",a),"basic"===c){let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;a?g.authorization="Basic "+d4.encode(`${a}:${b.clientSecret??""}`):g.authorization="Basic "+d4.encode(`:${b.clientSecret??""}`)}else{let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;f.set("client_id",a),b.clientSecret&&f.set("client_secret",b.clientSecret)}if(e)if("string"==typeof e)f.append("resource",e);else for(let a of e)f.append("resource",a);if(d)for(let[a,b]of Object.entries(d))f.set(a,b);return{body:f,headers:g}}({refreshToken:a,options:b,authentication:d,extraParams:e}),{data:h,error:i}=await i5(c,{method:"POST",body:f,headers:g});if(i)throw i;let j={accessToken:h.access_token,refreshToken:h.refresh_token,tokenType:h.token_type,scopes:h.scope?.split(" "),idToken:h.id_token};return h.expires_in&&(j.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*h.expires_in)),j}function i7(a){return c$(a)}class i8{#p;#q=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(i7)}(a))throw new co("JSON Web Key Set malformed");this.#p=structuredClone(a)}jwks(){return this.#p}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new ci('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#p.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new cp;if(1!==h){let a=new cq,b=this.#q;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await i9(b,a,c)}catch{}},a}return i9(this.#q,g,c)}}async function i9(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await dD({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new co("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function ja(a){let b=new i8(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}function jb(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(b5.decode(cb(b)));if(!c$(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}("u"<typeof navigator||!navigator.userAgent?.startsWith?.("Mozilla/5.0 "))&&(c="jose/v6.1.3");let jc=Symbol();async function jd(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new cr;throw a});if(200!==e.status)throw new ce("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new ce("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let je=Symbol();class jf{#r;#s;#t;#u;#v;#w;#x;#y;#z;#A;constructor(a,b){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#r=new URL(a.href),this.#s="number"==typeof b?.timeoutDuration?b?.timeoutDuration:5e3,this.#t="number"==typeof b?.cooldownDuration?b?.cooldownDuration:3e4,this.#u="number"==typeof b?.cacheMaxAge?b?.cacheMaxAge:6e5,this.#x=new Headers(b?.headers),c&&!this.#x.has("User-Agent")&&this.#x.set("User-Agent",c),this.#x.has("accept")||(this.#x.set("accept","application/json"),this.#x.append("accept","application/jwk-set+json")),this.#y=b?.[jc],b?.[je]!==void 0&&(this.#A=b?.[je],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!c$(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,c$)}(b?.[je],this.#u)&&(this.#v=this.#A.uat,this.#z=ja(this.#A.jwks)))}pendingFetch(){return!!this.#w}coolingDown(){return"number"==typeof this.#v&&Date.now()<this.#v+this.#t}fresh(){return"number"==typeof this.#v&&Date.now()<this.#v+this.#u}jwks(){return this.#z?.jwks()}async getKey(a,b){this.#z&&this.fresh()||await this.reload();try{return await this.#z(a,b)}catch(c){if(c instanceof cp&&!1===this.coolingDown())return await this.reload(),this.#z(a,b);throw c}}async reload(){this.#w&&("u">typeof WebSocketPair||"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"u">typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#w=void 0),this.#w||=jd(this.#r.href,this.#x,AbortSignal.timeout(this.#s),this.#y).then(a=>{this.#z=ja(a),this.#A&&(this.#A.uat=Date.now(),this.#A.jwks=a),this.#v=Date.now(),this.#w=void 0}).catch(a=>{throw this.#w=void 0,a}),await this.#w}}function jg({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:e,deviceId:f,headers:g,additionalParams:h={},resource:i}){let j=new URLSearchParams,k={"content-type":"application/x-www-form-urlencoded",accept:"application/json",...g};if(j.set("grant_type","authorization_code"),j.set("code",a),b&&j.set("code_verifier",b),d.clientKey&&j.set("client_key",d.clientKey),f&&j.set("device_id",f),j.set("redirect_uri",d.redirectURI||c),i)if("string"==typeof i)j.append("resource",i);else for(let a of i)j.append("resource",a);if("basic"===e){let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;k.authorization=`Basic ${d4.encode(`${a}:${d.clientSecret??""}`)}`}else{let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;j.set("client_id",a),d.clientSecret&&j.set("client_secret",d.clientSecret)}for(let[a,b]of Object.entries(h))j.has(a)||j.append(a,b);return{body:j,headers:k}}async function jh({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={},resource:j}){let{body:k,headers:l}=jg({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:f,deviceId:g,headers:h,additionalParams:i,resource:j}),{data:m,error:n}=await i5(e,{method:"POST",body:k,headers:l});if(n)throw n;return iJ(m)}function ji(a){let b,c;if("string"!=typeof a)throw new cm("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new cm("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new cm("Invalid JWT");if(!d)throw new cm("JWTs must contain a payload");try{b=cb(d)}catch{throw new cm("Failed to base64url decode the payload")}try{c=JSON.parse(b5.decode(b))}catch{throw new cm("Failed to parse the decoded payload as JSON")}if(!c$(c))throw new cm("Invalid JWT Claims Set");return c}let jj=async a=>{let{data:b}=await i5("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new gf("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await dD(c,c.alg)},jk=async(a,b,c)=>{let d=`https://cognito-idp.${b}.amazonaws.com/${c}/.well-known/jwks.json`;try{let{data:b}=await i5(d);if(!b?.keys)throw new gf("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await dD(c,c.alg)}catch(a){throw ib.logger.error("Failed to fetch Cognito public key:",a),a}},jl=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://"),jm=async a=>{let{data:b}=await i5("https://www.googleapis.com/oauth2/v3/certs");if(!b?.keys)throw new gf("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await dD(c,c.alg)},jn=async(a,b,c)=>{let{data:d}=await i5(`${c}/${b}/discovery/v2.0/keys`);if(!d?.keys)throw new gf("BAD_REQUEST",{message:"Keys not found"});let e=d.keys.find(b=>b.kid===a);if(!e)throw Error(`JWK with kid ${a} not found`);return await dD(e,e.alg)},jo={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await iL({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=jb(b);if(!d||!e)return!1;let{payload:f}=await dM(b,await jj(d),{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.audience&&a.audience.length?a.audience:a.appBundleIdentifier?a.appBundleIdentifier:a.clientId,maxTokenAge:"1h"});if(["email_verified","is_private_email"].forEach(a=>{void 0!==f[a]&&(f[a]=!!f[a])}),c&&f.nonce!==c)return!1;return!!f}catch{return!1}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){let c;if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let d=ji(b.idToken);if(!d)return null;c=b.user?.name?`${b.user.name.firstName||""} ${b.user.name.lastName||""}`.trim()||" ":d.name||" ";let e="boolean"==typeof d.email_verified?d.email_verified:"true"===d.email_verified,f={...d,name:c},g=await a.mapProfileToUser?.(f);return{user:{id:d.sub,name:f.name,emailVerified:e,email:d.email,...g},data:f}},options:a}),atlassian:a=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw ib.logger.error("Client Id and Secret are required for Atlassian"),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new dT.BetterAuthError("codeVerifier is required for Atlassian");let f=a.disableDefaultScope?[]:["read:jira-user","offline_access"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"atlassian",options:a,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,additionalParams:{audience:"api.atlassian.com"},prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;try{let{data:c}=await i5("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name,email:c.email,image:c.picture,emailVerified:!1,...d},data:c}}catch(a){return ib.logger.error("Failed to fetch user info from Figma:",a),null}},options:a}),cognito:a=>{if(!a.domain||!a.region||!a.userPoolId)throw ib.logger.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new dT.BetterAuthError("DOMAIN_AND_REGION_REQUIRED");let b=a.domain.replace(/^https?:\/\//,""),c=`https://${b}/oauth2/authorize`,d=`https://${b}/oauth2/token`,e=`https://${b}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId)throw ib.logger.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(a.requireClientSecret&&!a.clientSecret)throw ib.logger.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new dT.BetterAuthError("CLIENT_SECRET_REQUIRED");let g=a.disableDefaultScope?[]:["openid","profile","email"];a.scope&&g.push(...a.scope),d&&g.push(...d);let h=await iL({id:"cognito",options:{...a},authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt}),i=h.searchParams.get("scope");if(i){h.searchParams.delete("scope");let a=encodeURIComponent(i),b=h.toString(),c=b.includes("?")?"&":"?";return new URL(`${b}${c}scope=${a}`)}return h},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>jh({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=jb(b);if(!d||!e)return!1;let f=await jk(d,a.region,a.userPoolId),g=`https://cognito-idp.${a.region}.amazonaws.com/${a.userPoolId}`,{payload:h}=await dM(b,f,{algorithms:[e],issuer:g,audience:a.clientId,maxTokenAge:"1h"});if(c&&h.nonce!==c)return!1;return!0}catch(a){return ib.logger.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken)try{let c=ji(b.idToken);if(!c)return null;let d=c.name||c.given_name||c.username||c.email,e={...c,name:d},f=await a.mapProfileToUser?.(e);return{user:{id:c.sub,name:e.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...f},data:e}}catch(a){ib.logger.error("Failed to decode ID token:",a)}if(b.accessToken)try{let{data:c}=await i5(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(c){let b=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.given_name||c.username,email:c.email,image:c.picture,emailVerified:c.email_verified,...b},data:c}}}catch(a){ib.logger.error("Failed to fetch user info from Cognito:",a)}return null},options:a}},discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=e.includes("bot")&&void 0!==a.permissions?`&permissions=${a.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}${f}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar)c.image_url=`https://cdn.discordapp.com/embed/avatars/${"0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5}.png`;else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await iL({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v24.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/v24.0/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{var d;let e,f,{payload:g}=await dM(b,(d=new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/"),e=new jf(d,void 0),f=async(a,b)=>e.getKey(a,b),Object.defineProperties(f,{coolingDown:{get:()=>e.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>e.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>e.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>e.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>e.jwks(),enumerable:!0,configurable:!1,writable:!1}}),f),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&g.nonce!==c)return!1;return!!g}catch{return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v24.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=ji(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!1});return{user:{...d,emailVerified:!1,...e},data:c}}let{data:c,error:d}=await i5("https://graph.facebook.com/me?fields="+["id","name","email","picture",...a?.fields||[]].join(","),{auth:{type:"Bearer",token:b.accessToken}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.email,image:c.picture.data.url,emailVerified:c.email_verified,...e},data:c}},options:a}),figma:a=>({id:"figma",name:"Figma",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw ib.logger.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new dT.BetterAuthError("codeVerifier is required for Figma");let f=a.disableDefaultScope?[]:["current_user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await iL({id:"figma",options:a,authorizationEndpoint:"https://www.figma.com/oauth",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.figma.com/v1/oauth/token",authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.figma.com/v1/oauth/token",authentication:"basic"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await i5("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return ib.logger.error("Failed to fetch user from Figma"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.handle,email:c.email,image:c.img_url,emailVerified:!1,...d},data:c}}catch(a){return ib.logger.error("Failed to fetch user info from Figma:",a),null}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,codeVerifier:e,redirectURI:f}){let g=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),iL({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:g,state:b,codeVerifier:e,redirectURI:f,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>{let{body:e,headers:f}=jg({code:b,codeVerifier:c,redirectURI:d,options:a}),{data:g,error:h}=await i5("https://github.com/login/oauth/access_token",{method:"POST",body:e,headers:f});return h?(ib.logger.error("GitHub OAuth token exchange failed:",h),null):"error"in g?(ib.logger.error("GitHub OAuth token exchange failed:",g),null):iJ(g)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await i5("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=a.authority||"https://login.microsoftonline.com",d=`${c}/${b}/oauth2/v2.0/authorize`,e=`${c}/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),iL({id:"microsoft",options:a,authorizationEndpoint:d,state:b.state,codeVerifier:b.codeVerifier,scopes:c,redirectURI:b.redirectURI,prompt:a.prompt,loginHint:b.loginHint})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:e}),async verifyIdToken(d,e){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(d,e);try{let{kid:f,alg:g}=jb(d);if(!f||!g)return!1;let h=await jn(f,b,c),i={algorithms:[g],audience:a.clientId,maxTokenAge:"1h"};"common"!==b&&"organizations"!==b&&"consumers"!==b&&(i.issuer=`${c}/${b}/v2.0`);let{payload:j}=await dM(d,h,i);if(e&&j.nonce!==e)return!1;return!0}catch(a){return ib.logger.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=ji(b.idToken),d=a.profilePhotoSize||48;await i5(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=await b.response.clone().arrayBuffer();c.picture=`data:image/jpeg;base64, ${d4.encode(a)}`}catch(a){ib.logger.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c),f=void 0!==c.email_verified?c.email_verified:!!(c.email&&(c.verified_primary_email?.includes(c.email)||c.verified_secondary_email?.includes(c.email)));return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:f,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),i6({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:e})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw ib.logger.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new dT.BetterAuthError("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),await iL({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/v2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://oauth2.googleapis.com/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=jb(b);if(!d||!e)return!1;let{payload:f}=await dM(b,await jm(d),{algorithms:[e],issuer:["https://accounts.google.com","accounts.google.com"],audience:a.clientId,maxTokenAge:"1h"});if(c&&f.nonce!==c)return!1;return!0}catch{return!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=ji(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),iL({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return ib.logger.error("No idToken found in token"),null;let d=ji(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),iL({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await i5("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await iL({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://id.kick.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!1,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>jh({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>i6({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!1,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await iL({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await jh({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>i6({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let b,{authorizationEndpoint:c,tokenEndpoint:d,userinfoEndpoint:e}=(b=a.issuer||"https://gitlab.com",{authorizationEndpoint:jl(`${b}/oauth/authorize`),tokenEndpoint:jl(`${b}/oauth/token`),userinfoEndpoint:jl(`${b}/api/v4/user`)}),f="gitlab";return{id:f,name:"Gitlab",createAuthorizationURL:async({state:b,scopes:d,codeVerifier:e,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await iL({id:f,options:a,authorizationEndpoint:c,scopes:i,state:b,redirectURI:h,codeVerifier:e,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:e})=>jh({code:b,redirectURI:c,options:a,codeVerifier:e,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5(e,{headers:{authorization:`Bearer ${b.accessToken}`}});if(d||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:a.redirectURI||c,options:{clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:a.clientKey}}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!1},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),iL({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),{data:e,error:f}=await i5("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${d4.encode(`${a.clientId}:${a.clientSecret}`)}`},body:d.toString()});if(f)throw f;return iJ(e)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!1,...e},data:{...c}}},options:a}),salesforce:a=>{let b=(a.environment??"production")==="sandbox",c=a.loginUrl?`https://${a.loginUrl}/services/oauth2/authorize`:b?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",d=a.loginUrl?`https://${a.loginUrl}/services/oauth2/token`:b?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",e=a.loginUrl?`https://${a.loginUrl}/services/oauth2/userinfo`:b?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId||!a.clientSecret)throw ib.logger.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new dT.BetterAuthError("codeVerifier is required for Salesforce");let g=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&g.push(...a.scope),d&&g.push(...d),iL({id:"salesforce",options:a,authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:a.redirectURI||f})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>jh({code:b,codeVerifier:c,redirectURI:a.redirectURI||e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await i5(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return ib.logger.error("Failed to fetch user info from Salesforce"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.photos?.picture||c.photos?.thumbnail,emailVerified:c.email_verified??!1,...d},data:c}}catch(a){return ib.logger.error("Failed to fetch user info from Salesforce:",a),null}},options:a}},vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>jh({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await i5("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e)return null;let f=await a.mapProfileToUser?.(d);return d.user.email||f?.email?{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!1,birthday:d.user.birthday,sex:d.user.sex,name:`${d.user.first_name} ${d.user.last_name}`,...f},data:d}:null},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await iK(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>jh({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),refreshAccessToken:b.refreshAccessToken?b.refreshAccessToken:async a=>i6({refreshToken:a,options:{clientId:b.clientId,clientKey:b.clientKey,clientSecret:b.clientSecret},tokenEndpoint:"https://zoom.us/oauth/token"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await i5("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>jh({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>i6({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!1,...f},data:e}},options:a}},kakao:a=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return a.scope&&e.push(...a.scope),c&&e.push(...c),iL({id:"kakao",options:a,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c),f=c.kakao_account||{},g=f.profile||{};return{user:{id:String(c.id),name:g.nickname||f.name||void 0,email:f.email,image:g.profile_image_url||g.thumbnail_image_url,emailVerified:!!f.is_email_valid&&!!f.is_email_verified,...e},data:c}},options:a}),naver:a=>({id:"naver",name:"Naver",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["profile","email"];return a.scope&&e.push(...a.scope),c&&e.push(...c),iL({id:"naver",options:a,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>jh({code:b,redirectURI:c,options:a,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c||"00"!==c.resultcode)return null;let e=await a.mapProfileToUser?.(c),f=c.response||{};return{user:{id:f.id,name:f.name||f.nickname,email:f.email,image:f.profile_image,emailVerified:!1,...e},data:c}},options:a}),line:a=>{let b="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f}){let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),await iL({id:"line",options:a,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:g,state:b,codeVerifier:d,redirectURI:e,loginHint:f})},validateAuthorizationCode:async({code:c,codeVerifier:d,redirectURI:e})=>jh({code:c,codeVerifier:d,redirectURI:e,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>i6({refreshToken:c,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:b}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=new URLSearchParams;d.set("id_token",b),d.set("client_id",a.clientId),c&&d.set("nonce",c);let{data:e,error:f}=await i5("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:d});return!f&&!!e&&e.aud===a.clientId&&(!e.nonce||e.nonce===c)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=null;if(b.idToken)try{c=ji(b.idToken)}catch{}if(!c){let{data:a}=await i5("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});c=a||null}if(!c)return null;let d=await a.mapProfileToUser?.(c),e=c.sub||c.userId,f=c.name||c.displayName,g=c.picture||c.pictureUrl||void 0;return{user:{id:e,name:f,email:c.email,image:g,emailVerified:!1,...d},data:c}},options:a}},paybin:a=>{let b=a.issuer||"https://idp.paybin.io",c=`${b}/oauth2/authorize`,d=`${b}/oauth2/token`;return{id:"paybin",name:"Paybin",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f,loginHint:g}){if(!a.clientId||!a.clientSecret)throw ib.logger.error("Client Id and Client Secret is required for Paybin. Make sure to provide them in the options."),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new dT.BetterAuthError("codeVerifier is required for Paybin");let h=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&h.push(...a.scope),d&&h.push(...d),await iL({id:"paybin",options:a,authorizationEndpoint:c,scopes:h,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt,loginHint:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>jh({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=ji(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username||(c.email?c.email.split("@")[0]:"User")||"User",email:c.email,image:c.picture,emailVerified:c.email_verified||!1,...d},data:c}},options:a}},paypal:a=>{let b="sandbox"===(a.environment||"sandbox"),c=b?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",d=b?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",e=b?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:b,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw ib.logger.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new dT.BetterAuthError("CLIENT_ID_AND_SECRET_REQUIRED");return await iL({id:"paypal",options:a,authorizationEndpoint:c,scopes:[],state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let e=d4.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await i5(d,{method:"POST",headers:{Authorization:`Basic ${e}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:c}).toString()});if(!a.data)throw new dT.BetterAuthError("FAILED_TO_GET_ACCESS_TOKEN");let f=a.data;return{accessToken:f.access_token,refreshToken:f.refresh_token,accessTokenExpiresAt:f.expires_in?new Date(Date.now()+1e3*f.expires_in):void 0,idToken:f.id_token}}catch(a){throw ib.logger.error("PayPal token exchange failed:",a),new dT.BetterAuthError("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=d4.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await i5(d,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:b}).toString()});if(!a.data)throw new dT.BetterAuthError("FAILED_TO_REFRESH_ACCESS_TOKEN");let e=a.data;return{accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?new Date(Date.now()+1e3*e.expires_in):void 0}}catch(a){throw ib.logger.error("PayPal token refresh failed:",a),new dT.BetterAuthError("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{return!!ji(b).sub}catch(a){return ib.logger.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return ib.logger.error("Access token is required to fetch PayPal user info"),null;try{let c=await i5(`${e}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${b.accessToken}`,Accept:"application/json"}});if(!c.data)return ib.logger.error("Failed to fetch user info from PayPal"),null;let d=c.data,f=await a.mapProfileToUser?.(d);return{user:{id:d.user_id,name:d.name,email:d.email,image:d.picture,emailVerified:d.email_verified,...f},data:d}}catch(a){return ib.logger.error("Failed to fetch user info from PayPal:",a),null}},options:a}},polar:a=>({id:"polar",name:"Polar",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),iL({id:"polar",options:a,authorizationEndpoint:"https://polar.sh/oauth2/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>i6({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.polar.sh/v1/oauth2/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.public_name||c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),vercel:a=>({id:"vercel",name:"Vercel",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f;if(!d)throw new dT.BetterAuthError("codeVerifier is required for Vercel");return(void 0!==a.scope||void 0!==c)&&(f=[],a.scope&&f.push(...a.scope),c&&f.push(...c)),iL({id:"vercel",options:a,authorizationEndpoint:"https://vercel.com/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>jh({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.vercel.com/login/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await i5("https://api.vercel.com/login/oauth/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name??c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a})},jp=Object.keys(jo),jq=eL.enum(jp).or(eL.string()),jr=hY("/list-accounts",{method:"GET",use:[iB],metadata:{openapi:{operationId:"listUserAccounts",description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},userId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","userId","scopes"]}}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(b=>{let{scope:c,...d}=gO(a.context.options,b);return{...d,scopes:c?.split(",")||[]}}))}),js=hY("/link-social",{method:"POST",requireHeaders:!0,body:eL.object({callbackURL:eL.string().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:jq,idToken:eL.object({token:eL.string(),nonce:eL.string().optional(),accessToken:eL.string().optional(),refreshToken:eL.string().optional(),scopes:eL.array(eL.string()).optional()}).optional(),requestSignUp:eL.boolean().optional(),scopes:eL.array(eL.string()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:eL.string().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:eL.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),additionalData:eL.record(eL.string(),eL.any()).optional()}),use:[iB],metadata:{openapi:{description:"Link a social account to the user",operationId:"linkSocialAccount",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new gf("NOT_FOUND",{message:hS.BASE_ERROR_CODES.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new gf("NOT_FOUND",{message:hS.BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO});let g=String(f.user.id);if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===g))return a.json({url:"",status:!0,redirect:!1});if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new gf("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email?.toLowerCase()!==b.user.email.toLowerCase()&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new gf("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:g,accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")})}catch{throw new gf("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({url:"",status:!0,redirect:!1})}let d=await hE(a,{userId:b.user.id,email:b.user.email},a.body.additionalData),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.body.disableRedirect||a.setHeader("Location",e.toString()),a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),jt=hY("/unlink-account",{method:"POST",body:eL.object({providerId:eL.string(),accountId:eL.string().optional()}),use:[iD],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),ju=hY("/get-access-token",{method:"POST",body:eL.object({providerId:eL.string().meta({description:"The provider ID for the OAuth provider"}),accountId:eL.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:eL.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,{providerId:c,accountId:d,userId:e}=a.body||{},f=a.request,g=await iA(a);if(f&&!g)throw a.error("UNAUTHORIZED");let h=g?.user?.id||e;if(!h)throw a.error("UNAUTHORIZED");if(!a.context.socialProviders.find(a=>a.id===c))throw new gf("BAD_REQUEST",{message:`Provider ${c} is not supported.`});let i=await g1(a);if(!(b=i&&c===i.providerId&&(!d||i.id===d)?i:(await a.context.internalAdapter.findAccounts(h)).find(a=>d?a.id===d&&a.providerId===c:a.providerId===c)))throw new gf("BAD_REQUEST",{message:"Account not found"});let j=a.context.socialProviders.find(a=>a.id===c);if(!j)throw new gf("BAD_REQUEST",{message:`Provider ${c} not found.`});try{let c=null,d=b.accessTokenExpiresAt&&new Date(b.accessTokenExpiresAt).getTime()-Date.now()<5e3;if(b.refreshToken&&d&&j.refreshAccessToken){let d=await iH(b.refreshToken,a.context);c=await j.refreshAccessToken(d);let e={accessToken:await iI(c.accessToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshToken:await iI(c.refreshToken,a.context),refreshTokenExpiresAt:c.refreshTokenExpiresAt},f=null;b.id&&(f=await a.context.internalAdapter.updateAccount(b.id,e)),a.context.options.account?.storeAccountCookie&&await g0(a,{...b,...f??e})}let e=c?.accessTokenExpiresAt?"string"==typeof c.accessTokenExpiresAt?new Date(c.accessTokenExpiresAt):c.accessTokenExpiresAt:b.accessTokenExpiresAt?"string"==typeof b.accessTokenExpiresAt?new Date(b.accessTokenExpiresAt):b.accessTokenExpiresAt:void 0,f={accessToken:c?.accessToken??await iH(b.accessToken??"",a.context),accessTokenExpiresAt:e,scopes:b.scope?.split(",")??[],idToken:c?.idToken??b.idToken??void 0};return a.json(f)}catch(a){throw new gf("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),jv=hY("/refresh-token",{method:"POST",body:eL.object({providerId:eL.string().meta({description:"The provider ID for the OAuth provider"}),accountId:eL.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:eL.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,c,{providerId:d,accountId:e,userId:f}=a.body,g=a.request,h=await iA(a);if(g&&!h)throw a.error("UNAUTHORIZED");let i=h?.user?.id||f;if(!i)throw new gf("BAD_REQUEST",{message:"Either userId or session is required"});let j=a.context.socialProviders.find(a=>a.id===d);if(!j)throw new gf("BAD_REQUEST",{message:`Provider ${d} not found.`});if(!j.refreshAccessToken)throw new gf("BAD_REQUEST",{message:`Provider ${d} does not support token refreshing.`});let k=await g1(a);if(!(b=k&&(!d||d===k?.providerId)?k:(await a.context.internalAdapter.findAccounts(i)).find(a=>e?a.id===e&&a.providerId===d:a.providerId===d)))throw new gf("BAD_REQUEST",{message:"Account not found"});if(!(c=k&&d===k.providerId?k.refreshToken??void 0:b.refreshToken??void 0))throw new gf("BAD_REQUEST",{message:"Refresh token not found"});try{let e=await iH(c,a.context),f=await j.refreshAccessToken(e);if(b.id){let c={...b||{},accessToken:await iI(f.accessToken,a.context),refreshToken:await iI(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken};await a.context.internalAdapter.updateAccount(b.id,c)}return k&&d===k.providerId&&a.context.options.account?.storeAccountCookie&&await g0(a,{...k,accessToken:await iI(f.accessToken,a.context),refreshToken:await iI(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||k.scope,idToken:f.idToken||k.idToken}),a.json({accessToken:f.accessToken,refreshToken:f.refreshToken,accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken,providerId:b.providerId,accountId:b.accountId})}catch(a){throw new gf("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),jw=hY("/account-info",{method:"GET",use:[iB],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},query:eL.optional(eL.object({accountId:eL.string().meta({description:"The provider given account id for which to get the account info"}).optional()}))},async a=>{let b,c=a.query?.accountId;if(c){let d=await a.context.internalAdapter.findAccount(c);d&&(b=d)}else if(a.context.options.account?.storeAccountCookie){let c=await g1(a);c&&(b=c)}if(!b||b.userId!==a.context.session.user.id)throw new gf("BAD_REQUEST",{message:"Account not found"});let d=a.context.socialProviders.find(a=>a.id===b.providerId);if(!d)throw new gf("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let e=await ju({...a,method:"POST",body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1,returnStatus:!1});if(!e.accessToken)throw new gf("BAD_REQUEST",{message:"Access token not found"});let f=await d.getUserInfo({...e,accessToken:e.accessToken});return a.json(f)});async function jx(a,b,c,d=3600,e){return await dN({email:b.toLowerCase(),updateTo:c,...e},a,d)}async function jy(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new gf("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await jx(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${d}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:b,url:e,token:c},a.request))}let jz=hY("/send-verification-email",{method:"POST",operationId:"sendVerificationEmail",body:eL.object({email:eL.email().meta({description:"The email to send the verification email to"}),callbackURL:eL.string().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{operationId:"sendVerificationEmail",description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new gf("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await iA(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return!c||c.user.emailVerified?await jx(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn):await jy(a,c.user),a.json({status:!0})}if(c?.user.email!==b)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.EMAIL_MISMATCH});if(c?.user.emailVerified)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.EMAIL_ALREADY_VERIFIED});return await jy(a,c.user),a.json({status:!0})}),jA=hY("/verify-email",{method:"GET",operationId:"verifyEmail",query:eL.object({token:eL.string().meta({description:"The token to verify the email"}),callbackURL:eL.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[h0(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new gf("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await dM(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof cg)return c("token_expired");return c("invalid_token")}let e=eL.object({email:eL.email(),updateTo:eL.string().optional(),requestType:eL.string().optional()}).parse(b.payload),f=await a.context.internalAdapter.findUserByEmail(e.email);if(!f)return c("user_not_found");if(e.updateTo){let b=await iA(a);if(b&&b.user.email!==e.email)return c("unauthorized");switch(e.requestType){case"change-email-confirmation":{let b=await jx(a.context.secret,e.email,e.updateTo,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),c=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/"),d=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;if(a.context.options.emailVerification?.sendVerificationEmail&&await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:{...f.user,email:e.updateTo},url:d,token:b},a.request)),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0})}case"change-email-verification":{let c=b;if(!c){let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new gf("INTERNAL_SERVER_ERROR",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});c={session:b,user:f.user}}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!0});if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(d,a.request),await hc(a,{session:c.session,user:{...c.user,email:e.updateTo,emailVerified:!0}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:gM(a.context.options,d)})}default:{let c=b;if(!c){let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new gf("INTERNAL_SERVER_ERROR",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});c={session:b,user:f.user}}let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!1}),g=await jx(a.context.secret,e.updateTo),h=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/");if(a.context.options.emailVerification?.sendVerificationEmail&&await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:d,url:`${a.context.baseURL}/verify-email?token=${g}&callbackURL=${h}`,token:g},a.request)),await hc(a,{session:c.session,user:{...c.user,email:e.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:gM(a.context.options,d)})}}}if(f.user.emailVerified){if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}a.context.options.emailVerification?.beforeEmailVerification&&await a.context.options.emailVerification.beforeEmailVerification(f.user,a.request),a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let g=await a.context.internalAdapter.updateUserByEmail(e.email,{emailVerified:!0});if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(g,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await iA(a);if(b&&b.user.email===e.email)await hc(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new gf("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await hc(a,{session:b,user:{...f.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})});async function jB(a,b){let{userInfo:c,account:d,callbackURL:e,disableSignUp:f,overrideUserInfo:g}=b,h=await a.context.internalAdapter.findOAuthUser(c.email.toLowerCase(),d.accountId,d.providerId).catch(b=>{ib.logger.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),i=h?.user,j=!i;if(h){let e=h.linkedAccount??h.accounts.find(a=>a.providerId===d.providerId&&a.accountId===d.accountId);if(e){let b=a.context.options.account?.updateAccountOnSignIn!==!1?Object.fromEntries(Object.entries({idToken:d.idToken,accessToken:await iI(d.accessToken,a.context),refreshToken:await iI(d.refreshToken,a.context),accessTokenExpiresAt:d.accessTokenExpiresAt,refreshTokenExpiresAt:d.refreshTokenExpiresAt,scope:d.scope}).filter(([a,b])=>void 0!==b)):{};a.context.options.account?.storeAccountCookie&&await g0(a,{...e,...b}),Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(e.id,b),c.emailVerified&&!h.user.emailVerified&&c.email.toLowerCase()===h.user.email&&await a.context.internalAdapter.updateUser(h.user.id,{emailVerified:!0})}else{let e=a.context.options.account?.accountLinking,f=a.context.options.account?.accountLinking?.trustedProviders;if(!(b.isTrustedProvider||f?.includes(d.providerId))&&!c.emailVerified||e?.enabled===!1||e?.disableImplicitLinking===!0)return(0,g5.isDevelopment)()&&ib.logger.warn(`User already exist but account isn't linked to ${d.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:d.providerId,accountId:c.id.toString(),userId:h.user.id,accessToken:await iI(d.accessToken,a.context),refreshToken:await iI(d.refreshToken,a.context),idToken:d.idToken,accessTokenExpiresAt:d.accessTokenExpiresAt,refreshTokenExpiresAt:d.refreshTokenExpiresAt,scope:d.scope})}catch(a){return ib.logger.error("Unable to link account",a),{error:"unable to link account",data:null}}c.emailVerified&&!h.user.emailVerified&&c.email.toLowerCase()===h.user.email&&await a.context.internalAdapter.updateUser(h.user.id,{emailVerified:!0})}if(g){let{id:b,...d}=c;i=await a.context.internalAdapter.updateUser(h.user.id,{...d,email:c.email.toLowerCase(),emailVerified:c.email.toLowerCase()===h.user.email&&h.user.emailVerified||c.emailVerified})}}else{if(f)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:b,...f}=c,g={accessToken:await iI(d.accessToken,a.context),refreshToken:await iI(d.refreshToken,a.context),idToken:d.idToken,accessTokenExpiresAt:d.accessTokenExpiresAt,refreshTokenExpiresAt:d.refreshTokenExpiresAt,scope:d.scope,providerId:d.providerId,accountId:c.id.toString()},{user:h,account:j}=await a.context.internalAdapter.createOAuthUser({...f,email:c.email.toLowerCase()},g);if(i=h,a.context.options.account?.storeAccountCookie&&await g0(a,j),!c.emailVerified&&i&&a.context.options.emailVerification?.sendOnSignUp&&a.context.options.emailVerification?.sendVerificationEmail){let b=await jx(a.context.secret,i.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${e}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:i,url:c,token:b},a.request))}}catch(a){if(ib.logger.error(a),a instanceof gf)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!i)return{error:"unable to create user",data:null,isRegister:!1};let k=await a.context.internalAdapter.createSession(i.id);return k?{data:{session:k,user:i},error:null,isRegister:j}:{error:"unable to create session",data:null,isRegister:!1}}let jC=eL.object({code:eL.string().optional(),error:eL.string().optional(),device_id:eL.string().optional(),error_description:eL.string().optional(),state:eL.string().optional(),user:eL.string().optional()}),jD=hY("/callback/:id",{method:["GET","POST"],operationId:"handleOAuthCallback",body:jC.optional(),query:jC.optional(),metadata:{...hG,allowedMediaTypes:["application/x-www-form-urlencoded","application/json"]}},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;if("POST"===a.method){let b=a.body?jC.parse(a.body):{},c=a.query?jC.parse(a.query):{},d=jC.parse({...b,...c}),e=new URLSearchParams;for(let[a,b]of Object.entries(d))null!=b&&e.set(a,String(b));let f=`${a.context.baseURL}/callback/${a.params.id}?${e.toString()}`;throw a.redirect(f)}try{if("GET"===a.method)b=jC.parse(a.query);else if("POST"===a.method)b=jC.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j,user:k}=b;if(!h){a.context.logger.error("State not found",g);let b=`${e}${e.includes("?")?"&":"?"}state=state_not_found`;throw a.redirect(b)}let{codeVerifier:l,callbackURL:m,link:n,errorURL:o,newUserURL:p,requestSignUp:q}=await hF(a);function r(b,c){let d=o??e,f=new URLSearchParams({error:b});c&&f.set("error_description",c);let g=`${d}${d.includes("?")?"&":"?"}${f.toString()}`;throw a.redirect(g)}if(g&&r(g,i),!f)throw a.context.logger.error("Code not found"),r("no_code");let s=a.context.socialProviders.find(b=>b.id===a.params.id);if(!s)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),r("oauth_provider_not_found");try{c=await s.validateAuthorizationCode({code:f,codeVerifier:l,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${s.id}`})}catch(b){throw a.context.logger.error("",b),r("invalid_code")}if(!c)throw r("invalid_code");let t=k?(0,gV.safeJSONParse)(k):null,u=await s.getUserInfo({...c,user:t??void 0}).then(a=>a?.user);if(!u)return a.context.logger.error("Unable to get user info"),r("unable_to_get_user_info");if(!m)throw a.context.logger.error("No callback URL found"),r("no_callback_url");if(n){let b;if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(s.id)&&!u.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),r("unable_to_link_account");if(u.email?.toLowerCase()!==n.email.toLowerCase()&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return r("email_doesn't_match");let d=await a.context.internalAdapter.findAccount(String(u.id));if(d){if(d.userId.toString()!==n.userId.toString())return r("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await iI(c.accessToken,a.context),refreshToken:await iI(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(d.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:n.userId,providerId:s.id,accountId:String(u.id),...c,accessToken:await iI(c.accessToken,a.context),refreshToken:await iI(c.refreshToken,a.context),scope:c.scopes?.join(",")}))return r("unable_to_link_account");try{b=m.toString()}catch{b=m}throw a.redirect(b)}if(!u.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),r("email_not_found");let v={providerId:s.id,accountId:String(u.id),...c,scope:c.scopes?.join(",")},w=await jB(a,{userInfo:{...u,id:String(u.id),email:u.email,name:u.name||u.email},account:v,callbackURL:m,disableSignUp:s.disableImplicitSignUp&&!q||s.options?.disableSignUp,overrideUserInfo:s.options?.overrideUserInfoOnSignIn});if(w.error)return a.context.logger.error(w.error.split(" ").join("_")),r(w.error.split(" ").join("_"));let{session:x,user:y}=w.data;await hc(a,{session:x,user:y});try{d=(w.isRegister&&p||m).toString()}catch{d=w.isRegister&&p||m}throw a.redirect(d)});function jE(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/&(?!amp;|lt;|gt;|quot;|#39;|#x[0-9a-fA-F]+;|#[0-9]+;)/g,"&amp;")}let jF=hY("/error",{method:"GET",metadata:{...hG,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>{let b=new URL(a.request?.url||""),c=b.searchParams.get("error")||"UNKNOWN",d=b.searchParams.get("error_description")||null,e=/^[\'A-Za-z0-9_-]+$/.test(c||"")?c:"UNKNOWN",f=d?jE(d):null,g=new URLSearchParams;g.set("error",e),d&&g.set("error_description",d);let h=a.context.options,i=h.onAPIError?.errorURL;return i?new Response(null,{status:302,headers:{Location:`${i}${i.includes("?")?"&":"?"}${g.toString()}`}}):g5.isProduction&&!h.onAPIError?.customizeDefaultErrorPage?new Response(null,{status:302,headers:{Location:`/?${g.toString()}`}}):new Response(((a,b="Unknown",c=null)=>{let d=a.onAPIError?.customizeDefaultErrorPage;return`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: ${d?.font?.defaultFamily||"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"};
        background: ${d?.colors?.background||"var(--background)"};
        color: var(--foreground);
        margin: 0;
      }
      :root,
      :host {
        --spacing: 0.25rem;
        --container-md: 28rem;
        --text-sm: ${d?.size?.textSm||"0.875rem"};
        --text-sm--line-height: calc(1.25 / 0.875);
        --text-2xl: ${d?.size?.text2xl||"1.5rem"};
        --text-2xl--line-height: calc(2 / 1.5);
        --text-4xl: ${d?.size?.text4xl||"2.25rem"};
        --text-4xl--line-height: calc(2.5 / 2.25);
        --text-6xl: ${d?.size?.text6xl||"3rem"};
        --text-6xl--line-height: 1;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;
        --default-transition-duration: 150ms;
        --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        --radius: ${d?.size?.radiusSm||"0.625rem"};
        --default-mono-font-family: ${d?.font?.monoFamily||"var(--font-geist-mono)"};
        --primary: ${d?.colors?.primary||"black"};
        --primary-foreground: ${d?.colors?.primaryForeground||"white"};
        --background: ${d?.colors?.background||"white"};
        --foreground: ${d?.colors?.foreground||"oklch(0.271 0 0)"};
        --border: ${d?.colors?.border||"oklch(0.89 0 0)"};
        --destructive: ${d?.colors?.destructive||"oklch(0.55 0.15 25.723)"};
        --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.545 0 0)"};
        --corner-border: ${d?.colors?.cornerBorder||"#404040"};
      }

      button, .btn {
        cursor: pointer;
        background: none;
        border: none;
        color: inherit;
        font: inherit;
        transition: all var(--default-transition-duration)
          var(--default-transition-timing-function);
      }
      button:hover, .btn:hover {
        opacity: 0.8;
      }

      @media (prefers-color-scheme: dark) {
        :root,
        :host {
          --primary: ${d?.colors?.primary||"white"};
          --primary-foreground: ${d?.colors?.primaryForeground||"black"};
          --background: ${d?.colors?.background||"oklch(0.15 0 0)"};
          --foreground: ${d?.colors?.foreground||"oklch(0.98 0 0)"};
          --border: ${d?.colors?.border||"oklch(0.27 0 0)"};
          --destructive: ${d?.colors?.destructive||"oklch(0.65 0.15 25.723)"};
          --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.65 0 0)"};
          --corner-border: ${d?.colors?.cornerBorder||"#a0a0a0"};
        }
      }
      @media (max-width: 640px) {
        :root, :host {
          --text-6xl: 2.5rem;
          --text-2xl: 1.25rem;
          --text-sm: 0.8125rem;
        }
      }
      @media (max-width: 480px) {
        :root, :host {
          --text-6xl: 2rem;
          --text-2xl: 1.125rem;
        }
      }
    </style>
  </head>
  <body style="width: 100vw; min-height: 100vh; overflow-x: hidden; overflow-y: auto;">
    <div
        style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        "
        >
${d?.disableBackgroundGrid?"":`
      <div
        style="
          position: absolute;
          inset: 0;
          background-image: linear-gradient(to right, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px),
            linear-gradient(to bottom, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px);
          background-size: 40px 40px;
          opacity: 0.6;
          pointer-events: none;
          width: 100vw;
          height: 100vh;
        "
      ></div>
      <div
        style="
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: ${d?.colors?.background||"var(--background)"};
          mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          pointer-events: none;
        "
      ></div>
`}

<div
  style="
    position: relative;
    z-index: 10;
    border: 2px solid var(--border);
    background: ${d?.colors?.cardBackground||"var(--background)"};
    padding: 1.5rem;
    max-width: 42rem;
    width: 100%;
  "
>
    ${d?.disableCornerDecorations?"":`
        <!-- Corner decorations -->
        <div
          style="
            position: absolute;
            top: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            top: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>
  
        <div
          style="
            position: absolute;
            bottom: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>`}

        <div style="text-align: center; margin-bottom: 1.5rem;">
          <div style="margin-bottom: 1.5rem;">
            <div
              style="
                display: inline-block;
                border: 2px solid ${d?.disableTitleBorder?"transparent":d?.colors?.titleBorder||"var(--destructive)"};
                padding: 0.375rem 1rem;
              "
            >
              <h1
                style="
                  font-size: var(--text-6xl);
                  font-weight: var(--font-weight-semibold);
                  color: ${d?.colors?.titleColor||"var(--foreground)"};
                  letter-spacing: -0.02em;
                  margin: 0;
                "
              >
                ERROR
              </h1>
            </div>
            <div
              style="
                height: 2px;
                background-color: var(--border);
                width: calc(100% + 3rem);
                margin-left: -1.5rem;
                margin-top: 1.5rem;
              "
            ></div>
          </div>

          <h2
            style="
              font-size: var(--text-2xl);
              font-weight: var(--font-weight-semibold);
              color: var(--foreground);
              margin: 0 0 1rem;
            "
          >
            Something went wrong
          </h2>

          <div
            style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                border: 2px solid var(--border);
                background-color: var(--muted);
                padding: 0.375rem 0.75rem;
                margin: 0 0 1rem;
                flex-wrap: wrap;
                justify-content: center;
            "
            >
            <span
                style="
                font-size: 0.75rem;
                color: var(--muted-foreground);
                font-weight: var(--font-weight-semibold);
                "
            >
                CODE:
            </span>
            <span
                style="
                font-size: var(--text-sm);
                font-family: var(--default-mono-font-family, monospace);
                color: var(--foreground);
                word-break: break-all;
                "
            >
                ${jE(b)}
            </span>
            </div>

          <p
            style="
              color: var(--muted-foreground);
              max-width: 28rem;
              margin: 0 auto;
              font-size: var(--text-sm);
              line-height: 1.5;
              text-wrap: pretty;
            "
          >
            ${!c?`We encountered an unexpected error. Please try again or return to the home page. If you're a developer, you can find more information about the error <a href='https://better-auth.com/docs/reference/errors/${encodeURIComponent(b)}' target='_blank' rel="noopener noreferrer" style='color: var(--foreground); text-decoration: underline;'>here</a>.`:c}
          </p>
        </div>

        <div
          style="
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <a
            href="/"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: var(--primary);
                color: var(--primary-foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Go Home
            </div>
          </a>
          <a
            href="https://better-auth.com/docs/reference/errors/${encodeURIComponent(b)}?askai=${encodeURIComponent(`What does the error code ${b} mean?`)}"
            target="_blank"
            rel="noopener noreferrer"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: transparent;
                color: var(--foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Ask AI
            </div>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>`})(a.context.options,e,f),{headers:{"Content-Type":"text/html"}})}),jG=hY("/ok",{method:"GET",metadata:{...hG,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0}));async function jH(a,b){let c=(await a.context.internalAdapter.findAccounts(b.userId))?.find(a=>"credential"===a.providerId),d=c?.password;return!!c&&!!d&&await a.context.password.verify({hash:d,password:b.password})}async function jI(a,b){let c=(await b.context.internalAdapter.findAccounts(a))?.find(a=>"credential"===a.providerId),d=c?.password;if(!c||!d||!b.body.password)throw new gf("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:d,password:b.body.password}))throw new gf("BAD_REQUEST",{message:"Invalid password"});return!0}function jJ(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let jK=hY("/request-password-reset",{method:"POST",body:eL.object({email:eL.email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:eL.string().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{operationId:"requestPasswordReset",description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new gf("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return(0,hH.generateId)(24),await a.context.internalAdapter.findVerificationValue("dummy-verification-token"),a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=eJ(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,hH.generateId)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e});let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.runInBackgroundOrAwait(a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request)),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),jL=hY("/reset-password/:token",{method:"GET",operationId:"forgetPasswordCallback",query:eL.object({callbackURL:eL.string().meta({description:"The URL to redirect the user to reset their password"})}),use:[h0(a=>a.query.callbackURL)],metadata:{openapi:{operationId:"resetPasswordCallback",description:"Redirects the user to the callback URL with the token",parameters:[{name:"token",in:"path",required:!0,description:"The token to reset the password",schema:{type:"string"}},{name:"callbackURL",in:"query",required:!0,description:"The URL to redirect the user to reset their password",schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{var b,c;let d,{token:e}=a.params,{callbackURL:f}=a.query;if(!e||!f)throw a.redirect(jJ(a.context,f,{error:"INVALID_TOKEN"}));let g=await a.context.internalAdapter.findVerificationValue(`reset-password:${e}`);if(!g||g.expiresAt<new Date)throw a.redirect(jJ(a.context,f,{error:"INVALID_TOKEN"}));throw a.redirect((b=a.context,c={token:e},d=new URL(f,b.baseURL),c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href))}),jM=hY("/reset-password",{method:"POST",operationId:"resetPassword",query:eL.object({token:eL.string().optional()}).optional(),body:eL.object({newPassword:eL.string().meta({description:"The new password to set"}),token:eL.string().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{operationId:"resetPassword",description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});if(c.length>e)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,g=await a.context.internalAdapter.findVerificationValue(f);if(!g||g.expiresAt<new Date)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_TOKEN});let h=g.value,i=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(h)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(h,i):await a.context.internalAdapter.createAccount({userId:h,providerId:"credential",password:i,accountId:h}),await a.context.internalAdapter.deleteVerificationValue(g.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(h);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(h),a.json({status:!0})}),jN=hY("/verify-password",{method:"POST",body:eL.object({password:eL.string().meta({description:"The password to verify"})}),metadata:{scope:"server",openapi:{operationId:"verifyPassword",description:"Verify the current user's password",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}},use:[iC]},async a=>{let{password:b}=a.body,c=a.context.session;if(!await jH(a,{password:b,userId:c.user.id}))throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_PASSWORD});return a.json({status:!0})}),jO=eL.object({callbackURL:eL.string().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:eL.string().optional(),errorCallbackURL:eL.string().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:jq,disableRedirect:eL.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:eL.optional(eL.object({token:eL.string().meta({description:"ID token from the provider"}),nonce:eL.string().meta({description:"Nonce used to generate the token"}).optional(),accessToken:eL.string().meta({description:"Access token from the provider"}).optional(),refreshToken:eL.string().meta({description:"Refresh token from the provider"}).optional(),expiresAt:eL.number().meta({description:"Expiry date of the token"}).optional()})),scopes:eL.array(eL.string()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:eL.boolean().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:eL.string().meta({description:"The login hint to use for the authorization code request"}).optional(),additionalData:eL.record(eL.string(),eL.any()).optional().meta({description:"Additional data to be passed through the OAuth flow"})}),jP=hY("/sign-out",{method:"POST",operationId:"signOut",requireHeaders:!0,metadata:{openapi:{operationId:"signOut",description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(b)try{await a.context.internalAdapter.deleteSession(b)}catch(b){a.context.logger.error("Failed to delete session from database",b)}return he(a),a.json({success:!0})}),jQ=eL.object({name:eL.string(),email:eL.email(),password:eL.string().nonempty(),image:eL.string().optional(),callbackURL:eL.string().optional(),rememberMe:eL.boolean().optional()}).and(eL.record(eL.string(),eL.any())),jR=eL.record(eL.string().meta({description:"Field name must be a string"}),eL.any()),jS=hY("/change-password",{method:"POST",operationId:"changePassword",body:eL.object({newPassword:eL.string().meta({description:"The new password to set"}),currentPassword:eL.string().meta({description:"The current password is required"}),revokeOtherSessions:eL.boolean().meta({description:"Must be a boolean value"}).optional()}),use:[iC],metadata:{openapi:{operationId:"changePassword",description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});let g=a.context.password.config.maxPasswordLength;if(b.length>g)throw a.context.logger.error("Password is too long"),new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!h||!h.password)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND});let i=await a.context.password.hash(b);if(!await a.context.password.verify({hash:h.password,password:c}))throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(h.id,{password:i});let j=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id);if(!b)throw new gf("INTERNAL_SERVER_ERROR",{message:hS.BASE_ERROR_CODES.FAILED_TO_GET_SESSION});await hc(a,{session:b,user:e.user}),j=b.token}return a.json({token:j,user:gM(a.context.options,e.user)})}),jT=hY({method:"POST",body:eL.object({newPassword:eL.string().meta({description:"The new password to set is required"})}),use:[iC]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),g=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:g}),a.json({status:!0});throw new gf("BAD_REQUEST",{message:"user already has a password"})}),jU=hY("/delete-user",{method:"POST",use:[iC],body:eL.object({callbackURL:eL.string().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:eL.string().meta({description:"The password of the user is required to delete the user"}).optional(),token:eL.string().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{operationId:"deleteUser",description:"Delete the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{callbackURL:{type:"string",description:"The callback URL to redirect to after the user is deleted"},password:{type:"string",description:"The user's password. Required if session is not fresh"},token:{type:"string",description:"The deletion verification token"}}}}}},responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new gf("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_PASSWORD})}if(a.body.token)return await jV({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=bt(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))});let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${encodeURIComponent(a.body.callbackURL||"/")}`;return await a.context.runInBackgroundOrAwait(a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request)),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=new Date(b.session.createdAt).getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),he(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),jV=hY("/delete-user/callback",{method:"GET",query:eL.object({token:eL.string().meta({description:"The token to verify the deletion request"}),callbackURL:eL.string().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[h0(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new gf("NOT_FOUND");let b=await iA(a);if(!b)throw new gf("NOT_FOUND",{message:hS.BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new gf("NOT_FOUND",{message:hS.BASE_ERROR_CODES.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),he(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),jW=hY("/change-email",{method:"POST",body:eL.object({newEmail:eL.email().meta({description:"The new email address to set must be a valid email address"}),callbackURL:eL.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[iC],metadata:{openapi:{operationId:"changeEmail",responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new gf("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new gf("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new gf("UNPROCESSABLE_ENTITY",{message:hS.BASE_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(!0!==a.context.session.user.emailVerified&&a.context.options.user.changeEmail.updateEmailWithoutVerification){if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b}),await hc(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await jx(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request))}return a.json({status:!0})}if(a.context.session.user.emailVerified&&(a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification)){let c=await jx(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-confirmation"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`,e=a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification;return e&&await a.context.runInBackgroundOrAwait(e({user:a.context.session.user,newEmail:b,url:d,token:c},a.request)),a.json({status:!0})}if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new gf("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await jx(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)),a.json({status:!0})});function jX(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function jY(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,d=".",e){if(!jX(c))return a(b,{},d,e);let f=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let g=b[c];null!=g&&(e&&e(f,c,g,d)||(Array.isArray(g)&&Array.isArray(f[c])?f[c]=[...g,...f[c]]:jX(g)&&jX(f[c])?f[c]=a(g,f[c],(d?`${d}.`:"")+c.toString(),e):f[c]=g))}return f})(b,c,"",a),{})}let jZ=jY();jY((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),jY((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0});let j$=jY((a,b,c)=>{if(Array.isArray(a[b])&&Array.isArray(c))return a[b]=c,!0}),j_=new WeakMap;async function j0(a,b){let c={};for(let d of b){let b=!1;try{b=d.matcher(a)}catch(c){let b=j_.get(d.handler)??"unknown";throw a.context.logger.error(`An error occurred during ${b} hook matcher execution:`,c),new gf("INTERNAL_SERVER_ERROR",{message:"An error occurred during hook matcher execution. Check the logs for more details."})}if(b){let b=await d.handler({...a,returnHeaders:!1}).catch(b=>{throw b instanceof gf&&(0,ib.shouldPublishLog)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),b});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=j$(d,c);continue}return b}}}return{context:c}}async function j1(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(b=>{if(b instanceof gf)return(0,ib.shouldPublishLog)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),{response:b,headers:b.headers?new Headers(b.headers):null};throw b});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}function j2(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{})??{},d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>{let d=await a;return b.middleware({...c,context:{...d,...c.context}})};return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=async()=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0};return ht(d,async()=>{let{beforeHooks:b,afterHooks:f}=function(a){let b=a.options.plugins||[],c=[],d=[],e=a.options.hooks?.before;e&&(j_.set(e,"user"),c.push({matcher:()=>!0,handler:e}));let f=a.options.hooks?.after;f&&(j_.set(f,"user"),d.push({matcher:()=>!0,handler:f}));let g=b.filter(a=>a.hooks?.before).map(a=>a.hooks?.before).flat(),h=b.filter(a=>a.hooks?.after).map(a=>a.hooks?.after).flat();return g.length&&c.push(...g),h.length&&d.push(...h),{beforeHooks:c,afterHooks:d}}(c),g=await j0(d,b);if("context"in g&&g.context&&"object"==typeof g.context){let{headers:a,...b}=g.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=j$(b,d)}else if(g)return a?.asResponse?gl(g,{headers:a?.headers}):a?.returnHeaders?{headers:a?.headers,response:g}:g;d.asResponse=!1,d.returnHeaders=!0,d.returnStatus=!0;let h=await ht(d,()=>e(d)).catch(a=>{if(a instanceof gf)return{response:a,status:a.statusCode,headers:a.headers?new Headers(a.headers):null};throw a});if(h&&h instanceof Response)return h;d.context.returned=h.response,d.context.responseHeaders=h.headers;let i=await j1(d,f);if(i.response&&(h.response=i.response),h.response instanceof gf&&(0,ib.shouldPublishLog)(c.logger.level,"debug")&&(h.response.stack=h.response.errorStack),h.response instanceof gf&&!a?.asResponse)throw h.response;return a?.asResponse?gl(h.response,{headers:h.headers,status:h.status}):a?.returnHeaders?a?.returnStatus?{headers:h.headers,response:h.response,status:h.status}:{headers:h.headers,response:h.response}:a?.returnStatus?{response:h.response,status:h.status}:h.response})};return await hv()?c():hx(new WeakMap,c)},c[d].path=e.path,c[d].options=e.options;return c}({signInSocial:hY("/sign-in/social",{method:"POST",operationId:"socialSignIn",body:jO,metadata:{$Infer:{body:{},returned:{}},openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{token:{type:"string"},user:{type:"object",$ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean",enum:[!1]}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new gf("NOT_FOUND",{message:hS.BASE_ERROR_CODES.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new gf("NOT_FOUND",{message:hS.BASE_ERROR_CODES.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.USER_EMAIL_NOT_FOUND});let f=await jB(a,{userInfo:{...e.user,email:e.user.email,id:String(e.user.id),name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:String(e.user.id),accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new gf("UNAUTHORIZED",{message:f.error});return await hc(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:gM(a.context.options,f.data.user)})}let{codeVerifier:c,state:d}=await hE(a,void 0,a.body.additionalData),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.body.disableRedirect||a.setHeader("Location",e.toString()),a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),callbackOAuth:jD,getSession:iz(),signOut:jP,signUpEmail:hY("/sign-up/email",{method:"POST",operationId:"signUpWithEmailAndPassword",use:[h2],body:jQ,metadata:{allowedMediaTypes:["application/x-www-form-urlencoded","application/json"],$Infer:{body:{},returned:{}},openapi:{operationId:"signUpWithEmailAndPassword",description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>hB(a.context.adapter,async()=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new gf("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:g,callbackURL:h,rememberMe:i,...j}=c;if(!eL.email().safeParse(e).success)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_EMAIL});if(!f||"string"!=typeof f)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_PASSWORD});let k=a.context.password.config.minPasswordLength;if(f.length<k)throw a.context.logger.error("Password is too short"),new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_SHORT});let l=a.context.password.config.maxPasswordLength;if(f.length>l)throw a.context.logger.error("Password is too long"),new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.PASSWORD_TOO_LONG});if((await a.context.internalAdapter.findUserByEmail(e))?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new gf("UNPROCESSABLE_ENTITY",{message:hS.BASE_ERROR_CODES.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let m=await a.context.password.hash(f);try{let c=gQ(a.context.options,j,"create");if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:g,...c,emailVerified:!1})))throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_USER})}catch(b){if((0,g5.isDevelopment)()&&a.context.logger.error("Failed to create user",b),b instanceof gf)throw b;throw a.context.logger?.error("Failed to create user",b),new gf("UNPROCESSABLE_ENTITY",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_USER})}if(!b)throw new gf("UNPROCESSABLE_ENTITY",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:m}),a.context.options.emailVerification?.sendOnSignUp??a.context.options.emailAndPassword.requireEmailVerification){let d=await jx(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=c.callbackURL?encodeURIComponent(c.callbackURL):encodeURIComponent("/"),f=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${e}`;a.context.options.emailVerification?.sendVerificationEmail&&await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:b,url:f,token:d},a.request))}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:gM(a.context.options,b)});let n=await a.context.internalAdapter.createSession(b.id,!1===i);if(!n)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});return await hc(a,{session:n,user:b},!1===i),a.json({token:n.token,user:gM(a.context.options,b)})})),signInEmail:hY("/sign-in/email",{method:"POST",operationId:"signInEmail",use:[h2],body:eL.object({email:eL.string().meta({description:"Email of the user"}),password:eL.string().meta({description:"Password of the user"}),callbackURL:eL.string().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:eL.boolean().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{allowedMediaTypes:["application/x-www-form-urlencoded","application/json"],$Infer:{body:{},returned:{}},openapi:{operationId:"signInEmail",description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"string",nullable:!0},user:{type:"object",$ref:"#/components/schemas/User"}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new gf("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!eL.email().safeParse(b).success)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});let e=d.accounts.find(a=>"credential"===a.providerId);if(!e)throw await a.context.password.hash(c),a.context.logger.error("Credential account not found",{email:b}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});let f=e?.password;if(!f)throw await a.context.password.hash(c),a.context.logger.error("Password not found",{email:b}),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:f,password:c}))throw a.context.logger.error("Invalid password"),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new gf("FORBIDDEN",{message:hS.BASE_ERROR_CODES.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await jx(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;await a.context.runInBackgroundOrAwait(a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:e,token:b},a.request))}throw new gf("FORBIDDEN",{message:hS.BASE_ERROR_CODES.EMAIL_NOT_VERIFIED})}let g=await a.context.internalAdapter.createSession(d.user.id,!1===a.body.rememberMe);if(!g)throw a.context.logger.error("Failed to create session"),new gf("UNAUTHORIZED",{message:hS.BASE_ERROR_CODES.FAILED_TO_CREATE_SESSION});return await hc(a,{session:g,user:d.user},!1===a.body.rememberMe),a.body.callbackURL&&a.setHeader("Location",a.body.callbackURL),a.json({redirect:!!a.body.callbackURL,token:g.token,url:a.body.callbackURL,user:gM(a.context.options,d.user)})}),resetPassword:jM,verifyPassword:jN,verifyEmail:jA,sendVerificationEmail:jz,changeEmail:jW,changePassword:jS,setPassword:jT,updateUser:hY("/update-user",{method:"POST",operationId:"updateUser",body:jR,use:[iB],metadata:{$Infer:{body:{}},openapi:{operationId:"updateUser",description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user",nullable:!0}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async a=>{let b=a.body;if("object"!=typeof b||Array.isArray(b))throw new gf("BAD_REQUEST",{message:"Body must be an object"});if(b.email)throw new gf("BAD_REQUEST",{message:hS.BASE_ERROR_CODES.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session,g=gQ(a.context.options,e,"update");if(void 0===d&&void 0===c&&0===Object.keys(g).length)throw new gf("BAD_REQUEST",{message:"No fields to update"});let h=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...g})??{...f.user,...void 0!==c&&{name:c},...void 0!==d&&{image:d},...g};return await hc(a,{session:f.session,user:h}),a.json({status:!0})}),deleteUser:jU,requestPasswordReset:jK,requestPasswordResetCallback:jL,listSessions:hY("/list-sessions",{method:"GET",operationId:"listUserSessions",use:[iB],requireHeaders:!0,metadata:{openapi:{operationId:"listUserSessions",description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b.map(b=>gN(a.context.options,b)))}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),revokeSession:iE,revokeSessions:iF,revokeOtherSessions:iG,linkSocialAccount:js,listUserAccounts:jr,deleteUserCallback:jV,unlinkAccount:jt,refreshToken:jv,getAccessToken:ju,accountInfo:jw,...c,ok:jG,error:jF},a),middlewares:d}}let j3="better-auth-secret-12345678901234567890";async function j4(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c,f=a.init(d);if("object"==typeof(c=g3(f)?await f:f)){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=jZ(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=ij(d.adapter,{options:b,logger:d.logger,hooks:e.filter(a=>void 0!==a),generateId:d.generateId}),d.options=b,{context:d}}async function j5(a,b){let c=hM(a.baseURL,a.basePath,b),d=c?[new URL(c).origin]:[];if(a.trustedOrigins&&(Array.isArray(a.trustedOrigins)&&d.push(...a.trustedOrigins),"function"==typeof a.trustedOrigins)){let c=await a.trustedOrigins(b);d.push(...c)}let e=g5.env.BETTER_AUTH_TRUSTED_ORIGINS;return e&&d.push(...e.split(",")),d.filter(a=>!!a)}async function j6(){if(d)return d;try{let a="u">typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!a)return;let[{default:b},{default:c}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=await b.readFile(c.join(a,"package.json"),"utf-8");return d=JSON.parse(e)}catch{}}async function j7(a){if(d)return d.dependencies?.[a]||d.devDependencies?.[a]||d.peerDependencies?.[a];try{let b="u">typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!b)throw Error("no-cwd");let[{default:c},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=d.join(b,"node_modules",a,"package.json"),f=await c.readFile(e,"utf-8");return JSON.parse(f).version||await j8(a)||void 0}catch{}return await j8(a)}async function j8(a){let b=await j6();if(b)return({...b.dependencies,...b.devDependencies,...b.peerDependencies})[a]}async function j9(){return(await j6())?.name}let ka={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function kb(){for(let[a,b]of Object.entries(ka)){let c=await j7(a);if(c)return{name:b,version:c}}}let kc={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function kd(){for(let[a,b]of Object.entries(kc)){let c=await j7(a);if(c)return{name:b,version:c}}}function ke(){let a=(...a)=>a.some(a=>!!g5.env[a]);return a("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"u">typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":a("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":a("NETLIFY","NETLIFY_URL")?"netlify":a("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":a("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":a("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":a("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":a("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":a("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":a("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":a("DYNO","HEROKU_APP_NAME")?"heroku":a("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":a("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function kf(){try{if("cloudflare"===ke())return"cloudflare";let a=await Function("mm","return import(mm)")("os"),b=a.cpus();return{deploymentVendor:ke(),systemPlatform:a.platform(),systemRelease:a.release(),systemArchitecture:a.arch(),cpuCount:b.length,cpuModel:b.length?b[0].model:null,cpuSpeed:b.length?b[0].speed:null,memory:a.totalmem(),isWSL:await kj(),isDocker:await ki(),isTTY:"u">typeof process&&process.stdout?process.stdout.isTTY:null}}catch{return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function kg(){if("cloudflare"===ke())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function kh(){if("cloudflare"===ke())return!1;try{return(await Function("mm","return import(mm)")("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function ki(){return"cloudflare"!==ke()&&(void 0===e&&(e=await kg()||await kh()),e)}async function kj(){try{if("cloudflare"===ke()||"u"<typeof process||process?.platform!=="linux")return!1;let a=await Function("mm","return import(mm)")("fs");if((await Function("mm","return import(mm)")("os")).release().toLowerCase().includes("microsoft")){if(await kl())return!1;return!0}return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await kl()}catch{return!1}}let kk=async()=>{if("cloudflare"===ke())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function kl(){return void 0===f&&(f=await kk()||await ki()),f}async function km(a){let b=await d6("SHA-256").digest(a);return d4.encode(b)}let kn=null;async function ko(a){if(kn)return kn;let b=await j9();return b?kn=await km(a?a+b:b):a?kn=await km(a):kn=(0,bs.createRandomStringGenerator)("a-z","A-Z","0-9")(32)}let kp=async function(){};async function kq(a,b){let c,d=a.telemetry?.debug||(0,g5.getBooleanEnvVar)("BETTER_AUTH_TELEMETRY_DEBUG",!1),e=g5.ENV.BETTER_AUTH_TELEMETRY_ENDPOINT;if(!e&&!b?.customTrack)return{publish:kp};let f=async a=>{b?.customTrack?await b.customTrack(a).catch(ib.logger.error):e&&(d?ib.logger.info("telemetry event",JSON.stringify(a,null,2)):await i5(e,{method:"POST",body:a}).catch(ib.logger.error))},g=async()=>{let c=a.telemetry?.enabled!==void 0&&a.telemetry.enabled;return((0,g5.getBooleanEnvVar)("BETTER_AUTH_TELEMETRY",!1)||c)&&(b?.skipTestCheck||!(0,g5.isTest)())},h=await g();h&&(c=await ko(a.baseURL),f({type:"init",payload:{config:{database:b?.database,adapter:b?.adapter,emailVerification:{sendVerificationEmail:!!a.emailVerification?.sendVerificationEmail,sendOnSignUp:!!a.emailVerification?.sendOnSignUp,sendOnSignIn:!!a.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!a.emailVerification?.autoSignInAfterVerification,expiresIn:a.emailVerification?.expiresIn,onEmailVerification:!!a.emailVerification?.onEmailVerification,afterEmailVerification:!!a.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!a.emailAndPassword?.enabled,disableSignUp:!!a.emailAndPassword?.disableSignUp,requireEmailVerification:!!a.emailAndPassword?.requireEmailVerification,maxPasswordLength:a.emailAndPassword?.maxPasswordLength,minPasswordLength:a.emailAndPassword?.minPasswordLength,sendResetPassword:!!a.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:a.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!a.emailAndPassword?.onPasswordReset,password:{hash:!!a.emailAndPassword?.password?.hash,verify:!!a.emailAndPassword?.password?.verify},autoSignIn:!!a.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!a.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];return c?{id:b,mapProfileToUser:!!c.mapProfileToUser,disableDefaultScope:!!c.disableDefaultScope,disableIdTokenSignIn:!!c.disableIdTokenSignIn,disableImplicitSignUp:c.disableImplicitSignUp,disableSignUp:c.disableSignUp,getUserInfo:!!c.getUserInfo,overrideUserInfoOnSignIn:!!c.overrideUserInfoOnSignIn,prompt:c.prompt,verifyIdToken:!!c.verifyIdToken,scope:c.scope,refreshAccessToken:!!c.refreshAccessToken}:{}}),plugins:a.plugins?.map(a=>a.id.toString()),user:{modelName:a.user?.modelName,fields:a.user?.fields,additionalFields:a.user?.additionalFields,changeEmail:{enabled:a.user?.changeEmail?.enabled,sendChangeEmailVerification:!!a.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:a.verification?.modelName,disableCleanup:a.verification?.disableCleanup,fields:a.verification?.fields},session:{modelName:a.session?.modelName,additionalFields:a.session?.additionalFields,cookieCache:{enabled:a.session?.cookieCache?.enabled,maxAge:a.session?.cookieCache?.maxAge,strategy:a.session?.cookieCache?.strategy},disableSessionRefresh:a.session?.disableSessionRefresh,expiresIn:a.session?.expiresIn,fields:a.session?.fields,freshAge:a.session?.freshAge,preserveSessionInDatabase:a.session?.preserveSessionInDatabase,storeSessionInDatabase:a.session?.storeSessionInDatabase,updateAge:a.session?.updateAge},account:{modelName:a.account?.modelName,fields:a.account?.fields,encryptOAuthTokens:a.account?.encryptOAuthTokens,updateAccountOnSignIn:a.account?.updateAccountOnSignIn,accountLinking:{enabled:a.account?.accountLinking?.enabled,trustedProviders:a.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:a.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:a.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!a.hooks?.after,before:!!a.hooks?.before},secondaryStorage:!!a.secondaryStorage,advanced:{cookiePrefix:!!a.advanced?.cookiePrefix,cookies:!!a.advanced?.cookies,crossSubDomainCookies:{domain:!!a.advanced?.crossSubDomainCookies?.domain,enabled:a.advanced?.crossSubDomainCookies?.enabled,additionalCookies:a.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial",generateId:a.advanced?.database?.generateId,defaultFindManyLimit:a.advanced?.database?.defaultFindManyLimit},useSecureCookies:a.advanced?.useSecureCookies,ipAddress:{disableIpTracking:a.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:a.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:a.advanced?.disableCSRFCheck,cookieAttributes:{expires:a.advanced?.defaultCookieAttributes?.expires,secure:a.advanced?.defaultCookieAttributes?.secure,sameSite:a.advanced?.defaultCookieAttributes?.sameSite,domain:!!a.advanced?.defaultCookieAttributes?.domain,path:a.advanced?.defaultCookieAttributes?.path,httpOnly:a.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:a.trustedOrigins?.length,rateLimit:{storage:a.rateLimit?.storage,modelName:a.rateLimit?.modelName,window:a.rateLimit?.window,customStorage:!!a.rateLimit?.customStorage,enabled:a.rateLimit?.enabled,max:a.rateLimit?.max},onAPIError:{errorURL:a.onAPIError?.errorURL,onError:!!a.onAPIError?.onError,throw:a.onAPIError?.throw},logger:{disabled:a.logger?.disabled,level:a.logger?.level,log:!!a.logger?.log},databaseHooks:{user:{create:{after:!!a.databaseHooks?.user?.create?.after,before:!!a.databaseHooks?.user?.create?.before},update:{after:!!a.databaseHooks?.user?.update?.after,before:!!a.databaseHooks?.user?.update?.before}},session:{create:{after:!!a.databaseHooks?.session?.create?.after,before:!!a.databaseHooks?.session?.create?.before},update:{after:!!a.databaseHooks?.session?.update?.after,before:!!a.databaseHooks?.session?.update?.before}},account:{create:{after:!!a.databaseHooks?.account?.create?.after,before:!!a.databaseHooks?.account?.create?.before},update:{after:!!a.databaseHooks?.account?.update?.after,before:!!a.databaseHooks?.account?.update?.before}},verification:{create:{after:!!a.databaseHooks?.verification?.create?.after,before:!!a.databaseHooks?.verification?.create?.before},update:{after:!!a.databaseHooks?.verification?.update?.after,before:!!a.databaseHooks?.verification?.update?.before}}}},runtime:"u">typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"u">typeof Bun?{name:"bun",version:Bun?.version??null}:"u">typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await kb(),framework:await kd(),environment:"production"===(0,g5.getEnvVar)("NODE_ENV")?"production":"false"!==g5.env.CI&&("BUILD_ID"in g5.env||"BUILD_NUMBER"in g5.env||"CI"in g5.env||"CI_APP_ID"in g5.env||"CI_BUILD_ID"in g5.env||"CI_BUILD_NUMBER"in g5.env||"CI_NAME"in g5.env||"CONTINUOUS_INTEGRATION"in g5.env||"RUN_ID"in g5.env)?"ci":(0,g5.isTest)()?"test":"development",systemInfo:await kf(),packageManager:function(){let a=g5.env.npm_config_user_agent;if(!a)return;let b=a.split(" ")[0],c=b.lastIndexOf("/"),d=b.substring(0,c);return{name:"npminstall"===d?"cnpm":d,version:b.substring(c+1)}}()},anonymousId:c}));return{publish:async b=>{h&&(c||(c=await ko(a.baseURL)),await f({type:b.type,payload:b.payload,anonymousId:c}))}}}async function kr(a,b,c){var d,e;let f,g,h,i,j,k,l,m;b.database||(b=jZ(b,{session:{cookieCache:{enabled:!0,strategy:"jwe",refreshCache:!0}},account:{storeStateStrategy:"cookie",storeAccountCookie:!0}}));let n=b.plugins||[],o=(d=b,d.advanced?.crossSubDomainCookies?.enabled,[]),p=(0,ib.createLogger)(b.logger),q=hM(b.baseURL,b.basePath);q||p.warn("[better-auth] Base URL could not be determined. Please set a valid base URL using the baseURL config option or the BETTER_AUTH_URL environment variable. Without this, callbacks and redirects may not work correctly."),"memory"===a.id&&b.advanced?.database?.generateId===!1&&p.error(`[better-auth] Misconfiguration detected.
You are using the memory DB with generateId: false.
This will cause no id to be generated for any model.
Most of the features of Better Auth will not work correctly.`);let r=b.secret||g5.env.BETTER_AUTH_SECRET||g5.env.AUTH_SECRET||j3,s=r===j3;if(!(0,g5.isTest)()){let a;if(s&&g5.isProduction)throw new dT.BetterAuthError("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");if(!r)throw new dT.BetterAuthError("BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).");r.length<32&&p.warn("[better-auth] Warning: your BETTER_AUTH_SECRET should be at least 32 characters long for adequate security. Generate one with `npx @better-auth/cli secret` or `openssl rand -base64 32`."),120>(0===(a=new Set(r).size)?0:Math.log2(Math.pow(a,r.length)))&&p.warn("[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.")}!function(a,b){let c=new Map;a.plugins?.forEach(a=>{if(a.endpoints){for(let[b,d]of Object.entries(a.endpoints))if(d&&"path"in d&&"string"==typeof d.path){let e=d.path,f=[];d.options&&"method"in d.options&&(Array.isArray(d.options.method)?f=d.options.method:"string"==typeof d.options.method&&(f=[d.options.method])),0===f.length&&(f=["*"]),c.has(e)||c.set(e,[]),c.get(e).push({pluginId:a.id,endpointKey:b,methods:f})}}});let d=[];for(let[a,b]of c.entries())if(b.length>1){let c=new Map,e=!1;for(let a of b)for(let d of a.methods)c.has(d)||c.set(d,[]),c.get(d).push(a.pluginId),c.get(d).length>1&&(e=!0),"*"===d&&b.length>1?e=!0:"*"!==d&&c.has("*")&&(e=!0);if(e){let e=[...new Set(b.map(a=>a.pluginId))],f=[];for(let[a,d]of c.entries())(d.length>1||"*"===a&&b.length>1||"*"!==a&&c.has("*"))&&f.push(a);d.push({path:a,plugins:e,conflictingMethods:f})}}if(d.length>0){let a=d.map(a=>`  - "${a.path}" [${a.conflictingMethods.join(", ")}] used by plugins: ${a.plugins.join(", ")}`).join("\n");b.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${a}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}(b={...b,secret:r,baseURL:q?new URL(q).origin:"",basePath:b.basePath||"/api/auth",plugins:n.concat(o)},p);let t=(h=(g=ha(e=b))("session_token",{maxAge:e.session?.expiresIn||Math.round(function(a){let b,c=g4.exec("7d");if(!c||c[4]&&c[1])throw TypeError('Invalid time string format: "7d". Use formats like "7d", "30m", "1 hour", etc.');let d=parseFloat(c[2]),e=c[3].toLowerCase();switch(e){case"years":case"year":case"yrs":case"yr":case"y":b=315576e5*d;break;case"months":case"month":case"mo":b=2592e6*d;break;case"weeks":case"week":case"w":b=6048e5*d;break;case"days":case"day":case"d":b=864e5*d;break;case"hours":case"hour":case"hrs":case"hr":case"h":b=36e5*d;break;case"minutes":case"minute":case"mins":case"min":case"m":b=6e4*d;break;case"seconds":case"second":case"secs":case"sec":case"s":b=1e3*d;break;default:throw TypeError(`Unknown time unit: "${e}"`)}return"-"===c[1]||"ago"===c[4]?-b:b}("7d")/1e3)}),i=g("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),j=g("account_data",{maxAge:e.session?.cookieCache?.maxAge||300}),k=g("dont_remember"),{sessionToken:{name:h.name,attributes:h.attributes,options:h.attributes},sessionData:{name:i.name,attributes:i.attributes,options:i.attributes},dontRememberToken:{name:k.name,attributes:k.attributes,options:k.attributes},accountData:{name:j.name,attributes:j.attributes,options:j.attributes}}),u=(0,eK.getAuthTables)(b),v=Object.entries(b.socialProviders||{}).map(([a,b])=>{if(null==b||!1===b.enabled)return null;b.clientId||p.warn(`Social provider ${a} is missing clientId or clientSecret`);let c=jo[a](b);return c.disableImplicitSignUp=b.disableImplicitSignUp,c}).filter(a=>null!==a),w=({model:a,size:c})=>{if("function"==typeof b.advanced?.generateId)return b.advanced.generateId({model:a,size:c});let d=b?.advanced?.database?.generateId;return"function"==typeof d?d({model:a,size:c}):"uuid"===d?crypto.randomUUID():"serial"!==d&&!1!==d&&(0,hH.generateId)(c)},{publish:x}=await kq(b,{adapter:a.id,database:"function"==typeof b.database?"adapter":c(b.database)}),y=await j5(b),z=j4({appName:b.appName||"Better Auth",baseURL:q||"",version:ho().version,socialProviders:v,options:b,oauthConfig:{storeStateStrategy:b.account?.storeStateStrategy||(b.database?"database":"cookie"),skipStateCookieCheck:!!b.account?.skipStateCookieCheck},tables:u,trustedOrigins:y,isTrustedOrigin(a,b){return this.trustedOrigins.some(c=>hR(a,c,b))},sessionConfig:{updateAge:b.session?.updateAge!==void 0?b.session.updateAge:86400,expiresIn:b.session?.expiresIn||604800,freshAge:b.session?.freshAge===void 0?86400:b.session.freshAge,cookieRefreshCache:(l=b.session?.cookieCache?.refreshCache,m=b.session?.cookieCache?.maxAge||300,(b.database||b.secondaryStorage)&&l?(p.warn("[better-auth] `session.cookieCache.refreshCache` is enabled while `database` or `secondaryStorage` is configured. `refreshCache` is meant for stateless (DB-less) setups. Disabling `refreshCache`  remove it from your config to silence this warning."),!1):!1!==l&&void 0!==l&&(!0===l?{enabled:!0,updateAge:Math.floor(.2*m)}:{enabled:!0,updateAge:void 0!==l.updateAge?l.updateAge:Math.floor(.2*m)}))},secret:r,rateLimit:{...b.rateLimit,enabled:b.rateLimit?.enabled??g5.isProduction,window:b.rateLimit?.window||10,max:b.rateLimit?.max||100,storage:b.rateLimit?.storage||(b.secondaryStorage?"secondary-storage":"memory")},authCookies:t,logger:p,generateId:w,session:null,secondaryStorage:b.secondaryStorage,password:{hash:b.emailAndPassword?.password?.hash||d$,verify:b.emailAndPassword?.password?.verify||d_,config:{minPasswordLength:b.emailAndPassword?.minPasswordLength||8,maxPasswordLength:b.emailAndPassword?.maxPasswordLength||128},checkPassword:jI},setNewSession(a){this.newSession=a},newSession:null,adapter:a,internalAdapter:ij(a,{options:b,logger:p,hooks:b.databaseHooks?[b.databaseHooks]:[],generateId:w}),createAuthCookie:ha(b),async runMigrations(){throw new dT.BetterAuthError("runMigrations will be set by the specific init implementation")},publishTelemetry:x,skipCSRFCheck:!!b.advanced?.disableCSRFCheck,skipOriginCheck:b.advanced?.disableOriginCheck!==void 0?b.advanced.disableOriginCheck:!!(0,g5.isTest)(),runInBackground:b.advanced?.backgroundTasks?.handler??(a=>{a.catch(()=>{})}),async runInBackgroundOrAwait(a){try{b.advanced?.backgroundTasks?.handler?a instanceof Promise&&b.advanced.backgroundTasks.handler(a.catch(a=>{p.error("Failed to run background task:",a)})):await a}catch(a){p.error("Failed to run background task:",a)}},getPlugin:a=>b.plugins.find(b=>b.id===a)??null});return g3(z)?{context:f}=await z:{context:f}=z,"function"==typeof f.options.emailVerification?.onEmailVerification&&(f.options.emailVerification.onEmailVerification=(0,hT.deprecate)(f.options.emailVerification.onEmailVerification,"Use `afterEmailVerification` instead. This will be removed in 1.5",f.logger)),f}let ks=async a=>{let b=await id(a),c=await kr(b,a,a=>(0,ip.getKyselyDatabaseType)(a)||"unknown");return c.runMigrations=async function(){if(!a.database||"updateMany"in a.database)throw new dT.BetterAuthError("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await iw(a);await b()},c};a.i(64402);var kt=a.i(54604),ku=a.i(56303);a.s([],87091);let kv="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",kx=a=>{let b="u"<typeof Uint8Array?[]:new Uint8Array(256),c=kv.length;for(let d=0;d<c;d++)b[a.charCodeAt(d)]=d;return b},ky=kx(kv),kz=kx(kw),kA=/^[-A-Za-z0-9\-_]*$/,kB=/^[-A-Za-z0-9+/]*={0,3}$/,kC={};function kD(a,b="base64url"){return new Uint8Array(kC.toArrayBuffer(a,"base64url"===b))}function kE(a,b="base64url"){let c=new Uint8Array(a);return kC.fromArrayBuffer(c.buffer,"base64url"===b)}function kF(a){let b=kC.toArrayBuffer(a,!0);return kC.fromArrayBuffer(b)}function kG(a){return kC.fromString(a,!0)}function kH(a){return kC.toString(a,!0)}function kI(a){return kC.validate(a,!1)}function kJ(a){return a=kK(a),kC.validate(a,!0)}function kK(a){return a.replace(/=/g,"")}function kL(a,b,c){let d;if(b<24)return[b,1];let e=a.byteLength-c-1,f=new DataView(a.buffer,c+1),g=0;switch(b){case 24:e>0&&(d=f.getUint8(0),g=2);break;case 25:e>1&&(d=f.getUint16(0,!1),g=3);break;case 26:e>3&&(d=f.getUint32(0,!1),g=5);break;case 27:if(e>7){let a=f.getBigUint64(0,!1);if(a>=24n&&a<=Number.MAX_SAFE_INTEGER)return[Number(a),9]}}if(d&&d>=24)return[d,g];throw Error("Length not supported or not well formed")}function kM(a,b){let c,d=a<<5;if(b<0)throw Error("CBOR Data Item argument must not be negative");if("number"==typeof b){if(!Number.isInteger(b))throw Error("CBOR Data Item argument must be an integer");c=BigInt(b)}else c=b;if(1==a){if(0n==c)throw Error("CBOR Data Item argument cannot be zero when negative");c-=1n}if(c>0xffffffffffffffffn)throw Error("CBOR number out of range");let e=new Uint8Array(8);return(new DataView(e.buffer).setBigUint64(0,c,!1),c<=23)?[d|e[7]]:c<=255?[24|d,e[7]]:c<=65535?[25|d,...e.slice(6)]:c<=0xffffffff?[26|d,...e.slice(4)]:[27|d,...e]}kC.toArrayBuffer=(a,b)=>{let c=a.length,d=.75*a.length,e,f=0,g,h,i,j;"="===a[a.length-1]&&(d--,"="===a[a.length-2]&&d--);let k=new ArrayBuffer(d),l=new Uint8Array(k),m=b?kz:ky;for(e=0;e<c;e+=4)g=m[a.charCodeAt(e)],h=m[a.charCodeAt(e+1)],i=m[a.charCodeAt(e+2)],j=m[a.charCodeAt(e+3)],l[f++]=g<<2|h>>4,l[f++]=(15&h)<<4|i>>2,l[f++]=(3&i)<<6|63&j;return k},kC.fromArrayBuffer=(a,b)=>{let c=new Uint8Array(a),d,e="",f=c.length,g=b?kw:kv;for(d=0;d<f;d+=3)e+=g[c[d]>>2],e+=g[(3&c[d])<<4|c[d+1]>>4],e+=g[(15&c[d+1])<<2|c[d+2]>>6],e+=g[63&c[d+2]];let h=f%3;return 2===h?e=e.substring(0,e.length-1)+(b?"":"="):1===h&&(e=e.substring(0,e.length-2)+(b?"":"==")),e},kC.toString=(a,b)=>new TextDecoder().decode(kC.toArrayBuffer(a,b)),kC.fromString=(a,b)=>kC.fromArrayBuffer(new TextEncoder().encode(a),b),kC.validate=(a,b)=>{if(!("string"==typeof a||a instanceof String))return!1;try{return b?kA.test(a):kB.test(a)}catch(a){return!1}},kC.base64=kC,a.s(["fromBuffer",()=>kE,"fromUTF8String",()=>kG,"isBase64",()=>kI,"isBase64URL",()=>kJ,"toBase64",()=>kF,"toBuffer",()=>kD,"toUTF8String",()=>kH,"trimPadding",()=>kK],38540);class kN{constructor(a,b){Object.defineProperty(this,"tagId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tagValue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tagId=a,this.tagValue=b}get tag(){return this.tagId}get value(){return this.tagValue}}function kO(a,b,c){let[d,e]=kL(a,b,c),f=c+e;return[new Uint8Array(a.buffer.slice(f,f+d)),e+d]}let kP=new TextDecoder,kQ="Map is not supported or well formed";function kR(a,b){if(b>=a.byteLength)throw Error("CBOR stream ended before tag value");let c=a.getUint8(b),d=31&c;switch(c>>5){case 0:return kL(a,d,b);case 1:return function(a,b,c){let[d,e]=kL(a,b,c);return[-d-1,e]}(a,d,b);case 2:return kO(a,d,b);case 3:return function(a,b,c){let[d,e]=kO(a,b,c);return[kP.decode(d),e]}(a,d,b);case 4:return function(a,b,c){if(0===b)return[[],1];let[d,e]=kL(a,b,c),f=e,g=[];for(let b=0;b<d;b++){if(a.byteLength-c-f<=0)throw Error("array is not supported or well formed");let[b,d]=kR(a,c+f);g.push(b),f+=d}return[g,f]}(a,d,b);case 5:return function(a,b,c){if(0===b)return[new Map,1];let[d,e]=kL(a,b,c),f=e,g=new Map;for(let b=0;b<d;b++){let b=a.byteLength-c-f;if(b<=0)throw Error(kQ);let[d,e]=kR(a,c+f);if(f+=e,(b-=e)<=0||"string"!=typeof d&&"number"!=typeof d||g.has(d))throw Error(kQ);let[h,i]=kR(a,c+f);f+=i,g.set(d,h)}return[g,f]}(a,d,b);case 6:return function(a,b,c){let[d,e]=kL(a,b,c),[f,g]=kR(a,c+e);return[new kN(d,f),e+g]}(a,d,b);case 7:switch(d){case 20:return[!1,1];case 21:return[!0,1];case 22:return[null,1];case 23:return[void 0,1];case 25:if(b+3>a.byteLength)throw Error("CBOR stream ended before end of Float 16");let e=a.getUint16(b+1,!1);if(31744==e)return[1/0,3];if(32256==e)return[NaN,3];if(64512==e)return[-1/0,3];throw Error("Float16 data is unsupported");case 26:if(b+5>a.byteLength)throw Error("CBOR stream ended before end of Float 32");return[a.getFloat32(b+1,!1),5];case 27:if(b+9>a.byteLength)throw Error("CBOR stream ended before end of Float 64");return[a.getFloat64(b+1,!1),9]}}throw Error(`Unsupported or not well formed at ${b}`)}let kS=new TextEncoder;function kT(a){let[b]=function(a,b){if(0===a.byteLength||a.byteLength<=0)throw Error("No data");return a instanceof Uint8Array?kR(new DataView(a.buffer),0):a instanceof ArrayBuffer?kR(new DataView(a),0):kR(a,0)}(new Uint8Array(a),0);return b}function kU(a){let b=[];!function a(b,c){if("boolean"==typeof b||null===b||void 0==b){var d;return void c.push(!0===(d=b)?245:!1===d?244:null===d?246:247)}if("number"==typeof b||"bigint"==typeof b)return void c.push(...function(a){if("number"==typeof a){if(Number.isSafeInteger(a))if(a<0)return kM(1,Math.abs(a));else return kM(0,a);return[function(a){if(Math.fround(a)==a||!Number.isFinite(a)||Number.isNaN(a)){let b=new Uint8Array(5);return b[0]=250,new DataView(b.buffer).setFloat32(1,a,!1),b}{let b=new Uint8Array(9);return b[0]=251,new DataView(b.buffer).setFloat64(1,a,!1),b}}(a)]}return a<0n?kM(1,-(1n*a)):kM(0,a)}(b));if("string"==typeof b)return void(c.push(...kM(3,b.length)),c.push(kS.encode(b)));if(b instanceof Uint8Array)return void(c.push(...kM(2,b.length)),c.push(b));if(Array.isArray(b))return void function(b,c){for(let d of(c.push(...kM(4,b.length)),b))a(d,c)}(b,c);if(b instanceof Map)return void function(b,c){for(let[d,e]of(c.push(new Uint8Array(kM(5,b.size))),b.entries()))a(d,c),a(e,c)}(b,c);if(b instanceof kN)return void(c.push(...kM(6,b.tag)),a(b.value,c));throw Error("Not implemented")}(a,b);let c=0;for(let a of b)"number"==typeof a?c+=1:c+=a.length;let d=new Uint8Array(c),e=0;for(let a of b)"number"==typeof a?(d[e]=a,e+=1):(d.set(a,e),e+=a.length);return d}function kV(a){let b=a.get(R.kty);return kX(b)&&b===S.EC2}function kW(a){let b=a.get(R.kty);return kX(b)&&b===S.RSA}function kX(a){return Object.values(S).indexOf(a)>=0}function kY(a){return Object.values(U).indexOf(a)>=0}function kZ(a){if([U.RS1].indexOf(a)>=0)return"SHA-1";if([U.ES256,U.PS256,U.RS256].indexOf(a)>=0)return"SHA-256";if([U.ES384,U.PS384,U.RS384].indexOf(a)>=0)return"SHA-384";if([U.ES512,U.PS512,U.RS512,U.EdDSA].indexOf(a)>=0)return"SHA-512";throw Error(`Could not map COSE alg value of ${a} to a WebCrypto alg`)}function k$(){return new Promise((a,b)=>{if(k)return a(k);let c=k0.stubThisGlobalThisCrypto();return c?a(k=c):b(new k_)})}a.s(["decodeFirst",()=>kT,"encode",()=>kU],79500),a.s([],87917),(q=R||(R={}))[q.kty=1]="kty",q[q.alg=3]="alg",q[q.crv=-1]="crv",q[q.x=-2]="x",q[q.y=-3]="y",q[q.n=-1]="n",q[q.e=-2]="e",(r=S||(S={}))[r.OKP=1]="OKP",r[r.EC2=2]="EC2",r[r.RSA=3]="RSA",(s=T||(T={}))[s.P256=1]="P256",s[s.P384=2]="P384",s[s.P521=3]="P521",s[s.ED25519=6]="ED25519",s[s.SECP256K1=8]="SECP256K1",(t=U||(U={}))[t.ES256=-7]="ES256",t[t.EdDSA=-8]="EdDSA",t[t.ES384=-35]="ES384",t[t.ES512=-36]="ES512",t[t.PS256=-37]="PS256",t[t.PS384=-38]="PS384",t[t.PS512=-39]="PS512",t[t.ES256K=-47]="ES256K",t[t.RS256=-257]="RS256",t[t.RS384=-258]="RS384",t[t.RS512=-259]="RS512",t[t.RS1=-65535]="RS1";class k_ extends Error{constructor(){super("An instance of the Crypto API could not be located"),this.name="MissingWebCrypto"}}let k0={stubThisGlobalThisCrypto:()=>globalThis.crypto};async function k1(a,b){let c=await k$(),d=kZ(b);return new Uint8Array(await c.subtle.digest(d,a))}async function k2(a){return(await k$()).getRandomValues(a),a}async function k3(a){let b=await k$(),{keyData:c,algorithm:d}=a;return b.subtle.importKey("jwk",c,d,!1,["verify"])}var k4=a.i(38540),k4=k4;async function k5(a){let b,{cosePublicKey:c,signature:d,data:e,shaHashOverride:f}=a,g=await k$(),h=c.get(R.alg),i=c.get(R.crv),j=c.get(R.x),k=c.get(R.y);if(!h)throw Error("Public key was missing alg (EC2)");if(!i)throw Error("Public key was missing crv (EC2)");if(!j)throw Error("Public key was missing x (EC2)");if(!k)throw Error("Public key was missing y (EC2)");if(i===T.P256)b="P-256";else if(i===T.P384)b="P-384";else if(i===T.P521)b="P-521";else throw Error(`Unexpected COSE crv value of ${i} (EC2)`);let l={kty:"EC",crv:b,x:k4.fromBuffer(j),y:k4.fromBuffer(k),ext:!1},m={name:"ECDSA",namedCurve:b},n=await k3({keyData:l,algorithm:m}),o=kZ(h);f&&(o=kZ(f));let p={name:"ECDSA",hash:{name:o}};return g.subtle.verify(p,n,d,e)}var k4=k4;function k6(a){if([U.EdDSA].indexOf(a)>=0)return"Ed25519";if([U.ES256,U.ES384,U.ES512,U.ES256K].indexOf(a)>=0)return"ECDSA";if([U.RS256,U.RS384,U.RS512,U.RS1].indexOf(a)>=0)return"RSASSA-PKCS1-v1_5";if([U.PS256,U.PS384,U.PS512].indexOf(a)>=0)return"RSA-PSS";throw Error(`Could not map COSE alg value of ${a} to a WebCrypto key alg name`)}async function k7(a){let{cosePublicKey:b,signature:c,data:d,shaHashOverride:e}=a,f=await k$(),g=b.get(R.alg),h=b.get(R.n),i=b.get(R.e);if(!g)throw Error("Public key was missing alg (RSA)");if(!kY(g))throw Error(`Public key had invalid alg ${g} (RSA)`);if(!h)throw Error("Public key was missing n (RSA)");if(!i)throw Error("Public key was missing e (RSA)");let j={kty:"RSA",alg:"",n:k4.fromBuffer(h),e:k4.fromBuffer(i),ext:!1},k={name:k6(g),hash:{name:kZ(g)}},l={name:k6(g)};if(e&&(k.hash.name=kZ(e)),"RSASSA-PKCS1-v1_5"===k.name)"SHA-256"===k.hash.name?j.alg="RS256":"SHA-384"===k.hash.name?j.alg="RS384":"SHA-512"===k.hash.name?j.alg="RS512":"SHA-1"===k.hash.name&&(j.alg="RS1");else if("RSA-PSS"===k.name){let a=0;"SHA-256"===k.hash.name?(j.alg="PS256",a=32):"SHA-384"===k.hash.name?(j.alg="PS384",a=48):"SHA-512"===k.hash.name&&(j.alg="PS512",a=64),l.saltLength=a}else throw Error(`Unexpected RSA key algorithm ${g} (${k.name})`);let m=await k3({keyData:j,algorithm:k});return f.subtle.verify(l,m,c,d)}function k8(a,b){return a.length==b.length&&a.every((a,c)=>a===b[c])}function k9(a){return Array.from(a,a=>a.toString(16).padStart(2,"0")).join("")}function la(a){if(!a)return Uint8Array.from([]);if(!(0!==a.length&&a.length%2==0&&!/[^a-fA-F0-9]/u.test(a)))throw Error("Invalid hex string");let b=a.match(/.{1,2}/g)??[];return Uint8Array.from(b.map(a=>parseInt(a,16)))}function lb(a){let b=0,c=new Uint8Array(a.reduce((a,b)=>a+b.length,0));return a.forEach(a=>{c.set(a,b),b+=a.length}),c}function lc(a){return new globalThis.TextDecoder("utf-8").decode(a)}function ld(a){return new globalThis.TextEncoder().encode(a)}function le(a){return Uint8Array.from(a.split("").map(a=>a.charCodeAt(0)))}function lf(a){return new DataView(a.buffer,a.byteOffset,a.length)}a.s(["areEqual",()=>k8,"concat",()=>lb,"fromASCIIString",()=>le,"fromHex",()=>la,"fromUTF8String",()=>ld,"toDataView",()=>lf,"toHex",()=>k9,"toUTF8String",()=>lc],12225);var lg=a.i(12225),lg=lg;function lh(a){let b=lg.toHex(a);return[b.slice(0,8),b.slice(8,12),b.slice(12,16),b.slice(16,20),b.slice(20,32)].join("-")}var k4=k4;function li(a){let b;if("string"==typeof a)if(k4.isBase64URL(a))b=k4.toBase64(a);else if(k4.isBase64(a))b=a;else throw Error("Certificate is not a valid base64 or base64url string");else b=k4.fromBuffer(a,"base64");let c="";for(let a=0;a<Math.ceil(b.length/64);a+=1){let d=64*a;c+=`${b.substr(d,64)}
`}return`-----BEGIN CERTIFICATE-----
${c}-----END CERTIFICATE-----
`}var lj=a.i(79500),lj=lj,lg=lg;function lk(a){let b=lj.decodeFirst(a),c=Uint8Array.from([4]),d=b.get(R.x),e=b.get(R.y);if(!d)throw Error("COSE public key was missing x");return e?lg.concat([c,d,e]):lg.concat([c,d])}var lj=lj;let ll=a=>a;var k4=k4;function lm(a){let b=JSON.parse(k4.toUTF8String(a));return ln.stubThis(b)}let ln={stubThis:a=>a};var lj=lj;function lo(a){return lp.stubThis(lj.decodeFirst(a))}let lp={stubThis:a=>a};a.s(["digest",()=>k1,"getRandomValues",()=>k2,"verify",()=>tJ],2745),a.i(87917);var lq=a.i(2745),lq=lq;async function lr(){let a=new Uint8Array(32);return await lq.getRandomValues(a),ls.stubThis(a)}let ls={stubThis:a=>a};class lt{static isArrayBuffer(a){return"[object ArrayBuffer]"===Object.prototype.toString.call(a)}static toArrayBuffer(a){return this.isArrayBuffer(a)?a:a.byteLength===a.buffer.byteLength||0===a.byteOffset&&a.byteLength===a.buffer.byteLength?a.buffer:this.toUint8Array(a.buffer).slice(a.byteOffset,a.byteOffset+a.byteLength).buffer}static toUint8Array(a){return this.toView(a,Uint8Array)}static toView(a,b){if(a.constructor===b)return a;if(this.isArrayBuffer(a))return new b(a);if(this.isArrayBufferView(a))return new b(a.buffer,a.byteOffset,a.byteLength);throw TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(a){return this.isArrayBufferView(a)||this.isArrayBuffer(a)}static isArrayBufferView(a){return ArrayBuffer.isView(a)||a&&this.isArrayBuffer(a.buffer)}static isEqual(a,b){let c=lt.toUint8Array(a),d=lt.toUint8Array(b);if(c.length!==d.byteLength)return!1;for(let a=0;a<c.length;a++)if(c[a]!==d[a])return!1;return!0}static concat(...a){let b;b=!Array.isArray(a[0])||a[1]instanceof Function?Array.isArray(a[0])&&a[1]instanceof Function?a[0]:a[a.length-1]instanceof Function?a.slice(0,a.length-1):a:a[0];let c=0;for(let a of b)c+=a.byteLength;let d=new Uint8Array(c),e=0;for(let a of b){let b=this.toUint8Array(a);d.set(b,e),e+=b.length}return a[a.length-1]instanceof Function?this.toView(d,a[a.length-1]):d.buffer}}let lu="string",lv=/^[0-9a-f\s]+$/i,lw=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,lx=/^[a-zA-Z0-9-_]+$/;class ly{static fromString(a){let b=unescape(encodeURIComponent(a)),c=new Uint8Array(b.length);for(let a=0;a<b.length;a++)c[a]=b.charCodeAt(a);return c.buffer}static toString(a){let b=lt.toUint8Array(a),c="";for(let a=0;a<b.length;a++)c+=String.fromCharCode(b[a]);return decodeURIComponent(escape(c))}}class lz{static toString(a,b=!1){let c=lt.toArrayBuffer(a),d=new DataView(c),e="";for(let a=0;a<c.byteLength;a+=2)e+=String.fromCharCode(d.getUint16(a,b));return e}static fromString(a,b=!1){let c=new ArrayBuffer(2*a.length),d=new DataView(c);for(let c=0;c<a.length;c++)d.setUint16(2*c,a.charCodeAt(c),b);return c}}class lA{static isHex(a){return typeof a===lu&&lv.test(a)}static isBase64(a){return typeof a===lu&&lw.test(a)}static isBase64Url(a){return typeof a===lu&&lx.test(a)}static ToString(a,b="utf8"){let c=lt.toUint8Array(a);switch(b.toLowerCase()){case"utf8":return this.ToUtf8String(c);case"binary":return this.ToBinary(c);case"hex":return this.ToHex(c);case"base64":return this.ToBase64(c);case"base64url":return this.ToBase64Url(c);case"utf16le":return lz.toString(c,!0);case"utf16":case"utf16be":return lz.toString(c);default:throw Error(`Unknown type of encoding '${b}'`)}}static FromString(a,b="utf8"){if(!a)return new ArrayBuffer(0);switch(b.toLowerCase()){case"utf8":return this.FromUtf8String(a);case"binary":return this.FromBinary(a);case"hex":return this.FromHex(a);case"base64":return this.FromBase64(a);case"base64url":return this.FromBase64Url(a);case"utf16le":return lz.fromString(a,!0);case"utf16":case"utf16be":return lz.fromString(a);default:throw Error(`Unknown type of encoding '${b}'`)}}static ToBase64(a){let b=lt.toUint8Array(a);return"u">typeof btoa?btoa(this.ToString(b,"binary")):Buffer.from(b).toString("base64")}static FromBase64(a){let b=this.formatString(a);if(!b)return new ArrayBuffer(0);if(!lA.isBase64(b))throw TypeError("Argument 'base64Text' is not Base64 encoded");return"u">typeof atob?this.FromBinary(atob(b)):new Uint8Array(Buffer.from(b,"base64")).buffer}static FromBase64Url(a){let b=this.formatString(a);if(!b)return new ArrayBuffer(0);if(!lA.isBase64Url(b))throw TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(b.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(a){return this.ToBase64(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(a,b=lA.DEFAULT_UTF8_ENCODING){switch(b){case"ascii":return this.FromBinary(a);case"utf8":return ly.fromString(a);case"utf16":case"utf16be":return lz.fromString(a);case"utf16le":case"usc2":return lz.fromString(a,!0);default:throw Error(`Unknown type of encoding '${b}'`)}}static ToUtf8String(a,b=lA.DEFAULT_UTF8_ENCODING){switch(b){case"ascii":return this.ToBinary(a);case"utf8":return ly.toString(a);case"utf16":case"utf16be":return lz.toString(a);case"utf16le":case"usc2":return lz.toString(a,!0);default:throw Error(`Unknown type of encoding '${b}'`)}}static FromBinary(a){let b=a.length,c=new Uint8Array(b);for(let d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}static ToBinary(a){let b=lt.toUint8Array(a),c="";for(let a=0;a<b.length;a++)c+=String.fromCharCode(b[a]);return c}static ToHex(a){let b=lt.toUint8Array(a),c="",d=b.length;for(let a=0;a<d;a++){let d=b[a];d<16&&(c+="0"),c+=d.toString(16)}return c}static FromHex(a){let b=this.formatString(a);if(!b)return new ArrayBuffer(0);if(!lA.isHex(b))throw TypeError("Argument 'hexString' is not HEX encoded");b.length%2&&(b=`0${b}`);let c=new Uint8Array(b.length/2);for(let a=0;a<b.length;a+=2){let d=b.slice(a,a+2);c[a/2]=parseInt(d,16)}return c.buffer}static ToUtf16String(a,b=!1){return lz.toString(a,b)}static FromUtf16String(a,b=!1){return lz.fromString(a,b)}static Base64Padding(a){let b=4-a.length%4;if(b<4)for(let c=0;c<b;c++)a+="=";return a}static formatString(a){return(null==a?void 0:a.replace(/[\n\r\t ]/g,""))||""}}function lB(a,b){if(!(a&&b)||a.byteLength!==b.byteLength)return!1;let c=new Uint8Array(a),d=new Uint8Array(b);for(let b=0;b<a.byteLength;b++)if(c[b]!==d[b])return!1;return!0}function lC(a,b){let c=0;if(1===a.length)return a[0];for(let d=a.length-1;d>=0;d--)c+=a[a.length-1-d]*Math.pow(2,b*d);return c}function lD(a,b,c=-1){let d=a,e=0,f=Math.pow(2,b);for(let g=1;g<8;g++){if(a<f){let a;if(c<0)a=new ArrayBuffer(g),e=g;else{if(c<g)return new ArrayBuffer(0);a=new ArrayBuffer(c),e=c}let f=new Uint8Array(a);for(let a=g-1;a>=0;a--){let c=Math.pow(2,a*b);f[e-a-1]=Math.floor(d/c),d-=f[e-a-1]*c}return a}f*=Math.pow(2,b)}return new ArrayBuffer(0)}function lE(...a){let b=0,c=0;for(let c of a)b+=c.length;let d=new Uint8Array(new ArrayBuffer(b));for(let b of a)d.set(b,c),c+=b.length;return d}function lF(){let a=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){let b=255===a[0]&&128&a[1],c=0===a[0]&&(128&a[1])==0;(b||c)&&this.warnings.push("Needlessly long format")}let b=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let a=0;a<this.valueHex.byteLength;a++)b[a]=0;b[0]=128&a[0];let c=lC(b,8),d=new Uint8Array(new ArrayBuffer(this.valueHex.byteLength));for(let b=0;b<this.valueHex.byteLength;b++)d[b]=a[b];return d[0]&=127,lC(d,8)-c}function lG(a,b){let c=a.toString(10);if(b<c.length)return"";let d=b-c.length,e=Array(d);for(let a=0;a<d;a++)e[a]="0";return e.join("").concat(c)}function lH(){if("u"<typeof BigInt)throw Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function lI(a){let b=0,c=0;for(let c=0;c<a.length;c++)b+=a[c].byteLength;let d=new Uint8Array(b);for(let b=0;b<a.length;b++){let e=a[b];d.set(new Uint8Array(e),c),c+=e.byteLength}return d.buffer}function lJ(a,b,c,d){return b instanceof Uint8Array?b.byteLength?c<0?(a.error="Wrong parameter: inputOffset less than zero",!1):d<0?(a.error="Wrong parameter: inputLength less than zero",!1):!(b.byteLength-c-d<0)||(a.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(a.error="Wrong parameter: inputBuffer has zero length",!1):(a.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}lA.DEFAULT_UTF8_ENCODING="utf8";class lK{constructor(){this.items=[]}write(a){this.items.push(a)}final(){return lI(this.items)}}let lL=[new Uint8Array([1])],lM="0123456789",lN="name",lO="valueHexView",lP=new ArrayBuffer(0),lQ=new Uint8Array(0),lR="EndOfContent",lS="OCTET STRING",lT="BIT STRING";function lU(a){var b;return(b=class extends a{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(a){this.valueHexView=new Uint8Array(a)}constructor(...a){var b;super(...a);const c=a[0]||{};this.isHexOnly=null!=(b=c.isHexOnly)&&b,this.valueHexView=c.valueHex?lt.toUint8Array(c.valueHex):lQ}fromBER(a,b,c){let d=a instanceof ArrayBuffer?new Uint8Array(a):a;if(!lJ(this,d,b,c))return -1;let e=b+c;return(this.valueHexView=d.subarray(b,e),this.valueHexView.length)?(this.blockLength=c,e):(this.warnings.push("Zero buffer length"),b)}toBER(a=!1){return this.isHexOnly?a?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",lP)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:lA.ToHex(this.valueHexView)}}}).NAME="hexBlock",b}class lV{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(a){this.valueBeforeDecodeView=new Uint8Array(a)}constructor({blockLength:a=0,error:b="",warnings:c=[],valueBeforeDecode:d=lQ}={}){this.blockLength=a,this.error=b,this.warnings=c,this.valueBeforeDecodeView=lt.toUint8Array(d)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:lA.ToHex(this.valueBeforeDecodeView)}}}lV.NAME="baseBlock";class lW extends lV{fromBER(a,b,c){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(a,b){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}lW.NAME="valueBlock";class lX extends lU(lV){constructor({idBlock:a={}}={}){var b,c,d,e;super(),a?(this.isHexOnly=null!=(b=a.isHexOnly)&&b,this.valueHexView=a.valueHex?lt.toUint8Array(a.valueHex):lQ,this.tagClass=null!=(c=a.tagClass)?c:-1,this.tagNumber=null!=(d=a.tagNumber)?d:-1,this.isConstructed=null!=(e=a.isConstructed)&&e):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(a=!1){let b=0;switch(this.tagClass){case 1:b|=0;break;case 2:b|=64;break;case 3:b|=128;break;case 4:b|=192;break;default:return this.error="Unknown tag class",lP}if(this.isConstructed&&(b|=32),this.tagNumber<31&&!this.isHexOnly){let c=new Uint8Array(1);if(!a){let a=this.tagNumber;a&=31,b|=a,c[0]=b}return c.buffer}if(!this.isHexOnly){let c=lD(this.tagNumber,7),d=new Uint8Array(c),e=c.byteLength,f=new Uint8Array(e+1);if(f[0]=31|b,!a){for(let a=0;a<e-1;a++)f[a+1]=128|d[a];f[e]=d[e-1]}return f.buffer}let c=new Uint8Array(this.valueHexView.byteLength+1);if(c[0]=31|b,!a){let a=this.valueHexView;for(let b=0;b<a.length-1;b++)c[b+1]=128|a[b];c[this.valueHexView.byteLength]=a[a.length-1]}return c.buffer}fromBER(a,b,c){let d=lt.toUint8Array(a);if(!lJ(this,d,b,c))return -1;let e=d.subarray(b,b+c);if(0===e.length)return this.error="Zero buffer length",-1;switch(192&e[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(32&e[0])==32,this.isHexOnly=!1;let f=31&e[0];if(31!==f)this.tagNumber=f,this.blockLength=1;else{let a=1,b=this.valueHexView=new Uint8Array(255),c=255;for(;128&e[a];){if(b[a-1]=127&e[a],++a>=e.length)return this.error="End of input reached before message was fully decoded",-1;if(a===c){let a=new Uint8Array(c+=255);for(let c=0;c<b.length;c++)a[c]=b[c];b=this.valueHexView=new Uint8Array(c)}}this.blockLength=a+1,b[a-1]=127&e[a];let d=new Uint8Array(a);for(let c=0;c<a;c++)d[c]=b[c];(b=this.valueHexView=new Uint8Array(a)).set(d),this.blockLength<=9?this.tagNumber=lC(b,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return b+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}lX.NAME="identificationBlock";class lY extends lV{constructor({lenBlock:a={}}={}){var b,c,d;super(),this.isIndefiniteForm=null!=(b=a.isIndefiniteForm)&&b,this.longFormUsed=null!=(c=a.longFormUsed)&&c,this.length=null!=(d=a.length)?d:0}fromBER(a,b,c){let d=lt.toUint8Array(a);if(!lJ(this,d,b,c))return -1;let e=d.subarray(b,b+c);if(0===e.length)return this.error="Zero buffer length",-1;if(255===e[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===e[0],this.isIndefiniteForm)return this.blockLength=1,b+this.blockLength;if(this.longFormUsed=!!(128&e[0]),!1===this.longFormUsed)return this.length=e[0],this.blockLength=1,b+this.blockLength;let f=127&e[0];if(f>8)return this.error="Too big integer",-1;if(f+1>e.length)return this.error="End of input reached before message was fully decoded",-1;let g=b+1,h=d.subarray(g,g+f);return 0===h[f-1]&&this.warnings.push("Needlessly long encoded length"),this.length=lC(h,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=f+1,b+this.blockLength}toBER(a=!1){let b,c;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return b=new ArrayBuffer(1),!1===a&&((c=new Uint8Array(b))[0]=128),b;if(this.longFormUsed){let d=lD(this.length,8);if(d.byteLength>127)return this.error="Too big length",lP;if(b=new ArrayBuffer(d.byteLength+1),a)return b;let e=new Uint8Array(d);(c=new Uint8Array(b))[0]=128|d.byteLength;for(let a=0;a<d.byteLength;a++)c[a+1]=e[a];return b}return b=new ArrayBuffer(1),!1===a&&((c=new Uint8Array(b))[0]=this.length),b}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}lY.NAME="lengthBlock";let lZ={};class l$ extends lV{constructor({name:a="",optional:b=!1,primitiveSchema:c,...d}={},e){super(d),this.name=a,this.optional=b,c&&(this.primitiveSchema=c),this.idBlock=new lX(d),this.lenBlock=new lY(d),this.valueBlock=e?new e(d):new lW(d)}fromBER(a,b,c){let d=this.valueBlock.fromBER(a,b,this.lenBlock.isIndefiniteForm?c:this.lenBlock.length);return -1===d?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),d}toBER(a,b){let c=b||new lK;b||function a(b){var c;if(b instanceof lZ.Constructed)for(let c of b.valueBlock.value)a(c)&&(b.lenBlock.isIndefiniteForm=!0);return!!(null==(c=b.lenBlock)?void 0:c.isIndefiniteForm)}(this);let d=this.idBlock.toBER(a);if(c.write(d),this.lenBlock.isIndefiniteForm)c.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(a,c),c.write(new ArrayBuffer(2));else{let b=this.valueBlock.toBER(a);this.lenBlock.length=b.byteLength;let d=this.lenBlock.toBER(a);c.write(d),c.write(b)}return b?lP:c.final()}toJSON(){let a={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(a.primitiveSchema=this.primitiveSchema.toJSON()),a}toString(a="ascii"){return"ascii"===a?this.onAsciiEncoding():lA.ToHex(this.toBER())}onAsciiEncoding(){let a=this.constructor.NAME,b=lA.ToHex(this.valueBlock.valueBeforeDecodeView);return`${a} : ${b}`}isEqual(a){if(this===a)return!0;if(!(a instanceof this.constructor))return!1;let b=this.toBER(),c=a.toBER();if(b.byteLength!==c.byteLength)return!1;let d=new Uint8Array(b),e=new Uint8Array(c);for(let a=0;a<d.length;a++)if(d[a]!==e[a])return!1;return!0}}l$.NAME="BaseBlock";class l_ extends l${getValue(){return this.valueBlock.value}setValue(a){this.valueBlock.value=a}constructor({value:a="",...b}={},c){super(b,c),a&&this.fromString(a)}fromBER(a,b,c){let d=this.valueBlock.fromBER(a,b,this.lenBlock.isIndefiniteForm?c:this.lenBlock.length);return -1===d?this.error=this.valueBlock.error:(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),d}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}l_.NAME="BaseStringBlock";class l0 extends lU(lW){constructor({isHexOnly:a=!0,...b}={}){super(b),this.isHexOnly=a}}l0.NAME="PrimitiveValueBlock";class l1 extends l${constructor(a={}){super(a,l0),this.idBlock.isConstructed=!1}}function l2(a,b=0,c=a.length){let d=b,e=new l$({},lW),f=new lV;if(!lJ(f,a,b,c))return e.error=f.error,{offset:-1,result:e};if(!a.subarray(b,b+c).length)return e.error="Zero buffer length",{offset:-1,result:e};let g=e.idBlock.fromBER(a,b,c);if(e.idBlock.warnings.length&&e.warnings.concat(e.idBlock.warnings),-1===g)return e.error=e.idBlock.error,{offset:-1,result:e};if(b=g,c-=e.idBlock.blockLength,g=e.lenBlock.fromBER(a,b,c),e.lenBlock.warnings.length&&e.warnings.concat(e.lenBlock.warnings),-1===g)return e.error=e.lenBlock.error,{offset:-1,result:e};if(b=g,c-=e.lenBlock.blockLength,!e.idBlock.isConstructed&&e.lenBlock.isIndefiniteForm)return e.error="Indefinite length form used for primitive encoding form",{offset:-1,result:e};let h=l$;if(1===e.idBlock.tagClass){if(e.idBlock.tagNumber>=37&&!1===e.idBlock.isHexOnly)return e.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:e};switch(e.idBlock.tagNumber){case 0:if(e.idBlock.isConstructed&&e.lenBlock.length>0)return e.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:e};h=lZ.EndOfContent;break;case 1:h=lZ.Boolean;break;case 2:h=lZ.Integer;break;case 3:h=lZ.BitString;break;case 4:h=lZ.OctetString;break;case 5:h=lZ.Null;break;case 6:h=lZ.ObjectIdentifier;break;case 10:h=lZ.Enumerated;break;case 12:h=lZ.Utf8String;break;case 13:h=lZ.RelativeObjectIdentifier;break;case 14:h=lZ.TIME;break;case 15:return e.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:e};case 16:h=lZ.Sequence;break;case 17:h=lZ.Set;break;case 18:h=lZ.NumericString;break;case 19:h=lZ.PrintableString;break;case 20:h=lZ.TeletexString;break;case 21:h=lZ.VideotexString;break;case 22:h=lZ.IA5String;break;case 23:h=lZ.UTCTime;break;case 24:h=lZ.GeneralizedTime;break;case 25:h=lZ.GraphicString;break;case 26:h=lZ.VisibleString;break;case 27:h=lZ.GeneralString;break;case 28:h=lZ.UniversalString;break;case 29:h=lZ.CharacterString;break;case 30:h=lZ.BmpString;break;case 31:h=lZ.DATE;break;case 32:h=lZ.TimeOfDay;break;case 33:h=lZ.DateTime;break;case 34:h=lZ.Duration;break;default:{let a=e.idBlock.isConstructed?new lZ.Constructed:new lZ.Primitive;a.idBlock=e.idBlock,a.lenBlock=e.lenBlock,a.warnings=e.warnings,e=a}}}else h=e.idBlock.isConstructed?lZ.Constructed:lZ.Primitive;return g=(e=function(a,b){if(a instanceof b)return a;let c=new b;return c.idBlock=a.idBlock,c.lenBlock=a.lenBlock,c.warnings=a.warnings,c.valueBeforeDecodeView=a.valueBeforeDecodeView,c}(e,h)).fromBER(a,b,e.lenBlock.isIndefiniteForm?c:e.lenBlock.length),e.valueBeforeDecodeView=a.subarray(d,d+e.blockLength),{offset:g,result:e}}function l3(a){if(!a.byteLength){let a=new l$({},lW);return a.error="Input buffer has zero length",{offset:-1,result:a}}return l2(lt.toUint8Array(a).slice(),0,a.byteLength)}lZ.Primitive=l1,l1.NAME="PRIMITIVE";class l4 extends lW{constructor({value:a=[],isIndefiniteForm:b=!1,...c}={}){super(c),this.value=a,this.isIndefiniteForm=b}fromBER(a,b,c){var d,e;let f=lt.toUint8Array(a);if(!lJ(this,f,b,c))return -1;if(this.valueBeforeDecodeView=f.subarray(b,b+c),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),b;let g=b;for(;d=this.isIndefiniteForm,e=c,(d?1:e)>0;){let a=l2(f,g,c);if(-1===a.offset)return this.error=a.result.error,this.warnings.concat(a.result.warnings),-1;if(g=a.offset,this.blockLength+=a.result.blockLength,c-=a.result.blockLength,this.value.push(a.result),this.isIndefiniteForm&&a.result.constructor.NAME===lR)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===lR?this.value.pop():this.warnings.push("No EndOfContent block encoded")),g}toBER(a,b){let c=b||new lK;for(let b=0;b<this.value.length;b++)this.value[b].toBER(a,c);return b?lP:c.final()}toJSON(){let a={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(let b of this.value)a.value.push(b.toJSON());return a}}l4.NAME="ConstructedValueBlock";class l5 extends l${constructor(a={}){super(a,l4),this.idBlock.isConstructed=!0}fromBER(a,b,c){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;let d=this.valueBlock.fromBER(a,b,this.lenBlock.isIndefiniteForm?c:this.lenBlock.length);return -1===d?this.error=this.valueBlock.error:(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength)),d}onAsciiEncoding(){let a=[];for(let b of this.valueBlock.value)a.push(b.toString("ascii").split("\n").map(a=>`  ${a}`).join("\n"));let b=3===this.idBlock.tagClass?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return a.length?`${b} :
${a.join("\n")}`:`${b} :`}}lZ.Constructed=l5,l5.NAME="CONSTRUCTED";class l6 extends lW{fromBER(a,b,c){return b}toBER(a){return lP}}l6.override="EndOfContentValueBlock";class l7 extends l${constructor(a={}){super(a,l6),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}lZ.EndOfContent=l7,l7.NAME=lR;class l8 extends l${constructor(a={}){super(a,lW),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(a,b,c){return(this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=c,b+c>a.byteLength)?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):b+c}toBER(a,b){let c=new ArrayBuffer(2);if(!a){let a=new Uint8Array(c);a[0]=5,a[1]=0}return b&&b.write(c),c}onAsciiEncoding(){return`${this.constructor.NAME}`}}lZ.Null=l8,l8.NAME="NULL";class l9 extends lU(lW){get value(){for(let a of this.valueHexView)if(a>0)return!0;return!1}set value(a){this.valueHexView[0]=255*!!a}constructor({value:a,...b}={}){super(b),b.valueHex?this.valueHexView=lt.toUint8Array(b.valueHex):this.valueHexView=new Uint8Array(1),a&&(this.value=a)}fromBER(a,b,c){let d=lt.toUint8Array(a);return lJ(this,d,b,c)?(this.valueHexView=d.subarray(b,b+c),c>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,lF.call(this),this.blockLength=c,b+c):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}l9.NAME="BooleanValueBlock";class ma extends l${getValue(){return this.valueBlock.value}setValue(a){this.valueBlock.value=a}constructor(a={}){super(a,l9),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}}lZ.Boolean=ma,ma.NAME="BOOLEAN";class mb extends lU(l4){constructor({isConstructed:a=!1,...b}={}){super(b),this.isConstructed=a}fromBER(a,b,c){let d=0;if(this.isConstructed){if(this.isHexOnly=!1,-1===(d=l4.prototype.fromBER.call(this,a,b,c)))return d;for(let a=0;a<this.value.length;a++){let b=this.value[a].constructor.NAME;if(b===lR)if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1;else break;if(b!==lS)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,d=super.fromBER(a,b,c),this.blockLength=c;return d}toBER(a,b){return this.isConstructed?l4.prototype.toBER.call(this,a,b):a?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}mb.NAME="OctetStringValueBlock";class mc extends l${constructor({idBlock:a={},lenBlock:b={},...c}={}){var d;null!=c.isConstructed||(c.isConstructed=!!(null==(d=c.value)?void 0:d.length)),super({idBlock:{isConstructed:c.isConstructed,...a},lenBlock:{...b,isIndefiniteForm:!!c.isIndefiniteForm},...c},mb),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(a,b,c){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===c)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),b;if(!this.valueBlock.isConstructed){let d=(a instanceof ArrayBuffer?new Uint8Array(a):a).subarray(b,b+c);try{if(d.byteLength){let a=l2(d,0,d.byteLength);-1!==a.offset&&a.offset===c&&(this.valueBlock.value=[a.result])}}catch{}}return super.fromBER(a,b,c)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return l5.prototype.onAsciiEncoding.call(this);let a=this.constructor.NAME,b=lA.ToHex(this.valueBlock.valueHexView);return`${a} : ${b}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;let a=[];for(let b of this.valueBlock.value)b instanceof V&&a.push(b.valueBlock.valueHexView);return lt.concat(a)}}lZ.OctetString=V=mc,mc.NAME=lS;class md extends lU(l4){constructor({unusedBits:a=0,isConstructed:b=!1,...c}={}){super(c),this.unusedBits=a,this.isConstructed=b,this.blockLength=this.valueHexView.byteLength}fromBER(a,b,c){if(!c)return b;let d=-1;if(this.isConstructed){if(-1===(d=l4.prototype.fromBER.call(this,a,b,c)))return d;for(let a of this.value){let b=a.constructor.NAME;if(b===lR)if(!this.isIndefiniteForm)return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1;else break;if(b!==lT)return this.error="BIT STRING may consists of BIT STRINGs only",-1;let c=a.valueBlock;if(this.unusedBits>0&&c.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=c.unusedBits}return d}let e=lt.toUint8Array(a);if(!lJ(this,e,b,c))return -1;let f=e.subarray(b,b+c);if(this.unusedBits=f[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){let a=f.subarray(1);try{if(a.byteLength){let b=l2(a,0,a.byteLength);-1!==b.offset&&b.offset===c-1&&(this.value=[b.result])}}catch{}}return this.valueHexView=f.subarray(1),this.blockLength=f.length,b+c}toBER(a,b){if(this.isConstructed)return l4.prototype.toBER.call(this,a,b);if(a)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength){let a=new Uint8Array(1);return a[0]=0,a.buffer}let c=new Uint8Array(this.valueHexView.length+1);return c[0]=this.unusedBits,c.set(this.valueHexView,1),c.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}md.NAME="BitStringValueBlock";class me extends l${constructor({idBlock:a={},lenBlock:b={},...c}={}){var d;null!=c.isConstructed||(c.isConstructed=!!(null==(d=c.value)?void 0:d.length)),super({idBlock:{isConstructed:c.isConstructed,...a},lenBlock:{...b,isIndefiniteForm:!!c.isIndefiniteForm},...c},md),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(a,b,c){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(a,b,c)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return l5.prototype.onAsciiEncoding.call(this);{let a=[];for(let b of this.valueBlock.valueHexView)a.push(b.toString(2).padStart(8,"0"));let b=a.join(""),c=this.constructor.NAME,d=b.substring(0,b.length-this.valueBlock.unusedBits);return`${c} : ${d}`}}}function mf(a){if(a>=lL.length)for(let b=lL.length;b<=a;b++){let a=new Uint8Array([0]),c=lL[b-1].slice(0);for(let b=c.length-1;b>=0;b--){let d=new Uint8Array([(c[b]<<1)+a[0]]);a[0]=d[0]/10,c[b]=d[0]%10}a[0]>0&&(c=lE(a,c)),lL.push(c)}return lL[a]}lZ.BitString=me,me.NAME=lT;class mg extends lU(lW){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=lF.call(this)))}constructor({value:a,...b}={}){super(b),this._valueDec=0,b.valueHex&&this.setValueHex(),void 0!==a&&(this.valueDec=a)}set valueDec(a){this._valueDec=a,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(a){let b=a<0?-1*a:a,c=128;for(let d=1;d<8;d++){if(b<=c){if(a<0){let a=lD(c-b,8,d),e=new Uint8Array(a);return e[0]|=128,a}let e=lD(b,8,d),f=new Uint8Array(e);if(128&f[0]){let a=e.slice(0),b=new Uint8Array(a);f=new Uint8Array(e=new ArrayBuffer(e.byteLength+1));for(let c=0;c<a.byteLength;c++)f[c+1]=b[c];f[0]=0}return e}c*=256}return new ArrayBuffer(0)}(a))}get valueDec(){return this._valueDec}fromDER(a,b,c,d=0){let e=this.fromBER(a,b,c);if(-1===e)return e;let f=this.valueHexView;return 0===f[0]&&(128&f[1])!=0?this.valueHexView=f.subarray(1):0!==d&&f.length<d&&(d-f.length>1&&(d=f.length+1),this.valueHexView=f.subarray(d-f.length)),e}toDER(a=!1){let b=this.valueHexView;switch(!0){case(128&b[0])!=0:{let a=new Uint8Array(this.valueHexView.length+1);a[0]=0,a.set(b,1),this.valueHexView=a}break;case 0===b[0]&&(128&b[1])==0:this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(a)}fromBER(a,b,c){let d=super.fromBER(a,b,c);return -1===d||this.setValueHex(),d}toBER(a){return a?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){let a,b=8*this.valueHexView.length-1,c=new Uint8Array(8*this.valueHexView.length/3),d=0,e=this.valueHexView,f="",g=!1;for(let g=e.byteLength-1;g>=0;g--){a=e[g];for(let e=0;e<8;e++)(1&a)==1&&(d===b?(c=function(a,b){let c,d=0,e=new Uint8Array(a),f=new Uint8Array(b),g=e.slice(0),h=g.length-1,i=f.slice(0),j=i.length-1,k=0;for(let a=j;a>=0;a--,k++)!0==(c=g[h-k]-i[j-k]-d)<0?(d=1,g[h-k]=c+10):(d=0,g[h-k]=c);if(d>0)for(let a=h-j+1;a>=0;a--,k++)if((c=g[h-k]-d)<0)d=1,g[h-k]=c+10;else{d=0,g[h-k]=c;break}return g.slice()}(mf(d),c),f="-"):c=function(a,b){let c=new Uint8Array([0]),d=new Uint8Array(a),e=new Uint8Array(b),f=d.slice(0),g=f.length-1,h=e.slice(0),i=h.length-1,j=0,k=i<g?g:i,l=0;for(let a=k;a>=0;a--,l++)j=!0==l<h.length?f[g-l]+h[i-l]+c[0]:f[g-l]+c[0],c[0]=j/10,!0==l>=f.length?f=lE(new Uint8Array([j%10]),f):f[g-l]=j%10;return c[0]>0&&(f=lE(c,f)),f}(c,mf(d))),d++,a>>=1}for(let a=0;a<c.length;a++)c[a]&&(g=!0),g&&(f+=lM.charAt(c[a]));return!1===g&&(f+=lM.charAt(0)),f}}mg.NAME="IntegerValueBlock",Object.defineProperty(mg.prototype,"valueHex",{set:function(a){this.valueHexView=new Uint8Array(a),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class mh extends l${constructor(a={}){super(a,mg),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return lH(),BigInt(this.valueBlock.toString())}static fromBigInt(a){lH();let b=BigInt(a),c=new lK,d=b.toString(16).replace(/^-/,""),e=new Uint8Array(lA.FromHex(d));if(b<0){let a=new Uint8Array(e.length+(128&e[0]?1:0));a[0]|=128;let d=BigInt(`0x${lA.ToHex(a)}`)+b,f=lt.toUint8Array(lA.FromHex(d.toString(16)));f[0]|=128,c.write(f)}else 128&e[0]&&c.write(new Uint8Array([0])),c.write(e);return new W({valueHex:c.final()})}convertToDER(){let a=new W({valueHex:this.valueBlock.valueHexView});return a.valueBlock.toDER(),a}convertFromDER(){return new W({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}lZ.Integer=W=mh,mh.NAME="INTEGER";class mi extends mh{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}lZ.Enumerated=mi,mi.NAME="ENUMERATED";class mj extends lU(lW){constructor({valueDec:a=-1,isFirstSid:b=!1,...c}={}){super(c),this.valueDec=a,this.isFirstSid=b}fromBER(a,b,c){if(!c)return b;let d=lt.toUint8Array(a);if(!lJ(this,d,b,c))return -1;let e=d.subarray(b,b+c);this.valueHexView=new Uint8Array(c);for(let a=0;a<c&&(this.valueHexView[a]=127&e[a],this.blockLength++,(128&e[a])!=0);a++);let f=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)f[a]=this.valueHexView[a];return(this.valueHexView=f,(128&e[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=lC(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),b+this.blockLength)}set valueBigInt(a){lH();let b=BigInt(a).toString(2);for(;b.length%7;)b="0"+b;let c=new Uint8Array(b.length/7);for(let a=0;a<c.length;a++)c[a]=parseInt(b.slice(7*a,7*a+7),2)+128*(a+1<c.length);this.fromBER(c.buffer,0,c.length)}toBER(a){if(this.isHexOnly){if(a)return new ArrayBuffer(this.valueHexView.byteLength);let b=this.valueHexView,c=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)c[a]=128|b[a];return c[this.blockLength-1]=b[this.blockLength-1],c.buffer}let b=lD(this.valueDec,7);if(0===b.byteLength)return this.error="Error during encoding SID value",lP;let c=new Uint8Array(b.byteLength);if(!a){let a=new Uint8Array(b),d=b.byteLength-1;for(let b=0;b<d;b++)c[b]=128|a[b];c[d]=a[d]}return c}toString(){let a="";if(this.isHexOnly)a=lA.ToHex(this.valueHexView);else if(this.isFirstSid){let b=this.valueDec;this.valueDec<=39?a="0.":this.valueDec<=79?(a="1.",b-=40):(a="2.",b-=80),a+=b.toString()}else a=this.valueDec.toString();return a}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}mj.NAME="sidBlock";class mk extends lW{constructor({value:a="",...b}={}){super(b),this.value=[],a&&this.fromString(a)}fromBER(a,b,c){let d=b;for(;c>0;){let b=new mj;if(-1===(d=b.fromBER(a,d,c))){this.blockLength=0,this.error=b.error;break}0===this.value.length&&(b.isFirstSid=!0),this.blockLength+=b.blockLength,c-=b.blockLength,this.value.push(b)}return d}toBER(a){let b=[];for(let c=0;c<this.value.length;c++){let d=this.value[c].toBER(a);if(0===d.byteLength)return this.error=this.value[c].error,lP;b.push(d)}return lI(b)}fromString(a){this.value=[];let b=0,c=0,d="",e=!1;do if(d=-1===(c=a.indexOf(".",b))?a.substring(b):a.substring(b,c),b=c+1,e){let a=this.value[0],b=0;switch(a.valueDec){case 0:break;case 1:b=40;break;case 2:b=80;break;default:this.value=[];return}let c=parseInt(d,10);if(isNaN(c))return;a.valueDec=c+b,e=!1}else{let a=new mj;if(d>Number.MAX_SAFE_INTEGER)lH(),a.valueBigInt=BigInt(d);else if(a.valueDec=parseInt(d,10),isNaN(a.valueDec))return;this.value.length||(a.isFirstSid=!0,e=!0),this.value.push(a)}while(-1!==c)}toString(){let a="",b=!1;for(let c=0;c<this.value.length;c++){b=this.value[c].isHexOnly;let d=this.value[c].toString();0!==c&&(a=`${a}.`),b?(d=`{${d}}`,this.value[c].isFirstSid?a=`2.{${d} - 80}`:a+=d):a+=d}return a}toJSON(){let a={...super.toJSON(),value:this.toString(),sidArray:[]};for(let b=0;b<this.value.length;b++)a.sidArray.push(this.value[b].toJSON());return a}}mk.NAME="ObjectIdentifierValueBlock";class ml extends l${getValue(){return this.valueBlock.toString()}setValue(a){this.valueBlock.fromString(a)}constructor(a={}){super(a,mk),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}lZ.ObjectIdentifier=ml,ml.NAME="OBJECT IDENTIFIER";class mm extends lU(lV){constructor({valueDec:a=0,...b}={}){super(b),this.valueDec=a}fromBER(a,b,c){if(0===c)return b;let d=lt.toUint8Array(a);if(!lJ(this,d,b,c))return -1;let e=d.subarray(b,b+c);this.valueHexView=new Uint8Array(c);for(let a=0;a<c&&(this.valueHexView[a]=127&e[a],this.blockLength++,(128&e[a])!=0);a++);let f=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)f[a]=this.valueHexView[a];return(this.valueHexView=f,(128&e[this.blockLength-1])!=0)?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=lC(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),b+this.blockLength)}toBER(a){if(this.isHexOnly){if(a)return new ArrayBuffer(this.valueHexView.byteLength);let b=this.valueHexView,c=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength-1;a++)c[a]=128|b[a];return c[this.blockLength-1]=b[this.blockLength-1],c.buffer}let b=lD(this.valueDec,7);if(0===b.byteLength)return this.error="Error during encoding SID value",lP;let c=new Uint8Array(b.byteLength);if(!a){let a=new Uint8Array(b),d=b.byteLength-1;for(let b=0;b<d;b++)c[b]=128|a[b];c[d]=a[d]}return c.buffer}toString(){return this.isHexOnly?lA.ToHex(this.valueHexView):this.valueDec.toString()}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}mm.NAME="relativeSidBlock";class mn extends lW{constructor({value:a="",...b}={}){super(b),this.value=[],a&&this.fromString(a)}fromBER(a,b,c){let d=b;for(;c>0;){let b=new mm;if(-1===(d=b.fromBER(a,d,c))){this.blockLength=0,this.error=b.error;break}this.blockLength+=b.blockLength,c-=b.blockLength,this.value.push(b)}return d}toBER(a,b){let c=[];for(let b=0;b<this.value.length;b++){let d=this.value[b].toBER(a);if(0===d.byteLength)return this.error=this.value[b].error,lP;c.push(d)}return lI(c)}fromString(a){this.value=[];let b=0,c=0,d="";do{d=-1===(c=a.indexOf(".",b))?a.substring(b):a.substring(b,c),b=c+1;let e=new mm;if(e.valueDec=parseInt(d,10),isNaN(e.valueDec))break;this.value.push(e)}while(-1!==c)return!0}toString(){let a="",b=!1;for(let c=0;c<this.value.length;c++){b=this.value[c].isHexOnly;let d=this.value[c].toString();0!==c&&(a=`${a}.`),b?a+=d=`{${d}}`:a+=d}return a}toJSON(){let a={...super.toJSON(),value:this.toString(),sidArray:[]};for(let b=0;b<this.value.length;b++)a.sidArray.push(this.value[b].toJSON());return a}}mn.NAME="RelativeObjectIdentifierValueBlock";class mo extends l${getValue(){return this.valueBlock.toString()}setValue(a){this.valueBlock.fromString(a)}constructor(a={}){super(a,mn),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}lZ.RelativeObjectIdentifier=mo,mo.NAME="RelativeObjectIdentifier";class mp extends l5{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}lZ.Sequence=mp,mp.NAME="SEQUENCE";class mq extends l5{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}lZ.Set=mq,mq.NAME="SET";class mr extends lU(lW){constructor({...a}={}){super(a),this.isHexOnly=!0,this.value=""}toJSON(){return{...super.toJSON(),value:this.value}}}mr.NAME="StringValueBlock";class ms extends mr{}ms.NAME="SimpleStringValueBlock";class mt extends l_{constructor({...a}={}){super(a,ms)}fromBuffer(a){this.valueBlock.value=String.fromCharCode.apply(null,lt.toUint8Array(a))}fromString(a){let b=a.length,c=this.valueBlock.valueHexView=new Uint8Array(b);for(let d=0;d<b;d++)c[d]=a.charCodeAt(d);this.valueBlock.value=a}}mt.NAME="SIMPLE STRING";class mu extends mt{fromBuffer(a){this.valueBlock.valueHexView=lt.toUint8Array(a);try{this.valueBlock.value=lA.ToUtf8String(a)}catch(b){this.warnings.push(`Error during "decodeURIComponent": ${b}, using raw string`),this.valueBlock.value=lA.ToBinary(a)}}fromString(a){this.valueBlock.valueHexView=new Uint8Array(lA.FromUtf8String(a)),this.valueBlock.value=a}}mu.NAME="Utf8StringValueBlock";class mv extends mu{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}lZ.Utf8String=mv,mv.NAME="UTF8String";class mw extends mt{fromBuffer(a){this.valueBlock.value=lA.ToUtf16String(a),this.valueBlock.valueHexView=lt.toUint8Array(a)}fromString(a){this.valueBlock.value=a,this.valueBlock.valueHexView=new Uint8Array(lA.FromUtf16String(a))}}mw.NAME="BmpStringValueBlock";class mx extends mw{constructor({...a}={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}lZ.BmpString=mx,mx.NAME="BMPString";class my extends mt{fromBuffer(a){let b=ArrayBuffer.isView(a)?a.slice().buffer:a.slice(0),c=new Uint8Array(b);for(let a=0;a<c.length;a+=4)c[a]=c[a+3],c[a+1]=c[a+2],c[a+2]=0,c[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(b))}fromString(a){let b=a.length,c=this.valueBlock.valueHexView=new Uint8Array(4*b);for(let d=0;d<b;d++){let b=new Uint8Array(lD(a.charCodeAt(d),8));if(b.length>4)continue;let e=4-b.length;for(let a=b.length-1;a>=0;a--)c[4*d+a+e]=b[a]}this.valueBlock.value=a}}my.NAME="UniversalStringValueBlock";class mz extends my{constructor({...a}={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}lZ.UniversalString=mz,mz.NAME="UniversalString";class mA extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}lZ.NumericString=mA,mA.NAME="NumericString";class mB extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}lZ.PrintableString=mB,mB.NAME="PrintableString";class mC extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}lZ.TeletexString=mC,mC.NAME="TeletexString";class mD extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}lZ.VideotexString=mD,mD.NAME="VideotexString";class mE extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}lZ.IA5String=mE,mE.NAME="IA5String";class mF extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}lZ.GraphicString=mF,mF.NAME="GraphicString";class mG extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}lZ.VisibleString=mG,mG.NAME="VisibleString";class mH extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}lZ.GeneralString=mH,mH.NAME="GeneralString";class mI extends mt{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}lZ.CharacterString=mI,mI.NAME="CharacterString";class mJ extends mG{constructor({value:a,valueDate:b,...c}={}){if(super(c),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,a){this.fromString(a),this.valueBlock.valueHexView=new Uint8Array(a.length);for(let b=0;b<a.length;b++)this.valueBlock.valueHexView[b]=a.charCodeAt(b)}b&&(this.fromDate(b),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(a){this.fromString(String.fromCharCode.apply(null,lt.toUint8Array(a)))}toBuffer(){let a=this.toString(),b=new ArrayBuffer(a.length),c=new Uint8Array(b);for(let b=0;b<a.length;b++)c[b]=a.charCodeAt(b);return b}fromDate(a){this.year=a.getUTCFullYear(),this.month=a.getUTCMonth()+1,this.day=a.getUTCDate(),this.hour=a.getUTCHours(),this.minute=a.getUTCMinutes(),this.second=a.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(a){let b=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(a);if(null===b){this.error="Wrong input string for conversion";return}let c=parseInt(b[1],10);c>=50?this.year=1900+c:this.year=2e3+c,this.month=parseInt(b[2],10),this.day=parseInt(b[3],10),this.hour=parseInt(b[4],10),this.minute=parseInt(b[5],10),this.second=parseInt(b[6],10)}toString(a="iso"){if("iso"===a){let a=Array(7);return a[0]=lG(this.year<2e3?this.year-1900:this.year-2e3,2),a[1]=lG(this.month,2),a[2]=lG(this.day,2),a[3]=lG(this.hour,2),a[4]=lG(this.minute,2),a[5]=lG(this.second,2),a[6]="Z",a.join("")}return super.toString(a)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}lZ.UTCTime=mJ,mJ.NAME="UTCTime";class mK extends mJ{constructor(a={}){super(a),null!=this.millisecond||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(a){super.fromDate(a),this.millisecond=a.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(a){let b,c=!1,d="",e="",f=0,g=0,h=0;if("Z"===a[a.length-1])d=a.substring(0,a.length-1),c=!0;else{if(isNaN(new Number(a[a.length-1]).valueOf()))throw Error("Wrong input string for conversion");d=a}if(c){if(-1!==d.indexOf("+")||-1!==d.indexOf("-"))throw Error("Wrong input string for conversion")}else{let a=1,b=d.indexOf("+"),c="";if(-1===b&&(b=d.indexOf("-"),a=-1),-1!==b){if(c=d.substring(b+1),d=d.substring(0,b),2!==c.length&&4!==c.length)throw Error("Wrong input string for conversion");let e=parseInt(c.substring(0,2),10);if(isNaN(e.valueOf()))throw Error("Wrong input string for conversion");if(g=a*e,4===c.length){if(isNaN((e=parseInt(c.substring(2,4),10)).valueOf()))throw Error("Wrong input string for conversion");h=a*e}}}let i=d.indexOf(".");if(-1===i&&(i=d.indexOf(",")),-1!==i){let a=new Number(`0${d.substring(i)}`);if(isNaN(a.valueOf()))throw Error("Wrong input string for conversion");f=a.valueOf(),e=d.substring(0,i)}else e=d;switch(!0){case 8===e.length:if(b=/(\d{4})(\d{2})(\d{2})/ig,-1!==i)throw Error("Wrong input string for conversion");break;case 10===e.length:if(b=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,-1!==i){let a=60*f;this.minute=Math.floor(a),a=60*(a-this.minute),this.second=Math.floor(a),a=1e3*(a-this.second),this.millisecond=Math.floor(a)}break;case 12===e.length:if(b=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==i){let a=60*f;this.second=Math.floor(a),a=1e3*(a-this.second),this.millisecond=Math.floor(a)}break;case 14===e.length:if(b=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,-1!==i){let a=1e3*f;this.millisecond=Math.floor(a)}break;default:throw Error("Wrong input string for conversion")}let j=b.exec(e);if(null===j)throw Error("Wrong input string for conversion");for(let a=1;a<j.length;a++)switch(a){case 1:this.year=parseInt(j[a],10);break;case 2:this.month=parseInt(j[a],10);break;case 3:this.day=parseInt(j[a],10);break;case 4:this.hour=parseInt(j[a],10)+g;break;case 5:this.minute=parseInt(j[a],10)+h;break;case 6:this.second=parseInt(j[a],10);break;default:throw Error("Wrong input string for conversion")}if(!1===c){let a=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=a.getUTCFullYear(),this.month=a.getUTCMonth(),this.day=a.getUTCDay(),this.hour=a.getUTCHours(),this.minute=a.getUTCMinutes(),this.second=a.getUTCSeconds(),this.millisecond=a.getUTCMilliseconds()}}toString(a="iso"){if("iso"===a){let a=[];return a.push(lG(this.year,4)),a.push(lG(this.month,2)),a.push(lG(this.day,2)),a.push(lG(this.hour,2)),a.push(lG(this.minute,2)),a.push(lG(this.second,2)),0!==this.millisecond&&(a.push("."),a.push(lG(this.millisecond,3))),a.push("Z"),a.join("")}return super.toString(a)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}lZ.GeneralizedTime=mK,mK.NAME="GeneralizedTime";class mL extends mv{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}lZ.DATE=mL,mL.NAME="DATE";class mM extends mv{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}lZ.TimeOfDay=mM,mM.NAME="TimeOfDay";class mN extends mv{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}lZ.DateTime=mN,mN.NAME="DateTime";class mO extends mv{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}lZ.Duration=mO,mO.NAME="Duration";class mP extends mv{constructor(a={}){super(a),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}lZ.TIME=mP,mP.NAME="TIME";class mQ{constructor({name:a="",optional:b=!1}={}){this.name=a,this.optional=b}}class mR extends mQ{constructor({value:a=[],...b}={}){super(b),this.value=a}}class mS extends mQ{constructor({value:a=new mQ,local:b=!1,...c}={}){super(c),this.value=a,this.local=b}}class mT{get data(){return this.dataView.slice().buffer}set data(a){this.dataView=lt.toUint8Array(a)}constructor({data:a=lQ}={}){this.dataView=lt.toUint8Array(a)}fromBER(a,b,c){let d=b+c;return this.dataView=lt.toUint8Array(a).subarray(b,d),d}toBER(a){return this.dataView.slice().buffer}}function mU(a,b,c){if(c instanceof mR){for(let d of c.value)if(mU(a,b,d).verified)return{verified:!0,result:a};{let a={verified:!1,result:{error:"Wrong values for Choice type"}};return c.hasOwnProperty(lN)&&(a.name=c.name),a}}if(c instanceof mQ)return c.hasOwnProperty(lN)&&(a[c.name]=b),{verified:!0,result:a};if(a instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(b instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(c instanceof Object==!1||"idBlock"in c==!1||"fromBER"in c.idBlock==!1||"toBER"in c.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let d=c.idBlock.toBER(!1);if(0===d.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===c.idBlock.fromBER(d,0,d.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===c.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(c.idBlock.tagClass!==b.idBlock.tagClass)return{verified:!1,result:a};if(!1===c.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(c.idBlock.tagNumber!==b.idBlock.tagNumber)return{verified:!1,result:a};if(!1===c.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(c.idBlock.isConstructed!==b.idBlock.isConstructed)return{verified:!1,result:a};if(!("isHexOnly"in c.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(c.idBlock.isHexOnly!==b.idBlock.isHexOnly)return{verified:!1,result:a};if(c.idBlock.isHexOnly){if(lO in c.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};let d=c.idBlock.valueHexView,e=b.idBlock.valueHexView;if(d.length!==e.length)return{verified:!1,result:a};for(let b=0;b<d.length;b++)if(d[b]!==e[1])return{verified:!1,result:a}}if(c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&(a[c.name]=b)),c instanceof lZ.Constructed){let d=0,e={verified:!1,result:{error:"Unknown error"}},f=c.valueBlock.value.length;if(f>0&&c.valueBlock.value[0]instanceof mS&&(f=b.valueBlock.value.length),0===f)return{verified:!0,result:a};if(0===b.valueBlock.value.length&&0!==c.valueBlock.value.length){let b=!0;for(let a=0;a<c.valueBlock.value.length;a++)b=b&&(c.valueBlock.value[a].optional||!1);return b?{verified:!0,result:a}:(c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&delete a[c.name]),a.error="Inconsistent object length",{verified:!1,result:a})}for(let g=0;g<f;g++)if(g-d>=b.valueBlock.value.length){if(!1===c.valueBlock.value[g].optional){let b={verified:!1,result:a};return a.error="Inconsistent length between ASN.1 data and schema",c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&(delete a[c.name],b.name=c.name)),b}}else if(c.valueBlock.value[0]instanceof mS){if(!1===(e=mU(a,b.valueBlock.value[g],c.valueBlock.value[0].value)).verified)if(!c.valueBlock.value[0].optional)return c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&delete a[c.name]),e;else d++;if(lN in c.valueBlock.value[0]&&c.valueBlock.value[0].name.length>0){let d={};void 0===(d="local"in c.valueBlock.value[0]&&c.valueBlock.value[0].local?b:a)[c.valueBlock.value[0].name]&&(d[c.valueBlock.value[0].name]=[]),d[c.valueBlock.value[0].name].push(b.valueBlock.value[g])}}else if(!1===(e=mU(a,b.valueBlock.value[g-d],c.valueBlock.value[g])).verified)if(!c.valueBlock.value[g].optional)return c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&delete a[c.name]),e;else d++;if(!1===e.verified){let b={verified:!1,result:a};return c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&(delete a[c.name],b.name=c.name)),b}return{verified:!0,result:a}}if(c.primitiveSchema&&lO in b.valueBlock){let d=l2(b.valueBlock.valueHexView);if(-1===d.offset){let b={verified:!1,result:d.result};return c.name&&(c.name=c.name.replace(/^\s+|\s+$/g,""),c.name&&(delete a[c.name],b.name=c.name)),b}return mU(a,d.result,c.primitiveSchema)}return{verified:!0,result:a}}function mV(a,b){if(b instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};let c=l2(lt.toUint8Array(a));return -1===c.offset?{verified:!1,result:c.result}:mU(c.result,c.result,b)}a.s(["Any",()=>mQ,"BaseBlock",()=>l$,"BaseStringBlock",()=>l_,"BitString",()=>me,"BmpString",()=>mx,"Boolean",()=>ma,"CharacterString",()=>mI,"Choice",()=>mR,"Constructed",()=>l5,"DATE",()=>mL,"DateTime",()=>mN,"Duration",()=>mO,"EndOfContent",()=>l7,"Enumerated",()=>mi,"GeneralString",()=>mH,"GeneralizedTime",()=>mK,"GraphicString",()=>mF,"HexBlock",()=>lU,"IA5String",()=>mE,"Integer",()=>mh,"Null",()=>l8,"NumericString",()=>mA,"ObjectIdentifier",()=>ml,"OctetString",()=>mc,"Primitive",()=>l1,"PrintableString",()=>mB,"RawData",()=>mT,"RelativeObjectIdentifier",()=>mo,"Repeated",()=>mS,"Sequence",()=>mp,"Set",()=>mq,"TIME",()=>mP,"TeletexString",()=>mC,"TimeOfDay",()=>mM,"UTCTime",()=>mJ,"UniversalString",()=>mz,"Utf8String",()=>mv,"ValueBlock",()=>lW,"VideotexString",()=>mD,"ViewWriter",()=>lK,"VisibleString",()=>mG,"compareSchema",()=>mU,"fromBER",()=>l3,"verifySchema",()=>mV],53194),(u=X||(X={}))[u.Sequence=0]="Sequence",u[u.Set=1]="Set",u[u.Choice=2]="Choice",(v=Y||(Y={}))[v.Any=1]="Any",v[v.Boolean=2]="Boolean",v[v.OctetString=3]="OctetString",v[v.BitString=4]="BitString",v[v.Integer=5]="Integer",v[v.Enumerated=6]="Enumerated",v[v.ObjectIdentifier=7]="ObjectIdentifier",v[v.Utf8String=8]="Utf8String",v[v.BmpString=9]="BmpString",v[v.UniversalString=10]="UniversalString",v[v.NumericString=11]="NumericString",v[v.PrintableString=12]="PrintableString",v[v.TeletexString=13]="TeletexString",v[v.VideotexString=14]="VideotexString",v[v.IA5String=15]="IA5String",v[v.GraphicString=16]="GraphicString",v[v.VisibleString=17]="VisibleString",v[v.GeneralString=18]="GeneralString",v[v.CharacterString=19]="CharacterString",v[v.UTCTime=20]="UTCTime",v[v.GeneralizedTime=21]="GeneralizedTime",v[v.DATE=22]="DATE",v[v.TimeOfDay=23]="TimeOfDay",v[v.DateTime=24]="DateTime",v[v.Duration=25]="Duration",v[v.TIME=26]="TIME",v[v.Null=27]="Null";class mW{constructor(a,b=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),a)if("number"==typeof a)this.fromNumber(a);else if(lt.isBufferSource(a))this.unusedBits=b,this.value=lt.toArrayBuffer(a);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(a){if(!(a instanceof me))throw TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=a.valueBlock.unusedBits,this.value=a.valueBlock.valueHex,this}toASN(){return new me({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(a){return new me({name:a})}toNumber(){let a="";for(let b of new Uint8Array(this.value))a+=b.toString(2).padStart(8,"0");return a=a.split("").reverse().join(""),this.unusedBits&&(a=a.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(a,2)}fromNumber(a){let b=a.toString(2),c=b.length+7>>3;this.unusedBits=(c<<3)-b.length;let d=new Uint8Array(c);b=b.padStart(c<<3,"0").split("").reverse().join("");let e=0;for(;e<c;)d[e]=parseInt(b.slice(e<<3,(e<<3)+8),2),e++;this.value=d.buffer}}class mX{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(a){"number"==typeof a?this.buffer=new ArrayBuffer(a):lt.isBufferSource(a)?this.buffer=lt.toArrayBuffer(a):Array.isArray(a)?this.buffer=new Uint8Array(a):this.buffer=new ArrayBuffer(0)}fromASN(a){if(!(a instanceof mc))throw TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=a.valueBlock.valueHex,this}toASN(){return new mc({valueHex:this.buffer})}toSchema(a){return new mc({name:a})}}let mY={fromASN:a=>a instanceof l8?null:a.valueBeforeDecodeView,toASN:a=>{if(null===a)return new l8;let b=l3(a);if(b.result.error)throw Error(b.result.error);return b.result}},mZ={fromASN:a=>a.valueBlock.valueHexView.byteLength>=4?a.valueBlock.toString():a.valueBlock.valueDec,toASN:a=>new mh({value:+a})},m$={fromASN:a=>a.valueBlock.valueDec,toASN:a=>new mi({value:a})},m_={fromASN:a=>a.valueBlock.valueHexView,toASN:a=>new mh({valueHex:a})},m0={fromASN:a=>a.valueBlock.valueHexView,toASN:a=>new me({valueHex:a})},m1={fromASN:a=>a.valueBlock.toString(),toASN:a=>new ml({value:a})},m2={fromASN:a=>a.valueBlock.value,toASN:a=>new ma({value:a})},m3={fromASN:a=>a.valueBlock.valueHexView,toASN:a=>new mc({valueHex:a})};function m4(a){return{fromASN:a=>a.valueBlock.value,toASN:b=>new a({value:b})}}let m5=m4(mv),m6=m4(mx),m7=m4(mz),m8=m4(mA),m9=m4(mB),na=m4(mC),nb=m4(mD),nc=m4(mE),nd=m4(mF),ne=m4(mG),nf=m4(mH),ng=m4(mI),nh={fromASN:a=>a.toDate(),toASN:a=>new mJ({valueDate:a})},ni={fromASN:a=>a.toDate(),toASN:a=>new mK({valueDate:a})},nj={fromASN:()=>null,toASN:()=>new l8};function nk(a){switch(a){case Y.Any:return mY;case Y.BitString:return m0;case Y.BmpString:return m6;case Y.Boolean:return m2;case Y.CharacterString:return ng;case Y.Enumerated:return m$;case Y.GeneralString:return nf;case Y.GeneralizedTime:return ni;case Y.GraphicString:return nd;case Y.IA5String:return nc;case Y.Integer:return mZ;case Y.Null:return nj;case Y.NumericString:return m8;case Y.ObjectIdentifier:return m1;case Y.OctetString:return m3;case Y.PrintableString:return m9;case Y.TeletexString:return na;case Y.UTCTime:return nh;case Y.UniversalString:return m7;case Y.Utf8String:return m5;case Y.VideotexString:return nb;case Y.VisibleString:return ne;default:return null}}var nl=a.i(53194);function nm(a){return"function"==typeof a&&a.prototype?!!a.prototype.toASN&&!!a.prototype.fromASN||nm(a.prototype):!!(a&&"object"==typeof a&&"toASN"in a&&"fromASN"in a)}let nn=new class{constructor(){this.items=new WeakMap}has(a){return this.items.has(a)}get(a,b=!1){let c=this.items.get(a);if(!c)throw Error(`Cannot get schema for '${a.prototype.constructor.name}' target`);if(b&&!c.schema)throw Error(`Schema '${a.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return c}cache(a){let b=this.get(a);b.schema||(b.schema=this.create(a,!0))}createDefault(a){let b={type:X.Sequence,items:{}},c=this.findParentSchema(a);return c&&(Object.assign(b,c),b.items=Object.assign({},b.items,c.items)),b}create(a,b){let c=this.items.get(a)||this.createDefault(a),d=[];for(let a in c.items){let e,f=c.items[a],g=b?a:"";if("number"==typeof f.type){let a=Y[f.type],b=nl[a];if(!b)throw Error(`Cannot get ASN1 class by name '${a}'`);e=new b({name:g})}else nm(f.type)?e=new f.type().toSchema(g):f.optional?this.get(f.type).type===X.Choice?e=new nl.Any({name:g}):(e=this.create(f.type,!1)).name=g:e=new nl.Any({name:g});let h=!!f.optional||void 0!==f.defaultValue;if(f.repeated&&(e.name="",e=new("set"===f.repeated?nl.Set:nl.Sequence)({name:"",value:[new nl.Repeated({name:g,value:e})]})),null!==f.context&&void 0!==f.context)if(f.implicit)if("number"==typeof f.type||nm(f.type)){let a=f.repeated?nl.Constructed:nl.Primitive;d.push(new a({name:g,optional:h,idBlock:{tagClass:3,tagNumber:f.context}}))}else{this.cache(f.type);let a=!!f.repeated,b=a?e:this.get(f.type,!0).schema;b="valueBlock"in b?b.valueBlock.value:b.value,d.push(new nl.Constructed({name:a?"":g,optional:h,idBlock:{tagClass:3,tagNumber:f.context},value:b}))}else d.push(new nl.Constructed({optional:h,idBlock:{tagClass:3,tagNumber:f.context},value:[e]}));else e.optional=h,d.push(e)}switch(c.type){case X.Sequence:return new nl.Sequence({value:d,name:""});case X.Set:return new nl.Set({value:d,name:""});case X.Choice:return new nl.Choice({value:d,name:""});default:throw Error("Unsupported ASN1 type in use")}}set(a,b){return this.items.set(a,b),this}findParentSchema(a){let b=Object.getPrototypeOf(a);return b?this.items.get(b)||this.findParentSchema(b):null}},no=a=>b=>{let c;nn.has(b)?c=nn.get(b):(c=nn.createDefault(b),nn.set(b,c)),Object.assign(c,a)},np=a=>(b,c)=>{let d;nn.has(b.constructor)?d=nn.get(b.constructor):(d=nn.createDefault(b.constructor),nn.set(b.constructor,d));let e=Object.assign({},a);if("number"==typeof e.type&&!e.converter){let d=nk(a.type);if(!d)throw Error(`Cannot get default converter for property '${c}' of ${b.constructor.name}`);e.converter=d}e.raw=a.raw,d.items[c]=e};class nq extends Error{constructor(){super(...arguments),this.schemas=[]}}class nr{static parse(a,b){let c=nl.fromBER(a);if(c.result.error)throw Error(c.result.error);return this.fromASN(c.result,b)}static fromASN(a,b){try{if(nm(b))return new b().fromASN(a);let c=nn.get(b);nn.cache(b);let d=c.schema,e=this.handleChoiceTypes(a,c,b,d);if(null==e?void 0:e.result)return e.result;(null==e?void 0:e.targetSchema)&&(d=e.targetSchema);let f=this.handleSequenceTypes(a,c,b,d),g=new b;if(function a(b){var c;if(b){let d=Object.getPrototypeOf(b);return(null==(c=null==d?void 0:d.prototype)?void 0:c.constructor)===Array||a(d)}return!1}(b))return this.handleArrayTypes(a,c,b);return this.processSchemaItems(c,f,g),g}catch(a){throw a instanceof nq&&a.schemas.push(b.name),a}}static handleChoiceTypes(a,b,c,d){if(a.constructor===nl.Constructed&&b.type===X.Choice&&3===a.idBlock.tagClass)for(let d in b.items){let e=b.items[d];if(e.context===a.idBlock.tagNumber&&e.implicit&&"function"==typeof e.type&&nn.has(e.type)){let b=nn.get(e.type);if(b&&b.type===X.Sequence){let b=new nl.Sequence;if("value"in a.valueBlock&&Array.isArray(a.valueBlock.value)&&"value"in b.valueBlock){b.valueBlock.value=a.valueBlock.value;let f=this.fromASN(b,e.type),g=new c;return g[d]=f,{result:g}}}}}else if(a.constructor===nl.Constructed&&b.type!==X.Choice){let c=new nl.Constructed({idBlock:{tagClass:3,tagNumber:a.idBlock.tagNumber},value:b.schema.valueBlock.value});for(let c in b.items)delete a[c];return{targetSchema:c}}return null}static handleSequenceTypes(a,b,c,d){if(b.type===X.Sequence){let b=nl.compareSchema({},a,d);if(!b.verified)throw new nq(`Data does not match to ${c.name} ASN1 schema.${b.result.error?` ${b.result.error}`:""}`);return b}{let b=nl.compareSchema({},a,d);if(!b.verified)throw new nq(`Data does not match to ${c.name} ASN1 schema.${b.result.error?` ${b.result.error}`:""}`);return b}}static processRepeatedField(a,b,c){let d=a.slice(b);if(1===d.length&&"Sequence"===d[0].constructor.name){let a=d[0];a.valueBlock&&a.valueBlock.value&&Array.isArray(a.valueBlock.value)&&(d=a.valueBlock.value)}if("number"!=typeof c.type)return d.filter(a=>a&&a.valueBlock).map(a=>{try{return this.fromASN(a,c.type)}catch{return}}).filter(a=>void 0!==a);{let a=nk(c.type);if(!a)throw Error(`No converter for ASN.1 type ${c.type}`);return d.filter(a=>a&&a.valueBlock).map(b=>{try{return a.fromASN(b)}catch{return}}).filter(a=>void 0!==a)}}static processPrimitiveField(a,b){let c=nk(b.type);if(!c)throw Error(`No converter for ASN.1 type ${b.type}`);return c.fromASN(a)}static isOptionalChoiceField(a){return a.optional&&"function"==typeof a.type&&nn.has(a.type)&&nn.get(a.type).type===X.Choice}static processOptionalChoiceField(a,b){try{let c=this.fromASN(a,b.type);return{processed:!0,value:c}}catch(a){if(a instanceof nq&&/Wrong values for Choice type/.test(a.message))return{processed:!1};throw a}}static handleArrayTypes(a,b,c){if(!("value"in a.valueBlock&&Array.isArray(a.valueBlock.value)))throw Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");let d=b.itemType;if("number"!=typeof d)return c.from(a.valueBlock.value,a=>this.fromASN(a,d));{let b=nk(d);if(!b)throw Error(`Cannot get default converter for array item of ${c.name} ASN1 schema`);return c.from(a.valueBlock.value,a=>b.fromASN(a))}}static processSchemaItems(a,b,c){for(let d in a.items){let e,f=b.result[d];if(!f)continue;let g=a.items[d],h=g.type;(e="number"==typeof h||nm(h)?this.processPrimitiveSchemaItem(f,g,h):this.processComplexSchemaItem(f,g,h))&&"object"==typeof e&&"value"in e&&"raw"in e?(c[d]=e.value,c[`${d}Raw`]=e.raw):c[d]=e}}static processPrimitiveSchemaItem(a,b,c){var d;let e=null!=(d=b.converter)?d:nm(c)?new c:null;if(!e)throw Error("Converter is empty");return b.repeated?this.processRepeatedPrimitiveItem(a,b,e):this.processSinglePrimitiveItem(a,b,c,e)}static processRepeatedPrimitiveItem(a,b,c){if(!b.implicit)return Array.from(a,a=>c.fromASN(a));{let d=new("sequence"===b.repeated?nl.Sequence:nl.Set);d.valueBlock=a.valueBlock;let e=nl.fromBER(d.toBER(!1));if(-1===e.offset)throw Error(`Cannot parse the child item. ${e.result.error}`);if(!("value"in e.result.valueBlock&&Array.isArray(e.result.valueBlock.value)))throw Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");return Array.from(e.result.valueBlock.value,a=>c.fromASN(a))}}static processSinglePrimitiveItem(a,b,c,d){let e=a;if(b.implicit){let a;if(nm(c))a=new c().toSchema("");else{let b=Y[c],d=nl[b];if(!d)throw Error(`Cannot get '${b}' class from asn1js module`);a=new d}a.valueBlock=e.valueBlock,e=nl.fromBER(a.toBER(!1)).result}return d.fromASN(e)}static processComplexSchemaItem(a,b,c){if(b.repeated){if(!Array.isArray(a))throw Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");return Array.from(a,a=>this.fromASN(a,c))}{let d=this.handleImplicitTagging(a,b,c);if(this.isOptionalChoiceField(b))try{return this.fromASN(d,c)}catch(a){if(a instanceof nq&&/Wrong values for Choice type/.test(a.message))return;throw a}{let e=this.fromASN(d,c);return b.raw?{value:e,raw:a.valueBeforeDecodeView}:e}}}static handleImplicitTagging(a,b,c){if(b.implicit&&"number"==typeof b.context){let b=nn.get(c);if(b.type===X.Sequence){let b=new nl.Sequence;if("value"in a.valueBlock&&Array.isArray(a.valueBlock.value)&&"value"in b.valueBlock)return b.valueBlock.value=a.valueBlock.value,b}else if(b.type===X.Set){let b=new nl.Set;if("value"in a.valueBlock&&Array.isArray(a.valueBlock.value)&&"value"in b.valueBlock)return b.valueBlock.value=a.valueBlock.value,b}}return a}}class ns{static serialize(a){return a instanceof l$?a.toBER(!1):this.toASN(a).toBER(!1)}static toASN(a){let b;if(a&&"object"==typeof a&&nm(a))return a.toASN();if(!(a&&"object"==typeof a))throw TypeError("Parameter 1 should be type of Object.");let c=a.constructor,d=nn.get(c);nn.cache(c);let e=[];if(d.itemType){if(!Array.isArray(a))throw TypeError("Parameter 1 should be type of Array.");if("number"==typeof d.itemType){let b=nk(d.itemType);if(!b)throw Error(`Cannot get default converter for array item of ${c.name} ASN1 schema`);e=a.map(a=>b.toASN(a))}else e=a.map(a=>this.toAsnItem({type:d.itemType},"[]",c,a))}else for(let b in d.items){let f=d.items[b],g=a[b];if(void 0===g||f.defaultValue===g||"object"==typeof f.defaultValue&&"object"==typeof g&&function(a,b){if(!(a&&b)||a.byteLength!==b.byteLength)return!1;let c=new Uint8Array(a),d=new Uint8Array(b);for(let b=0;b<a.byteLength;b++)if(c[b]!==d[b])return!1;return!0}(this.serialize(f.defaultValue),this.serialize(g)))continue;let h=ns.toAsnItem(f,b,c,g);if("number"==typeof f.context)if(f.implicit)if(!f.repeated&&("number"==typeof f.type||nm(f.type))){let a={};a.valueHex=h instanceof l8?h.valueBeforeDecodeView:h.valueBlock.toBER(),e.push(new l1({optional:f.optional,idBlock:{tagClass:3,tagNumber:f.context},...a}))}else e.push(new l5({optional:f.optional,idBlock:{tagClass:3,tagNumber:f.context},value:h.valueBlock.value}));else e.push(new l5({optional:f.optional,idBlock:{tagClass:3,tagNumber:f.context},value:[h]}));else f.repeated?e=e.concat(h):e.push(h)}switch(d.type){case X.Sequence:b=new mp({value:e});break;case X.Set:b=new mq({value:e});break;case X.Choice:if(!e[0])throw Error(`Schema '${c.name}' has wrong data. Choice cannot be empty.`);b=e[0]}return b}static toAsnItem(a,b,c,d){let e;if("number"==typeof a.type){let f=a.converter;if(!f)throw Error(`Property '${b}' doesn't have converter for type ${Y[a.type]} in schema '${c.name}'`);if(a.repeated){if(!Array.isArray(d))throw TypeError("Parameter 'objProp' should be type of Array.");let b=Array.from(d,a=>f.toASN(a));e=new("sequence"===a.repeated?mp:mq)({value:b})}else e=f.toASN(d)}else if(a.repeated){if(!Array.isArray(d))throw TypeError("Parameter 'objProp' should be type of Array.");let b=Array.from(d,a=>this.toASN(a));e=new("sequence"===a.repeated?mp:mq)({value:b})}else e=this.toASN(d);return e}}class nt extends Array{constructor(a=[]){if("number"==typeof a)super(a);else for(const b of(super(),a))this.push(b)}}class nu{static serialize(a){return ns.serialize(a)}static parse(a,b){return nr.parse(a,b)}static toString(a){let b=l3(lt.isBufferSource(a)?lt.toArrayBuffer(a):nu.serialize(a));if(-1===b.offset)throw Error(`Cannot decode ASN.1 data. ${b.result.error}`);return b.result.toString()}}function nv(a,b,c,d){var e,f=arguments.length,g=f<3?b:null===d?d=Object.getOwnPropertyDescriptor(b,c):d;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)g=Reflect.decorate(a,b,c,d);else for(var h=a.length-1;h>=0;h--)(e=a[h])&&(g=(f<3?e(g):f>3?e(b,c,g):e(b,c))||g);return f>3&&g&&Object.defineProperty(b,c,g),g}function nw(a,b,c,d){if("a"===c&&!d)throw TypeError("Private accessor was defined without a getter");if("function"==typeof b?a!==b||!d:!b.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===c?d:"a"===c?d.call(a):d?d.value:b.get(a)}function nx(a,b,c,d,e){if("m"===d)throw TypeError("Private method is not writable");if("a"===d&&!e)throw TypeError("Private accessor was defined without a setter");if("function"==typeof b?a!==b||!e:!b.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===d?e.call(a,c):e?e.value=c:b.set(a,c),c}"function"==typeof SuppressedError&&SuppressedError;class ny{static isIPv4(a){return/^(\d{1,3}\.){3}\d{1,3}$/.test(a)}static parseIPv4(a){let b=a.split(".");if(4!==b.length)throw Error("Invalid IPv4 address");return b.map(a=>{let b=parseInt(a,10);if(isNaN(b)||b<0||b>255)throw Error("Invalid IPv4 address part");return b})}static parseIPv6(a){let b=this.expandIPv6(a).split(":");if(8!==b.length)throw Error("Invalid IPv6 address");return b.reduce((a,b)=>{let c=parseInt(b,16);if(isNaN(c)||c<0||c>65535)throw Error("Invalid IPv6 address part");return a.push(c>>8&255),a.push(255&c),a},[])}static expandIPv6(a){if(!a.includes("::"))return a;let b=a.split("::");if(b.length>2)throw Error("Invalid IPv6 address");let c=b[0]?b[0].split(":"):[],d=b[1]?b[1].split(":"):[],e=8-(c.length+d.length);if(e<0)throw Error("Invalid IPv6 address");return[...c,...Array(e).fill("0"),...d].join(":")}static formatIPv6(a){let b=[];for(let c=0;c<16;c+=2)b.push((a[c]<<8|a[c+1]).toString(16));return this.compressIPv6(b.join(":"))}static compressIPv6(a){let b=a.split(":"),c=-1,d=0,e=-1,f=0;for(let a=0;a<b.length;a++)"0"===b[a]?(-1===e&&(e=a),f++):(f>d&&(c=e,d=f),e=-1,f=0);if(f>d&&(c=e,d=f),d>1){let a=b.slice(0,c).join(":"),e=b.slice(c+d).join(":");return`${a}::${e}`}return a}static parseCIDR(a){let[b,c]=a.split("/"),d=parseInt(c,10);if(this.isIPv4(b)){if(d<0||d>32)throw Error("Invalid IPv4 prefix length");return[this.parseIPv4(b),d]}if(d<0||d>128)throw Error("Invalid IPv6 prefix length");return[this.parseIPv6(b),d]}static decodeIP(a){if(64===a.length&&0===parseInt(a,16))return"::/0";if(16!==a.length)return a;let b=parseInt(a.slice(8),16).toString(2).split("").reduce((a,b)=>a+ +b,0),c=a.slice(0,8).replace(/(.{2})/g,a=>`${parseInt(a,16)}.`);return c=c.slice(0,-1),`${c}/${b}`}static toString(a){let b=new Uint8Array(a);if(4===b.length)return Array.from(b).join(".");if(16===b.length)return this.formatIPv6(b);if(8===b.length||32===b.length){let a=b.length/2,c=b.slice(0,a),d=b.slice(a);if(b.every(a=>0===a))return 8===b.length?"0.0.0.0/0":"::/0";let e=d.reduce((a,b)=>a+(b.toString(2).match(/1/g)||[]).length,0);if(8===b.length){let a=Array.from(c).join(".");return`${a}/${e}`}{let a=this.formatIPv6(c);return`${a}/${e}`}}return this.decodeIP(lA.ToHex(a))}static fromString(a){if(a.includes("/")){let[b,c]=this.parseCIDR(a),d=new Uint8Array(b.length),e=c;for(let a=0;a<d.length;a++)e>=8?(d[a]=255,e-=8):e>0&&(d[a]=255<<8-e,e=0);let f=new Uint8Array(2*b.length);return f.set(b,0),f.set(d,b.length),f.buffer}return new Uint8Array(this.isIPv4(a)?this.parseIPv4(a):this.parseIPv6(a)).buffer}}let nz=class{constructor(a={}){Object.assign(this,a)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};nv([np({type:Y.TeletexString})],nz.prototype,"teletexString",void 0),nv([np({type:Y.PrintableString})],nz.prototype,"printableString",void 0),nv([np({type:Y.UniversalString})],nz.prototype,"universalString",void 0),nv([np({type:Y.Utf8String})],nz.prototype,"utf8String",void 0),nv([np({type:Y.BmpString})],nz.prototype,"bmpString",void 0),nz=nv([no({type:X.Choice})],nz);let nA=class extends nz{constructor(a={}){super(a),Object.assign(this,a)}toString(){return this.ia5String||(this.anyValue?lA.ToHex(this.anyValue):super.toString())}};nv([np({type:Y.IA5String})],nA.prototype,"ia5String",void 0),nv([np({type:Y.Any})],nA.prototype,"anyValue",void 0),nA=nv([no({type:X.Choice})],nA);class nB{constructor(a={}){this.type="",this.value=new nA,Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],nB.prototype,"type",void 0),nv([np({type:nA})],nB.prototype,"value",void 0);let nC=Z=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,Z.prototype)}};nC=Z=nv([no({type:X.Set,itemType:nB})],nC);let nD=$=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,$.prototype)}};nD=$=nv([no({type:X.Sequence,itemType:nC})],nD);let nE=_=class extends nD{constructor(a){super(a),Object.setPrototypeOf(this,_.prototype)}};nE=_=nv([no({type:X.Sequence})],nE);class nF{constructor(a={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],nF.prototype,"typeId",void 0),nv([np({type:Y.Any,context:0})],nF.prototype,"value",void 0);class nG{constructor(a={}){this.partyName=new nz,Object.assign(this,a)}}nv([np({type:nz,optional:!0,context:0,implicit:!0})],nG.prototype,"nameAssigner",void 0),nv([np({type:nz,context:1,implicit:!0})],nG.prototype,"partyName",void 0);let nH=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:nF,context:0,implicit:!0})],nH.prototype,"otherName",void 0),nv([np({type:Y.IA5String,context:1,implicit:!0})],nH.prototype,"rfc822Name",void 0),nv([np({type:Y.IA5String,context:2,implicit:!0})],nH.prototype,"dNSName",void 0),nv([np({type:Y.Any,context:3,implicit:!0})],nH.prototype,"x400Address",void 0),nv([np({type:nE,context:4,implicit:!1})],nH.prototype,"directoryName",void 0),nv([np({type:nG,context:5})],nH.prototype,"ediPartyName",void 0),nv([np({type:Y.IA5String,context:6,implicit:!0})],nH.prototype,"uniformResourceIdentifier",void 0),nv([np({type:Y.OctetString,context:7,implicit:!0,converter:{fromASN:a=>ny.toString(m3.fromASN(a)),toASN:a=>m3.toASN(ny.fromString(a))}})],nH.prototype,"iPAddress",void 0),nv([np({type:Y.ObjectIdentifier,context:8,implicit:!0})],nH.prototype,"registeredID",void 0),nH=nv([no({type:X.Choice})],nH);let nI="1.3.6.1.5.5.7",nJ=`${nI}.1`,nK=`${nI}.3`,nL=`${nI}.48`,nM=`${nL}.1`,nN=`${nL}.2`,nO=`${nL}.3`,nP=`${nL}.5`,nQ="2.5.29",nR=`${nJ}.1`;class nS{constructor(a={}){this.accessMethod="",this.accessLocation=new nH,Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],nS.prototype,"accessMethod",void 0),nv([np({type:nH})],nS.prototype,"accessLocation",void 0);let nT=aa=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aa.prototype)}};nT=aa=nv([no({type:X.Sequence,itemType:nS})],nT);let nU=`${nQ}.35`;class nV extends mX{}class nW{constructor(a={}){a&&Object.assign(this,a)}}nv([np({type:nV,context:0,optional:!0,implicit:!0})],nW.prototype,"keyIdentifier",void 0),nv([np({type:nH,context:1,optional:!0,implicit:!0,repeated:"sequence"})],nW.prototype,"authorityCertIssuer",void 0),nv([np({type:Y.Integer,context:2,optional:!0,implicit:!0,converter:m_})],nW.prototype,"authorityCertSerialNumber",void 0);let nX=`${nQ}.19`;class nY{constructor(a={}){this.cA=!1,Object.assign(this,a)}}nv([np({type:Y.Boolean,defaultValue:!1})],nY.prototype,"cA",void 0),nv([np({type:Y.Integer,optional:!0})],nY.prototype,"pathLenConstraint",void 0);let nZ=ab=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,ab.prototype)}};nZ=ab=nv([no({type:X.Sequence,itemType:nH})],nZ);let n$=ac=class extends nZ{constructor(a){super(a),Object.setPrototypeOf(this,ac.prototype)}};n$=ac=nv([no({type:X.Sequence})],n$);let n_=`${nQ}.32`,n0=class{constructor(a={}){Object.assign(this,a)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};nv([np({type:Y.IA5String})],n0.prototype,"ia5String",void 0),nv([np({type:Y.VisibleString})],n0.prototype,"visibleString",void 0),nv([np({type:Y.BmpString})],n0.prototype,"bmpString",void 0),nv([np({type:Y.Utf8String})],n0.prototype,"utf8String",void 0),n0=nv([no({type:X.Choice})],n0);class n1{constructor(a={}){this.organization=new n0,this.noticeNumbers=[],Object.assign(this,a)}}nv([np({type:n0})],n1.prototype,"organization",void 0),nv([np({type:Y.Integer,repeated:"sequence"})],n1.prototype,"noticeNumbers",void 0);class n2{constructor(a={}){Object.assign(this,a)}}nv([np({type:n1,optional:!0})],n2.prototype,"noticeRef",void 0),nv([np({type:n0,optional:!0})],n2.prototype,"explicitText",void 0);let n3=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:Y.IA5String})],n3.prototype,"cPSuri",void 0),nv([np({type:n2})],n3.prototype,"userNotice",void 0),n3=nv([no({type:X.Choice})],n3);class n4{constructor(a={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],n4.prototype,"policyQualifierId",void 0),nv([np({type:Y.Any})],n4.prototype,"qualifier",void 0);class n5{constructor(a={}){this.policyIdentifier="",Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],n5.prototype,"policyIdentifier",void 0),nv([np({type:n4,repeated:"sequence",optional:!0})],n5.prototype,"policyQualifiers",void 0);let n6=ad=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,ad.prototype)}};n6=ad=nv([no({type:X.Sequence,itemType:n5})],n6);let n7=class{constructor(a=0){this.value=a}};nv([np({type:Y.Integer})],n7.prototype,"value",void 0),n7=nv([no({type:X.Choice})],n7);let n8=class extends n7{};n8=nv([no({type:X.Choice})],n8);let n9=`${nQ}.31`;(w=af||(af={}))[w.unused=1]="unused",w[w.keyCompromise=2]="keyCompromise",w[w.cACompromise=4]="cACompromise",w[w.affiliationChanged=8]="affiliationChanged",w[w.superseded=16]="superseded",w[w.cessationOfOperation=32]="cessationOfOperation",w[w.certificateHold=64]="certificateHold",w[w.privilegeWithdrawn=128]="privilegeWithdrawn",w[w.aACompromise=256]="aACompromise";class oa extends mW{toJSON(){let a=[],b=this.toNumber();return b&af.aACompromise&&a.push("aACompromise"),b&af.affiliationChanged&&a.push("affiliationChanged"),b&af.cACompromise&&a.push("cACompromise"),b&af.certificateHold&&a.push("certificateHold"),b&af.cessationOfOperation&&a.push("cessationOfOperation"),b&af.keyCompromise&&a.push("keyCompromise"),b&af.privilegeWithdrawn&&a.push("privilegeWithdrawn"),b&af.superseded&&a.push("superseded"),b&af.unused&&a.push("unused"),a}toString(){return`[${this.toJSON().join(", ")}]`}}let ob=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:nH,context:0,repeated:"sequence",implicit:!0})],ob.prototype,"fullName",void 0),nv([np({type:nC,context:1,implicit:!0})],ob.prototype,"nameRelativeToCRLIssuer",void 0),ob=nv([no({type:X.Choice})],ob);class oc{constructor(a={}){Object.assign(this,a)}}nv([np({type:ob,context:0,optional:!0})],oc.prototype,"distributionPoint",void 0),nv([np({type:oa,context:1,optional:!0,implicit:!0})],oc.prototype,"reasons",void 0),nv([np({type:nH,context:2,optional:!0,repeated:"sequence",implicit:!0})],oc.prototype,"cRLIssuer",void 0);let od=ae=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,ae.prototype)}};od=ae=nv([no({type:X.Sequence,itemType:oc})],od);let oe=ag=class extends od{constructor(a){super(a),Object.setPrototypeOf(this,ag.prototype)}};oe=ag=nv([no({type:X.Sequence,itemType:oc})],oe);class of{constructor(a={}){this.onlyContainsUserCerts=of.ONLY,this.onlyContainsCACerts=of.ONLY,this.indirectCRL=of.ONLY,this.onlyContainsAttributeCerts=of.ONLY,Object.assign(this,a)}}of.ONLY=!1,nv([np({type:ob,context:0,optional:!0})],of.prototype,"distributionPoint",void 0),nv([np({type:Y.Boolean,context:1,defaultValue:of.ONLY,implicit:!0})],of.prototype,"onlyContainsUserCerts",void 0),nv([np({type:Y.Boolean,context:2,defaultValue:of.ONLY,implicit:!0})],of.prototype,"onlyContainsCACerts",void 0),nv([np({type:oa,context:3,optional:!0,implicit:!0})],of.prototype,"onlySomeReasons",void 0),nv([np({type:Y.Boolean,context:4,defaultValue:of.ONLY,implicit:!0})],of.prototype,"indirectCRL",void 0),nv([np({type:Y.Boolean,context:5,defaultValue:of.ONLY,implicit:!0})],of.prototype,"onlyContainsAttributeCerts",void 0);let og=`${nQ}.21`;(x=ah||(ah={}))[x.unspecified=0]="unspecified",x[x.keyCompromise=1]="keyCompromise",x[x.cACompromise=2]="cACompromise",x[x.affiliationChanged=3]="affiliationChanged",x[x.superseded=4]="superseded",x[x.cessationOfOperation=5]="cessationOfOperation",x[x.certificateHold=6]="certificateHold",x[x.removeFromCRL=8]="removeFromCRL",x[x.privilegeWithdrawn=9]="privilegeWithdrawn",x[x.aACompromise=10]="aACompromise";let oh=class{constructor(a=ah.unspecified){this.reason=ah.unspecified,this.reason=a}toJSON(){return ah[this.reason]}toString(){return this.toJSON()}};nv([np({type:Y.Enumerated})],oh.prototype,"reason",void 0),oh=nv([no({type:X.Choice})],oh);let oi=`${nQ}.37`,oj=ai=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,ai.prototype)}};oj=ai=nv([no({type:X.Sequence,itemType:Y.ObjectIdentifier})],oj);let ok=`${nK}.1`,ol=`${nK}.2`,om=`${nK}.3`,on=`${nK}.4`,oo=`${nK}.8`,op=`${nK}.9`,oq=class{constructor(a=new ArrayBuffer(0)){this.value=a}};nv([np({type:Y.Integer,converter:m_})],oq.prototype,"value",void 0),oq=nv([no({type:X.Choice})],oq);let or=`${nQ}.24`,os=class{constructor(a){this.value=new Date,a&&(this.value=a)}};nv([np({type:Y.GeneralizedTime})],os.prototype,"value",void 0),os=nv([no({type:X.Choice})],os);let ot=`${nQ}.18`,ou=aj=class extends nZ{constructor(a){super(a),Object.setPrototypeOf(this,aj.prototype)}};ou=aj=nv([no({type:X.Sequence})],ou);let ov=`${nQ}.15`;(y=ak||(ak={}))[y.digitalSignature=1]="digitalSignature",y[y.nonRepudiation=2]="nonRepudiation",y[y.keyEncipherment=4]="keyEncipherment",y[y.dataEncipherment=8]="dataEncipherment",y[y.keyAgreement=16]="keyAgreement",y[y.keyCertSign=32]="keyCertSign",y[y.cRLSign=64]="cRLSign",y[y.encipherOnly=128]="encipherOnly",y[y.decipherOnly=256]="decipherOnly";class ow extends mW{toJSON(){let a=this.toNumber(),b=[];return a&ak.cRLSign&&b.push("crlSign"),a&ak.dataEncipherment&&b.push("dataEncipherment"),a&ak.decipherOnly&&b.push("decipherOnly"),a&ak.digitalSignature&&b.push("digitalSignature"),a&ak.encipherOnly&&b.push("encipherOnly"),a&ak.keyAgreement&&b.push("keyAgreement"),a&ak.keyCertSign&&b.push("keyCertSign"),a&ak.keyEncipherment&&b.push("keyEncipherment"),a&ak.nonRepudiation&&b.push("nonRepudiation"),b}toString(){return`[${this.toJSON().join(", ")}]`}}class ox{constructor(a={}){this.base=new nH,this.minimum=0,Object.assign(this,a)}}nv([np({type:nH})],ox.prototype,"base",void 0),nv([np({type:Y.Integer,context:0,defaultValue:0,implicit:!0})],ox.prototype,"minimum",void 0),nv([np({type:Y.Integer,context:1,optional:!0,implicit:!0})],ox.prototype,"maximum",void 0);let oy=al=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,al.prototype)}};oy=al=nv([no({type:X.Sequence,itemType:ox})],oy);class oz{constructor(a={}){Object.assign(this,a)}}nv([np({type:oy,context:0,optional:!0,implicit:!0})],oz.prototype,"permittedSubtrees",void 0),nv([np({type:oy,context:1,optional:!0,implicit:!0})],oz.prototype,"excludedSubtrees",void 0);class oA{constructor(a={}){Object.assign(this,a)}}nv([np({type:Y.Integer,context:0,implicit:!0,optional:!0,converter:m_})],oA.prototype,"requireExplicitPolicy",void 0),nv([np({type:Y.Integer,context:1,implicit:!0,optional:!0,converter:m_})],oA.prototype,"inhibitPolicyMapping",void 0);class oB{constructor(a={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],oB.prototype,"issuerDomainPolicy",void 0),nv([np({type:Y.ObjectIdentifier})],oB.prototype,"subjectDomainPolicy",void 0);let oC=am=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,am.prototype)}};oC=am=nv([no({type:X.Sequence,itemType:oB})],oC);let oD=`${nQ}.17`,oE=an=class extends nZ{constructor(a){super(a),Object.setPrototypeOf(this,an.prototype)}};oE=an=nv([no({type:X.Sequence})],oE);class oF{constructor(a={}){this.type="",this.values=[],Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],oF.prototype,"type",void 0),nv([np({type:Y.Any,repeated:"set"})],oF.prototype,"values",void 0);let oG=ao=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,ao.prototype)}};oG=ao=nv([no({type:X.Sequence,itemType:oF})],oG);let oH=`${nQ}.14`;class oI extends nV{}class oJ{constructor(a={}){Object.assign(this,a)}}nv([np({type:Y.GeneralizedTime,context:0,implicit:!0,optional:!0})],oJ.prototype,"notBefore",void 0),nv([np({type:Y.GeneralizedTime,context:1,implicit:!0,optional:!0})],oJ.prototype,"notAfter",void 0),(z=ap||(ap={}))[z.keyUpdateAllowed=1]="keyUpdateAllowed",z[z.newExtensions=2]="newExtensions",z[z.pKIXCertificate=4]="pKIXCertificate";class oK extends mW{toJSON(){let a=[],b=this.toNumber();return b&ap.pKIXCertificate&&a.push("pKIXCertificate"),b&ap.newExtensions&&a.push("newExtensions"),b&ap.keyUpdateAllowed&&a.push("keyUpdateAllowed"),a}toString(){return`[${this.toJSON().join(", ")}]`}}class oL{constructor(a={}){this.entrustVers="",this.entrustInfoFlags=new oK,Object.assign(this,a)}}nv([np({type:Y.GeneralString})],oL.prototype,"entrustVers",void 0),nv([np({type:oK})],oL.prototype,"entrustInfoFlags",void 0);let oM=aq=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aq.prototype)}};oM=aq=nv([no({type:X.Sequence,itemType:nS})],oM);class oN{constructor(a={}){this.algorithm="",Object.assign(this,a)}isEqual(a){return a instanceof oN&&a.algorithm==this.algorithm&&(a.parameters&&this.parameters&&lB(a.parameters,this.parameters)||a.parameters===this.parameters)}}nv([np({type:Y.ObjectIdentifier})],oN.prototype,"algorithm",void 0),nv([np({type:Y.Any,optional:!0})],oN.prototype,"parameters",void 0);class oO{constructor(a={}){this.algorithm=new oN,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:oN})],oO.prototype,"algorithm",void 0),nv([np({type:Y.BitString})],oO.prototype,"subjectPublicKey",void 0);let oP=class{constructor(a){if(a)if("string"==typeof a||"number"==typeof a||a instanceof Date){const b=new Date(a);b.setMilliseconds(0),b.getUTCFullYear()>2049?this.generalTime=b:this.utcTime=b}else Object.assign(this,a)}getTime(){let a=this.utcTime||this.generalTime;if(!a)throw Error("Cannot get time from CHOICE object");return a}};nv([np({type:Y.UTCTime})],oP.prototype,"utcTime",void 0),nv([np({type:Y.GeneralizedTime})],oP.prototype,"generalTime",void 0),oP=nv([no({type:X.Choice})],oP);class oQ{constructor(a){this.notBefore=new oP(new Date),this.notAfter=new oP(new Date),a&&(this.notBefore=new oP(a.notBefore),this.notAfter=new oP(a.notAfter))}}nv([np({type:oP})],oQ.prototype,"notBefore",void 0),nv([np({type:oP})],oQ.prototype,"notAfter",void 0);class oR{constructor(a={}){this.extnID="",this.critical=oR.CRITICAL,this.extnValue=new mX,Object.assign(this,a)}}oR.CRITICAL=!1,nv([np({type:Y.ObjectIdentifier})],oR.prototype,"extnID",void 0),nv([np({type:Y.Boolean,defaultValue:oR.CRITICAL})],oR.prototype,"critical",void 0),nv([np({type:mX})],oR.prototype,"extnValue",void 0);let oS=ar=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,ar.prototype)}};oS=ar=nv([no({type:X.Sequence,itemType:oR})],oS),(A=as||(as={}))[A.v1=0]="v1",A[A.v2=1]="v2",A[A.v3=2]="v3";class oT{constructor(a={}){this.version=as.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new oN,this.issuer=new nE,this.validity=new oQ,this.subject=new nE,this.subjectPublicKeyInfo=new oO,Object.assign(this,a)}}nv([np({type:Y.Integer,context:0,defaultValue:as.v1})],oT.prototype,"version",void 0),nv([np({type:Y.Integer,converter:m_})],oT.prototype,"serialNumber",void 0),nv([np({type:oN})],oT.prototype,"signature",void 0),nv([np({type:nE})],oT.prototype,"issuer",void 0),nv([np({type:oQ})],oT.prototype,"validity",void 0),nv([np({type:nE})],oT.prototype,"subject",void 0),nv([np({type:oO})],oT.prototype,"subjectPublicKeyInfo",void 0),nv([np({type:Y.BitString,context:1,implicit:!0,optional:!0})],oT.prototype,"issuerUniqueID",void 0),nv([np({type:Y.BitString,context:2,implicit:!0,optional:!0})],oT.prototype,"subjectUniqueID",void 0),nv([np({type:oS,context:3,optional:!0})],oT.prototype,"extensions",void 0);class oU{constructor(a={}){this.tbsCertificate=new oT,this.signatureAlgorithm=new oN,this.signatureValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:oT,raw:!0})],oU.prototype,"tbsCertificate",void 0),nv([np({type:oN})],oU.prototype,"signatureAlgorithm",void 0),nv([np({type:Y.BitString})],oU.prototype,"signatureValue",void 0);class oV{constructor(a={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new oP,Object.assign(this,a)}}nv([np({type:Y.Integer,converter:m_})],oV.prototype,"userCertificate",void 0),nv([np({type:oP})],oV.prototype,"revocationDate",void 0),nv([np({type:oR,optional:!0,repeated:"sequence"})],oV.prototype,"crlEntryExtensions",void 0);class oW{constructor(a={}){this.signature=new oN,this.issuer=new nE,this.thisUpdate=new oP,Object.assign(this,a)}}nv([np({type:Y.Integer,optional:!0})],oW.prototype,"version",void 0),nv([np({type:oN})],oW.prototype,"signature",void 0),nv([np({type:nE})],oW.prototype,"issuer",void 0),nv([np({type:oP})],oW.prototype,"thisUpdate",void 0),nv([np({type:oP,optional:!0})],oW.prototype,"nextUpdate",void 0),nv([np({type:oV,repeated:"sequence",optional:!0})],oW.prototype,"revokedCertificates",void 0),nv([np({type:oR,optional:!0,context:0,repeated:"sequence"})],oW.prototype,"crlExtensions",void 0);class oX{constructor(a={}){this.tbsCertList=new oW,this.signatureAlgorithm=new oN,this.signature=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:oW,raw:!0})],oX.prototype,"tbsCertList",void 0),nv([np({type:oN})],oX.prototype,"signatureAlgorithm",void 0),nv([np({type:Y.BitString})],oX.prototype,"signature",void 0);let oY={"2.5.4.6":"C","2.5.4.10":"O","2.5.4.11":"OU","2.5.4.3":"CN"};function oZ(a){let b=nr.parse(a,oU),c=b.tbsCertificate,d={combined:""};c.issuer.forEach(([a])=>{let b=oY[a.type];b&&(d[b]=a.value.toString())}),d.combined=o$(d);let e={combined:""};c.subject.forEach(([a])=>{let b=oY[a.type];b&&(e[b]=a.value.toString())}),e.combined=o$(e);let f=!1;if(c.extensions)for(let a of c.extensions)a.extnID===nX&&(f=nr.parse(a.extnValue,nY).cA);return{issuer:d,subject:e,version:c.version,basicConstraintsCA:f,notBefore:c.validity.notBefore.getTime(),notAfter:c.validity.notAfter.getTime(),parsedCertificate:b}}function o$(a){let b=[];return a.C&&b.push(a.C),a.O&&b.push(a.O),a.OU&&b.push(a.OU),a.CN&&b.push(a.CN),b.join(" : ")}a.i(48647);class o_{constructor(a={}){this.issuer=new nE,this.serialNumber=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:nE})],o_.prototype,"issuer",void 0),nv([np({type:Y.Integer,converter:m_})],o_.prototype,"serialNumber",void 0);let o0=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:oI,context:0,implicit:!0})],o0.prototype,"subjectKeyIdentifier",void 0),nv([np({type:o_})],o0.prototype,"issuerAndSerialNumber",void 0),o0=nv([no({type:X.Choice})],o0),(B=at||(at={}))[B.v0=0]="v0",B[B.v1=1]="v1",B[B.v2=2]="v2",B[B.v3=3]="v3",B[B.v4=4]="v4",B[B.v5=5]="v5";let o1=class extends oN{};o1=nv([no({type:X.Sequence})],o1);let o2=class extends oN{};o2=nv([no({type:X.Sequence})],o2);let o3=class extends oN{};o3=nv([no({type:X.Sequence})],o3);let o4=class extends oN{};o4=nv([no({type:X.Sequence})],o4);let o5=class extends oN{};o5=nv([no({type:X.Sequence})],o5);let o6=class extends oN{};o6=nv([no({type:X.Sequence})],o6);class o7{constructor(a={}){this.attrType="",this.attrValues=[],Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],o7.prototype,"attrType",void 0),nv([np({type:Y.Any,repeated:"set"})],o7.prototype,"attrValues",void 0);class o8{constructor(a={}){this.version=at.v0,this.sid=new o0,this.digestAlgorithm=new o1,this.signatureAlgorithm=new o2,this.signature=new mX,Object.assign(this,a)}}nv([np({type:Y.Integer})],o8.prototype,"version",void 0),nv([np({type:o0})],o8.prototype,"sid",void 0),nv([np({type:o1})],o8.prototype,"digestAlgorithm",void 0),nv([np({type:o7,repeated:"set",context:0,implicit:!0,optional:!0,raw:!0})],o8.prototype,"signedAttrs",void 0),nv([np({type:o2})],o8.prototype,"signatureAlgorithm",void 0),nv([np({type:mX})],o8.prototype,"signature",void 0),nv([np({type:o7,repeated:"set",context:1,implicit:!0,optional:!0})],o8.prototype,"unsignedAttrs",void 0);let o9=au=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,au.prototype)}};o9=au=nv([no({type:X.Set,itemType:o8})],o9);let pa=class extends o8{};pa=nv([no({type:X.Sequence})],pa);let pb=class extends oP{};pb=nv([no({type:X.Choice})],pb);class pc{constructor(a={}){this.acIssuer=new nH,this.acSerial=0,this.attrs=[],Object.assign(this,a)}}nv([np({type:nH})],pc.prototype,"acIssuer",void 0),nv([np({type:Y.Integer})],pc.prototype,"acSerial",void 0),nv([np({type:oF,repeated:"sequence"})],pc.prototype,"attrs",void 0);let pd=av=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,av.prototype)}};pd=av=nv([no({type:X.Sequence,itemType:Y.ObjectIdentifier})],pd);class pe{constructor(a={}){this.permitUnSpecified=!0,Object.assign(this,a)}}nv([np({type:Y.Integer,optional:!0})],pe.prototype,"pathLenConstraint",void 0),nv([np({type:pd,implicit:!0,context:0,optional:!0})],pe.prototype,"permittedAttrs",void 0),nv([np({type:pd,implicit:!0,context:1,optional:!0})],pe.prototype,"excludedAttrs",void 0),nv([np({type:Y.Boolean,defaultValue:!0})],pe.prototype,"permitUnSpecified",void 0);class pf{constructor(a={}){this.issuer=new nZ,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:nZ})],pf.prototype,"issuer",void 0),nv([np({type:Y.Integer,converter:m_})],pf.prototype,"serial",void 0),nv([np({type:Y.BitString,optional:!0})],pf.prototype,"issuerUID",void 0),(C=aw||(aw={}))[C.publicKey=0]="publicKey",C[C.publicKeyCert=1]="publicKeyCert",C[C.otherObjectTypes=2]="otherObjectTypes";class pg{constructor(a={}){this.digestedObjectType=aw.publicKey,this.digestAlgorithm=new oN,this.objectDigest=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.Enumerated})],pg.prototype,"digestedObjectType",void 0),nv([np({type:Y.ObjectIdentifier,optional:!0})],pg.prototype,"otherObjectTypeID",void 0),nv([np({type:oN})],pg.prototype,"digestAlgorithm",void 0),nv([np({type:Y.BitString})],pg.prototype,"objectDigest",void 0);class ph{constructor(a={}){Object.assign(this,a)}}nv([np({type:nZ,optional:!0})],ph.prototype,"issuerName",void 0),nv([np({type:pf,context:0,implicit:!0,optional:!0})],ph.prototype,"baseCertificateID",void 0),nv([np({type:pg,context:1,implicit:!0,optional:!0})],ph.prototype,"objectDigestInfo",void 0);let pi=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:nH,repeated:"sequence"})],pi.prototype,"v1Form",void 0),nv([np({type:ph,context:0,implicit:!0})],pi.prototype,"v2Form",void 0),pi=nv([no({type:X.Choice})],pi);class pj{constructor(a={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,a)}}nv([np({type:Y.GeneralizedTime})],pj.prototype,"notBeforeTime",void 0),nv([np({type:Y.GeneralizedTime})],pj.prototype,"notAfterTime",void 0);class pk{constructor(a={}){Object.assign(this,a)}}nv([np({type:pf,implicit:!0,context:0,optional:!0})],pk.prototype,"baseCertificateID",void 0),nv([np({type:nZ,implicit:!0,context:1,optional:!0})],pk.prototype,"entityName",void 0),nv([np({type:pg,implicit:!0,context:2,optional:!0})],pk.prototype,"objectDigestInfo",void 0),(D=ax||(ax={}))[D.v2=1]="v2";class pl{constructor(a={}){this.version=ax.v2,this.holder=new pk,this.issuer=new pi,this.signature=new oN,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new pj,this.attributes=[],Object.assign(this,a)}}nv([np({type:Y.Integer})],pl.prototype,"version",void 0),nv([np({type:pk})],pl.prototype,"holder",void 0),nv([np({type:pi})],pl.prototype,"issuer",void 0),nv([np({type:oN})],pl.prototype,"signature",void 0),nv([np({type:Y.Integer,converter:m_})],pl.prototype,"serialNumber",void 0),nv([np({type:pj})],pl.prototype,"attrCertValidityPeriod",void 0),nv([np({type:oF,repeated:"sequence"})],pl.prototype,"attributes",void 0),nv([np({type:Y.BitString,optional:!0})],pl.prototype,"issuerUniqueID",void 0),nv([np({type:oS,optional:!0})],pl.prototype,"extensions",void 0);class pm{constructor(a={}){this.acinfo=new pl,this.signatureAlgorithm=new oN,this.signatureValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:pl})],pm.prototype,"acinfo",void 0),nv([np({type:oN})],pm.prototype,"signatureAlgorithm",void 0),nv([np({type:Y.BitString})],pm.prototype,"signatureValue",void 0),(E=ay||(ay={}))[E.unmarked=1]="unmarked",E[E.unclassified=2]="unclassified",E[E.restricted=4]="restricted",E[E.confidential=8]="confidential",E[E.secret=16]="secret",E[E.topSecret=32]="topSecret";class pn extends mW{}class po{constructor(a={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier,implicit:!0,context:0})],po.prototype,"type",void 0),nv([np({type:Y.Any,implicit:!0,context:1})],po.prototype,"value",void 0);class pp{constructor(a={}){this.policyId="",this.classList=new pn(ay.unclassified),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pp.prototype,"policyId",void 0),nv([np({type:pn,defaultValue:new pn(ay.unclassified)})],pp.prototype,"classList",void 0),nv([np({type:po,repeated:"set"})],pp.prototype,"securityCategories",void 0);class pq{constructor(a={}){Object.assign(this,a)}}nv([np({type:mX})],pq.prototype,"cotets",void 0),nv([np({type:Y.ObjectIdentifier})],pq.prototype,"oid",void 0),nv([np({type:Y.Utf8String})],pq.prototype,"string",void 0);class pr{constructor(a={}){this.values=[],Object.assign(this,a)}}nv([np({type:nZ,implicit:!0,context:0,optional:!0})],pr.prototype,"policyAuthority",void 0),nv([np({type:pq,repeated:"sequence"})],pr.prototype,"values",void 0);class ps{constructor(a={}){this.targetCertificate=new pf,Object.assign(this,a)}}nv([np({type:pf})],ps.prototype,"targetCertificate",void 0),nv([np({type:nH,optional:!0})],ps.prototype,"targetName",void 0),nv([np({type:pg,optional:!0})],ps.prototype,"certDigestInfo",void 0);let pt=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:nH,context:0,implicit:!0})],pt.prototype,"targetName",void 0),nv([np({type:nH,context:1,implicit:!0})],pt.prototype,"targetGroup",void 0),nv([np({type:ps,context:2,implicit:!0})],pt.prototype,"targetCert",void 0),pt=nv([no({type:X.Choice})],pt);let pu=az=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,az.prototype)}};pu=az=nv([no({type:X.Sequence,itemType:pt})],pu);let pv=aA=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aA.prototype)}};pv=aA=nv([no({type:X.Sequence,itemType:pu})],pv);class pw{constructor(a={}){Object.assign(this,a)}}nv([np({type:nZ,implicit:!0,context:0,optional:!0})],pw.prototype,"roleAuthority",void 0),nv([np({type:nH,implicit:!0,context:1})],pw.prototype,"roleName",void 0);class px{constructor(a={}){this.service=new nH,this.ident=new nH,Object.assign(this,a)}}nv([np({type:nH})],px.prototype,"service",void 0),nv([np({type:nH})],px.prototype,"ident",void 0),nv([np({type:mX,optional:!0})],px.prototype,"authInfo",void 0);class py{constructor(a={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],py.prototype,"otherCertFormat",void 0),nv([np({type:Y.Any})],py.prototype,"otherCert",void 0);let pz=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:oU})],pz.prototype,"certificate",void 0),nv([np({type:pm,context:2,implicit:!0})],pz.prototype,"v2AttrCert",void 0),nv([np({type:py,context:3,implicit:!0})],pz.prototype,"other",void 0),pz=nv([no({type:X.Choice})],pz);let pA=aB=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aB.prototype)}};pA=aB=nv([no({type:X.Set,itemType:pz})],pA);class pB{constructor(a={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pB.prototype,"contentType",void 0),nv([np({type:Y.Any,context:0})],pB.prototype,"content",void 0);let pC=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:mX})],pC.prototype,"single",void 0),nv([np({type:Y.Any})],pC.prototype,"any",void 0),pC=nv([no({type:X.Choice})],pC);class pD{constructor(a={}){this.eContentType="",Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pD.prototype,"eContentType",void 0),nv([np({type:pC,context:0,optional:!0})],pD.prototype,"eContent",void 0);let pE=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:mX,context:0,implicit:!0,optional:!0})],pE.prototype,"value",void 0),nv([np({type:mX,converter:{fromASN:a=>new mX(a.getValue()),toASN:a=>a.toASN()},context:0,implicit:!0,optional:!0,repeated:"sequence"})],pE.prototype,"constructedValue",void 0),pE=nv([no({type:X.Choice})],pE);class pF{constructor(a={}){this.contentType="",this.contentEncryptionAlgorithm=new o4,Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pF.prototype,"contentType",void 0),nv([np({type:o4})],pF.prototype,"contentEncryptionAlgorithm",void 0),nv([np({type:pE,optional:!0})],pF.prototype,"encryptedContent",void 0);class pG{constructor(a={}){this.keyAttrId="",Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pG.prototype,"keyAttrId",void 0),nv([np({type:Y.Any,optional:!0})],pG.prototype,"keyAttr",void 0);class pH{constructor(a={}){this.subjectKeyIdentifier=new oI,Object.assign(this,a)}}nv([np({type:oI})],pH.prototype,"subjectKeyIdentifier",void 0),nv([np({type:Y.GeneralizedTime,optional:!0})],pH.prototype,"date",void 0),nv([np({type:pG,optional:!0})],pH.prototype,"other",void 0);let pI=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:pH,context:0,implicit:!0,optional:!0})],pI.prototype,"rKeyId",void 0),nv([np({type:o_,optional:!0})],pI.prototype,"issuerAndSerialNumber",void 0),pI=nv([no({type:X.Choice})],pI);class pJ{constructor(a={}){this.rid=new pI,this.encryptedKey=new mX,Object.assign(this,a)}}nv([np({type:pI})],pJ.prototype,"rid",void 0),nv([np({type:mX})],pJ.prototype,"encryptedKey",void 0);let pK=aC=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aC.prototype)}};pK=aC=nv([no({type:X.Sequence,itemType:pJ})],pK);class pL{constructor(a={}){this.algorithm=new oN,this.publicKey=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:oN})],pL.prototype,"algorithm",void 0),nv([np({type:Y.BitString})],pL.prototype,"publicKey",void 0);let pM=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:oI,context:0,implicit:!0,optional:!0})],pM.prototype,"subjectKeyIdentifier",void 0),nv([np({type:pL,context:1,implicit:!0,optional:!0})],pM.prototype,"originatorKey",void 0),nv([np({type:o_,optional:!0})],pM.prototype,"issuerAndSerialNumber",void 0),pM=nv([no({type:X.Choice})],pM);class pN{constructor(a={}){this.version=at.v3,this.originator=new pM,this.keyEncryptionAlgorithm=new o3,this.recipientEncryptedKeys=new pK,Object.assign(this,a)}}nv([np({type:Y.Integer})],pN.prototype,"version",void 0),nv([np({type:pM,context:0})],pN.prototype,"originator",void 0),nv([np({type:mX,context:1,optional:!0})],pN.prototype,"ukm",void 0),nv([np({type:o3})],pN.prototype,"keyEncryptionAlgorithm",void 0),nv([np({type:pK})],pN.prototype,"recipientEncryptedKeys",void 0);let pO=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:oI,context:0,implicit:!0})],pO.prototype,"subjectKeyIdentifier",void 0),nv([np({type:o_})],pO.prototype,"issuerAndSerialNumber",void 0),pO=nv([no({type:X.Choice})],pO);class pP{constructor(a={}){this.version=at.v0,this.rid=new pO,this.keyEncryptionAlgorithm=new o3,this.encryptedKey=new mX,Object.assign(this,a)}}nv([np({type:Y.Integer})],pP.prototype,"version",void 0),nv([np({type:pO})],pP.prototype,"rid",void 0),nv([np({type:o3})],pP.prototype,"keyEncryptionAlgorithm",void 0),nv([np({type:mX})],pP.prototype,"encryptedKey",void 0);class pQ{constructor(a={}){this.keyIdentifier=new mX,Object.assign(this,a)}}nv([np({type:mX})],pQ.prototype,"keyIdentifier",void 0),nv([np({type:Y.GeneralizedTime,optional:!0})],pQ.prototype,"date",void 0),nv([np({type:pG,optional:!0})],pQ.prototype,"other",void 0);class pR{constructor(a={}){this.version=at.v4,this.kekid=new pQ,this.keyEncryptionAlgorithm=new o3,this.encryptedKey=new mX,Object.assign(this,a)}}nv([np({type:Y.Integer})],pR.prototype,"version",void 0),nv([np({type:pQ})],pR.prototype,"kekid",void 0),nv([np({type:o3})],pR.prototype,"keyEncryptionAlgorithm",void 0),nv([np({type:mX})],pR.prototype,"encryptedKey",void 0);class pS{constructor(a={}){this.version=at.v0,this.keyEncryptionAlgorithm=new o3,this.encryptedKey=new mX,Object.assign(this,a)}}nv([np({type:Y.Integer})],pS.prototype,"version",void 0),nv([np({type:o6,context:0,optional:!0})],pS.prototype,"keyDerivationAlgorithm",void 0),nv([np({type:o3})],pS.prototype,"keyEncryptionAlgorithm",void 0),nv([np({type:mX})],pS.prototype,"encryptedKey",void 0);class pT{constructor(a={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pT.prototype,"oriType",void 0),nv([np({type:Y.Any})],pT.prototype,"oriValue",void 0);let pU=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:pP,optional:!0})],pU.prototype,"ktri",void 0),nv([np({type:pN,context:1,implicit:!0,optional:!0})],pU.prototype,"kari",void 0),nv([np({type:pR,context:2,implicit:!0,optional:!0})],pU.prototype,"kekri",void 0),nv([np({type:pS,context:3,implicit:!0,optional:!0})],pU.prototype,"pwri",void 0),nv([np({type:pT,context:4,implicit:!0,optional:!0})],pU.prototype,"ori",void 0),pU=nv([no({type:X.Choice})],pU);let pV=aD=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aD.prototype)}};pV=aD=nv([no({type:X.Set,itemType:pU})],pV);class pW{constructor(a={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],pW.prototype,"otherRevInfoFormat",void 0),nv([np({type:Y.Any})],pW.prototype,"otherRevInfo",void 0);let pX=class{constructor(a={}){this.other=new pW,Object.assign(this,a)}};nv([np({type:pW,context:1,implicit:!0})],pX.prototype,"other",void 0),pX=nv([no({type:X.Choice})],pX);let pY=aE=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aE.prototype)}};pY=aE=nv([no({type:X.Set,itemType:pX})],pY);class pZ{constructor(a={}){Object.assign(this,a)}}nv([np({type:pA,context:0,implicit:!0,optional:!0})],pZ.prototype,"certs",void 0),nv([np({type:pY,context:1,implicit:!0,optional:!0})],pZ.prototype,"crls",void 0);let p$=aF=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aF.prototype)}};p$=aF=nv([no({type:X.Set,itemType:o7})],p$);class p_{constructor(a={}){this.version=at.v0,this.recipientInfos=new pV,this.encryptedContentInfo=new pF,Object.assign(this,a)}}nv([np({type:Y.Integer})],p_.prototype,"version",void 0),nv([np({type:pZ,context:0,implicit:!0,optional:!0})],p_.prototype,"originatorInfo",void 0),nv([np({type:pV})],p_.prototype,"recipientInfos",void 0),nv([np({type:pF})],p_.prototype,"encryptedContentInfo",void 0),nv([np({type:p$,context:1,implicit:!0,optional:!0})],p_.prototype,"unprotectedAttrs",void 0);let p0=aG=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aG.prototype)}};p0=aG=nv([no({type:X.Set,itemType:o1})],p0);class p1{constructor(a={}){this.version=at.v0,this.digestAlgorithms=new p0,this.encapContentInfo=new pD,this.signerInfos=new o9,Object.assign(this,a)}}nv([np({type:Y.Integer})],p1.prototype,"version",void 0),nv([np({type:p0})],p1.prototype,"digestAlgorithms",void 0),nv([np({type:pD})],p1.prototype,"encapContentInfo",void 0),nv([np({type:pA,context:0,implicit:!0,optional:!0})],p1.prototype,"certificates",void 0),nv([np({type:pY,context:1,implicit:!0,optional:!0})],p1.prototype,"crls",void 0),nv([np({type:o9})],p1.prototype,"signerInfos",void 0);let p2="1.2.840.10045.2.1",p3="1.2.840.10045.4.1",p4="1.2.840.10045.4.3.1",p5="1.2.840.10045.4.3.2",p6="1.2.840.10045.4.3.3",p7="1.2.840.10045.4.3.4",p8="1.2.840.10045.3.1.7",p9="1.3.132.0.34",qa="1.3.132.0.35";function qb(a){return new oN({algorithm:a})}let qc=qb(p3);qb(p4);let qd=qb(p5),qe=qb(p6),qf=qb(p7),qg=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:Y.ObjectIdentifier})],qg.prototype,"fieldType",void 0),nv([np({type:Y.Any})],qg.prototype,"parameters",void 0),qg=nv([no({type:X.Sequence})],qg);let qh=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:Y.OctetString})],qh.prototype,"a",void 0),nv([np({type:Y.OctetString})],qh.prototype,"b",void 0),nv([np({type:Y.BitString,optional:!0})],qh.prototype,"seed",void 0),qh=nv([no({type:X.Sequence})],qh),(F=aH||(aH={}))[F.ecpVer1=1]="ecpVer1";let qi=class{constructor(a={}){this.version=aH.ecpVer1,Object.assign(this,a)}};nv([np({type:Y.Integer})],qi.prototype,"version",void 0),nv([np({type:qg})],qi.prototype,"fieldID",void 0),nv([np({type:qh})],qi.prototype,"curve",void 0),nv([np({type:class extends mX{}})],qi.prototype,"base",void 0),nv([np({type:Y.Integer,converter:m_})],qi.prototype,"order",void 0),nv([np({type:Y.Integer,optional:!0})],qi.prototype,"cofactor",void 0),qi=nv([no({type:X.Sequence})],qi);let qj=class{constructor(a={}){Object.assign(this,a)}};nv([np({type:Y.ObjectIdentifier})],qj.prototype,"namedCurve",void 0),nv([np({type:Y.Null})],qj.prototype,"implicitCurve",void 0),nv([np({type:qi})],qj.prototype,"specifiedCurve",void 0),qj=nv([no({type:X.Choice})],qj);class qk{constructor(a={}){this.version=1,this.privateKey=new mX,Object.assign(this,a)}}nv([np({type:Y.Integer})],qk.prototype,"version",void 0),nv([np({type:mX})],qk.prototype,"privateKey",void 0),nv([np({type:qj,context:0,optional:!0})],qk.prototype,"parameters",void 0),nv([np({type:Y.BitString,context:1,optional:!0})],qk.prototype,"publicKey",void 0);class ql{constructor(a={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.Integer,converter:m_})],ql.prototype,"r",void 0),nv([np({type:Y.Integer,converter:m_})],ql.prototype,"s",void 0);let qm="1.2.840.113549.1.1",qn=`${qm}.1`,qo=`${qm}.7`,qp=`${qm}.9`,qq=`${qm}.10`,qr=`${qm}.2`,qs=`${qm}.4`,qt=`${qm}.5`,qu=`${qm}.14`,qv=`${qm}.11`,qw=`${qm}.12`,qx=`${qm}.13`,qy=`${qm}.15`,qz=`${qm}.16`,qA="1.3.14.3.2.26",qB="2.16.840.1.101.3.4.2.4",qC="2.16.840.1.101.3.4.2.1",qD="2.16.840.1.101.3.4.2.2",qE="2.16.840.1.101.3.4.2.3",qF=`${qm}.8`;function qG(a){return new oN({algorithm:a,parameters:null})}qG("1.2.840.113549.2.2"),qG("1.2.840.113549.2.5");let qH=qG(qA);qG(qB),qG(qC),qG(qD),qG(qE),qG("2.16.840.1.101.3.4.2.5"),qG("2.16.840.1.101.3.4.2.6");let qI=new oN({algorithm:qF,parameters:nu.serialize(qH)}),qJ=new oN({algorithm:qp,parameters:nu.serialize(m3.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});qG(qn),qG(qr),qG(qs),qG(qt),qG(qy),qG(qz),qG(qw),qG(qx),qG(qy),qG(qz);class qK{constructor(a={}){this.hashAlgorithm=new oN(qH),this.maskGenAlgorithm=new oN({algorithm:qF,parameters:nu.serialize(qH)}),this.pSourceAlgorithm=new oN(qJ),Object.assign(this,a)}}nv([np({type:oN,context:0,defaultValue:qH})],qK.prototype,"hashAlgorithm",void 0),nv([np({type:oN,context:1,defaultValue:qI})],qK.prototype,"maskGenAlgorithm",void 0),nv([np({type:oN,context:2,defaultValue:qJ})],qK.prototype,"pSourceAlgorithm",void 0),new oN({algorithm:qo,parameters:nu.serialize(new qK)});class qL{constructor(a={}){this.hashAlgorithm=new oN(qH),this.maskGenAlgorithm=new oN({algorithm:qF,parameters:nu.serialize(qH)}),this.saltLength=20,this.trailerField=1,Object.assign(this,a)}}nv([np({type:oN,context:0,defaultValue:qH})],qL.prototype,"hashAlgorithm",void 0),nv([np({type:oN,context:1,defaultValue:qI})],qL.prototype,"maskGenAlgorithm",void 0),nv([np({type:Y.Integer,context:2,defaultValue:20})],qL.prototype,"saltLength",void 0),nv([np({type:Y.Integer,context:3,defaultValue:1})],qL.prototype,"trailerField",void 0),new oN({algorithm:qq,parameters:nu.serialize(new qL)});class qM{constructor(a={}){this.digestAlgorithm=new oN,this.digest=new mX,Object.assign(this,a)}}nv([np({type:oN})],qM.prototype,"digestAlgorithm",void 0),nv([np({type:mX})],qM.prototype,"digest",void 0);class qN{constructor(a={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.Integer,converter:m_})],qN.prototype,"prime",void 0),nv([np({type:Y.Integer,converter:m_})],qN.prototype,"exponent",void 0),nv([np({type:Y.Integer,converter:m_})],qN.prototype,"coefficient",void 0);let qO=aI=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aI.prototype)}};qO=aI=nv([no({type:X.Sequence,itemType:qN})],qO);class qP{constructor(a={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.Integer})],qP.prototype,"version",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"modulus",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"publicExponent",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"privateExponent",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"prime1",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"prime2",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"exponent1",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"exponent2",void 0),nv([np({type:Y.Integer,converter:m_})],qP.prototype,"coefficient",void 0),nv([np({type:qO,optional:!0})],qP.prototype,"otherPrimeInfos",void 0);class qQ{constructor(a={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.Integer,converter:m_})],qQ.prototype,"modulus",void 0),nv([np({type:Y.Integer,converter:m_})],qQ.prototype,"publicExponent",void 0),(G=aJ||(aJ={}))[G.Transient=0]="Transient",G[G.Singleton=1]="Singleton",G[G.ResolutionScoped=2]="ResolutionScoped",G[G.ContainerScoped=3]="ContainerScoped";let qR=aJ;var qS=function(a,b){return(qS=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)};function qT(a,b){function c(){this.constructor=a}qS(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}function qU(a){var b="function"==typeof Symbol&&Symbol.iterator,c=b&&a[b],d=0;if(c)return c.call(a);if(a&&"number"==typeof a.length)return{next:function(){return a&&d>=a.length&&(a=void 0),{value:a&&a[d++],done:!a}}};throw TypeError(b?"Object is not iterable.":"Symbol.iterator is not defined.")}function qV(a,b){var c="function"==typeof Symbol&&a[Symbol.iterator];if(!c)return a;var d,e,f=c.call(a),g=[];try{for(;(void 0===b||b-- >0)&&!(d=f.next()).done;)g.push(d.value)}catch(a){e={error:a}}finally{try{d&&!d.done&&(c=f.return)&&c.call(f)}finally{if(e)throw e.error}}return g}function qW(){for(var a=[],b=0;b<arguments.length;b++)a=a.concat(qV(arguments[b]));return a}function qX(a){return!!a.useClass}function qY(a){return!!a.useFactory}var qZ=function(){function a(a){this.wrap=a,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return a.prototype.createProxy=function(a){var b,c=this,d=!1;return new Proxy({},this.createHandler(function(){return d||(b=a(c.wrap()),d=!0),b}))},a.prototype.createHandler=function(a){var b={};return this.reflectMethods.forEach(function(c){b[c]=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];return b[0]=a(),Reflect[c].apply(void 0,qW(b))}}),b},a}();function q$(a){return"string"==typeof a||"symbol"==typeof a}function q_(a){return"object"==typeof a&&"token"in a&&"transform"in a}function q0(a){return!!a.useToken}function q1(a){return void 0!=a.useValue}var q2=function(){function a(){this._registryMap=new Map}return a.prototype.entries=function(){return this._registryMap.entries()},a.prototype.getAll=function(a){return this.ensure(a),this._registryMap.get(a)},a.prototype.get=function(a){this.ensure(a);var b=this._registryMap.get(a);return b[b.length-1]||null},a.prototype.set=function(a,b){this.ensure(a),this._registryMap.get(a).push(b)},a.prototype.setAll=function(a,b){this._registryMap.set(a,b)},a.prototype.has=function(a){return this.ensure(a),this._registryMap.get(a).length>0},a.prototype.clear=function(){this._registryMap.clear()},a.prototype.ensure=function(a){this._registryMap.has(a)||this._registryMap.set(a,[])},a}(),q3=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return qT(b,a),b}(q2);let q4=function(){this.scopedResolutions=new Map};var q5=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return qT(b,a),b}(q2),q6=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}return qT(b,a),b}(q2);let q7=function(){this.preResolution=new q5,this.postResolution=new q6};var q8=new Map,q9=new(function(){function a(a){this.parent=a,this._registry=new q3,this.interceptors=new q7,this.disposed=!1,this.disposables=new Set}return a.prototype.register=function(a,b,c){if(void 0===c&&(c={lifecycle:qR.Transient}),this.ensureNotDisposed(),d=qX(b)||q1(b)||q0(b)||qY(b)?b:{useClass:b},q0(d))for(var d,e=[a],f=d;null!=f;){var g=f.useToken;if(e.includes(g))throw Error("Token registration cycle detected! "+qW(e,[g]).join(" -> "));e.push(g);var h=this._registry.get(g);f=h&&q0(h.provider)?h.provider:null}if((c.lifecycle===qR.Singleton||c.lifecycle==qR.ContainerScoped||c.lifecycle==qR.ResolutionScoped)&&(q1(d)||qY(d)))throw Error('Cannot use lifecycle "'+qR[c.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(a,{provider:d,options:c}),this},a.prototype.registerType=function(a,b){return(this.ensureNotDisposed(),q$(b))?this.register(a,{useToken:b}):this.register(a,{useClass:b})},a.prototype.registerInstance=function(a,b){return this.ensureNotDisposed(),this.register(a,{useValue:b})},a.prototype.registerSingleton=function(a,b){if(this.ensureNotDisposed(),q$(a)){if(q$(b))return this.register(a,{useToken:b},{lifecycle:qR.Singleton});if(b)return this.register(a,{useClass:b},{lifecycle:qR.Singleton});throw Error('Cannot register a type name as a singleton without a "to" token')}var c=a;return b&&!q$(b)&&(c=b),this.register(a,{useClass:c},{lifecycle:qR.Singleton})},a.prototype.resolve=function(a,b,c){void 0===b&&(b=new q4),void 0===c&&(c=!1),this.ensureNotDisposed();var d=this.getRegistration(a);if(!d&&q$(a)){if(c)return;throw Error('Attempted to resolve unregistered dependency token: "'+a.toString()+'"')}if(this.executePreResolutionInterceptor(a,"Single"),d){var e=this.resolveRegistration(d,b);return this.executePostResolutionInterceptor(a,e,"Single"),e}if("function"==typeof a||a instanceof qZ){var e=this.construct(a,b);return this.executePostResolutionInterceptor(a,e,"Single"),e}throw Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},a.prototype.executePreResolutionInterceptor=function(a,b){var c,d;if(this.interceptors.preResolution.has(a)){var e=[];try{for(var f=qU(this.interceptors.preResolution.getAll(a)),g=f.next();!g.done;g=f.next()){var h=g.value;"Once"!=h.options.frequency&&e.push(h),h.callback(a,b)}}catch(a){c={error:a}}finally{try{g&&!g.done&&(d=f.return)&&d.call(f)}finally{if(c)throw c.error}}this.interceptors.preResolution.setAll(a,e)}},a.prototype.executePostResolutionInterceptor=function(a,b,c){var d,e;if(this.interceptors.postResolution.has(a)){var f=[];try{for(var g=qU(this.interceptors.postResolution.getAll(a)),h=g.next();!h.done;h=g.next()){var i=h.value;"Once"!=i.options.frequency&&f.push(i),i.callback(a,b,c)}}catch(a){d={error:a}}finally{try{h&&!h.done&&(e=g.return)&&e.call(g)}finally{if(d)throw d.error}}this.interceptors.postResolution.setAll(a,f)}},a.prototype.resolveRegistration=function(a,b){if(this.ensureNotDisposed(),a.options.lifecycle===qR.ResolutionScoped&&b.scopedResolutions.has(a))return b.scopedResolutions.get(a);var c,d=a.options.lifecycle===qR.Singleton,e=a.options.lifecycle===qR.ContainerScoped,f=d||e;return c=q1(a.provider)?a.provider.useValue:q0(a.provider)?f?a.instance||(a.instance=this.resolve(a.provider.useToken,b)):this.resolve(a.provider.useToken,b):qX(a.provider)?f?a.instance||(a.instance=this.construct(a.provider.useClass,b)):this.construct(a.provider.useClass,b):qY(a.provider)?a.provider.useFactory(this):this.construct(a.provider,b),a.options.lifecycle===qR.ResolutionScoped&&b.scopedResolutions.set(a,c),c},a.prototype.resolveAll=function(a,b,c){var d=this;void 0===b&&(b=new q4),void 0===c&&(c=!1),this.ensureNotDisposed();var e=this.getAllRegistrations(a);if(!e&&q$(a)){if(c)return[];throw Error('Attempted to resolve unregistered dependency token: "'+a.toString()+'"')}if(this.executePreResolutionInterceptor(a,"All"),e){var f=e.map(function(a){return d.resolveRegistration(a,b)});return this.executePostResolutionInterceptor(a,f,"All"),f}var g=[this.construct(a,b)];return this.executePostResolutionInterceptor(a,g,"All"),g},a.prototype.isRegistered=function(a,b){return void 0===b&&(b=!1),this.ensureNotDisposed(),this._registry.has(a)||b&&(this.parent||!1)&&this.parent.isRegistered(a,!0)},a.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},a.prototype.clearInstances=function(){var a,b;this.ensureNotDisposed();try{for(var c=qU(this._registry.entries()),d=c.next();!d.done;d=c.next()){var e=qV(d.value,2),f=e[0],g=e[1];this._registry.setAll(f,g.filter(function(a){return!q1(a.provider)}).map(function(a){return a.instance=void 0,a}))}}catch(b){a={error:b}}finally{try{d&&!d.done&&(b=c.return)&&b.call(c)}finally{if(a)throw a.error}}},a.prototype.createChildContainer=function(){this.ensureNotDisposed();var b,c,d=new a(this);try{for(var e=qU(this._registry.entries()),f=e.next();!f.done;f=e.next()){var g=qV(f.value,2),h=g[0],i=g[1];i.some(function(a){return a.options.lifecycle===qR.ContainerScoped})&&d._registry.setAll(h,i.map(function(a){return a.options.lifecycle===qR.ContainerScoped?{provider:a.provider,options:a.options}:a}))}}catch(a){b={error:a}}finally{try{f&&!f.done&&(c=e.return)&&c.call(e)}finally{if(b)throw b.error}}return d},a.prototype.beforeResolution=function(a,b,c){void 0===c&&(c={frequency:"Always"}),this.interceptors.preResolution.set(a,{callback:b,options:c})},a.prototype.afterResolution=function(a,b,c){void 0===c&&(c={frequency:"Always"}),this.interceptors.postResolution.set(a,{callback:b,options:c})},a.prototype.dispose=function(){var a,b,c,d;return a=this,b=void 0,c=void 0,d=function(){var a;return function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}}(this,function(b){switch(b.label){case 0:return this.disposed=!0,a=[],this.disposables.forEach(function(b){var c=b.dispose();c&&a.push(c)}),[4,Promise.all(a)];case 1:return b.sent(),[2]}})},new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})},a.prototype.getRegistration=function(a){return this.isRegistered(a)?this._registry.get(a):this.parent?this.parent.getRegistration(a):null},a.prototype.getAllRegistrations=function(a){return this.isRegistered(a)?this._registry.getAll(a):this.parent?this.parent.getAllRegistrations(a):null},a.prototype.construct=function(a,b){var c=this;if(a instanceof qZ)return a.createProxy(function(a){return c.resolve(a,b)});var d=function(){var d=q8.get(a);if(!d||0===d.length)if(0===a.length)return new a;else throw Error('TypeInfo not known for "'+a.name+'"');var e=d.map(c.resolveParams(b,a));return new(a.bind.apply(a,qW([void 0],e)))}();return"function"!=typeof d.dispose||d.dispose.length>0||this.disposables.add(d),d},a.prototype.resolveParams=function(a,b){var c=this;return function(d,e){var f,g,h,i,j,k,l;try{if("object"==typeof d&&"token"in d&&"multiple"in d)if(q_(d))return d.multiple?(f=c.resolve(d.transform)).transform.apply(f,qW([c.resolveAll(d.token,new q4,d.isOptional)],d.transformArgs)):(g=c.resolve(d.transform)).transform.apply(g,qW([c.resolve(d.token,a,d.isOptional)],d.transformArgs));else return d.multiple?c.resolveAll(d.token,new q4,d.isOptional):c.resolve(d.token,a,d.isOptional);if(q_(d))return(h=c.resolve(d.transform,a)).transform.apply(h,qW([c.resolve(d.token,a)],d.transformArgs));return c.resolve(d,a)}catch(a){throw Error((k="Cannot inject the dependency "+(j=void 0===(i=qV(b.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1])?null:i,null===j?"at position #"+e:'"'+j.split(",")[e].trim()+'" at position #'+e)+' of "'+b.name+'" constructor. Reason:',void 0===l&&(l="    "),qW([k],a.message.split("\n").map(function(a){return l+a})).join("\n")))}}},a.prototype.ensureNotDisposed=function(){if(this.disposed)throw Error("This container has been disposed, you cannot interact with a disposed container")},a}());let ra=function(a){return function(b){var c,d;q8.set(b,(c=Reflect.getMetadata("design:paramtypes",b)||[],Object.keys(d=Reflect.getOwnMetadata("injectionTokens",b)||{}).forEach(function(a){c[+a]=d[a]}),c)),a&&a.token&&(Array.isArray(a.token)?a.token.forEach(function(a){q9.register(a,b)}):q9.register(a.token,b))}};if(a.s([],54484),"u"<typeof Reflect||!Reflect.getMetadata)throw Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.");a.i(54484);class rb{constructor(a={}){this.attrId="",this.attrValues=[],Object.assign(a)}}nv([np({type:Y.ObjectIdentifier})],rb.prototype,"attrId",void 0),nv([np({type:Y.Any,repeated:"set"})],rb.prototype,"attrValues",void 0);let rc=aK=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aK.prototype)}};rc=aK=nv([no({type:X.Sequence,itemType:rb})],rc);let rd=aL=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aL.prototype)}};rd=aL=nv([no({type:X.Sequence,itemType:pB})],rd);class re{constructor(a={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],re.prototype,"certId",void 0),nv([np({type:Y.Any,context:0})],re.prototype,"certValue",void 0);class rf{constructor(a={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],rf.prototype,"crlId",void 0),nv([np({type:Y.Any,context:0})],rf.prototype,"crltValue",void 0);class rg extends mX{}class rh{constructor(a={}){this.encryptionAlgorithm=new oN,this.encryptedData=new rg,Object.assign(this,a)}}nv([np({type:oN})],rh.prototype,"encryptionAlgorithm",void 0),nv([np({type:rg})],rh.prototype,"encryptedData",void 0),(H=aN||(aN={}))[H.v1=0]="v1";class ri extends mX{}let rj=aM=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aM.prototype)}};rj=aM=nv([no({type:X.Sequence,itemType:oF})],rj);class rk{constructor(a={}){this.version=aN.v1,this.privateKeyAlgorithm=new oN,this.privateKey=new ri,Object.assign(this,a)}}nv([np({type:Y.Integer})],rk.prototype,"version",void 0),nv([np({type:oN})],rk.prototype,"privateKeyAlgorithm",void 0),nv([np({type:ri})],rk.prototype,"privateKey",void 0),nv([np({type:rj,implicit:!0,context:0,optional:!0})],rk.prototype,"attributes",void 0);let rl=class extends rk{};rl=nv([no({type:X.Sequence})],rl);let rm=class extends rh{};rm=nv([no({type:X.Sequence})],rm);class rn{constructor(a={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],rn.prototype,"secretTypeId",void 0),nv([np({type:Y.Any,context:0})],rn.prototype,"secretValue",void 0);class ro{constructor(a={}){this.mac=new qM,this.macSalt=new mX,this.iterations=1,Object.assign(this,a)}}nv([np({type:qM})],ro.prototype,"mac",void 0),nv([np({type:mX})],ro.prototype,"macSalt",void 0),nv([np({type:Y.Integer,defaultValue:1})],ro.prototype,"iterations",void 0);class rp{constructor(a={}){this.version=3,this.authSafe=new pB,this.macData=new ro,Object.assign(this,a)}}nv([np({type:Y.Integer})],rp.prototype,"version",void 0),nv([np({type:pB})],rp.prototype,"authSafe",void 0),nv([np({type:ro,optional:!0})],rp.prototype,"macData",void 0);class rq{constructor(a={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:Y.ObjectIdentifier})],rq.prototype,"bagId",void 0),nv([np({type:Y.Any,context:0})],rq.prototype,"bagValue",void 0),nv([np({type:rb,repeated:"set",optional:!0})],rq.prototype,"bagAttributes",void 0);let rr=aO=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aO.prototype)}};rr=aO=nv([no({type:X.Sequence,itemType:rq})],rr);let rs="1.2.840.113549.1.9",rt=`${rs}.7`,ru=`${rs}.14`,rv=class extends nz{constructor(a={}){super(a)}toString(){return({}).toString(),this.ia5String||super.toString()}};nv([np({type:Y.IA5String})],rv.prototype,"ia5String",void 0),rv=nv([no({type:X.Choice})],rv);let rw=class extends pB{};rw=nv([no({type:X.Sequence})],rw);let rx=class extends rp{};rx=nv([no({type:X.Sequence})],rx);let ry=class extends rh{};ry=nv([no({type:X.Sequence})],ry);let rz=class{constructor(a=""){this.value=a}toString(){return this.value}};nv([np({type:Y.IA5String})],rz.prototype,"value",void 0),rz=nv([no({type:X.Choice})],rz);let rA=class extends rv{};rA=nv([no({type:X.Choice})],rA);let rB=class extends nz{};rB=nv([no({type:X.Choice})],rB);let rC=class{constructor(a=new Date){this.value=a}};nv([np({type:Y.GeneralizedTime})],rC.prototype,"value",void 0),rC=nv([no({type:X.Choice})],rC);let rD=class extends nz{};rD=nv([no({type:X.Choice})],rD);let rE=class{constructor(a="M"){this.value=a}toString(){return this.value}};nv([np({type:Y.PrintableString})],rE.prototype,"value",void 0),rE=nv([no({type:X.Choice})],rE);let rF=class{constructor(a=""){this.value=a}toString(){return this.value}};nv([np({type:Y.PrintableString})],rF.prototype,"value",void 0),rF=nv([no({type:X.Choice})],rF);let rG=class extends rF{};rG=nv([no({type:X.Choice})],rG);let rH=class extends nz{};rH=nv([no({type:X.Choice})],rH);let rI=class{constructor(a=""){this.value=a}toString(){return this.value}};nv([np({type:Y.ObjectIdentifier})],rI.prototype,"value",void 0),rI=nv([no({type:X.Choice})],rI);let rJ=class extends oP{};rJ=nv([no({type:X.Choice})],rJ);let rK=class{constructor(a=0){this.value=a}toString(){return this.value.toString()}};nv([np({type:Y.Integer})],rK.prototype,"value",void 0),rK=nv([no({type:X.Choice})],rK);let rL=class extends o8{};rL=nv([no({type:X.Sequence})],rL);let rM=class extends nz{};rM=nv([no({type:X.Choice})],rM);let rN=aP=class extends oS{constructor(a){super(a),Object.setPrototypeOf(this,aP.prototype)}};rN=aP=nv([no({type:X.Sequence})],rN);let rO=aQ=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aQ.prototype)}};rO=aQ=nv([no({type:X.Set,itemType:o7})],rO);let rP=class{constructor(a=""){this.value=a}toString(){return this.value}};nv([np({type:Y.BmpString})],rP.prototype,"value",void 0),rP=nv([no({type:X.Choice})],rP);let rQ=class extends oN{};rQ=nv([no({type:X.Sequence})],rQ);let rR=aR=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aR.prototype)}};rR=aR=nv([no({type:X.Sequence,itemType:rQ})],rR);let rS=aS=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,aS.prototype)}};rS=aS=nv([no({type:X.Sequence,itemType:oF})],rS);class rT{constructor(a={}){this.version=0,this.subject=new nE,this.subjectPKInfo=new oO,this.attributes=new rS,Object.assign(this,a)}}nv([np({type:Y.Integer})],rT.prototype,"version",void 0),nv([np({type:nE})],rT.prototype,"subject",void 0),nv([np({type:oO})],rT.prototype,"subjectPKInfo",void 0),nv([np({type:rS,implicit:!0,context:0,optional:!0})],rT.prototype,"attributes",void 0);class rU{constructor(a={}){this.certificationRequestInfo=new rT,this.signatureAlgorithm=new oN,this.signature=new ArrayBuffer(0),Object.assign(this,a)}}nv([np({type:rT,raw:!0})],rU.prototype,"certificationRequestInfo",void 0),nv([np({type:oN})],rU.prototype,"signatureAlgorithm",void 0),nv([np({type:Y.BitString})],rU.prototype,"signature",void 0);let rV="crypto.algorithm",rW="crypto.algorithmProvider";q9.registerSingleton(rW,class{getAlgorithms(){return q9.resolveAll(rV)}toAsnAlgorithm(a){for(let b of({...a},this.getAlgorithms())){let c=b.toAsnAlgorithm(a);if(c)return c}if(/^[0-9.]+$/.test(a.name)){let b=new oN({algorithm:a.name});return"parameters"in a&&(b.parameters=a.parameters),b}throw Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(a){for(let b of this.getAlgorithms()){let c=b.toWebAlgorithm(a);if(c)return c}return{name:a.algorithm,parameters:a.parameters}}});let rX="1.3.36.3.3.2.8.1.1",rY=`${rX}.1`,rZ=`${rX}.2`,r$=`${rX}.3`,r_=`${rX}.4`,r0=`${rX}.5`,r1=`${rX}.6`,r2=`${rX}.7`,r3=`${rX}.8`,r4=`${rX}.9`,r5=`${rX}.10`,r6=`${rX}.11`,r7=`${rX}.12`,r8=`${rX}.13`,r9=`${rX}.14`,sa="brainpoolP160r1",sb="brainpoolP160t1",sc="brainpoolP192r1",sd="brainpoolP192t1",se="brainpoolP224r1",sf="brainpoolP224t1",sg="brainpoolP256r1",sh="brainpoolP256t1",si="brainpoolP320r1",sj="brainpoolP320t1",sk="brainpoolP384r1",sl="brainpoolP384t1",sm="brainpoolP512r1",sn="brainpoolP512t1",so="ECDSA",sp=aT=class{toAsnAlgorithm(a){if(a.name.toLowerCase()===so.toLowerCase()){if("hash"in a)switch(("string"==typeof a.hash?a.hash:a.hash.name).toLowerCase()){case"sha-1":return qc;case"sha-256":return qd;case"sha-384":return qe;case"sha-512":return qf}else if("namedCurve"in a){let b="";switch(a.namedCurve){case"P-256":b=p8;break;case"K-256":b=aT.SECP256K1;break;case"P-384":b=p9;break;case"P-521":b=qa;break;case sa:b=rY;break;case sb:b=rZ;break;case sc:b=r$;break;case sd:b=r_;break;case se:b=r0;break;case sf:b=r1;break;case sg:b=r2;break;case sh:b=r3;break;case si:b=r4;break;case sj:b=r5;break;case sk:b=r6;break;case sl:b=r7;break;case sm:b=r8;break;case sn:b=r9}if(b)return new oN({algorithm:p2,parameters:nu.serialize(new qj({namedCurve:b}))})}}return null}toWebAlgorithm(a){switch(a.algorithm){case p3:return{name:so,hash:{name:"SHA-1"}};case p5:return{name:so,hash:{name:"SHA-256"}};case p6:return{name:so,hash:{name:"SHA-384"}};case p7:return{name:so,hash:{name:"SHA-512"}};case p2:if(!a.parameters)throw TypeError("Cannot get required parameters from EC algorithm");switch(nu.parse(a.parameters,qj).namedCurve){case p8:return{name:so,namedCurve:"P-256"};case aT.SECP256K1:return{name:so,namedCurve:"K-256"};case p9:return{name:so,namedCurve:"P-384"};case qa:return{name:so,namedCurve:"P-521"};case rY:return{name:so,namedCurve:sa};case rZ:return{name:so,namedCurve:sb};case r$:return{name:so,namedCurve:sc};case r_:return{name:so,namedCurve:sd};case r0:return{name:so,namedCurve:se};case r1:return{name:so,namedCurve:sf};case r2:return{name:so,namedCurve:sg};case r3:return{name:so,namedCurve:sh};case r4:return{name:so,namedCurve:si};case r5:return{name:so,namedCurve:sj};case r6:return{name:so,namedCurve:sk};case r7:return{name:so,namedCurve:sl};case r8:return{name:so,namedCurve:sm};case r9:return{name:so,namedCurve:sn}}}return null}};sp.SECP256K1="1.3.132.0.10",sp=aT=nv([ra()],sp),q9.registerSingleton(rV,sp);let sq=Symbol("name"),sr=Symbol("value");class ss{constructor(a,b={},c=""){for(const d in this[sq]=a,this[sr]=c,b)this[d]=b[d]}}ss.NAME=sq,ss.VALUE=sr;class st{static toString(a){let b=this.items[a];return b||a}}st.items={[qA]:"sha1",[qB]:"sha224",[qC]:"sha256",[qD]:"sha384",[qE]:"sha512",[qn]:"rsaEncryption",[qt]:"sha1WithRSAEncryption",[qu]:"sha224WithRSAEncryption",[qv]:"sha256WithRSAEncryption",[qw]:"sha384WithRSAEncryption",[qx]:"sha512WithRSAEncryption",[p2]:"ecPublicKey",[p3]:"ecdsaWithSHA1",[p4]:"ecdsaWithSHA224",[p5]:"ecdsaWithSHA256",[p6]:"ecdsaWithSHA384",[p7]:"ecdsaWithSHA512",[ok]:"TLS WWW server authentication",[ol]:"TLS WWW client authentication",[om]:"Code Signing",[on]:"E-mail Protection",[oo]:"Time Stamping",[op]:"OCSP Signing","1.2.840.113549.1.7.2":"Signed Data"};class su{static serialize(a){return this.serializeObj(a).join("\n")}static pad(a=0){return"".padStart(2*a," ")}static serializeObj(a,b=0){let c=[],d=this.pad(b++),e="",f=a[ss.VALUE];for(let g in f&&(e=` ${f}`),c.push(`${d}${a[ss.NAME]}:${e}`),d=this.pad(b),a){if("symbol"==typeof g)continue;let e=a[g],f=g?`${g}: `:"";if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)c.push(`${d}${f}${e}`);else if(e instanceof Date)c.push(`${d}${f}${e.toUTCString()}`);else if(Array.isArray(e))for(let a of e)a[ss.NAME]=g,c.push(...this.serializeObj(a,b));else if(e instanceof ss)e[ss.NAME]=g,c.push(...this.serializeObj(e,b));else if(lt.isBufferSource(e))g?(c.push(`${d}${f}`),c.push(...this.serializeBufferSource(e,b+1))):c.push(...this.serializeBufferSource(e,b));else if("toTextObject"in e){let a=e.toTextObject();a[ss.NAME]=g,c.push(...this.serializeObj(a,b))}else throw TypeError("Cannot serialize data in text format. Unsupported type.")}return c}static serializeBufferSource(a,b=0){let c=this.pad(b),d=lt.toUint8Array(a),e=[];for(let a=0;a<d.length;){let b=[];for(let c=0;c<16&&a<d.length;c++){8===c&&b.push("");let e=d[a++].toString(16).padStart(2,"0");b.push(e)}e.push(`${c}${b.join(" ")}`)}return e}static serializeAlgorithm(a){return this.algorithmSerializer.toTextObject(a)}}su.oidSerializer=st,su.algorithmSerializer=class{static toTextObject(a){let b=new ss("Algorithm Identifier",{},st.toString(a.algorithm));if(a.parameters)if(a.algorithm===p2){let c=new sp().toWebAlgorithm(a);c&&"namedCurve"in c?b["Named Curve"]=c.namedCurve:b.Parameters=a.parameters}else b.Parameters=a.parameters;return b}};class sv{get rawData(){return nw(this,aU,"f")||nx(this,aU,nu.serialize(this.asn),"f"),nw(this,aU,"f")}constructor(...a){aU.set(this,void 0),lt.isBufferSource(a[0])?(this.asn=nu.parse(a[0],a[1]),nx(this,aU,lt.toArrayBuffer(a[0]),"f")):this.asn=a[0],this.onInit(this.asn)}equal(a){return a instanceof sv&&lB(a.rawData,this.rawData)}toString(a="text"){switch(a){case"asn":return nu.toString(this.rawData);case"text":return su.serialize(this.toTextObject());case"hex":return lA.ToHex(this.rawData);case"base64":return lA.ToBase64(this.rawData);case"base64url":return lA.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){let a=this.toTextObjectEmpty();return a[""]=this.rawData,a}toTextObjectEmpty(a){return new ss(this.getTextName(),{},a)}}aU=new WeakMap,sv.NAME="ASN";class sw extends sv{constructor(...a){super(lt.isBufferSource(a[0])?lt.toArrayBuffer(a[0]):nu.serialize(new oR({extnID:a[0],critical:a[1],extnValue:new mX(lt.toArrayBuffer(a[2]))})),oR)}onInit(a){this.type=a.extnID,this.critical=a.critical,this.value=a.extnValue.buffer}toTextObject(){let a=this.toTextObjectWithoutValue();return a[""]=this.value,a}toTextObjectWithoutValue(){let a=this.toTextObjectEmpty(this.critical?"critical":void 0);return a[ss.NAME]===sw.NAME&&(a[ss.NAME]=st.toString(this.type)),a}}class sx{static isCryptoKeyPair(a){return a&&a.privateKey&&a.publicKey}static isCryptoKey(a){return a&&a.usages&&a.type&&a.algorithm&&void 0!==a.extractable}constructor(){this.items=new Map,this[aV]="CryptoProvider","u">typeof self&&"u">typeof crypto?this.set(sx.DEFAULT,crypto):a.g.crypto&&a.g.crypto.subtle&&this.set(sx.DEFAULT,a.g.crypto)}clear(){this.items.clear()}delete(a){return this.items.delete(a)}forEach(a,b){return this.items.forEach(a,b)}has(a){return this.items.has(a)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(a=sx.DEFAULT){let b=this.items.get(a.toLowerCase());if(!b)throw Error(`Cannot get Crypto by name '${a}'`);return b}set(a,b){if("string"==typeof a){if(!b)throw TypeError("Argument 'value' is required");this.items.set(a.toLowerCase(),b)}else this.items.set(sx.DEFAULT,a);return this}}aV=Symbol.toStringTag,sx.DEFAULT="default";let sy=new sx,sz=/^[0-2](?:\.[1-9][0-9]*)+$/;class sA{constructor(a={}){for(const b in this.items={},a)this.register(b,a[b])}get(a){return this.items[a]||null}findId(a){return new RegExp(sz).test(a)?a:this.get(a)}register(a,b){this.items[a]=b,this.items[b]=a}}let sB=new sA;function sC(a,b){return`\\${lA.ToHex(lA.FromUtf8String(b)).toUpperCase()}`}sB.register("CN","2.5.4.3"),sB.register("L","2.5.4.7"),sB.register("ST","2.5.4.8"),sB.register("O","2.5.4.10"),sB.register("OU","2.5.4.11"),sB.register("C","2.5.4.6"),sB.register("DC","0.9.2342.19200300.100.1.25"),sB.register("E","1.2.840.113549.1.9.1"),sB.register("G","2.5.4.42"),sB.register("I","2.5.4.43"),sB.register("SN","2.5.4.4"),sB.register("T","2.5.4.12");class sD{static isASCII(a){for(let b=0;b<a.length;b++)if(a.charCodeAt(b)>255)return!1;return!0}static isPrintableString(a){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(a)}constructor(a,b={}){for(const a in this.extraNames=new sA,this.asn=new nE,b)if(Object.prototype.hasOwnProperty.call(b,a)){const c=b[a];this.extraNames.register(a,c)}"string"==typeof a?this.asn=this.fromString(a):a instanceof nE?this.asn=a:lt.isBufferSource(a)?this.asn=nu.parse(a,nE):this.asn=this.fromJSON(a)}getField(a){let b=this.extraNames.findId(a)||sB.findId(a),c=[];for(let a of this.asn)for(let d of a)d.type===b&&c.push(d.value.toString());return c}getName(a){return this.extraNames.get(a)||sB.get(a)}toString(){return this.asn.map(a=>a.map(a=>{let b=this.getName(a.type)||a.type,c=a.value.anyValue?`#${lA.ToHex(a.value.anyValue)}`:a.value.toString().replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,sC);return`${b}=${c}`}).join("+")).join(", ")}toJSON(){let a=[];for(let b of this.asn){let c={};for(let a of b){let b=this.getName(a.type)||a.type;null!=c[b]||(c[b]=[]),c[b].push(a.value.anyValue?`#${lA.ToHex(a.value.anyValue)}`:a.value.toString())}a.push(c)}return a}fromString(a){let b=new nE,c=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g,d=null,e=",";for(;d=c.exec(`${a},`);){let[,a,c]=d,f=c[c.length-1];(","===f||"+"===f)&&(c=c.slice(0,c.length-1),d[3]=f);let g=d[3];a=this.getTypeOid(a);let h=this.createAttribute(a,c);"+"===e?b[b.length-1].push(h):b.push(new nC([h])),e=g}return b}fromJSON(a){let b=new nE;for(let c of a){let a=new nC;for(let b in c){let d=this.getTypeOid(b);for(let e of c[b]){let b=this.createAttribute(d,e);a.push(b)}}b.push(a)}return b}getTypeOid(a){if(/[\d.]+/.test(a)||(a=this.getName(a)||""),!a)throw Error(`Cannot get OID for name type '${a}'`);return a}createAttribute(a,b){let c=new nB({type:a});if("object"==typeof b)for(let a in b)switch(a){case"ia5String":c.value.ia5String=b[a];break;case"utf8String":c.value.utf8String=b[a];break;case"universalString":c.value.universalString=b[a];break;case"bmpString":c.value.bmpString=b[a];break;case"printableString":c.value.printableString=b[a]}else if("#"===b[0])c.value.anyValue=lA.FromHex(b.slice(1));else{let d=this.processStringValue(b);a===this.getName("E")||a===this.getName("DC")?c.value.ia5String=d:sD.isPrintableString(d)?c.value.printableString=d:c.value.utf8String=d}return c}processStringValue(a){let b=/"(.*?[^\\])?"/.exec(a);return b&&(a=b[1]),a.replace(/\\0a/ig,"\n").replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return nu.serialize(this.asn)}async getThumbprint(...a){var b;let c,d="SHA-1";return!(a.length>=1)||(null==(b=a[0])?void 0:b.subtle)?c=a[0]||sy.get():(d=a[0]||d,c=a[1]||sy.get()),await c.subtle.digest(d,this.toArrayBuffer())}}let sE="Cannot initialize GeneralName from ASN.1 data.",sF=`${sE} Unsupported string format in use.`,sG=`${sE} Value doesn't match to GUID regular expression.`,sH=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,sI="1.3.6.1.4.1.311.25.1",sJ="1.3.6.1.4.1.311.20.2.3",sK="email",sL="guid";class sM extends sv{constructor(...a){let b;if(2===a.length)switch(a[0]){case"dn":{const c=new sD(a[1]).toArrayBuffer(),d=nu.parse(c,nE);b=new nH({directoryName:d});break}case"dns":b=new nH({dNSName:a[1]});break;case sK:b=new nH({rfc822Name:a[1]});break;case sL:{const c=RegExp(sH,"i").exec(a[1]);if(!c)throw Error("Cannot parse GUID value. Value doesn't match to regular expression");const d=c.slice(1).map((a,b)=>b<3?lA.ToHex(new Uint8Array(lA.FromHex(a)).reverse()):a).join("");b=new nH({otherName:new nF({typeId:sI,value:nu.serialize(new mX(lA.FromHex(d)))})});break}case"ip":b=new nH({iPAddress:a[1]});break;case"id":b=new nH({registeredID:a[1]});break;case"upn":b=new nH({otherName:new nF({typeId:sJ,value:nu.serialize(m5.toASN(a[1]))})});break;case"url":b=new nH({uniformResourceIdentifier:a[1]});break;default:throw Error("Cannot create GeneralName. Unsupported type of the name")}else b=lt.isBufferSource(a[0])?nu.parse(a[0],nH):a[0];super(b)}onInit(a){if(void 0!=a.dNSName)this.type="dns",this.value=a.dNSName;else if(void 0!=a.rfc822Name)this.type=sK,this.value=a.rfc822Name;else if(void 0!=a.iPAddress)this.type="ip",this.value=a.iPAddress;else if(void 0!=a.uniformResourceIdentifier)this.type="url",this.value=a.uniformResourceIdentifier;else if(void 0!=a.registeredID)this.type="id",this.value=a.registeredID;else if(void 0!=a.directoryName)this.type="dn",this.value=new sD(a.directoryName).toString();else if(void 0!=a.otherName)if(a.otherName.typeId===sI){this.type=sL;let b=nu.parse(a.otherName.value,mX),c=RegExp(sH,"i").exec(lA.ToHex(b));if(!c)throw Error(sG);this.value=c.slice(1).map((a,b)=>b<3?lA.ToHex(new Uint8Array(lA.FromHex(a)).reverse()):a).join("-")}else if(a.otherName.typeId===sJ)this.type="upn",this.value=nu.parse(a.otherName.value,nz).toString();else throw Error(sF);else throw Error(sF)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let a;switch(this.type){case"dn":case"dns":case sL:case"ip":case"id":case"upn":case"url":a=this.type.toUpperCase();break;case sK:a="Email";break;default:throw Error("Unsupported GeneralName type")}let b=this.value;return"id"===this.type&&(b=st.toString(b)),new ss(a,void 0,b)}}class sN extends sv{constructor(a){let b;if(a instanceof nZ)b=a;else if(Array.isArray(a)){const c=[];for(const b of a)if(b instanceof nH)c.push(b);else{const a=nu.parse(new sM(b.type,b.value).rawData,nH);c.push(a)}b=new nZ(c)}else if(lt.isBufferSource(a))b=nu.parse(a,nZ);else throw Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(b)}onInit(a){let b=[];for(let c of a){let a=null;try{a=new sM(c)}catch{continue}b.push(a)}this.items=b}toJSON(){return this.items.map(a=>a.toJSON())}toTextObject(){let a=super.toTextObjectEmpty();for(let b of this.items){let c=b.toTextObject(),d=a[c[ss.NAME]];Array.isArray(d)||(d=[],a[c[ss.NAME]]=d),d.push(c)}return a}}sN.NAME="GeneralNames";let sO="-{5}",sP=`[^\\n]+`,sQ=`${sO}BEGIN (${sP}(?=${sO}))${sO}`,sR=`${sO}END \\1${sO}`,sS=`[^:\\n]+`,sT=`(?:[^\\n]+\\n(?: +[^\\n]+\\n)*)`,sU=`(?:[a-zA-Z0-9=+/]+\\n)+`,sV=`${sQ}\\n(?:((?:${sS}: ${sT})+))?\\n?(${sU})${sR}`;class sW{static isPem(a){return"string"==typeof a&&RegExp(sV,"g").test(a.replace(/\r/g,""))}static decodeWithHeaders(a){a=a.replace(/\r/g,"");let b=RegExp(sV,"g"),c=[],d=null;for(;d=b.exec(a);){let a=d[3].replace(RegExp(`[\\n]+`,"g"),""),b={type:d[1],headers:[],rawData:lA.FromBase64(a)},e=d[2];if(e){let a=e.split(RegExp("\\n","g")),c=null;for(let d of a){let[a,e]=d.split(/:(.*)/);if(void 0===e){if(!c)throw Error("Cannot parse PEM string. Incorrect header value");c.value+=a.trim()}else c&&b.headers.push(c),c={key:a,value:e.trim()}}c&&b.headers.push(c)}c.push(b)}return c}static decode(a){return this.decodeWithHeaders(a).map(a=>a.rawData)}static decodeFirst(a){let b=this.decode(a);if(!b.length)throw RangeError("PEM string doesn't contain any objects");return b[0]}static encode(a,b){if(Array.isArray(a)){let c=[];return b?a.forEach(a=>{if(!lt.isBufferSource(a))throw TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");c.push(this.encodeStruct({type:b,rawData:lt.toArrayBuffer(a)}))}):a.forEach(a=>{if(!("type"in a))throw TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");c.push(this.encodeStruct(a))}),c.join("\n")}if(!b)throw Error("Required argument 'tag' is missed");return this.encodeStruct({type:b,rawData:lt.toArrayBuffer(a)})}static encodeStruct(a){var b;let c,d=a.type.toLocaleUpperCase(),e=[];if(e.push(`-----BEGIN ${d}-----`),null==(b=a.headers)?void 0:b.length){for(let b of a.headers)e.push(`${b.key}: ${b.value}`);e.push("")}let f=lA.ToBase64(a.rawData),g=0,h=[];for(;g<f.length;)if(f.length-g<64?c=f.substring(g):(c=f.substring(g,g+64),g+=64),0!==c.length){if(h.push(c),c.length<64)break}else break;return e.push(...h),e.push(`-----END ${d}-----`),e.join("\n")}}sW.CertificateTag="CERTIFICATE",sW.CrlTag="CRL",sW.CertificateRequestTag="CERTIFICATE REQUEST",sW.PublicKeyTag="PUBLIC KEY",sW.PrivateKeyTag="PRIVATE KEY";class sX extends sv{static isAsnEncoded(a){return lt.isBufferSource(a)||"string"==typeof a}static toArrayBuffer(a){if("string"==typeof a)if(sW.isPem(a))return sW.decode(a)[0];else if(lA.isHex(a))return lA.FromHex(a);else if(lA.isBase64(a))return lA.FromBase64(a);else if(lA.isBase64Url(a))return lA.FromBase64Url(a);else throw TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url");{let b=lt.toUint8Array(a);if(b.length>0&&48===b[0])return lt.toArrayBuffer(a);let c=lA.ToBinary(a);if(sW.isPem(c))return sW.decode(c)[0];if(lA.isHex(c))return lA.FromHex(c);if(lA.isBase64(c))return lA.FromBase64(c);else if(lA.isBase64Url(c))return lA.FromBase64Url(c);throw TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}}constructor(...a){sX.isAsnEncoded(a[0])?super(sX.toArrayBuffer(a[0]),a[1]):super(a[0])}toString(a="pem"){return"pem"===a?sW.encode(this.rawData,this.tag):super.toString(a)}}class sY extends sX{static async create(a,b=sy.get()){if(a instanceof sY)return a;if(sx.isCryptoKey(a)){if("public"!==a.type)throw TypeError("Public key is required");return new sY(await b.subtle.exportKey("spki",a))}if(a.publicKey)return a.publicKey;if(lt.isBufferSource(a))return new sY(a);throw TypeError("Unsupported PublicKeyType")}constructor(a){sX.isAsnEncoded(a)?super(a,oO):super(a),this.tag=sW.PublicKeyTag}async export(...a){var b;let c,d=["verify"],e={hash:"SHA-256",...this.algorithm};a.length>1?(e=a[0]||e,d=a[1]||d,c=a[2]||sy.get()):c=a[0]||sy.get();let f=this.rawData,g=nu.parse(this.rawData,oO);return g.algorithm.algorithm===qq&&(b=g,b.algorithm=new oN({algorithm:qn,parameters:null}),f=nu.serialize(b)),c.subtle.importKey("spki",f,e,!0,d)}onInit(a){let b=q9.resolve(rW),c=this.algorithm=b.toWebAlgorithm(a.algorithm);if(a.algorithm.algorithm===qn){let b=nu.parse(a.subjectPublicKey,qQ),d=lt.toUint8Array(b.modulus);c.publicExponent=lt.toUint8Array(b.publicExponent),c.modulusLength=(!d[0]?d.slice(1):d).byteLength<<3}}async getThumbprint(...a){var b;let c,d="SHA-1";return!(a.length>=1)||(null==(b=a[0])?void 0:b.subtle)?c=a[0]||sy.get():(d=a[0]||d,c=a[1]||sy.get()),await c.subtle.digest(d,this.rawData)}async getKeyIdentifier(...a){let b,c="SHA-1";1===a.length?"string"==typeof a[0]?(c=a[0],b=sy.get()):b=a[0]:2===a.length?(c=a[0],b=a[1]):b=sy.get();let d=nu.parse(this.rawData,oO);return await b.subtle.digest(c,d.subjectPublicKey)}toTextObject(){let a=this.toTextObjectEmpty(),b=nu.parse(this.rawData,oO);return a.Algorithm=su.serializeAlgorithm(b.algorithm),b.algorithm.algorithm===p2?a["EC Point"]=b.subjectPublicKey:a["Raw Data"]=b.subjectPublicKey,a}}class sZ extends sw{static async create(a,b=!1,c=sy.get()){if("name"in a&&"serialNumber"in a)return new sZ(a,b);let d=await sY.create(a,c),e=await d.getKeyIdentifier(c);return new sZ(lA.ToHex(e),b)}constructor(...a){if(lt.isBufferSource(a[0]))super(a[0]);else if("string"==typeof a[0]){const b=new nW({keyIdentifier:new nV(lA.FromHex(a[0]))});super(nU,a[1],nu.serialize(b))}else{const b=a[0],c=new nW({authorityCertIssuer:b.name instanceof sN?nu.parse(b.name.rawData,nZ):b.name,authorityCertSerialNumber:lA.FromHex(b.serialNumber)});super(nU,a[1],nu.serialize(c))}}onInit(a){super.onInit(a);let b=nu.parse(a.extnValue,nW);b.keyIdentifier&&(this.keyId=lA.ToHex(b.keyIdentifier)),(b.authorityCertIssuer||b.authorityCertSerialNumber)&&(this.certId={name:b.authorityCertIssuer||[],serialNumber:b.authorityCertSerialNumber?lA.ToHex(b.authorityCertSerialNumber):""})}toTextObject(){let a=this.toTextObjectWithoutValue(),b=nu.parse(this.value,nW);return b.authorityCertIssuer&&(a["Authority Issuer"]=new sN(b.authorityCertIssuer).toTextObject()),b.authorityCertSerialNumber&&(a["Authority Serial Number"]=b.authorityCertSerialNumber),b.keyIdentifier&&(a[""]=b.keyIdentifier),a}}sZ.NAME="Authority Key Identifier";class s$ extends sw{constructor(...a){if(lt.isBufferSource(a[0])){super(a[0]);const b=nu.parse(this.value,nY);this.ca=b.cA,this.pathLength=b.pathLenConstraint}else{const b=new nY({cA:a[0],pathLenConstraint:a[1]});super(nX,a[2],nu.serialize(b)),this.ca=a[0],this.pathLength=a[1]}}toTextObject(){let a=this.toTextObjectWithoutValue();return this.ca&&(a.CA=this.ca),void 0!==this.pathLength&&(a["Path Length"]=this.pathLength),a}}s$.NAME="Basic Constraints",(I=aW||(aW={})).serverAuth="1.3.6.1.5.5.7.3.1",I.clientAuth="1.3.6.1.5.5.7.3.2",I.codeSigning="1.3.6.1.5.5.7.3.3",I.emailProtection="1.3.6.1.5.5.7.3.4",I.timeStamping="1.3.6.1.5.5.7.3.8",I.ocspSigning="1.3.6.1.5.5.7.3.9";class s_ extends sw{constructor(...a){if(lt.isBufferSource(a[0])){super(a[0]);const b=nu.parse(this.value,oj);this.usages=b.map(a=>a)}else{const b=new oj(a[0]);super(oi,a[1],nu.serialize(b)),this.usages=a[0]}}toTextObject(){let a=this.toTextObjectWithoutValue();return a[""]=this.usages.map(a=>st.toString(a)).join(", "),a}}s_.NAME="Extended Key Usages",(J=aX||(aX={}))[J.digitalSignature=1]="digitalSignature",J[J.nonRepudiation=2]="nonRepudiation",J[J.keyEncipherment=4]="keyEncipherment",J[J.dataEncipherment=8]="dataEncipherment",J[J.keyAgreement=16]="keyAgreement",J[J.keyCertSign=32]="keyCertSign",J[J.cRLSign=64]="cRLSign",J[J.encipherOnly=128]="encipherOnly",J[J.decipherOnly=256]="decipherOnly";class s0 extends sw{constructor(...a){if(lt.isBufferSource(a[0])){super(a[0]);const b=nu.parse(this.value,ow);this.usages=b.toNumber()}else{const b=new ow(a[0]);super(ov,a[1],nu.serialize(b)),this.usages=a[0]}}toTextObject(){let a=this.toTextObjectWithoutValue(),b=nu.parse(this.value,ow);return a[""]=b.toJSON().join(", "),a}}s0.NAME="Key Usages";class s1 extends sw{static async create(a,b=!1,c=sy.get()){let d=await sY.create(a,c),e=await d.getKeyIdentifier(c);return new s1(lA.ToHex(e),b)}constructor(...a){if(lt.isBufferSource(a[0])){super(a[0]);const b=nu.parse(this.value,oI);this.keyId=lA.ToHex(b)}else{const b="string"==typeof a[0]?lA.FromHex(a[0]):a[0],c=new oI(b);super(oH,a[1],nu.serialize(c)),this.keyId=lA.ToHex(b)}}toTextObject(){let a=this.toTextObjectWithoutValue(),b=nu.parse(this.value,oI);return a[""]=b,a}}s1.NAME="Subject Key Identifier";class s2 extends sw{constructor(...a){lt.isBufferSource(a[0])?super(a[0]):super(oD,a[1],new sN(a[0]||[]).rawData)}onInit(a){super.onInit(a);let b=nu.parse(a.extnValue,oE);this.names=new sN(b)}toTextObject(){let a=this.toTextObjectWithoutValue(),b=this.names.toTextObject();for(let c in b)a[c]=b[c];return a}}s2.NAME="Subject Alternative Name";class s3{static register(a,b){this.items.set(a,b)}static create(a){let b=new sw(a),c=this.items.get(b.type);return c?new c(a):b}}s3.items=new Map;class s4 extends sw{constructor(...a){var b;if(lt.isBufferSource(a[0])){super(a[0]);const b=nu.parse(this.value,n6);this.policies=b.map(a=>a.policyIdentifier)}else{const c=a[0],d=null!=(b=a[1])&&b,e=new n6(c.map(a=>new n5({policyIdentifier:a})));super(n_,d,nu.serialize(e)),this.policies=c}}toTextObject(){let a=this.toTextObjectWithoutValue();return a.Policy=this.policies.map(a=>new ss("",{},st.toString(a))),a}}s4.NAME="Certificate Policies",s3.register(n_,s4);class s5 extends sw{constructor(...a){if(lt.isBufferSource(a[0]))super(a[0]);else if(Array.isArray(a[0])&&"string"==typeof a[0][0]){const b=a[0].map(a=>new oc({distributionPoint:new ob({fullName:[new nH({uniformResourceIdentifier:a})]})})),c=new od(b);super(n9,a[1],nu.serialize(c))}else{const b=new od(a[0]);super(n9,a[1],nu.serialize(b))}null!=this.distributionPoints||(this.distributionPoints=[])}onInit(a){super.onInit(a);let b=nu.parse(a.extnValue,od);this.distributionPoints=b}toTextObject(){let a=this.toTextObjectWithoutValue();return a["Distribution Point"]=this.distributionPoints.map(a=>{var b;let c={};return a.distributionPoint&&(c[""]=null==(b=a.distributionPoint.fullName)?void 0:b.map(a=>new sM(a).toString()).join(", ")),a.reasons&&(c.Reasons=a.reasons.toString()),a.cRLIssuer&&(c["CRL Issuer"]=a.cRLIssuer.map(a=>a.toString()).join(", ")),c}),a}}s5.NAME="CRL Distribution Points";class s6 extends sw{constructor(...a){if(lt.isBufferSource(a[0]))super(a[0]);else if(a[0]instanceof nT){const b=new nT(a[0]);super(nR,a[1],nu.serialize(b))}else{const b=a[0],c=new nT;s8(c,b,nM,"ocsp"),s8(c,b,nN,"caIssuers"),s8(c,b,nO,"timeStamping"),s8(c,b,nP,"caRepository"),super(nR,a[1],nu.serialize(c))}null!=this.ocsp||(this.ocsp=[]),null!=this.caIssuers||(this.caIssuers=[]),null!=this.timeStamping||(this.timeStamping=[]),null!=this.caRepository||(this.caRepository=[])}onInit(a){super.onInit(a),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],nu.parse(a.extnValue,nT).forEach(a=>{switch(a.accessMethod){case nM:this.ocsp.push(new sM(a.accessLocation));break;case nN:this.caIssuers.push(new sM(a.accessLocation));break;case nO:this.timeStamping.push(new sM(a.accessLocation));break;case nP:this.caRepository.push(new sM(a.accessLocation))}})}toTextObject(){let a=this.toTextObjectWithoutValue();return this.ocsp.length&&s7(a,"OCSP",this.ocsp),this.caIssuers.length&&s7(a,"CA Issuers",this.caIssuers),this.timeStamping.length&&s7(a,"Time Stamping",this.timeStamping),this.caRepository.length&&s7(a,"CA Repository",this.caRepository),a}}function s7(a,b,c){if(1===c.length)a[b]=c[0].toTextObject();else{let d=new ss("");c.forEach((a,b)=>{let c=a.toTextObject(),e=`${c[ss.NAME]} ${b+1}`,f=d[e];Array.isArray(f)||(f=[],d[e]=f),f.push(c)}),a[b]=d}}function s8(a,b,c,d){let e=b[d];e&&(Array.isArray(e)?e:[e]).forEach(b=>{"string"==typeof b&&(b=new sM("url",b)),a.push(new nS({accessMethod:c,accessLocation:nu.parse(b.rawData,nH)}))})}s6.NAME="Authority Info Access";class s9 extends sw{constructor(...a){lt.isBufferSource(a[0])?super(a[0]):super(ot,a[1],new sN(a[0]||[]).rawData)}onInit(a){super.onInit(a);let b=nu.parse(a.extnValue,nZ);this.names=new sN(b)}toTextObject(){let a=this.toTextObjectWithoutValue(),b=this.names.toTextObject();for(let c in b)a[c]=b[c];return a}}s9.NAME="Issuer Alternative Name";class ta extends sv{constructor(...a){let b;if(lt.isBufferSource(a[0]))b=lt.toArrayBuffer(a[0]);else{const c=a[0],d=Array.isArray(a[1])?a[1].map(a=>lt.toArrayBuffer(a)):[];b=nu.serialize(new oF({type:c,values:d}))}super(b,oF)}onInit(a){this.type=a.type,this.values=a.values}toTextObject(){let a=this.toTextObjectWithoutValue();return a.Value=this.values.map(a=>new ss("",{"":a})),a}toTextObjectWithoutValue(){let a=this.toTextObjectEmpty();return a[ss.NAME]===ta.NAME&&(a[ss.NAME]=st.toString(this.type)),a}}ta.NAME="Attribute";class tb extends ta{constructor(...a){if(lt.isBufferSource(a[0]))super(a[0]);else{const b=new rM({printableString:a[0]});super(rt,[nu.serialize(b)])}null!=this.password||(this.password="")}onInit(a){if(super.onInit(a),this.values[0]){let a=nu.parse(this.values[0],rM);this.password=a.toString()}}toTextObject(){let a=this.toTextObjectWithoutValue();return a[ss.VALUE]=this.password,a}}tb.NAME="Challenge Password";class tc extends ta{constructor(...a){if(lt.isBufferSource(a[0]))super(a[0]);else{const b=a[0],c=new oS;for(const a of b)c.push(nu.parse(a.rawData,oR));super(ru,[nu.serialize(c)])}null!=this.items||(this.items=[])}onInit(a){if(super.onInit(a),this.values[0]){let a=nu.parse(this.values[0],oS);this.items=a.map(a=>s3.create(nu.serialize(a)))}}toTextObject(){let a=this.toTextObjectWithoutValue();for(let b of this.items.map(a=>a.toTextObject()))a[b[ss.NAME]]=b;return a}}tc.NAME="Extensions";class td{static register(a,b){this.items.set(a,b)}static create(a){let b=new ta(a),c=this.items.get(b.type);return c?new c(a):b}}td.items=new Map;let te="crypto.signatureFormatter",tf=aY=class{static createPssParams(a,b){let c=aY.getHashAlgorithm(a);return c?new qL({hashAlgorithm:c,maskGenAlgorithm:new oN({algorithm:qF,parameters:nu.serialize(c)}),saltLength:b}):null}static getHashAlgorithm(a){let b=q9.resolve(rW);return"string"==typeof a?b.toAsnAlgorithm({name:a}):"object"==typeof a&&a&&"name"in a?b.toAsnAlgorithm(a):null}toAsnAlgorithm(a){switch(a.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if(!("hash"in a))return new oN({algorithm:qn,parameters:null});{let b;if("string"==typeof a.hash)b=a.hash;else if(a.hash&&"object"==typeof a.hash&&"name"in a.hash&&"string"==typeof a.hash.name)b=a.hash.name.toUpperCase();else throw Error("Cannot get hash algorithm name");switch(b.toLowerCase()){case"sha-1":return new oN({algorithm:qt,parameters:null});case"sha-256":return new oN({algorithm:qv,parameters:null});case"sha-384":return new oN({algorithm:qw,parameters:null});case"sha-512":return new oN({algorithm:qx,parameters:null})}}break;case"rsa-pss":if(!("hash"in a))return new oN({algorithm:qq,parameters:null});{if(!("saltLength"in a&&"number"==typeof a.saltLength))throw Error("Cannot get 'saltLength' from 'alg' argument");let b=aY.createPssParams(a.hash,a.saltLength);if(!b)throw Error("Cannot create PSS parameters");return new oN({algorithm:qq,parameters:nu.serialize(b)})}}return null}toWebAlgorithm(a){switch(a.algorithm){case qn:return{name:"RSASSA-PKCS1-v1_5"};case qt:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case qv:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case qw:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case qx:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case qq:if(!a.parameters)return{name:"RSA-PSS"};{let b=nu.parse(a.parameters,qL);return{name:"RSA-PSS",hash:q9.resolve(rW).toWebAlgorithm(b.hashAlgorithm),saltLength:b.saltLength}}}return null}};tf=aY=nv([ra()],tf),q9.registerSingleton(rV,tf);let tg=class{toAsnAlgorithm(a){switch(a.name.toLowerCase()){case"sha-1":return new oN({algorithm:qA});case"sha-256":return new oN({algorithm:qC});case"sha-384":return new oN({algorithm:qD});case"sha-512":return new oN({algorithm:qE})}return null}toWebAlgorithm(a){switch(a.algorithm){case qA:return{name:"SHA-1"};case qC:return{name:"SHA-256"};case qD:return{name:"SHA-384"};case qE:return{name:"SHA-512"}}return null}};tg=nv([ra()],tg),q9.registerSingleton(rV,tg);class th{addPadding(a,b){let c=lt.toUint8Array(b),d=new Uint8Array(a);return d.set(c,a-c.length),d.buffer}removePadding(a,b=!1){let c=lt.toUint8Array(a);for(let a=0;a<c.length;a++)if(c[a]){c=c.slice(a);break}if(b&&c[0]>127){let a=new Uint8Array(c.length+1);return a.set(c,1),a.buffer}return c.buffer}toAsnSignature(a,b){if("ECDSA"===a.name){let c=a.namedCurve,d=th.namedCurveSize.get(c)||th.defaultNamedCurveSize,e=new ql,f=lt.toUint8Array(b);return e.r=this.removePadding(f.slice(0,d),!0),e.s=this.removePadding(f.slice(d,d+d),!0),nu.serialize(e)}return null}toWebSignature(a,b){if("ECDSA"===a.name){let c=nu.parse(b,ql),d=a.namedCurve,e=th.namedCurveSize.get(d)||th.defaultNamedCurveSize;return function(...a){let b=new Uint8Array(a.map(a=>a.byteLength).reduce((a,b)=>a+b)),c=0;return a.map(a=>new Uint8Array(a)).forEach(a=>{for(let d of a)b[c++]=d}),b.buffer}(this.addPadding(e,this.removePadding(c.r)),this.addPadding(e,this.removePadding(c.s)))}return null}}th.namedCurveSize=new Map,th.defaultNamedCurveSize=32;let ti="1.3.101.110",tj="1.3.101.111",tk="1.3.101.112",tl="1.3.101.113",tm=class{toAsnAlgorithm(a){let b=null;switch(a.name.toLowerCase()){case"ed25519":b=tk;break;case"x25519":b=ti;break;case"eddsa":switch(a.namedCurve.toLowerCase()){case"ed25519":b=tk;break;case"ed448":b=tl}break;case"ecdh-es":switch(a.namedCurve.toLowerCase()){case"x25519":b=ti;break;case"x448":b=tj}}return b?new oN({algorithm:b}):null}toWebAlgorithm(a){switch(a.algorithm){case tk:return{name:"Ed25519"};case tl:return{name:"EdDSA",namedCurve:"Ed448"};case ti:return{name:"X25519"};case tj:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};tm=nv([ra()],tm),q9.registerSingleton(rV,tm),new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap,new WeakMap;class tn extends sX{get publicKey(){return nw(this,a8,"f")||nx(this,a8,new sY(this.asn.tbsCertificate.subjectPublicKeyInfo),"f"),nw(this,a8,"f")}get serialNumber(){if(!nw(this,a$,"f")){let a=new Uint8Array(this.asn.tbsCertificate.serialNumber);a.length>1&&0===a[0]&&a[1]>127&&(a=a.slice(1)),nx(this,a$,lA.ToHex(a),"f")}return nw(this,a$,"f")}get subjectName(){return nw(this,a_,"f")||nx(this,a_,new sD(this.asn.tbsCertificate.subject),"f"),nw(this,a_,"f")}get subject(){return nw(this,a0,"f")||nx(this,a0,this.subjectName.toString(),"f"),nw(this,a0,"f")}get issuerName(){return nw(this,a1,"f")||nx(this,a1,new sD(this.asn.tbsCertificate.issuer),"f"),nw(this,a1,"f")}get issuer(){return nw(this,a2,"f")||nx(this,a2,this.issuerName.toString(),"f"),nw(this,a2,"f")}get notBefore(){if(!nw(this,a3,"f")){let a=this.asn.tbsCertificate.validity.notBefore.utcTime||this.asn.tbsCertificate.validity.notBefore.generalTime;if(!a)throw Error("Cannot get 'notBefore' value");nx(this,a3,a,"f")}return nw(this,a3,"f")}get notAfter(){if(!nw(this,a4,"f")){let a=this.asn.tbsCertificate.validity.notAfter.utcTime||this.asn.tbsCertificate.validity.notAfter.generalTime;if(!a)throw Error("Cannot get 'notAfter' value");nx(this,a4,a,"f")}return nw(this,a4,"f")}get signatureAlgorithm(){if(!nw(this,a5,"f")){let a=q9.resolve(rW);nx(this,a5,a.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return nw(this,a5,"f")}get signature(){return nw(this,a6,"f")||nx(this,a6,this.asn.signatureValue,"f"),nw(this,a6,"f")}get extensions(){return!nw(this,a7,"f")&&(nx(this,a7,[],"f"),this.asn.tbsCertificate.extensions&&nx(this,a7,this.asn.tbsCertificate.extensions.map(a=>s3.create(nu.serialize(a))),"f")),nw(this,a7,"f")}get tbs(){return nw(this,aZ,"f")||nx(this,aZ,this.asn.tbsCertificateRaw||nu.serialize(this.asn.tbsCertificate),"f"),nw(this,aZ,"f")}constructor(a){const b=sX.isAsnEncoded(a)?[a,oU]:[a];super(b[0],b[1]),aZ.set(this,void 0),a$.set(this,void 0),a_.set(this,void 0),a0.set(this,void 0),a1.set(this,void 0),a2.set(this,void 0),a3.set(this,void 0),a4.set(this,void 0),a5.set(this,void 0),a6.set(this,void 0),a7.set(this,void 0),a8.set(this,void 0),this.tag=sW.CertificateTag}onInit(a){}getExtension(a){for(let b of this.extensions)if("string"==typeof a){if(b.type===a)return b}else if(b instanceof a)return b;return null}getExtensions(a){return this.extensions.filter(b=>"string"==typeof a?b.type===a:b instanceof a)}async verify(a={},b=sy.get()){let c,d,e=a.publicKey;try{if(e)if("publicKey"in e)c={...e.publicKey.algorithm,...this.signatureAlgorithm},d=await e.publicKey.export(c,["verify"],b);else if(e instanceof sY)c={...e.algorithm,...this.signatureAlgorithm},d=await e.export(c,["verify"],b);else if(lt.isBufferSource(e)){let a=new sY(e);c={...a.algorithm,...this.signatureAlgorithm},d=await a.export(c,["verify"],b)}else c={...e.algorithm,...this.signatureAlgorithm},d=e;else c={...this.publicKey.algorithm,...this.signatureAlgorithm},d=await this.publicKey.export(c,["verify"],b)}catch{return!1}let f=q9.resolveAll(te).reverse(),g=null;for(let a of f)if(g=a.toWebSignature(c,this.signature))break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");let h=await b.subtle.verify(this.signatureAlgorithm,d,g,this.tbs);if(a.signatureOnly)return h;{let b=(a.date||new Date).getTime();return h&&this.notBefore.getTime()<b&&b<this.notAfter.getTime()}}async getThumbprint(...a){let b,c="SHA-1";return a[0]&&(a[0].subtle?b=a[0]:(c=a[0]||c,b=a[1])),null!=b||(b=sy.get()),await b.subtle.digest(c,this.rawData)}async isSelfSigned(a=sy.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},a)}toTextObject(){let a=this.toTextObjectEmpty(),b=nu.parse(this.rawData,oU),c=b.tbsCertificate,d=new ss("",{Version:`${as[c.version]} (${c.version})`,"Serial Number":c.serialNumber,"Signature Algorithm":su.serializeAlgorithm(c.signature),Issuer:this.issuer,Validity:new ss("",{"Not Before":c.validity.notBefore.getTime(),"Not After":c.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(c.issuerUniqueID&&(d["Issuer Unique ID"]=c.issuerUniqueID),c.subjectUniqueID&&(d["Subject Unique ID"]=c.subjectUniqueID),this.extensions.length){let a=new ss("");for(let b of this.extensions){let c=b.toTextObject();a[c[ss.NAME]]=c}d.Extensions=a}return a.Data=d,a.Signature=new ss("",{Algorithm:su.serializeAlgorithm(b.signatureAlgorithm),"":b.signatureValue}),a}}function to(a,b=sy.get()){let c=lt.toUint8Array(lA.FromHex(a||"")),d=c&&c.length&&c.some(a=>a>0)?new Uint8Array(c):void 0;d||(d=b.getRandomValues(new Uint8Array(16)));let e=0;for(;e<d.length-1&&0===d[e];)e++;if((d=d.slice(e))[0]>127){let a=new Uint8Array(d.length+1);a[0]=0,a.set(d,1),d=a}return d.buffer}aZ=new WeakMap,a$=new WeakMap,a_=new WeakMap,a0=new WeakMap,a1=new WeakMap,a2=new WeakMap,a3=new WeakMap,a4=new WeakMap,a5=new WeakMap,a6=new WeakMap,a7=new WeakMap,a8=new WeakMap,tn.NAME="Certificate",(K=be||(be={}))[K.unspecified=0]="unspecified",K[K.keyCompromise=1]="keyCompromise",K[K.cACompromise=2]="cACompromise",K[K.affiliationChanged=3]="affiliationChanged",K[K.superseded=4]="superseded",K[K.cessationOfOperation=5]="cessationOfOperation",K[K.certificateHold=6]="certificateHold",K[K.removeFromCRL=8]="removeFromCRL",K[K.privilegeWithdrawn=9]="privilegeWithdrawn",K[K.aACompromise=10]="aACompromise";class tp extends sv{get serialNumber(){return nw(this,a9,"f")||nx(this,a9,lA.ToHex(this.asn.userCertificate),"f"),nw(this,a9,"f")}get revocationDate(){return nw(this,ba,"f")||nx(this,ba,this.asn.revocationDate.getTime(),"f"),nw(this,ba,"f")}get reason(){return void 0===nw(this,bb,"f")&&this.extensions,nw(this,bb,"f")}get invalidity(){return void 0===nw(this,bc,"f")&&this.extensions,nw(this,bc,"f")}get extensions(){return!nw(this,bd,"f")&&(nx(this,bd,[],"f"),this.asn.crlEntryExtensions&&nx(this,bd,this.asn.crlEntryExtensions.map(a=>{let b=s3.create(nu.serialize(a));switch(b.type){case og:void 0===nw(this,bb,"f")&&nx(this,bb,nu.parse(b.value,oh).reason,"f");break;case or:void 0===nw(this,bc,"f")&&nx(this,bc,nu.parse(b.value,os).value,"f")}return b}),"f")),nw(this,bd,"f")}constructor(...a){let b;if(lt.isBufferSource(a[0])?b=lt.toArrayBuffer(a[0]):"string"==typeof a[0]?b=nu.serialize(new oV({userCertificate:to(a[0]),revocationDate:new oP(a[1]),crlEntryExtensions:a[2]})):a[0]instanceof oV&&(b=a[0]),!b)throw TypeError("Cannot create X509CrlEntry instance. Wrong constructor arguments.");super(b,oV),a9.set(this,void 0),ba.set(this,void 0),bb.set(this,void 0),bc.set(this,void 0),bd.set(this,void 0)}onInit(a){}}a9=new WeakMap,ba=new WeakMap,bb=new WeakMap,bc=new WeakMap,bd=new WeakMap;class tq extends sX{get version(){return this.asn.tbsCertList.version}get signatureAlgorithm(){if(!nw(this,bg,"f")){let a=q9.resolve(rW);nx(this,bg,a.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return nw(this,bg,"f")}get signature(){return this.asn.signature}get issuer(){return this.issuerName.toString()}get issuerName(){return nw(this,bh,"f")||nx(this,bh,new sD(this.asn.tbsCertList.issuer),"f"),nw(this,bh,"f")}get thisUpdate(){if(!nw(this,bi,"f")){let a=this.asn.tbsCertList.thisUpdate.getTime();if(!a)throw Error("Cannot get 'thisUpdate' value");nx(this,bi,a,"f")}return nw(this,bi,"f")}get nextUpdate(){var a;return void 0===nw(this,bj,"f")&&nx(this,bj,(null==(a=this.asn.tbsCertList.nextUpdate)?void 0:a.getTime())||void 0,"f"),nw(this,bj,"f")}get entries(){var a;return nw(this,bk,"f")||nx(this,bk,(null==(a=this.asn.tbsCertList.revokedCertificates)?void 0:a.map(a=>new tp(a)))||[],"f"),nw(this,bk,"f")}get extensions(){return!nw(this,bl,"f")&&(nx(this,bl,[],"f"),this.asn.tbsCertList.crlExtensions&&nx(this,bl,this.asn.tbsCertList.crlExtensions.map(a=>s3.create(nu.serialize(a))),"f")),nw(this,bl,"f")}get tbs(){return nw(this,bf,"f")||nx(this,bf,this.asn.tbsCertListRaw||nu.serialize(this.asn.tbsCertList),"f"),nw(this,bf,"f")}get tbsCertListSignatureAlgorithm(){return this.asn.tbsCertList.signature}get certListSignatureAlgorithm(){return this.asn.signatureAlgorithm}constructor(a){super(a,sX.isAsnEncoded(a)?oX:void 0),this.tag=sW.CrlTag,bf.set(this,void 0),bg.set(this,void 0),bh.set(this,void 0),bi.set(this,void 0),bj.set(this,void 0),bk.set(this,void 0),bl.set(this,void 0)}onInit(a){}getExtension(a){for(let b of this.extensions)if("string"==typeof a){if(b.type===a)return b}else if(b instanceof a)return b;return null}getExtensions(a){return this.extensions.filter(b=>"string"==typeof a?b.type===a:b instanceof a)}async verify(a,b=sy.get()){let c,d;if(!this.certListSignatureAlgorithm.isEqual(this.tbsCertListSignatureAlgorithm))throw Error("algorithm identifier in the sequence tbsCertList and CertificateList mismatch");let e=a.publicKey;try{e instanceof tn?(c={...e.publicKey.algorithm,...e.signatureAlgorithm},d=await e.publicKey.export(c,["verify"])):e instanceof sY?(c={...e.algorithm,...this.signatureAlgorithm},d=await e.export(c,["verify"])):(c={...e.algorithm,...this.signatureAlgorithm},d=e)}catch{return!1}let f=q9.resolveAll(te).reverse(),g=null;for(let a of f)if(g=a.toWebSignature(c,this.signature))break;if(!g)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return await b.subtle.verify(this.signatureAlgorithm,d,g,this.tbs)}async getThumbprint(...a){let b,c="SHA-1";return a[0]&&(a[0].subtle?b=a[0]:(c=a[0]||c,b=a[1])),null!=b||(b=sy.get()),await b.subtle.digest(c,this.rawData)}findRevoked(a){let b=to("string"==typeof a?a:a.serialNumber);for(let a of this.asn.tbsCertList.revokedCertificates||[])if(lt.isEqual(a.userCertificate,b))return new tp(nu.serialize(a));return null}}function tr(a){return ts.stubThis(a)}bf=new WeakMap,bg=new WeakMap,bh=new WeakMap,bi=new WeakMap,bj=new WeakMap,bk=new WeakMap,bl=new WeakMap,s3.register(nX,s$),s3.register(oi,s_),s3.register(ov,s0),s3.register(oH,s1),s3.register(nU,sZ),s3.register(oD,s2),s3.register(n9,s5),s3.register(nR,s6),s3.register(ot,s9),td.register(rt,tb),td.register(ru,tc),q9.registerSingleton(te,class{toAsnSignature(a,b){return lt.toArrayBuffer(b)}toWebSignature(a,b){return lt.toArrayBuffer(b)}}),q9.registerSingleton(te,th),th.namedCurveSize.set("P-256",32),th.namedCurveSize.set("K-256",32),th.namedCurveSize.set("P-384",48),th.namedCurveSize.set("P-521",66);let ts={stubThis:a=>globalThis.fetch(a)},tt={};async function tu(a){let b,c,d,e,f,g,{extensions:h}=a;if(!h)return!1;if(h.forEach(a=>{a instanceof sZ?b=a:a instanceof s1?c=a:a instanceof s5&&(d=a)}),b&&b.keyId?g=b.keyId:c&&(g=c.keyId),g){let b=tt[g];if(b){let c=new Date;if(!b.nextUpdate||b.nextUpdate>c)return b.revokedCerts.indexOf(a.serialNumber)>=0}}let i=d?.distributionPoints?.[0].distributionPoint?.fullName?.[0].uniformResourceIdentifier;if(!i)return!1;try{let a=await tr(i);e=await a.arrayBuffer()}catch(a){return!1}try{f=new tq(e)}catch(a){return!1}let j={revokedCerts:[],nextUpdate:void 0};f.nextUpdate&&(j.nextUpdate=f.nextUpdate);let k=f.entries;if(k){for(let a of k){let b=a.serialNumber;j.revokedCerts.push(b)}return g&&(tt[g]=j),j.revokedCerts.indexOf(a.serialNumber)>=0}return!1}var lj=lj,lj=lj,lg=lg;function tv(a){let b,c,d,e,f;if(a.byteLength<37)throw Error(`Authenticator data was ${a.byteLength} bytes, expected at least 37 bytes`);let g=0,h=lg.toDataView(a),i=a.slice(g,g+=32),j=a.slice(g,g+=1),k=j[0],l={up:!!(1&k),uv:!!(4&k),be:!!(8&k),bs:!!(16&k),at:!!(64&k),ed:!!(128&k),flagsInt:k},m=a.slice(g,g+4),n=h.getUint32(g,!1);if(g+=4,l.at){b=a.slice(g,g+=16);let e=h.getUint16(g);g+=2,c=a.slice(g,g+=e);let f=lg.fromHex("a301634f4b500327206745643235353139"),i=a.slice(g,g+f.byteLength),j=!1;lg.areEqual(f,i)&&(j=!0,a[g]=164);let k=lj.decodeFirst(a.slice(g)),l=Uint8Array.from(lj.encode(k));j&&(a[g]=163),d=l,g+=l.byteLength}if(l.ed){let b=lj.decodeFirst(a.slice(g));e=function(a){let b;try{b=lj.decodeFirst(a)}catch(a){throw Error(`Error decoding authenticator extensions: ${a.message}`)}return function a(b){let c={};for(let[d,e]of b)e instanceof Map?c[d]=a(e):c[d]=e;return c}(b)}(f=Uint8Array.from(lj.encode(b))),g+=f.byteLength}if(a.byteLength>g)throw Error("Leftover bytes detected while parsing authenticator data");return tw.stubThis({rpIdHash:i,flagsBuf:j,flags:l,counter:n,counterBuf:m,aaguid:b,credentialID:c,credentialPublicKey:d,extensionsData:e,extensionsDataBuffer:f})}let tw={stubThis:a=>a};var lq=lq,lg=lg;function tx(a,b=-7){return"string"==typeof a&&(a=lg.fromUTF8String(a)),lq.digest(a,b)}async function ty(a,b=[]){if(0===b.length)return!0;let c=await k$(),d=a.map(a=>new tn(a));for(let b=0;b<d.length;b++){let c=d[b],e=a[b];try{await tz(c)}catch(a){throw Error(`Found revoked certificate in x5c:
${e}`)}try{tA(c.notBefore,c.notAfter)}catch(a){throw Error(`Found certificate out of validity period in x5c:
${e}`)}}let e=b.map(a=>{try{return new tn(a)}catch(b){throw Error(`Could not parse trust anchor certificate:
${a}`,{cause:b})}}),f=[];for(let a=0;a<e.length;a++){let b=e[a];try{await tz(b)}catch(a){continue}try{tA(b.notBefore,b.notAfter)}catch(a){continue}f.push(b)}if(0===f.length)throw Error("No specified trust anchor was valid for verifying x5c");let g=!1;for(let a of e)try{let b=d.concat([a]);if(new Set(b).size!==b.length)throw Error("Invalid certificate path: found duplicate certificates");for(let a=0;a<b.length-1;a++){let d=b[a],e=b[a+1];if(!await d.verify({publicKey:e.publicKey,signatureOnly:!0},c))throw new tB;if(e.subject===e.issuer){if(!await e.verify({publicKey:e.publicKey,signatureOnly:!0},c))throw new tB;break}}g=!1;break}catch(a){if(a instanceof tB)g=!0;else throw Error("Unexpected error while validating certificate path",{cause:a})}if(g)throw new tB;return!0}async function tz(a){if(await tu(a))throw Error("Found revoked certificate in certificate path")}function tA(a,b){let c=new Date(Date.now());if(a>c||b<c)throw Error("Certificate is not yet valid or expired")}class tB extends Error{constructor(){super("Subject issuer did not match issuer subject"),this.name="InvalidSubjectAndIssuer"}}var lq=lq;function tC(a){let b;if("1.2.840.10045.4.3.2"===a)b=U.ES256;else if("1.2.840.10045.4.3.3"===a)b=U.ES384;else if("1.2.840.10045.4.3.4"===a)b=U.ES512;else if("1.2.840.113549.1.1.11"===a)b=U.RS256;else if("1.2.840.113549.1.1.12"===a)b=U.RS384;else if("1.2.840.113549.1.1.13"===a)b=U.RS512;else if("1.2.840.113549.1.1.5"===a)b=U.RS1;else throw Error(`Unable to map X.509 signature algorithm ${a} to a COSE algorithm`);return b}function tD(a){let b=new Map,{tbsCertificate:c}=nr.parse(a,oU),{subjectPublicKeyInfo:d,signature:e}=c,f=e.algorithm,g=d.algorithm.algorithm;if(g===p2){let a,c;if(!d.algorithm.parameters)throw Error("Certificate public key was missing parameters (EC2)");let e=nr.parse(new Uint8Array(d.algorithm.parameters),qj),g=-999,{namedCurve:h}=e;if(h===p8)g=T.P256;else if(h===p9)g=T.P384;else throw Error(`Certificate public key contained unexpected namedCurve ${h} (EC2)`);let i=new Uint8Array(d.subjectPublicKey);if(4===i[0]){let b=1,d=(i.length-1)/2;a=i.slice(b,b+=d),c=i.slice(b)}else throw Error('TODO: Figure out how to handle public keys in "compressed form"');let j=new Map;j.set(R.kty,S.EC2),j.set(R.alg,tC(f)),j.set(R.crv,g),j.set(R.x,a),j.set(R.y,c),b=j}else if(g===qn){let a=nr.parse(d.subjectPublicKey,qQ),c=new Map;c.set(R.kty,S.RSA),c.set(R.alg,tC(f)),c.set(R.n,new Uint8Array(a.modulus)),c.set(R.e,new Uint8Array(a.publicExponent)),b=c}else throw Error(`Certificate public key contained unexpected algorithm ID ${g}`);return b}function tE(a){let{signature:b,data:c,credentialPublicKey:d,x509Certificate:e,hashAlgorithm:f}=a;if(!e&&!d)throw Error('Must declare either "leafCert" or "credentialPublicKey"');if(e&&d)throw Error('Must not declare both "leafCert" and "credentialPublicKey"');let g=new Map;return d?g=lo(d):e&&(g=tD(e)),tF.stubThis(lq.verify({cosePublicKey:g,signature:b,data:c,shaHashOverride:f}))}let tF={stubThis:a=>a};a.i(87091);var tG=k4;async function tH(a){let b,{cosePublicKey:c,signature:d,data:e}=a,f=await k$(),g=c.get(R.alg),h=c.get(R.crv),i=c.get(R.x);if(!g)throw Error("Public key was missing alg (OKP)");if(!kY(g))throw Error(`Public key had invalid alg ${g} (OKP)`);if(!h)throw Error("Public key was missing crv (OKP)");if(!i)throw Error("Public key was missing x (OKP)");if(h===T.ED25519)b="Ed25519";else throw Error(`Unexpected COSE crv value of ${h} (OKP)`);let j={kty:"OKP",crv:b,alg:"EdDSA",x:tG.fromBuffer(i),ext:!1},k={name:b,namedCurve:b},l=await k3({keyData:j,algorithm:k}),m={name:b};return f.subtle.verify(m,l,d,e)}var lg=lg;function tI(a,b){let c;if(a.length<b)(c=new Uint8Array(b)).set(a,b-a.length);else if(a.length===b)c=a;else if(a.length===b+1&&0===a[0]&&(128&a[1])==128)c=a.subarray(1);else throw Error(`Invalid signature component length ${a.length}, expected ${b}`);return c}function tJ(a){let b,{cosePublicKey:c,signature:d,data:e,shaHashOverride:f}=a;if(kV(c)){let a,b,g,h,i,j,k=c.get(R.crv);if(!(Object.values(T).indexOf(k)>=0))throw Error(`unknown COSE curve ${k}`);return k5({cosePublicKey:c,signature:(b=new Uint8Array((a=nr.parse(d,ql)).r),g=new Uint8Array(a.s),i=tI(b,h=function(a){switch(a){case T.P256:return 32;case T.P384:return 48;case T.P521:return 66;default:throw Error(`Unexpected COSE crv value of ${a} (EC2)`)}}(k)),j=tI(g,h),lg.concat([i,j])),data:e,shaHashOverride:f})}if(kW(c))return k7({cosePublicKey:c,signature:d,data:e,shaHashOverride:f});if(kX(b=c.get(R.kty))&&b===S.OKP)return tH({cosePublicKey:c,signature:d,data:e});let g=c.get(R.kty);throw Error(`Signature verification with public key of kty ${g} is not supported by this method`)}var lq=lq;async function tK(){let a=new Uint8Array(32);return await lq.getRandomValues(a),tL.stubThis(a)}let tL={stubThis:a=>a};var k4=k4,lg=lg;let tM=[-8,-7,-36,-37,-38,-39,-257,-258,-259,-65535],tN={residentKey:"preferred",userVerification:"preferred"},tO=[-8,-7,-257];async function tP(a){let{rpName:b,rpID:c,userName:d,userID:e,challenge:f=await tK(),userDisplayName:g="",timeout:h=6e4,attestationType:i="none",excludeCredentials:j=[],authenticatorSelection:k=tN,extensions:l,supportedAlgorithmIDs:m=tO,preferredAuthenticatorType:n}=a,o=m.map(a=>({alg:a,type:"public-key"}));void 0===k.residentKey?k.requireResidentKey&&(k.residentKey="required"):k.requireResidentKey="required"===k.residentKey;let p=f;if("string"==typeof p&&(p=lg.fromUTF8String(p)),"string"==typeof e)throw Error("String values for `userID` are no longer supported. See https://simplewebauthn.dev/docs/advanced/server/custom-user-ids");let q=e;q||(q=await lr());let r=[];return n&&("securityKey"===n?(r.push("security-key"),k.authenticatorAttachment="cross-platform"):"localDevice"===n?(r.push("client-device"),k.authenticatorAttachment="platform"):"remoteDevice"===n&&(r.push("hybrid"),k.authenticatorAttachment="cross-platform")),{challenge:k4.fromBuffer(p),rp:{name:b,id:c},user:{id:k4.fromBuffer(q),name:d,displayName:g},pubKeyCredParams:o,timeout:h,attestation:i,excludeCredentials:j.map(a=>{if(!k4.isBase64URL(a.id))throw Error(`excludeCredential id "${a.id}" is not a valid base64url string`);return{...a,id:k4.trimPadding(a.id),type:"public-key"}}),authenticatorSelection:k,extensions:{...l,credProps:!0},hints:r}}function tQ({be:a,bs:b}){let c="singleDevice";if(a&&(c="multiDevice"),"singleDevice"===c&&b)throw new tR("Single-device credential indicated that it was backed up, which should be impossible.");return{credentialDeviceType:c,credentialBackedUp:b}}class tR extends Error{constructor(a){super(a),this.name="InvalidBackupFlags"}}var lg=lg;async function tS(a,b){try{return await Promise.any(b.map(b=>new Promise((c,d)=>{tx(lg.fromASCIIString(b)).then(e=>{lg.areEqual(a,e)?c(b):d()})})))}catch(a){if("AggregateError"===a.name)throw new tT;throw a}}class tT extends Error{constructor(){super("Unexpected RP ID hash"),this.name="UnexpectedRPIDHash"}}var k4=k4;let tU=`-----BEGIN CERTIFICATE-----
MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG
A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv
b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw05ODA5MDExMjAw
MDBaFw0yODAxMjgxMjAwMDBaMFcxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i
YWxTaWduIG52LXNhMRAwDgYDVQQLEwdSb290IENBMRswGQYDVQQDExJHbG9iYWxT
aWduIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDaDuaZ
jc6j40+Kfvvxi4Mla+pIH/EqsLmVEQS98GPR4mdmzxzdzxtIK+6NiY6arymAZavp
xy0Sy6scTHAHoT0KMM0VjU/43dSMUBUc71DuxC73/OlS8pF94G3VNTCOXkNz8kHp
1Wrjsok6Vjk4bwY8iGlbKk3Fp1S4bInMm/k8yuX9ifUSPJJ4ltbcdG6TRGHRjcdG
snUOhugZitVtbNV4FpWi6cgKOOvyJBNPc1STE4U6G7weNLWLBYy5d4ux2x8gkasJ
U26Qzns3dLlwR5EiUWMWea6xrkEmCMgZK9FGqkjWZCrXgzT/LCrBbBlDSgeF59N8
9iFo7+ryUp9/k5DPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E
BTADAQH/MB0GA1UdDgQWBBRge2YaRQ2XyolQL30EzTSo//z9SzANBgkqhkiG9w0B
AQUFAAOCAQEA1nPnfE920I2/7LqivjTFKDK1fPxsnCwrvQmeU79rXqoRSLblCKOz
yj1hTdNGCbM+w6DjY1Ub8rrvrTnhQ7k4o+YviiY776BQVvnGCv04zcQLcFGUl5gE
38NflNUVyRRBnMRddWQVDf9VMOyGj/8N7yy5Y0b2qvzfvGn9LhJIZJrglfCm7ymP
AbEVtQwdpf5pLGkkeB6zpxxxYu7KyJesF12KwvhHhm4qxFYxldBniYUr+WymXUad
DKqC5JlR3XC321Y9YeRq4VzW9v493kHMB65jUr9TU/Qr6cf9tveCX4XSQRjbgbME
HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==
-----END CERTIFICATE-----
`,tV=`-----BEGIN CERTIFICATE-----
MIIFYDCCA0igAwIBAgIJAOj6GWMU0voYMA0GCSqGSIb3DQEBCwUAMBsxGTAXBgNV
BAUTEGY5MjAwOWU4NTNiNmIwNDUwHhcNMTYwNTI2MTYyODUyWhcNMjYwNTI0MTYy
ODUyWjAbMRkwFwYDVQQFExBmOTIwMDllODUzYjZiMDQ1MIICIjANBgkqhkiG9w0B
AQEFAAOCAg8AMIICCgKCAgEAr7bHgiuxpwHsK7Qui8xUFmOr75gvMsd/dTEDDJdS
Sxtf6An7xyqpRR90PL2abxM1dEqlXnf2tqw1Ne4Xwl5jlRfdnJLmN0pTy/4lj4/7
tv0Sk3iiKkypnEUtR6WfMgH0QZfKHM1+di+y9TFRtv6y//0rb+T+W8a9nsNL/ggj
nar86461qO0rOs2cXjp3kOG1FEJ5MVmFmBGtnrKpa73XpXyTqRxB/M0n1n/W9nGq
C4FSYa04T6N5RIZGBN2z2MT5IKGbFlbC8UrW0DxW7AYImQQcHtGl/m00QLVWutHQ
oVJYnFPlXTcHYvASLu+RhhsbDmxMgJJ0mcDpvsC4PjvB+TxywElgS70vE0XmLD+O
JtvsBslHZvPBKCOdT0MS+tgSOIfga+z1Z1g7+DVagf7quvmag8jfPioyKvxnK/Eg
sTUVi2ghzq8wm27ud/mIM7AY2qEORR8Go3TVB4HzWQgpZrt3i5MIlCaY504LzSRi
igHCzAPlHws+W0rB5N+er5/2pJKnfBSDiCiFAVtCLOZ7gLiMm0jhO2B6tUXHI/+M
RPjy02i59lINMRRev56GKtcd9qO/0kUJWdZTdA2XoS82ixPvZtXQpUpuL12ab+9E
aDK8Z4RHJYYfCT3Q5vNAXaiWQ+8PTWm2QgBR/bkwSWc+NpUFgNPN9PvQi8WEg5Um
AGMCAwEAAaOBpjCBozAdBgNVHQ4EFgQUNmHhAHyIBQlRi0RsR/8aTMnqTxIwHwYD
VR0jBBgwFoAUNmHhAHyIBQlRi0RsR/8aTMnqTxIwDwYDVR0TAQH/BAUwAwEB/zAO
BgNVHQ8BAf8EBAMCAYYwQAYDVR0fBDkwNzA1oDOgMYYvaHR0cHM6Ly9hbmRyb2lk
Lmdvb2dsZWFwaXMuY29tL2F0dGVzdGF0aW9uL2NybC8wDQYJKoZIhvcNAQELBQAD
ggIBACDIw41L3KlXG0aMiS//cqrG+EShHUGo8HNsw30W1kJtjn6UBwRM6jnmiwfB
Pb8VA91chb2vssAtX2zbTvqBJ9+LBPGCdw/E53Rbf86qhxKaiAHOjpvAy5Y3m00m
qC0w/Zwvju1twb4vhLaJ5NkUJYsUS7rmJKHHBnETLi8GFqiEsqTWpG/6ibYCv7rY
DBJDcR9W62BW9jfIoBQcxUCUJouMPH25lLNcDc1ssqvC2v7iUgI9LeoM1sNovqPm
QUiG9rHli1vXxzCyaMTjwftkJLkf6724DFhuKug2jITV0QkXvaJWF4nUaHOTNA4u
JU9WDvZLI1j83A+/xnAJUucIv/zGJ1AMH2boHqF8CY16LpsYgBt6tKxxWH00XcyD
CdW2KlBCeqbQPcsFmWyWugxdcekhYsAWyoSf818NUsZdBWBaR/OukXrNLfkQ79Iy
ZohZbvabO/X+MVT3rriAoKc8oE2Uws6DF+60PV7/WIPjNvXySdqspImSN78mflxD
qwLqRBYkA3I75qppLGG9rp7UCdRjxMl8ZDBld+7yvHVgt1cVzJx9xnyGCC23Uaic
MDSXYrB4I4WHXPGjxhZuCuPBLTdOLU8YRvMYdEvYebWHMpvwGCF6bAx3JBpIeOQ1
wDB5y0USicV3YgYGmi+NZfhA4URSh77Yd6uuJOJENRaNVTzk
-----END CERTIFICATE-----
`,tW=`-----BEGIN CERTIFICATE-----
MIIFHDCCAwSgAwIBAgIJANUP8luj8tazMA0GCSqGSIb3DQEBCwUAMBsxGTAXBgNV
BAUTEGY5MjAwOWU4NTNiNmIwNDUwHhcNMTkxMTIyMjAzNzU4WhcNMzQxMTE4MjAz
NzU4WjAbMRkwFwYDVQQFExBmOTIwMDllODUzYjZiMDQ1MIICIjANBgkqhkiG9w0B
AQEFAAOCAg8AMIICCgKCAgEAr7bHgiuxpwHsK7Qui8xUFmOr75gvMsd/dTEDDJdS
Sxtf6An7xyqpRR90PL2abxM1dEqlXnf2tqw1Ne4Xwl5jlRfdnJLmN0pTy/4lj4/7
tv0Sk3iiKkypnEUtR6WfMgH0QZfKHM1+di+y9TFRtv6y//0rb+T+W8a9nsNL/ggj
nar86461qO0rOs2cXjp3kOG1FEJ5MVmFmBGtnrKpa73XpXyTqRxB/M0n1n/W9nGq
C4FSYa04T6N5RIZGBN2z2MT5IKGbFlbC8UrW0DxW7AYImQQcHtGl/m00QLVWutHQ
oVJYnFPlXTcHYvASLu+RhhsbDmxMgJJ0mcDpvsC4PjvB+TxywElgS70vE0XmLD+O
JtvsBslHZvPBKCOdT0MS+tgSOIfga+z1Z1g7+DVagf7quvmag8jfPioyKvxnK/Eg
sTUVi2ghzq8wm27ud/mIM7AY2qEORR8Go3TVB4HzWQgpZrt3i5MIlCaY504LzSRi
igHCzAPlHws+W0rB5N+er5/2pJKnfBSDiCiFAVtCLOZ7gLiMm0jhO2B6tUXHI/+M
RPjy02i59lINMRRev56GKtcd9qO/0kUJWdZTdA2XoS82ixPvZtXQpUpuL12ab+9E
aDK8Z4RHJYYfCT3Q5vNAXaiWQ+8PTWm2QgBR/bkwSWc+NpUFgNPN9PvQi8WEg5Um
AGMCAwEAAaNjMGEwHQYDVR0OBBYEFDZh4QB8iAUJUYtEbEf/GkzJ6k8SMB8GA1Ud
IwQYMBaAFDZh4QB8iAUJUYtEbEf/GkzJ6k8SMA8GA1UdEwEB/wQFMAMBAf8wDgYD
VR0PAQH/BAQDAgIEMA0GCSqGSIb3DQEBCwUAA4ICAQBOMaBc8oumXb2voc7XCWnu
XKhBBK3e2KMGz39t7lA3XXRe2ZLLAkLM5y3J7tURkf5a1SutfdOyXAmeE6SRo83U
h6WszodmMkxK5GM4JGrnt4pBisu5igXEydaW7qq2CdC6DOGjG+mEkN8/TA6p3cno
L/sPyz6evdjLlSeJ8rFBH6xWyIZCbrcpYEJzXaUOEaxxXxgYz5/cTiVKN2M1G2ok
QBUIYSY6bjEL4aUN5cfo7ogP3UvliEo3Eo0YgwuzR2v0KR6C1cZqZJSTnghIC/vA
D32KdNQ+c3N+vl2OTsUVMC1GiWkngNx1OO1+kXW+YTnnTUOtOIswUP/Vqd5SYgAI
mMAfY8U9/iIgkQj6T2W6FsScy94IN9fFhE1UtzmLoBIuUFsVXJMTz+Jucth+IqoW
Fua9v1R93/k98p41pjtFX+H8DslVgfP097vju4KDlqN64xV1grw3ZLl4CiOe/A91
oeLm2UHOq6wn3esB4r2EIQKb6jTVGu5sYCcdWpXr0AUVqcABPdgL+H7qJguBw09o
jm6xNIrw2OocrDKsudk/okr/AwqEyPKw9WnMlQgLIKw1rODG2NvU9oR3GVGdMkUB
ZutL8VuFkERQGt6vQ2OCw0sV47VMkuYbacK/xyZFiRcrPJPb41zgbQj9XAEyLKCH
ex0SdDrx+tWUDqG8At2JHA==
-----END CERTIFICATE-----
`,tX=`
-----BEGIN CERTIFICATE-----
MIIFHDCCAwSgAwIBAgIJAMNrfES5rhgxMA0GCSqGSIb3DQEBCwUAMBsxGTAXBgNV
BAUTEGY5MjAwOWU4NTNiNmIwNDUwHhcNMjExMTE3MjMxMDQyWhcNMzYxMTEzMjMx
MDQyWjAbMRkwFwYDVQQFExBmOTIwMDllODUzYjZiMDQ1MIICIjANBgkqhkiG9w0B
AQEFAAOCAg8AMIICCgKCAgEAr7bHgiuxpwHsK7Qui8xUFmOr75gvMsd/dTEDDJdS
Sxtf6An7xyqpRR90PL2abxM1dEqlXnf2tqw1Ne4Xwl5jlRfdnJLmN0pTy/4lj4/7
tv0Sk3iiKkypnEUtR6WfMgH0QZfKHM1+di+y9TFRtv6y//0rb+T+W8a9nsNL/ggj
nar86461qO0rOs2cXjp3kOG1FEJ5MVmFmBGtnrKpa73XpXyTqRxB/M0n1n/W9nGq
C4FSYa04T6N5RIZGBN2z2MT5IKGbFlbC8UrW0DxW7AYImQQcHtGl/m00QLVWutHQ
oVJYnFPlXTcHYvASLu+RhhsbDmxMgJJ0mcDpvsC4PjvB+TxywElgS70vE0XmLD+O
JtvsBslHZvPBKCOdT0MS+tgSOIfga+z1Z1g7+DVagf7quvmag8jfPioyKvxnK/Eg
sTUVi2ghzq8wm27ud/mIM7AY2qEORR8Go3TVB4HzWQgpZrt3i5MIlCaY504LzSRi
igHCzAPlHws+W0rB5N+er5/2pJKnfBSDiCiFAVtCLOZ7gLiMm0jhO2B6tUXHI/+M
RPjy02i59lINMRRev56GKtcd9qO/0kUJWdZTdA2XoS82ixPvZtXQpUpuL12ab+9E
aDK8Z4RHJYYfCT3Q5vNAXaiWQ+8PTWm2QgBR/bkwSWc+NpUFgNPN9PvQi8WEg5Um
AGMCAwEAAaNjMGEwHQYDVR0OBBYEFDZh4QB8iAUJUYtEbEf/GkzJ6k8SMB8GA1Ud
IwQYMBaAFDZh4QB8iAUJUYtEbEf/GkzJ6k8SMA8GA1UdEwEB/wQFMAMBAf8wDgYD
VR0PAQH/BAQDAgIEMA0GCSqGSIb3DQEBCwUAA4ICAQBTNNZe5cuf8oiq+jV0itTG
zWVhSTjOBEk2FQvh11J3o3lna0o7rd8RFHnN00q4hi6TapFhh4qaw/iG6Xg+xOan
63niLWIC5GOPFgPeYXM9+nBb3zZzC8ABypYuCusWCmt6Tn3+Pjbz3MTVhRGXuT/T
QH4KGFY4PhvzAyXwdjTOCXID+aHud4RLcSySr0Fq/L+R8TWalvM1wJJPhyRjqRCJ
erGtfBagiALzvhnmY7U1qFcS0NCnKjoO7oFedKdWlZz0YAfu3aGCJd4KHT0MsGiL
Zez9WP81xYSrKMNEsDK+zK5fVzw6jA7cxmpXcARTnmAuGUeI7VVDhDzKeVOctf3a
0qQLwC+d0+xrETZ4r2fRGNw2YEs2W8Qj6oDcfPvq9JySe7pJ6wcHnl5EZ0lwc4xH
7Y4Dx9RA1JlfooLMw3tOdJZH0enxPXaydfAD3YifeZpFaUzicHeLzVJLt9dvGB0b
HQLE4+EqKFgOZv2EoP686DQqbVS1u+9k0p2xbMA105TBIk7npraa8VM0fnrRKi7w
lZKwdH+aNAyhbXRW9xsnODJ+g8eF452zvbiKKngEKirK5LGieoXBX7tZ9D1GNBH2
Ob3bKOwwIWdEFle/YF/h6zWgdeoaNGDqVBrLr2+0DtWoiB1aDEjLWl9FmyIUyUm7
mD/vFDkzF+wm7cyWpQpCVQ==
-----END CERTIFICATE-----
`,tY=`
-----BEGIN CERTIFICATE-----
MIIFHDCCAwSgAwIBAgIJAPHBcqaZ6vUdMA0GCSqGSIb3DQEBCwUAMBsxGTAXBgNV
BAUTEGY5MjAwOWU4NTNiNmIwNDUwHhcNMjIwMzIwMTgwNzQ4WhcNNDIwMzE1MTgw
NzQ4WjAbMRkwFwYDVQQFExBmOTIwMDllODUzYjZiMDQ1MIICIjANBgkqhkiG9w0B
AQEFAAOCAg8AMIICCgKCAgEAr7bHgiuxpwHsK7Qui8xUFmOr75gvMsd/dTEDDJdS
Sxtf6An7xyqpRR90PL2abxM1dEqlXnf2tqw1Ne4Xwl5jlRfdnJLmN0pTy/4lj4/7
tv0Sk3iiKkypnEUtR6WfMgH0QZfKHM1+di+y9TFRtv6y//0rb+T+W8a9nsNL/ggj
nar86461qO0rOs2cXjp3kOG1FEJ5MVmFmBGtnrKpa73XpXyTqRxB/M0n1n/W9nGq
C4FSYa04T6N5RIZGBN2z2MT5IKGbFlbC8UrW0DxW7AYImQQcHtGl/m00QLVWutHQ
oVJYnFPlXTcHYvASLu+RhhsbDmxMgJJ0mcDpvsC4PjvB+TxywElgS70vE0XmLD+O
JtvsBslHZvPBKCOdT0MS+tgSOIfga+z1Z1g7+DVagf7quvmag8jfPioyKvxnK/Eg
sTUVi2ghzq8wm27ud/mIM7AY2qEORR8Go3TVB4HzWQgpZrt3i5MIlCaY504LzSRi
igHCzAPlHws+W0rB5N+er5/2pJKnfBSDiCiFAVtCLOZ7gLiMm0jhO2B6tUXHI/+M
RPjy02i59lINMRRev56GKtcd9qO/0kUJWdZTdA2XoS82ixPvZtXQpUpuL12ab+9E
aDK8Z4RHJYYfCT3Q5vNAXaiWQ+8PTWm2QgBR/bkwSWc+NpUFgNPN9PvQi8WEg5Um
AGMCAwEAAaNjMGEwHQYDVR0OBBYEFDZh4QB8iAUJUYtEbEf/GkzJ6k8SMB8GA1Ud
IwQYMBaAFDZh4QB8iAUJUYtEbEf/GkzJ6k8SMA8GA1UdEwEB/wQFMAMBAf8wDgYD
VR0PAQH/BAQDAgIEMA0GCSqGSIb3DQEBCwUAA4ICAQB8cMqTllHc8U+qCrOlg3H7
174lmaCsbo/bJ0C17JEgMLb4kvrqsXZs01U3mB/qABg/1t5Pd5AORHARs1hhqGIC
W/nKMav574f9rZN4PC2ZlufGXb7sIdJpGiO9ctRhiLuYuly10JccUZGEHpHSYM2G
tkgYbZba6lsCPYAAP83cyDV+1aOkTf1RCp/lM0PKvmxYN10RYsK631jrleGdcdkx
oSK//mSQbgcWnmAEZrzHoF1/0gso1HZgIn0YLzVhLSA/iXCX4QT2h3J5z3znluKG
1nv8NQdxei2DIIhASWfu804CA96cQKTTlaae2fweqXjdN1/v2nqOhngNyz1361mF
mr4XmaKH/ItTwOe72NI9ZcwS1lVaCvsIkTDCEXdm9rCNPAY10iTunIHFXRh+7KPz
lHGewCq/8TOohBRn0/NNfh7uRslOSZ/xKbN9tMBtw37Z8d2vvnXq/YWdsm1+JLVw
n6yYD/yacNJBlwpddla8eaVMjsF6nBnIgQOf9zKSe06nSTqvgwUHosgOECZJZ1Eu
zbH4yswbt02tKtKEFhx+v+OTge/06V+jGsqTWLsfrOCNLuA8H++z+pUENmpqnnHo
vaI47gC+TNpkgYGkkBT6B/m/U01BuOBBTzhIlMEZq9qkDWuM2cA5kW5V3FJUcfHn
w1IdYIg2Wxg7yHcQZemFQg==
-----END CERTIFICATE-----
`,tZ=`-----BEGIN CERTIFICATE-----
MIICEjCCAZmgAwIBAgIQaB0BbHo84wIlpQGUKEdXcTAKBggqhkjOPQQDAzBLMR8w
HQYDVQQDDBZBcHBsZSBXZWJBdXRobiBSb290IENBMRMwEQYDVQQKDApBcHBsZSBJ
bmMuMRMwEQYDVQQIDApDYWxpZm9ybmlhMB4XDTIwMDMxODE4MjEzMloXDTQ1MDMx
NTAwMDAwMFowSzEfMB0GA1UEAwwWQXBwbGUgV2ViQXV0aG4gUm9vdCBDQTETMBEG
A1UECgwKQXBwbGUgSW5jLjETMBEGA1UECAwKQ2FsaWZvcm5pYTB2MBAGByqGSM49
AgEGBSuBBAAiA2IABCJCQ2pTVhzjl4Wo6IhHtMSAzO2cv+H9DQKev3//fG59G11k
xu9eI0/7o6V5uShBpe1u6l6mS19S1FEh6yGljnZAJ+2GNP1mi/YK2kSXIuTHjxA/
pcoRf7XkOtO4o1qlcaNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUJtdk
2cV4wlpn0afeaxLQG2PxxtcwDgYDVR0PAQH/BAQDAgEGMAoGCCqGSM49BAMDA2cA
MGQCMFrZ+9DsJ1PW9hfNdBywZDsWDbWFp28it1d/5w2RPkRX3Bbn/UbDTNLx7Jr3
jAGGiQIwHFj+dJZYUJR786osByBelJYsVZd2GbHQu209b5RCmGQ21gpSAk9QZW4B
1bWeT0vT
-----END CERTIFICATE-----
`,t$=`-----BEGIN CERTIFICATE-----
MIIDXzCCAkegAwIBAgILBAAAAAABIVhTCKIwDQYJKoZIhvcNAQELBQAwTDEgMB4G
A1UECxMXR2xvYmFsU2lnbiBSb290IENBIC0gUjMxEzARBgNVBAoTCkdsb2JhbFNp
Z24xEzARBgNVBAMTCkdsb2JhbFNpZ24wHhcNMDkwMzE4MTAwMDAwWhcNMjkwMzE4
MTAwMDAwWjBMMSAwHgYDVQQLExdHbG9iYWxTaWduIFJvb3QgQ0EgLSBSMzETMBEG
A1UEChMKR2xvYmFsU2lnbjETMBEGA1UEAxMKR2xvYmFsU2lnbjCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBAMwldpB5BngiFvXAg7aEyiie/QV2EcWtiHL8
RgJDx7KKnQRfJMsuS+FggkbhUqsMgUdwbN1k0ev1LKMPgj0MK66X17YUhhB5uzsT
gHeMCOFJ0mpiLx9e+pZo34knlTifBtc+ycsmWQ1z3rDI6SYOgxXG71uL0gRgykmm
KPZpO/bLyCiR5Z2KYVc3rHQU3HTgOu5yLy6c+9C7v/U9AOEGM+iCK65TpjoWc4zd
QQ4gOsC0p6Hpsk+QLjJg6VfLuQSSaGjlOCZgdbKfd/+RFO+uIEn8rUAVSNECMWEZ
XriX7613t2Saer9fwRPvm2L7DWzgVGkWqQPabumDk3F2xmmFghcCAwEAAaNCMEAw
DgYDVR0PAQH/BAQDAgEGMA8GA1UdEwEB/wQFMAMBAf8wHQYDVR0OBBYEFI/wS3+o
LkUkrk1Q+mOai97i3Ru8MA0GCSqGSIb3DQEBCwUAA4IBAQBLQNvAUKr+yAzv95ZU
RUm7lgAJQayzE4aGKAczymvmdLm6AC2upArT9fHxD4q/c2dKg8dEe3jgr25sbwMp
jjM5RcOO5LlXbKr8EpbsU8Yt5CRsuZRj+9xTaGdWPoO4zzUhw8lo/s7awlOqzJCK
6fBdRoyV3XpYKBovHd7NADdBj+1EbddTKJd+82cEHhXXipa0095MJ6RMG3NzdvQX
mcIfeg7jLQitChws/zyrVQ4PkX4268NXSb7hLi18YIvDQVETI53O9zJrlAGomecs
Mx86OyXShkDOOyyGeMlhLxS67ttVb9+E7gUJTb0o2HLO02JQZR7rkpeDMdmztcpH
WD9f
-----END CERTIFICATE-----
 `,t_=new class{constructor(){Object.defineProperty(this,"pemCertificates",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pemCertificates=new Map}setRootCertificates(a){let{identifier:b,certificates:c}=a,d=[];for(let a of c)a instanceof Uint8Array?d.push(li(a)):d.push(a);this.pemCertificates.set(b,d)}getRootCertificates(a){let{identifier:b}=a;return this.pemCertificates.get(b)??[]}};t_.setRootCertificates({identifier:"android-key",certificates:[tV,tW,tX,tY]}),t_.setRootCertificates({identifier:"android-safetynet",certificates:[tU]}),t_.setRootCertificates({identifier:"apple",certificates:[tZ]}),t_.setRootCertificates({identifier:"mds",certificates:[t$]});var lg=lg;async function t0(a){let{attStmt:b,clientDataHash:c,rpIdHash:d,credentialID:e,credentialPublicKey:f,aaguid:g,rootCertificates:h}=a,i=Uint8Array.from([0]),j=lk(f),k=lg.concat([i,d,c,e,j]),l=b.get("sig"),m=b.get("x5c");if(!m)throw Error("No attestation certificate provided in attestation statement (FIDOU2F)");if(!l)throw Error("No attestation signature provided in attestation statement (FIDOU2F)");let n=Number.parseInt(lg.toHex(g),16);if(0!==n)throw Error(`AAGUID "${n}" was not expected value`);try{await ty(m.map(li),h)}catch(a){throw Error(`${a.message} (FIDOU2F)`)}return tE({signature:l,data:k,x509Certificate:m[0],hashAlgorithm:U.ES256})}var lg=lg,lg=lg;let t1="1.3.6.1.4.1.45724.1.1.4";function t2(a,b){if(!a)return!0;let c=a.find(a=>a.extnID===t1);if(!c)return!0;let d=new Uint8Array(nr.parse(c.extnValue,mX).buffer);if(!lg.areEqual(b,d)){let a=lg.toHex(d),c=lg.toHex(b);throw Error(`Certificate extension id-fido-gen-ce-aaguid (${t1}) value of "${a}" was present but not equal to attestation statement AAGUID value of "${c}"`)}return!0}var k4=k4,k4=k4,k4=k4,lg=lg;(L=bm||(bm={}))[L.DISABLED=0]="DISABLED",L[L.REFRESHING=1]="REFRESHING",L[L.READY=2]="READY";let t3=(a,...b)=>{},t4=new class{constructor(){Object.defineProperty(this,"mdsCache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"statementCache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:bm.DISABLED}),Object.defineProperty(this,"verificationMode",{enumerable:!0,configurable:!0,writable:!0,value:"strict"})}async initialize(a={}){let{mdsServers:b=["https://mds.fidoalliance.org/"],statements:c,verificationMode:d}=a;if(this.setState(bm.REFRESHING),c?.length){let a=0;c.forEach(b=>{b.aaguid&&(this.statementCache[b.aaguid]={entry:{metadataStatement:b,statusReports:[],timeOfLastStatusChange:"1970-01-01"},url:""},a+=1)}),t3(`Cached ${a} local statements`)}if(b?.length){let a=Object.keys(this.statementCache).length,c=b.length;for(let a of b)try{await this.downloadBlob({url:a,no:0,nextUpdate:new Date(0)})}catch(b){t3(`Could not download BLOB from ${a}:`,b),c-=1}let d=Object.keys(this.statementCache).length;t3(`Cached ${d-a} statements from ${c} metadata server(s)`)}d&&(this.verificationMode=d),this.setState(bm.READY)}async getStatement(a){if(this.state===bm.DISABLED||!a)return;a instanceof Uint8Array&&(a=lh(a)),await this.pauseUntilReady();let b=this.statementCache[a];if(!b){if("strict"===this.verificationMode)throw Error(`No metadata statement found for aaguid "${a}"`);return}if(b.url){let a=this.mdsCache[b.url];if(new Date>a.nextUpdate)try{this.setState(bm.REFRESHING),await this.downloadBlob(a)}finally{this.setState(bm.READY)}}let{entry:c}=b;for(let b of c.statusReports){let{status:c}=b;if("USER_VERIFICATION_BYPASS"===c||"ATTESTATION_KEY_COMPROMISE"===c||"USER_KEY_REMOTE_COMPROMISE"===c||"USER_KEY_PHYSICAL_COMPROMISE"===c)throw Error(`Detected compromised aaguid "${a}"`)}return c.metadataStatement}async downloadBlob(a){let b,c,{url:d,no:e}=a,f=await tr(d),g=await f.text(),h=(b=g.split("."),[JSON.parse(k4.toUTF8String(b[0])),JSON.parse(k4.toUTF8String(b[1])),b[2]]),i=h[0],j=h[1];if(j.no<=e)throw Error(`Latest BLOB no. "${j.no}" is not greater than previous ${e}`);let k=i.x5c.map(li);try{let a=t_.getRootCertificates({identifier:"mds"});await ty(k,a)}catch(a){throw Error("BLOB certificate path could not be validated",{cause:a})}let l=k[0];if(!await function(a,b){let[c,d,e]=a.split("."),f=tD(b),g=lg.fromUTF8String(`${c}.${d}`),h=k4.toBuffer(e);if(kV(f))return k5({data:g,signature:h,cosePublicKey:f,shaHashOverride:U.ES256});if(kW(f))return k7({data:g,signature:h,cosePublicKey:f});let i=f.get(R.kty);throw Error(`JWT verification with public key of kty ${i} is not supported by this method`)}(g,(c=l.replace("-----BEGIN CERTIFICATE-----","").replace("-----END CERTIFICATE-----","").replace(/[\n ]/g,""),k4.toBuffer(c,"base64"))))throw Error("BLOB signature could not be verified");for(let a of j.entries)a.aaguid&&(this.statementCache[a.aaguid]={entry:a,url:d});let[m,n,o]=j.nextUpdate.split("-");this.mdsCache[d]={...a,no:j.no,nextUpdate:new Date(parseInt(m,10),parseInt(n,10)-1,parseInt(o,10))}}pauseUntilReady(){return new Promise(this.state===bm.READY?a=>{a()}:(a,b)=>{let c=700,d=globalThis.setInterval(()=>{c<1?(clearInterval(d),b("State did not become ready in 70 seconds")):this.state===bm.READY&&(clearInterval(d),a()),c-=1},100)})}setState(a){this.state=a,a===bm.DISABLED?t3("MetadataService is DISABLED"):a===bm.REFRESHING?t3("MetadataService is REFRESHING"):a===bm.READY&&t3("MetadataService is READY")}};async function t5({statement:a,credentialPublicKey:b,x5c:c,attestationStatementAlg:d}){let{authenticationAlgorithms:e,authenticatorGetInfo:f,attestationRootCertificates:g}=a,h=new Set;e.forEach(a=>{let b=t6[a];b&&h.add(b)});let i=lo(b),j=i.get(R.kty),k=i.get(R.alg);if(!j)throw Error("Credential public key was missing kty");if(!k)throw Error("Credential public key was missing alg");if(!j)throw Error("Credential public key was missing kty");let l={kty:j,alg:k};kV(i)&&(l.crv=i.get(R.crv));let m=!1;for(let a of h)if(a.alg===l.alg&&a.kty===l.kty&&((a.kty===S.EC2||a.kty===S.OKP)&&a.crv===l.crv,m=!0),m)break;if(!m){let a=JSON.stringify(e.map(a=>`'${a}' (COSE info: ${t7(t6[a])})`),null,2).replace(/"/g,""),b=t7(l);throw Error(`Public key parameters ${b} did not match any of the following metadata algorithms:
${a}`)}if(void 0!==d&&f?.algorithms!==void 0){let a=f.algorithms.map(a=>a.alg);if(0>a.indexOf(d))throw Error(`Attestation statement alg ${d} did not match one of ${a}`)}let n=c.map(li),o=g.map(li),p=!1;if(1===n.length&&o.indexOf(n[0])>=0&&(p=!0),!p)try{await ty(n,o)}catch(a){throw Error(`Could not validate certificate path with any metadata root certificates: ${a.message}`)}return!0}let t6={secp256r1_ecdsa_sha256_raw:{kty:2,alg:-7,crv:1},secp256r1_ecdsa_sha256_der:{kty:2,alg:-7,crv:1},rsassa_pss_sha256_raw:{kty:3,alg:-37},rsassa_pss_sha256_der:{kty:3,alg:-37},secp256k1_ecdsa_sha256_raw:{kty:2,alg:-47,crv:8},secp256k1_ecdsa_sha256_der:{kty:2,alg:-47,crv:8},rsassa_pss_sha384_raw:{kty:3,alg:-38},rsassa_pkcsv15_sha256_raw:{kty:3,alg:-257},rsassa_pkcsv15_sha384_raw:{kty:3,alg:-258},rsassa_pkcsv15_sha512_raw:{kty:3,alg:-259},rsassa_pkcsv15_sha1_raw:{kty:3,alg:-65535},secp384r1_ecdsa_sha384_raw:{kty:2,alg:-35,crv:2},secp512r1_ecdsa_sha256_raw:{kty:2,alg:-36,crv:3},ed25519_eddsa_sha512_raw:{kty:1,alg:-8,crv:6}};function t7(a){let{kty:b,alg:c,crv:d}=a;return b!==S.RSA?`{ kty: ${b}, alg: ${c}, crv: ${d} }`:`{ kty: ${b}, alg: ${c} }`}async function t8(a){let{attStmt:b,clientDataHash:c,authData:d,credentialPublicKey:e,aaguid:f,rootCertificates:g}=a,h=b.get("sig"),i=b.get("x5c"),j=b.get("alg");if(!h)throw Error("No attestation signature provided in attestation statement (Packed)");if(!j)throw Error("Attestation statement did not contain alg (Packed)");if(!kY(j))throw Error(`Attestation statement contained invalid alg ${j} (Packed)`);let k=lg.concat([d,c]),l=!1;if(i){let{subject:a,basicConstraintsCA:b,version:c,notBefore:d,notAfter:m,parsedCertificate:n}=oZ(i[0]),{OU:o,CN:p,O:q,C:r}=a;if("Authenticator Attestation"!==o)throw Error('Certificate OU was not "Authenticator Attestation" (Packed|Full)');if(!p)throw Error("Certificate CN was empty (Packed|Full)");if(!q)throw Error("Certificate O was empty (Packed|Full)");if(!r||2!==r.length)throw Error("Certificate C was not two-character ISO 3166 code (Packed|Full)");if(b)throw Error("Certificate basic constraints CA was not `false` (Packed|Full)");if(2!==c)throw Error("Certificate version was not `3` (ASN.1 value of 2) (Packed|Full)");let s=new Date;if(d>s)throw Error(`Certificate not good before "${d.toString()}" (Packed|Full)`);if(m<(s=new Date))throw Error(`Certificate not good after "${m.toString()}" (Packed|Full)`);try{await t2(n.tbsCertificate.extensions,f)}catch(a){throw Error(`${a.message} (Packed|Full)`)}let t=await t4.getStatement(f);if(t){if(0>t.attestationTypes.indexOf("basic_full"))throw Error("Metadata does not indicate support for full attestations (Packed|Full)");try{await t5({statement:t,credentialPublicKey:e,x5c:i,attestationStatementAlg:j})}catch(a){throw Error(`${a.message} (Packed|Full)`)}}else try{await ty(i.map(li),g)}catch(a){throw Error(`${a.message} (Packed|Full)`)}l=await tE({signature:h,data:k,x509Certificate:i[0]})}else l=await tE({signature:h,data:k,credentialPublicKey:e,hashAlgorithm:j});return l}var k4=k4,lg=lg;async function t9(a){let{attStmt:b,clientDataHash:c,authData:d,aaguid:e,rootCertificates:f,verifyTimestampMS:g=!0,credentialPublicKey:h,attestationSafetyNetEnforceCTSCheck:i}=a,j=b.get("alg"),k=b.get("response");if(!b.get("ver"))throw Error("No ver value in attestation (SafetyNet)");if(!k)throw Error("No response was included in attStmt by authenticator (SafetyNet)");let l=lg.toUTF8String(k).split("."),m=JSON.parse(k4.toUTF8String(l[0])),n=JSON.parse(k4.toUTF8String(l[1])),o=l[2],{nonce:p,ctsProfileMatch:q,timestampMs:r}=n;if(g){let a=Date.now();if(r>Date.now())throw Error(`Payload timestamp "${r}" was later than "${a}" (SafetyNet)`);let b=r+6e4;if(b<(a=Date.now()))throw Error(`Payload timestamp "${b}" has expired (SafetyNet)`)}let s=lg.concat([d,c]),t=await tx(s);if(p!==k4.fromBuffer(t,"base64"))throw Error("Could not verify payload nonce (SafetyNet)");if(i&&!q)throw Error("Could not verify device integrity (SafetyNet)");let u=k4.toBuffer(m.x5c[0],"base64"),{subject:v}=oZ(u);if("attest.android.com"!==v.CN)throw Error('Certificate common name was not "attest.android.com" (SafetyNet)');let w=await t4.getStatement(e);if(w)try{await t5({statement:w,credentialPublicKey:h,x5c:m.x5c,attestationStatementAlg:j})}catch(a){throw Error(`${a.message} (SafetyNet)`)}else try{await ty(m.x5c.map(li),f)}catch(a){throw Error(`${a.message} (SafetyNet)`)}let x=lg.fromUTF8String(`${l[0]}.${l[1]}`),y=k4.toBuffer(o);return await tE({signature:y,data:x,x509Certificate:u})}var lg=lg;let ua={196:"TPM_ST_RSP_COMMAND",32768:"TPM_ST_NULL",32769:"TPM_ST_NO_SESSIONS",32770:"TPM_ST_SESSIONS",32788:"TPM_ST_ATTEST_NV",32789:"TPM_ST_ATTEST_COMMAND_AUDIT",32790:"TPM_ST_ATTEST_SESSION_AUDIT",32791:"TPM_ST_ATTEST_CERTIFY",32792:"TPM_ST_ATTEST_QUOTE",32793:"TPM_ST_ATTEST_TIME",32794:"TPM_ST_ATTEST_CREATION",32801:"TPM_ST_CREATION",32802:"TPM_ST_VERIFIED",32803:"TPM_ST_AUTH_SECRET",32804:"TPM_ST_HASHCHECK",32805:"TPM_ST_AUTH_SIGNED",32809:"TPM_ST_FU_MANIFEST"},ub={0:"TPM_ALG_ERROR",1:"TPM_ALG_RSA",4:"TPM_ALG_SHA",4:"TPM_ALG_SHA1",5:"TPM_ALG_HMAC",6:"TPM_ALG_AES",7:"TPM_ALG_MGF1",8:"TPM_ALG_KEYEDHASH",10:"TPM_ALG_XOR",11:"TPM_ALG_SHA256",12:"TPM_ALG_SHA384",13:"TPM_ALG_SHA512",16:"TPM_ALG_NULL",18:"TPM_ALG_SM3_256",19:"TPM_ALG_SM4",20:"TPM_ALG_RSASSA",21:"TPM_ALG_RSAES",22:"TPM_ALG_RSAPSS",23:"TPM_ALG_OAEP",24:"TPM_ALG_ECDSA",25:"TPM_ALG_ECDH",26:"TPM_ALG_ECDAA",27:"TPM_ALG_SM2",28:"TPM_ALG_ECSCHNORR",29:"TPM_ALG_ECMQV",32:"TPM_ALG_KDF1_SP800_56A",33:"TPM_ALG_KDF2",34:"TPM_ALG_KDF1_SP800_108",35:"TPM_ALG_ECC",37:"TPM_ALG_SYMCIPHER",38:"TPM_ALG_CAMELLIA",64:"TPM_ALG_CTR",65:"TPM_ALG_OFB",66:"TPM_ALG_CBC",67:"TPM_ALG_CFB",68:"TPM_ALG_ECB"},uc={0:"TPM_ECC_NONE",1:"TPM_ECC_NIST_P192",2:"TPM_ECC_NIST_P224",3:"TPM_ECC_NIST_P256",4:"TPM_ECC_NIST_P384",5:"TPM_ECC_NIST_P521",16:"TPM_ECC_BN_P256",17:"TPM_ECC_BN_P638",32:"TPM_ECC_SM2_P256"},ud={"id:414D4400":{name:"AMD",id:"AMD"},"id:414E5400":{name:"Ant Group",id:"ANT"},"id:41544D4C":{name:"Atmel",id:"ATML"},"id:4252434D":{name:"Broadcom",id:"BRCM"},"id:4353434F":{name:"Cisco",id:"CSCO"},"id:464C5953":{name:"Flyslice Technologies",id:"FLYS"},"id:524F4343":{name:"Fuzhou Rockchip",id:"ROCC"},"id:474F4F47":{name:"Google",id:"GOOG"},"id:48504900":{name:"HPI",id:"HPI"},"id:48504500":{name:"HPE",id:"HPE"},"id:48495349":{name:"Huawei",id:"HISI"},"id:49424d00":{name:"IBM",id:"IBM"},"id:49424D00":{name:"IBM",id:"IBM"},"id:49465800":{name:"Infineon",id:"IFX"},"id:494E5443":{name:"Intel",id:"INTC"},"id:4C454E00":{name:"Lenovo",id:"LEN"},"id:4D534654":{name:"Microsoft",id:"MSFT"},"id:4E534D20":{name:"National Semiconductor",id:"NSM"},"id:4E545A00":{name:"Nationz",id:"NTZ"},"id:4E534700":{name:"NSING",id:"NSG"},"id:4E544300":{name:"Nuvoton Technology",id:"NTC"},"id:51434F4D":{name:"Qualcomm",id:"QCOM"},"id:534D534E":{name:"Samsung",id:"SMSN"},"id:53454345":{name:"SecEdge",id:"SECE"},"id:534E5300":{name:"Sinosun",id:"SNS"},"id:534D5343":{name:"SMSC",id:"SMSC"},"id:53544D20":{name:"STMicroelectronics",id:"STM"},"id:54584E00":{name:"Texas Instruments",id:"TXN"},"id:57454300":{name:"Winbond",id:"WEC"},"id:5345414C":{name:"Wisekey",id:"SEAL"},"id:FFFFF1D0":{name:"FIDO Alliance",id:"FIDO"}},ue={TPM_ECC_NIST_P256:1,TPM_ECC_NIST_P384:2,TPM_ECC_NIST_P521:3,TPM_ECC_BN_P256:1,TPM_ECC_SM2_P256:1};var lg=lg,lg=lg;async function uf(a){let b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,{aaguid:z,attStmt:A,authData:B,credentialPublicKey:C,clientDataHash:D,rootCertificates:E}=a,F=A.get("ver"),G=A.get("sig"),H=A.get("alg"),I=A.get("x5c"),J=A.get("pubArea"),K=A.get("certInfo");if("2.0"!==F)throw Error(`Unexpected ver "${F}", expected "2.0" (TPM)`);if(!G)throw Error("No attestation signature provided in attestation statement (TPM)");if(!H)throw Error("Attestation statement did not contain alg (TPM)");if(!kY(H))throw Error(`Attestation statement contained invalid alg ${H} (TPM)`);if(!I)throw Error("No attestation certificate provided in attestation statement (TPM)");if(!J)throw Error("Attestation statement did not contain pubArea (TPM)");if(!K)throw Error("Attestation statement did not contain certInfo (TPM)");let{unique:L,type:M,parameters:N}=function(a){let b=0,c=lg.toDataView(a),d=ub[c.getUint16(b)];b+=2;let e=ub[c.getUint16(b)];b+=2;let f=c.getUint32(b);b+=4;let g=c.getUint16(b);b+=2;let h=a.slice(b,b+=g),i={},j=Uint8Array.from([]);if("TPM_ALG_RSA"===d){let d=ub[c.getUint16(b)];b+=2;let e=ub[c.getUint16(b)];b+=2;let f=c.getUint16(b);b+=2;let g=c.getUint32(b);b+=4,i.rsa={symmetric:d,scheme:e,keyBits:f,exponent:g};let h=c.getUint16(b);b+=2,j=a.slice(b,b+=h)}else if("TPM_ALG_ECC"===d){let d=ub[c.getUint16(b)];b+=2;let e=ub[c.getUint16(b)];b+=2;let f=uc[c.getUint16(b)];b+=2;let g=ub[c.getUint16(b)];b+=2,i.ecc={symmetric:d,scheme:e,curveID:f,kdf:g};let h=c.getUint16(b);b+=2;let k=a.slice(b,b+=h),l=c.getUint16(b);b+=2;let m=a.slice(b,b+=l);j=lg.concat([k,m])}else throw Error(`Unexpected type "${d}" (TPM)`);return{type:d,nameAlg:e,objectAttributes:{fixedTPM:!!(1&f),stClear:!!(2&f),fixedParent:!!(8&f),sensitiveDataOrigin:!!(16&f),userWithAuth:!!(32&f),adminWithPolicy:!!(64&f),noDA:!!(512&f),encryptedDuplication:!!(1024&f),restricted:!!(32768&f),decrypt:!!(65536&f),signOrEncrypt:!!(131072&f)},authPolicy:h,parameters:i,unique:j}}(J),O=lo(C);if("TPM_ALG_RSA"===M){if(!kW(O))throw Error(`Credential public key with kty ${O.get(R.kty)} did not match ${M}`);let a=O.get(R.n),b=O.get(R.e);if(!a)throw Error("COSE public key missing n (TPM|RSA)");if(!b)throw Error("COSE public key missing e (TPM|RSA)");if(!lg.areEqual(L,a))throw Error("PubArea unique is not same as credentialPublicKey (TPM|RSA)");if(!N.rsa)throw Error("Parsed pubArea type is RSA, but missing parameters.rsa (TPM|RSA)");let c=N.rsa.exponent||65537,d=b[0]+(b[1]<<8)+(b[2]<<16);if(c!==d)throw Error(`Unexpected public key exp ${d}, expected ${c} (TPM|RSA)`)}else if("TPM_ALG_ECC"===M){if(!kV(O))throw Error(`Credential public key with kty ${O.get(R.kty)} did not match ${M}`);let a=O.get(R.crv),b=O.get(R.x),c=O.get(R.y);if(!a)throw Error("COSE public key missing crv (TPM|ECC)");if(!b)throw Error("COSE public key missing x (TPM|ECC)");if(!c)throw Error("COSE public key missing y (TPM|ECC)");if(!lg.areEqual(L,lg.concat([b,c])))throw Error("PubArea unique is not same as public key x and y (TPM|ECC)");if(!N.ecc)throw Error("Parsed pubArea type is ECC, but missing parameters.ecc (TPM|ECC)");let d=N.ecc.curveID,e=ue[d];if(e!==a)throw Error(`Public area key curve ID "${d}" mapped to "${e}" which did not match public key crv of "${a}" (TPM|ECC)`)}else throw Error(`Unsupported pubArea.type "${M}"`);let{magic:P,type:Q,attested:S,extraData:T}=(g=0,i=(h=lg.toDataView(K)).getUint32(g),g+=4,j=h.getUint16(g),g+=2,k=ua[j],l=h.getUint16(g),g+=2,m=K.slice(g,g+=l),n=h.getUint16(g),g+=2,o=K.slice(g,g+=n),p=K.slice(g,g+=8),q=h.getUint32(g),g+=4,r=h.getUint32(g),g+=4,s=!!K.slice(g,g+=1),t=K.slice(g,g+=8),u=h.getUint16(g),g+=2,v=K.slice(g,g+=u),w=lg.toDataView(v),x=h.getUint16(g),g+=2,y=K.slice(g,g+=x),{magic:i,type:k,qualifiedSigner:m,extraData:o,clockInfo:{clock:p,resetCount:q,restartCount:r,safe:s},firmwareVersion:t,attested:{nameAlg:ub[w.getUint16(0)],nameAlgBuffer:v.slice(0,2),name:v,qualifiedName:y}});if(0xff544347!==P)throw Error(`Unexpected magic value "${P}", expected "0xff544347" (TPM)`);if("TPM_ST_ATTEST_CERTIFY"!==Q)throw Error(`Unexpected type "${Q}", expected "TPM_ST_ATTEST_CERTIFY" (TPM)`);let V=await tx(J,function(a){if("TPM_ALG_SHA256"===a)return U.ES256;if("TPM_ALG_SHA384"===a)return U.ES384;if("TPM_ALG_SHA512"===a)return U.ES512;throw Error(`Unexpected TPM attested name alg ${a}`)}(S.nameAlg)),W=lg.concat([S.nameAlgBuffer,V]);if(!lg.areEqual(S.name,W))throw Error("Attested name comparison failed (TPM)");let X=lg.concat([B,D]),Y=await tx(X,H);if(!lg.areEqual(T,Y))throw Error("CertInfo extra data did not equal hashed attestation (TPM)");if(I.length<1)throw Error("No certificates present in x5c array (TPM)");let{basicConstraintsCA:Z,version:$,subject:_,notAfter:aa,notBefore:ab}=oZ(I[0]);if(Z)throw Error("Certificate basic constraints CA was not `false` (TPM)");if(2!==$)throw Error("Certificate version was not `3` (ASN.1 value of 2) (TPM)");if(_.combined.length>0)throw Error("Certificate subject was not empty (TPM)");let ac=new Date;if(ab>ac)throw Error(`Certificate not good before "${ab.toString()}" (TPM)`);if(aa<(ac=new Date))throw Error(`Certificate not good after "${aa.toString()}" (TPM)`);let ad=nr.parse(I[0],oU);if(!ad.tbsCertificate.extensions)throw Error("Certificate was missing extensions (TPM)");if(ad.tbsCertificate.extensions.forEach(a=>{a.extnID===oD?e=nr.parse(a.extnValue,oE):a.extnID===oi&&(f=nr.parse(a.extnValue,oj))}),!e)throw Error("Certificate did not contain subjectAltName extension (TPM)");if(!e[0].directoryName?.[0].length)throw Error("Certificate subjectAltName extension directoryName was empty (TPM)");let{tcgAtTpmManufacturer:ae,tcgAtTpmModel:af,tcgAtTpmVersion:ag}=(e[0].directoryName.forEach(a=>{a.forEach(a=>{"2.23.133.2.1"===a.type?b=a.value.toString():"2.23.133.2.2"===a.type?c=a.value.toString():"2.23.133.2.3"===a.type&&(d=a.value.toString())})}),{tcgAtTpmManufacturer:b,tcgAtTpmModel:c,tcgAtTpmVersion:d});if(!ae||!af||!ag)throw Error("Certificate contained incomplete subjectAltName data (TPM)");if(!f)throw Error("Certificate did not contain ExtendedKeyUsage extension (TPM)");if(!ud[ae])throw Error(`Could not match TPM manufacturer "${ae}" (TPM)`);if("2.23.133.8.3"!==f[0])throw Error(`Unexpected extKeyUsage "${f[0]}", expected "2.23.133.8.3" (TPM)`);try{await t2(ad.tbsCertificate.extensions,z)}catch(a){throw Error(`${a.message} (TPM)`)}let ah=await t4.getStatement(z);if(ah)try{await t5({statement:ah,credentialPublicKey:C,x5c:I,attestationStatementAlg:H})}catch(a){throw Error(`${a.message} (TPM)`)}else try{await ty(I.map(li),E)}catch(a){throw Error(`${a.message} (TPM)`)}return tE({signature:G,data:K,x509Certificate:I[0],hashAlgorithm:H})}(M=bo||(bo={}))[M.verified=0]="verified",M[M.selfSigned=1]="selfSigned",M[M.unverified=2]="unverified",M[M.failed=3]="failed";class ug{constructor(a={}){this.verifiedBootKey=new mX,this.deviceLocked=!1,this.verifiedBootState=bo.verified,Object.assign(this,a)}}nv([np({type:mX})],ug.prototype,"verifiedBootKey",void 0),nv([np({type:Y.Boolean})],ug.prototype,"deviceLocked",void 0),nv([np({type:Y.Enumerated})],ug.prototype,"verifiedBootState",void 0),nv([np({type:mX,optional:!0})],ug.prototype,"verifiedBootHash",void 0);let uh=bn=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,bn.prototype)}};uh=bn=nv([no({type:X.Set,itemType:Y.Integer})],uh);class ui{constructor(a={}){Object.assign(this,a)}}nv([np({context:1,type:uh,optional:!0})],ui.prototype,"purpose",void 0),nv([np({context:2,type:Y.Integer,optional:!0})],ui.prototype,"algorithm",void 0),nv([np({context:3,type:Y.Integer,optional:!0})],ui.prototype,"keySize",void 0),nv([np({context:5,type:uh,optional:!0})],ui.prototype,"digest",void 0),nv([np({context:6,type:uh,optional:!0})],ui.prototype,"padding",void 0),nv([np({context:10,type:Y.Integer,optional:!0})],ui.prototype,"ecCurve",void 0),nv([np({context:200,type:Y.Integer,optional:!0})],ui.prototype,"rsaPublicExponent",void 0),nv([np({context:203,type:uh,optional:!0})],ui.prototype,"mgfDigest",void 0),nv([np({context:303,type:Y.Null,optional:!0})],ui.prototype,"rollbackResistance",void 0),nv([np({context:305,type:Y.Null,optional:!0})],ui.prototype,"earlyBootOnly",void 0),nv([np({context:400,type:Y.Integer,optional:!0})],ui.prototype,"activeDateTime",void 0),nv([np({context:401,type:Y.Integer,optional:!0})],ui.prototype,"originationExpireDateTime",void 0),nv([np({context:402,type:Y.Integer,optional:!0})],ui.prototype,"usageExpireDateTime",void 0),nv([np({context:405,type:Y.Integer,optional:!0})],ui.prototype,"usageCountLimit",void 0),nv([np({context:503,type:Y.Null,optional:!0})],ui.prototype,"noAuthRequired",void 0),nv([np({context:504,type:Y.Integer,optional:!0})],ui.prototype,"userAuthType",void 0),nv([np({context:505,type:Y.Integer,optional:!0})],ui.prototype,"authTimeout",void 0),nv([np({context:506,type:Y.Null,optional:!0})],ui.prototype,"allowWhileOnBody",void 0),nv([np({context:507,type:Y.Null,optional:!0})],ui.prototype,"trustedUserPresenceRequired",void 0),nv([np({context:508,type:Y.Null,optional:!0})],ui.prototype,"trustedConfirmationRequired",void 0),nv([np({context:509,type:Y.Null,optional:!0})],ui.prototype,"unlockedDeviceRequired",void 0),nv([np({context:600,type:Y.Null,optional:!0})],ui.prototype,"allApplications",void 0),nv([np({context:601,type:mX,optional:!0})],ui.prototype,"applicationId",void 0),nv([np({context:701,type:Y.Integer,optional:!0})],ui.prototype,"creationDateTime",void 0),nv([np({context:702,type:Y.Integer,optional:!0})],ui.prototype,"origin",void 0),nv([np({context:703,type:Y.Null,optional:!0})],ui.prototype,"rollbackResistant",void 0),nv([np({context:704,type:ug,optional:!0})],ui.prototype,"rootOfTrust",void 0),nv([np({context:705,type:Y.Integer,optional:!0})],ui.prototype,"osVersion",void 0),nv([np({context:706,type:Y.Integer,optional:!0})],ui.prototype,"osPatchLevel",void 0),nv([np({context:709,type:mX,optional:!0})],ui.prototype,"attestationApplicationId",void 0),nv([np({context:710,type:mX,optional:!0})],ui.prototype,"attestationIdBrand",void 0),nv([np({context:711,type:mX,optional:!0})],ui.prototype,"attestationIdDevice",void 0),nv([np({context:712,type:mX,optional:!0})],ui.prototype,"attestationIdProduct",void 0),nv([np({context:713,type:mX,optional:!0})],ui.prototype,"attestationIdSerial",void 0),nv([np({context:714,type:mX,optional:!0})],ui.prototype,"attestationIdImei",void 0),nv([np({context:715,type:mX,optional:!0})],ui.prototype,"attestationIdMeid",void 0),nv([np({context:716,type:mX,optional:!0})],ui.prototype,"attestationIdManufacturer",void 0),nv([np({context:717,type:mX,optional:!0})],ui.prototype,"attestationIdModel",void 0),nv([np({context:718,type:Y.Integer,optional:!0})],ui.prototype,"vendorPatchLevel",void 0),nv([np({context:719,type:Y.Integer,optional:!0})],ui.prototype,"bootPatchLevel",void 0),nv([np({context:720,type:Y.Null,optional:!0})],ui.prototype,"deviceUniqueAttestation",void 0),nv([np({context:723,type:mX,optional:!0})],ui.prototype,"attestationIdSecondImei",void 0),nv([np({context:724,type:mX,optional:!0})],ui.prototype,"moduleHash",void 0),(N=bp||(bp={}))[N.software=0]="software",N[N.trustedEnvironment=1]="trustedEnvironment",N[N.strongBox=2]="strongBox",(O=bq||(bq={}))[O.KM2=1]="KM2",O[O.KM3=2]="KM3",O[O.KM4=3]="KM4",O[O.KM4_1=4]="KM4_1",O[O.keyMint1=100]="keyMint1",O[O.keyMint2=200]="keyMint2",O[O.keyMint3=300]="keyMint3",O[O.keyMint4=400]="keyMint4";class uj{constructor(a={}){this.attestationVersion=bq.KM4,this.attestationSecurityLevel=bp.software,this.keymasterVersion=0,this.keymasterSecurityLevel=bp.software,this.attestationChallenge=new mX,this.uniqueId=new mX,this.softwareEnforced=new ui,this.teeEnforced=new ui,Object.assign(this,a)}}nv([np({type:Y.Integer})],uj.prototype,"attestationVersion",void 0),nv([np({type:Y.Enumerated})],uj.prototype,"attestationSecurityLevel",void 0),nv([np({type:Y.Integer})],uj.prototype,"keymasterVersion",void 0),nv([np({type:Y.Enumerated})],uj.prototype,"keymasterSecurityLevel",void 0),nv([np({type:mX})],uj.prototype,"attestationChallenge",void 0),nv([np({type:mX})],uj.prototype,"uniqueId",void 0),nv([np({type:ui})],uj.prototype,"softwareEnforced",void 0),nv([np({type:ui})],uj.prototype,"teeEnforced",void 0);class uk{constructor(a={}){this.attestationVersion=bq.keyMint4,this.attestationSecurityLevel=bp.software,this.keyMintVersion=0,this.keyMintSecurityLevel=bp.software,this.attestationChallenge=new mX,this.uniqueId=new mX,this.softwareEnforced=new ui,this.hardwareEnforced=new ui,Object.assign(this,a)}toLegacyKeyDescription(){return new uj({attestationVersion:this.attestationVersion,attestationSecurityLevel:this.attestationSecurityLevel,keymasterVersion:this.keyMintVersion,keymasterSecurityLevel:this.keyMintSecurityLevel,attestationChallenge:this.attestationChallenge,uniqueId:this.uniqueId,softwareEnforced:this.softwareEnforced,teeEnforced:this.hardwareEnforced})}static fromLegacyKeyDescription(a){return new uk({attestationVersion:a.attestationVersion,attestationSecurityLevel:a.attestationSecurityLevel,keyMintVersion:a.keymasterVersion,keyMintSecurityLevel:a.keymasterSecurityLevel,attestationChallenge:a.attestationChallenge,uniqueId:a.uniqueId,softwareEnforced:a.softwareEnforced,hardwareEnforced:a.teeEnforced})}}nv([np({type:Y.Integer})],uk.prototype,"attestationVersion",void 0),nv([np({type:Y.Enumerated})],uk.prototype,"attestationSecurityLevel",void 0),nv([np({type:Y.Integer})],uk.prototype,"keyMintVersion",void 0),nv([np({type:Y.Enumerated})],uk.prototype,"keyMintSecurityLevel",void 0),nv([np({type:mX})],uk.prototype,"attestationChallenge",void 0),nv([np({type:mX})],uk.prototype,"uniqueId",void 0),nv([np({type:ui})],uk.prototype,"softwareEnforced",void 0),nv([np({type:ui})],uk.prototype,"hardwareEnforced",void 0);let ul=class extends ui{};ul=nv([no({type:X.Choice})],ul);let um=br=class extends nt{constructor(a){super(a),Object.setPrototypeOf(this,br.prototype)}findProperty(a){let b=this.find(b=>a in b);if(b)return b[a]}};um=br=nv([no({type:X.Sequence,itemType:ul})],um);class un{get keyMintVersion(){return this.keymasterVersion}set keyMintVersion(a){this.keymasterVersion=a}get keyMintSecurityLevel(){return this.keymasterSecurityLevel}set keyMintSecurityLevel(a){this.keymasterSecurityLevel=a}get hardwareEnforced(){return this.teeEnforced}set hardwareEnforced(a){this.teeEnforced=a}constructor(a={}){this.attestationVersion=bq.KM4,this.attestationSecurityLevel=bp.software,this.keymasterVersion=0,this.keymasterSecurityLevel=bp.software,this.attestationChallenge=new mX,this.uniqueId=new mX,this.softwareEnforced=new um,this.teeEnforced=new um,Object.assign(this,a)}}nv([np({type:Y.Integer})],un.prototype,"attestationVersion",void 0),nv([np({type:Y.Enumerated})],un.prototype,"attestationSecurityLevel",void 0),nv([np({type:Y.Integer})],un.prototype,"keymasterVersion",void 0),nv([np({type:Y.Enumerated})],un.prototype,"keymasterSecurityLevel",void 0),nv([np({type:mX})],un.prototype,"attestationChallenge",void 0),nv([np({type:mX})],un.prototype,"uniqueId",void 0),nv([np({type:um})],un.prototype,"softwareEnforced",void 0),nv([np({type:um})],un.prototype,"teeEnforced",void 0);let uo=class extends un{constructor(a={}){"keymasterVersion"in a&&!("keyMintVersion"in a)&&(a.keyMintVersion=a.keymasterVersion),"keymasterSecurityLevel"in a&&!("keyMintSecurityLevel"in a)&&(a.keyMintSecurityLevel=a.keymasterSecurityLevel),"teeEnforced"in a&&!("hardwareEnforced"in a)&&(a.hardwareEnforced=a.teeEnforced),super(a)}};uo=nv([no({type:X.Sequence})],uo);class up{constructor(a={}){Object.assign(this,a)}}nv([np({type:Y.OctetString})],up.prototype,"packageName",void 0),nv([np({type:Y.Integer})],up.prototype,"version",void 0);class uq{constructor(a={}){Object.assign(this,a)}}nv([np({type:up,repeated:"set"})],uq.prototype,"packageInfos",void 0),nv([np({type:Y.OctetString,repeated:"set"})],uq.prototype,"signatureDigests",void 0);var lg=lg;async function ur(a){let{authData:b,clientDataHash:c,attStmt:d,credentialPublicKey:e,aaguid:f,rootCertificates:g}=a,h=d.get("x5c"),i=d.get("sig"),j=d.get("alg");if(!h)throw Error("No attestation certificate provided in attestation statement (Android Key)");if(!i)throw Error("No attestation signature provided in attestation statement (Android Key)");if(!j)throw Error("Attestation statement did not contain alg (Android Key)");if(!kY(j))throw Error(`Attestation statement contained invalid alg ${j} (Android Key)`);let k=nr.parse(h[0],oU),l=new Uint8Array(k.tbsCertificate.subjectPublicKeyInfo.subjectPublicKey),m=lk(e);if(!lg.areEqual(m,l))throw Error("Credential public key does not equal leaf cert public key (Android Key)");let n=k.tbsCertificate.extensions?.find(a=>"1.3.6.1.4.1.11129.2.1.17"===a.extnID);if(!n)throw Error("Certificate did not contain extKeyStore (Android Key)");let{attestationChallenge:o,teeEnforced:p,softwareEnforced:q}=nr.parse(n.extnValue,uj);if(!lg.areEqual(new Uint8Array(o.buffer),c))throw Error("Attestation challenge was not equal to client data hash (Android Key)");if(void 0!==p.allApplications||void 0!==q.allApplications)throw Error('teeEnforced contained "allApplications [600]" tag (Android Key)');let r=await t4.getStatement(f);if(r)try{await t5({statement:r,credentialPublicKey:e,x5c:h,attestationStatementAlg:j})}catch(a){throw Error(`${a.message} (Android Key)`,{cause:a})}else{let a=h.slice(0,-1).map(li),b=h.slice(-1).map(li);try{await ty(a,b)}catch(a){throw Error(`${a.message} (Android Key)`,{cause:a})}if(g.length>0&&0>g.indexOf(b[0]))throw Error("x5c root certificate was not a known root certificate (Android Key)")}return tE({signature:i,data:lg.concat([b,c]),x509Certificate:h[0],hashAlgorithm:j})}var lg=lg;async function us(a){let{attStmt:b,authData:c,clientDataHash:d,credentialPublicKey:e,rootCertificates:f}=a,g=b.get("x5c");if(!g)throw Error("No attestation certificate provided in attestation statement (Apple)");try{await ty(g.map(li),f)}catch(a){throw Error(`${a.message} (Apple)`)}let{extensions:h,subjectPublicKeyInfo:i}=nr.parse(g[0],oU).tbsCertificate;if(!h)throw Error("credCert missing extensions (Apple)");let j=h.find(a=>"1.2.840.113635.100.8.2"===a.extnID);if(!j)throw Error('credCert missing "1.2.840.113635.100.8.2" extension (Apple)');let k=lg.concat([c,d]),l=await tx(k),m=new Uint8Array(j.extnValue.buffer).slice(6);if(!lg.areEqual(l,m))throw Error("credCert nonce was not expected value (Apple)");let n=lk(e),o=new Uint8Array(i.subjectPublicKey);if(!lg.areEqual(n,o))throw Error("Credential public key does not equal credCert public key (Apple)");return!0}async function ut(a){let b,{response:c,expectedChallenge:d,expectedOrigin:e,expectedRPID:f,expectedType:g,requireUserPresence:h=!0,requireUserVerification:i=!0,supportedAlgorithmIDs:j=tM,attestationSafetyNetEnforceCTSCheck:k=!0}=a,{id:l,rawId:m,type:n,response:o}=c;if(!l)throw Error("Missing credential ID");if(l!==m)throw Error("Credential ID was not base64url-encoded");if("public-key"!==n)throw Error(`Unexpected credential type ${n}, expected "public-key"`);let p=lm(o.clientDataJSON),{type:q,origin:r,challenge:s,tokenBinding:t}=p;if(Array.isArray(g)){if(!g.includes(q)){let a=g.join(", ");throw Error(`Unexpected registration response type "${q}", expected one of: ${a}`)}}else if(g){if(q!==g)throw Error(`Unexpected registration response type "${q}", expected "${g}"`)}else if("webauthn.create"!==q)throw Error(`Unexpected registration response type: ${q}`);if("function"==typeof d){if(!await d(s))throw Error(`Custom challenge verifier returned false for registration response challenge "${s}"`)}else if(s!==d)throw Error(`Unexpected registration response challenge "${s}", expected "${d}"`);if(Array.isArray(e)){if(!e.includes(r))throw Error(`Unexpected registration response origin "${r}", expected one of: ${e.join(", ")}`)}else if(r!==e)throw Error(`Unexpected registration response origin "${r}", expected "${e}"`);if(t){if("object"!=typeof t)throw Error(`Unexpected value for TokenBinding "${t}"`);if(0>["present","supported","not-supported"].indexOf(t.status))throw Error(`Unexpected tokenBinding.status value of "${t.status}"`)}let u=k4.toBuffer(o.attestationObject),v=ll(lj.decodeFirst(u)),w=v.get("fmt"),x=v.get("authData"),y=v.get("attStmt"),{aaguid:z,rpIdHash:A,flags:B,credentialID:C,counter:D,credentialPublicKey:E,extensionsData:F}=tv(x);if(f){let a=[];a="string"==typeof f?[f]:f,b=await tS(A,a)}if(h&&!B.up)throw Error("User presence was required, but user was not present");if(i&&!B.uv)throw Error("User verification was required, but user could not be verified");if(!C)throw Error("No credential ID was provided by authenticator");if(!E)throw Error("No public key was provided by authenticator");if(!z)throw Error("No AAGUID was present during registration");let G=lo(E).get(R.alg);if("number"!=typeof G)throw Error("Credential public key was missing numeric alg");if(!j.includes(G)){let a=j.join(", ");throw Error(`Unexpected public key alg "${G}", expected one of "${a}"`)}let H={aaguid:z,attStmt:y,authData:x,clientDataHash:await tx(k4.toBuffer(o.clientDataJSON)),credentialID:C,credentialPublicKey:E,rootCertificates:t_.getRootCertificates({identifier:w}),rpIdHash:A,attestationSafetyNetEnforceCTSCheck:k},I=!1;if("fido-u2f"===w)I=await t0(H);else if("packed"===w)I=await t8(H);else if("android-safetynet"===w)I=await t9(H);else if("android-key"===w)I=await ur(H);else if("tpm"===w)I=await uf(H);else if("apple"===w)I=await us(H);else if("none"===w){if(y.size>0)throw Error("None attestation had unexpected attestation statement");I=!0}else throw Error(`Unsupported Attestation Format: ${w}`);if(!I)return{verified:!1};let{credentialDeviceType:J,credentialBackedUp:K}=tQ(B);return{verified:!0,registrationInfo:{fmt:w,aaguid:lh(z),credentialType:n,credential:{id:k4.fromBuffer(C),publicKey:E,counter:D,transports:c.response.transports},attestationObject:u,userVerified:B.uv,credentialDeviceType:J,credentialBackedUp:K,origin:p.origin,rpID:b,authenticatorExtensionResults:F}}}var k4=k4,lg=lg;async function uu(a){let{allowCredentials:b,challenge:c=await tK(),timeout:d=6e4,userVerification:e="preferred",extensions:f,rpID:g}=a,h=c;return"string"==typeof h&&(h=lg.fromUTF8String(h)),{rpId:g,challenge:k4.fromBuffer(h),allowCredentials:b?.map(a=>{if(!k4.isBase64URL(a.id))throw Error(`allowCredential id "${a.id}" is not a valid base64url string`);return{...a,id:k4.trimPadding(a.id),type:"public-key"}}),timeout:d,userVerification:e,extensions:f}}var k4=k4,lg=lg;async function uv(a){let{response:b,expectedChallenge:c,expectedOrigin:d,expectedRPID:e,expectedType:f,credential:g,requireUserVerification:h=!0,advancedFIDOConfig:i}=a,{id:j,rawId:k,type:l,response:m}=b;if(!j)throw Error("Missing credential ID");if(j!==k)throw Error("Credential ID was not base64url-encoded");if("public-key"!==l)throw Error(`Unexpected credential type ${l}, expected "public-key"`);if(!b)throw Error("Credential missing response");if("string"!=typeof m?.clientDataJSON)throw Error("Credential response clientDataJSON was not a string");let n=lm(m.clientDataJSON),{type:o,origin:p,challenge:q,tokenBinding:r}=n;if(Array.isArray(f)){if(!f.includes(o)){let a=f.join(", ");throw Error(`Unexpected authentication response type "${o}", expected one of: ${a}`)}}else if(f){if(o!==f)throw Error(`Unexpected authentication response type "${o}", expected "${f}"`)}else if("webauthn.get"!==o)throw Error(`Unexpected authentication response type: ${o}`);if("function"==typeof c){if(!await c(q))throw Error(`Custom challenge verifier returned false for registration response challenge "${q}"`)}else if(q!==c)throw Error(`Unexpected authentication response challenge "${q}", expected "${c}"`);if(Array.isArray(d)){if(!d.includes(p)){let a=d.join(", ");throw Error(`Unexpected authentication response origin "${p}", expected one of: ${a}`)}}else if(p!==d)throw Error(`Unexpected authentication response origin "${p}", expected "${d}"`);if(!k4.isBase64URL(m.authenticatorData))throw Error("Credential response authenticatorData was not a base64url string");if(!k4.isBase64URL(m.signature))throw Error("Credential response signature was not a base64url string");if(m.userHandle&&"string"!=typeof m.userHandle)throw Error("Credential response userHandle was not a string");if(r){if("object"!=typeof r)throw Error("ClientDataJSON tokenBinding was not an object");if(0>["present","supported","notSupported"].indexOf(r.status))throw Error(`Unexpected tokenBinding status ${r.status}`)}let s=k4.toBuffer(m.authenticatorData),{rpIdHash:t,flags:u,counter:v,extensionsData:w}=tv(s),x=[];x="string"==typeof e?[e]:e;let y=await tS(t,x);if(void 0!==i){let{userVerification:a}=i;if("required"===a&&!u.uv)throw Error("User verification required, but user could not be verified")}else{if(!u.up)throw Error("User not present during authentication");if(h&&!u.uv)throw Error("User verification required, but user could not be verified")}let z=await tx(k4.toBuffer(m.clientDataJSON)),A=lg.concat([s,z]),B=k4.toBuffer(m.signature);if((v>0||g.counter>0)&&v<=g.counter)throw Error(`Response counter value ${v} was lower than expected ${g.counter}`);let{credentialDeviceType:C,credentialBackedUp:D}=tQ(u);return{verified:await tE({signature:B,data:A,credentialPublicKey:g.publicKey}),authenticationInfo:{newCounter:v,credentialID:g.id,userVerified:u.uv,credentialDeviceType:C,credentialBackedUp:D,authenticatorExtensionResults:w,origin:n.origin,rpID:y}}}let uw=(0,ku.defineErrorCodes)({CHALLENGE_NOT_FOUND:"Challenge not found",YOU_ARE_NOT_ALLOWED_TO_REGISTER_THIS_PASSKEY:"You are not allowed to register this passkey",FAILED_TO_VERIFY_REGISTRATION:"Failed to verify registration",PASSKEY_NOT_FOUND:"Passkey not found",AUTHENTICATION_FAILED:"Authentication failed",UNABLE_TO_CREATE_SESSION:"Unable to create session",FAILED_TO_UPDATE_PASSKEY:"Failed to update passkey"});function ux(a,b){return a.rpID||(b?new URL(b).hostname:"localhost")}let uy=eL.object({authenticatorAttachment:eL.enum(["platform","cross-platform"]).optional(),name:eL.string().optional()}).optional(),uz=eL.object({response:eL.any(),name:eL.string().meta({description:"Name of the passkey"}).optional()}),uA=eL.object({response:eL.record(eL.any(),eL.any())}),uB=hY("/passkey/list-user-passkeys",{method:"GET",use:[iB],metadata:{openapi:{description:"List all passkeys for the authenticated user",responses:{200:{description:"Passkeys retrieved successfully",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Passkey",required:["id","userId","publicKey","createdAt","updatedAt"]},description:"Array of passkey objects associated with the user"}}}}}}}},async a=>{let b=await a.context.adapter.findMany({model:"passkey",where:[{field:"userId",value:a.context.session.user.id}]});return a.json(b,{status:200})}),uC=hY("/passkey/delete-passkey",{method:"POST",body:eL.object({id:eL.string().meta({description:'The ID of the passkey to delete. Eg: "some-passkey-id"'})}),use:[iB],metadata:{openapi:{description:"Delete a specific passkey",responses:{200:{description:"Passkey deleted successfully",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates whether the deletion was successful"}},required:["status"]}}}}}}}},async a=>{let b=await a.context.adapter.findOne({model:"passkey",where:[{field:"id",value:a.body.id}]});if(!b)throw new gf("NOT_FOUND",{message:uw.PASSKEY_NOT_FOUND});if(b.userId!==a.context.session.user.id)throw new gf("UNAUTHORIZED");return await a.context.adapter.delete({model:"passkey",where:[{field:"id",value:b.id}]}),a.json({status:!0})}),uD=hY("/passkey/update-passkey",{method:"POST",body:eL.object({id:eL.string().meta({description:'The ID of the passkey which will be updated. Eg: "passkey-id"'}),name:eL.string().meta({description:'The new name which the passkey will be updated to. Eg: "my-new-passkey-name"'})}),use:[iB],metadata:{openapi:{description:"Update a specific passkey's name",responses:{200:{description:"Passkey updated successfully",content:{"application/json":{schema:{type:"object",properties:{passkey:{$ref:"#/components/schemas/Passkey"}},required:["passkey"]}}}}}}}},async a=>{let b=await a.context.adapter.findOne({model:"passkey",where:[{field:"id",value:a.body.id}]});if(!b)throw new gf("NOT_FOUND",{message:uw.PASSKEY_NOT_FOUND});if(b.userId!==a.context.session.user.id)throw new gf("UNAUTHORIZED",{message:uw.YOU_ARE_NOT_ALLOWED_TO_REGISTER_THIS_PASSKEY});let c=await a.context.adapter.update({model:"passkey",where:[{field:"id",value:a.body.id}],update:{name:a.body.name}});if(!c)throw new gf("INTERNAL_SERVER_ERROR",{message:uw.FAILED_TO_UPDATE_PASSKEY});return a.json({passkey:c},{status:200})}),uE=async a=>{let b=await d6("SHA-256").digest(new TextEncoder().encode(a));return d5.encode(new Uint8Array(b),{padding:!1})},uF=eL.object({email:eL.email().meta({description:"Email address to send the magic link"}),name:eL.string().meta({description:'User display name. Only used if the user is registering for the first time. Eg: "my-name"'}).optional(),callbackURL:eL.string().meta({description:"URL to redirect after magic link verification"}).optional(),newUserCallbackURL:eL.string().meta({description:"URL to redirect after new user signup. Only used if the user is registering for the first time."}).optional(),errorCallbackURL:eL.string().meta({description:"URL to redirect after error."}).optional()}),uG=eL.object({token:eL.string().meta({description:"Verification token"}),callbackURL:eL.string().meta({description:'URL to redirect after magic link verification, if not provided the user will be redirected to the root URL. Eg: "/dashboard"'}).optional(),errorCallbackURL:eL.string().meta({description:"URL to redirect after error."}).optional(),newUserCallbackURL:eL.string().meta({description:"URL to redirect after new user signup. Only used if the user is registering for the first time."}).optional()}),uH=async({to:a,subject:b,html:c,text:d,from:e})=>(console.log(`[Mock Email] To: ${a}, Subject: ${b}`),{MessageId:"mock-id-edge"}),uI=process.env.BETTER_AUTH_BASE_URL||"http://localhost:3000",uJ=new URL(uI).hostname;process.env.BETTER_AUTH_SECRET;let uK=((a,b)=>{let c=b(a),{api:d}=j2(c,a);return{handler:async b=>{let d=await c,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=hM(void 0,e,b,void 0,d.options.advanced?.trustedProxyHeaders);if(a)d.baseURL=a,d.options.baseURL=hN(d.baseURL)||void 0;else throw new dT.BetterAuthError("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=await j5(d.options,b);let{handler:f}=((a,b)=>{let{api:c,middlewares:d}=j2(a,b),e=new URL(a.baseURL).pathname;return((a,b)=>{if(!b?.openapi?.disabled){let c={path:"/api/reference",...b?.openapi};a.openapi=gx(c.path,{method:"GET"},async b=>{let d,e;return new Response((d=await gD(a),e=c.scalar,`<!doctype html>
<html>
  <head>
    <title>Scalar API Reference</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
  </head>
  <body>
    <script
      id="api-reference"
      type="application/json">
    ${JSON.stringify(d)}
    </script>
	 <script>
      var configuration = {
	  	favicon: ${e?.logo?`data:image/svg+xml;utf8,${encodeURIComponent(e.logo)}`:void 0} ,
	   	theme: ${e?.theme||"saturn"},
        metaData: {
			title: ${e?.title||"Open API Reference"},
			description: ${e?.description||"Better Call Open API"},
		}
      }
      document.getElementById('api-reference').dataset.configuration =
        JSON.stringify(configuration)
    </script>
	  <script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script>
  </body>
</html>`),{headers:{"Content-Type":"text/html"}})})}let c=gF(),d=gF();for(let b of Object.values(a))if(!(!b.options||!b.path||b.options?.metadata?.SERVER_ONLY))for(let a of Array.isArray(b.options?.method)?b.options.method:[b.options?.method])gI(c,a,b.path,b);if(b?.routerMiddleware?.length)for(let{path:a,middleware:c}of b.routerMiddleware)gI(d,"*",a,c);let e=async a=>{let e=new URL(a.url),f=e.pathname,g=b?.basePath&&"/"!==b.basePath?f.split(b.basePath).reduce((a,c,d)=>(0!==d&&(d>1?a.push(`${b.basePath}${c}`):a.push(c)),a),[]).join(""):e.pathname;if(!g?.length||/\/{2,}/.test(g))return new Response(null,{status:404,statusText:"Not Found"});let h=function(a,b="",c,d){47===c.charCodeAt(c.length-1)&&(c=c.slice(0,-1));let e=a.static[c];if(e&&e.methods){let a=e.methods[b]||e.methods[""];if(void 0!==a)return a[0]}let f=gG(c),g=function a(b,c,d,e,f){if(f===e.length){if(c.methods){let a=c.methods[d]||c.methods[""];if(a)return a}if(c.param&&c.param.methods){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];if(a){let b=a[0].paramsMap;if(b?.[b?.length-1]?.[2])return a}}return}let g=e[f];if(c.static){let h=c.static[g];if(h){let c=a(b,h,d,e,f+1);if(c)return c}}if(c.param){let h=a(b,c.param,d,e,f+1);if(h){if(c.param.hasRegexParam){let a=h.find(a=>a.paramsRegexp[f]?.test(g))||h.find(a=>!a.paramsRegexp[f]);return a?[a]:void 0}return h}}if(c.wildcard&&c.wildcard.methods)return c.wildcard.methods[d]||c.wildcard.methods[""]}(a,a.root,b,f,0)?.[0];if(void 0!==g)return{data:g.data,params:g.paramsMap?gH(f,g.paramsMap):void 0}}(c,a.method,g);if(g.endsWith("/")!==h?.data?.path?.endsWith("/")&&!b?.skipTrailingSlashes||!h?.data)return new Response(null,{status:404,statusText:"Not Found"});let i={};e.searchParams.forEach((a,b)=>{b in i?Array.isArray(i[b])?i[b].push(a):i[b]=[i[b],a]:i[b]=a});let j=h.data;try{let c=j.options.metadata?.allowedMediaTypes||b?.allowedMediaTypes,e={path:g,method:a.method,headers:a.headers,params:h.params?JSON.parse(JSON.stringify(h.params)):{},request:a,body:j.options.disableBody?void 0:await gh(j.options.cloneRequest?a.clone():a,c),query:i,_flag:"router",asResponse:!0,context:b?.routerContext},f=function(a,b="",c,d){47===c.charCodeAt(c.length-1)&&(c=c.slice(0,-1));let e=gG(c);return(function a(b,c,d,e,f,g=[]){let h=e[f];if(c.wildcard&&c.wildcard.methods){let a=c.wildcard.methods[d]||c.wildcard.methods[""];a&&g.push(...a)}if(c.param&&(a(b,c.param,d,e,f+1,g),f===e.length&&c.param.methods)){let a=c.param.methods[d]||c.param.methods[""];if(a){let b=a[0].paramsMap;b?.[b?.length-1]?.[2]&&g.push(...a)}}let i=c.static?.[h];if(i&&a(b,i,d,e,f+1,g),f===e.length&&c.methods){let a=c.methods[d]||c.methods[""];a&&g.push(...a)}return g})(a,a.root,b,e,0).map(a=>({data:a.data,params:a.paramsMap?gH(e,a.paramsMap):void 0}))}(d,"*",g);if(f?.length)for(let{data:a,params:b}of f){let c=await a({...e,params:b,asResponse:!1});if(c instanceof Response)return c}return await j(e)}catch(a){if(b?.onError)try{let c=await b.onError(a);if(c instanceof Response)return gl(c)}catch(a){if(gi(a))return gl(a);throw a}if(b?.throwError)throw a;if(gi(a))return gl(a);return console.error("# SERVER_ERROR: ",a),new Response(null,{status:500,statusText:"Internal Server Error"})}};return{handler:async a=>{let c=await b?.onRequest?.(a);if(c instanceof Response)return c;let d=await e(gk(c)?c:a),f=await b?.onResponse?.(d);return f instanceof Response?f:d},endpoints:a}})(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:h_},...d],allowedMediaTypes:["application/json"],skipTrailingSlashes:b.advanced?.skipTrailingSlashes??!1,async onRequest(b){let c=a.options.disabledPaths||[],d=(0,hU.normalizePathname)(b.url,e);if(c.includes(d))return new Response("Not Found",{status:404});let f=b;for(let b of a.options.plugins||[])if(b.onRequest){let c=await b.onRequest(f,a);if(c&&"response"in c)return c.response;c&&"request"in c&&(f=c.request)}return await h5(f,a)||f},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof gf&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?ib.logger:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof gf?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(d,a);return hA(d.adapter,()=>f(b))},api:d,options:a,$context:c,$ERROR_CODES:{...a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{}),...hS.BASE_ERROR_CODES}}})({baseURL:process.env.BETTER_AUTH_BASE_URL||"http://localhost:3000",secret:process.env.BETTER_AUTH_SECRET||"fallback_secret_for_build",database:(0,kt.memoryAdapter)({user:[],session:[],account:[],verification:[],passkey:[]}),emailAndPassword:{enabled:!1},socialProviders:{google:{clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}},session:{expiresIn:2592e3,updateAge:86400},plugins:[{id:"next-cookies",hooks:{after:[{matcher:a=>!0,handler:hW(async b=>{let c=b.context.responseHeaders;if((!("_flag"in b)||"router"!==b._flag)&&c instanceof Headers){let b,d,e=c?.get("set-cookie");if(!e)return;let f=(d=new Map,(function(a){if(!a)return[];let b=[],c="",d=0;for(;d<a.length;){let e=a[d];if(","===e){let f=c.toLowerCase();if(f.includes("expires=")&&!f.includes("gmt"))c+=e,d++;else{let e=c.trim();e&&b.push(e),c="",++d<a.length&&" "===a[d]&&d++}continue}c+=e,d++}let e=c.trim();return e&&b.push(e),b})(e).forEach(a=>{let[b,...c]=a.split(";").map(a=>a.trim()),[e,...f]=(b||"").split("="),g=f.join("=");if(!e||void 0===g)return;let h={value:g};c.forEach(a=>{let[b,...c]=a.split("="),d=c.join("="),e=b.trim().toLowerCase();switch(e){case"max-age":h["max-age"]=d?parseInt(d.trim(),10):void 0;break;case"expires":h.expires=d?new Date(d.trim()):void 0;break;case"domain":h.domain=d?d.trim():void 0;break;case"path":h.path=d?d.trim():void 0;break;case"secure":h.secure=!0;break;case"httponly":h.httponly=!0;break;case"samesite":h.samesite=d?d.trim().toLowerCase():void 0;break;default:h[e]=!d||d.trim()}}),d.set(e,h)}),d),{cookies:g}=await a.A(23804);try{b=await g()}catch(a){if(a instanceof Error&&a.message.startsWith("`cookies` was called outside a request scope."))return;throw a}f.forEach((a,c)=>{if(!c)return;let d={sameSite:a.samesite,secure:a.secure,maxAge:a["max-age"],httpOnly:a.httponly,domain:a.domain,path:a.path};try{b.set(c,decodeURIComponent(a.value),d)}catch{}});return}})}]}},(a=>{let b={storeToken:"plain",...a};async function c(a,c){return"hashed"===b.storeToken?await uE(c):"object"==typeof b.storeToken&&"type"in b.storeToken&&"custom-hasher"===b.storeToken.type?await b.storeToken.hash(c):c}return{id:"magic-link",endpoints:{signInMagicLink:hY("/sign-in/magic-link",{method:"POST",requireHeaders:!0,body:uF,metadata:{openapi:{operationId:"signInWithMagicLink",description:"Sign in with magic link",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async d=>{let{email:e}=d.body,f=b?.generateToken?await b.generateToken(e):bt(32,"a-z","A-Z"),g=await c(d,f);await d.context.internalAdapter.createVerificationValue({identifier:g,value:JSON.stringify({email:e,name:d.body.name}),expiresAt:new Date(Date.now()+1e3*(b.expiresIn||300))});let h=new URL(d.context.baseURL),i="/"===h.pathname?"":h.pathname,j=i?"":d.context.options.basePath||"",k=new URL(`${i}${j}/magic-link/verify`,h.origin);return k.searchParams.set("token",f),k.searchParams.set("callbackURL",d.body.callbackURL||"/"),d.body.newUserCallbackURL&&k.searchParams.set("newUserCallbackURL",d.body.newUserCallbackURL),d.body.errorCallbackURL&&k.searchParams.set("errorCallbackURL",d.body.errorCallbackURL),await a.sendMagicLink({email:e,url:k.toString(),token:f},d),d.json({status:!0})}),magicLinkVerify:hY("/magic-link/verify",{method:"GET",query:uG,use:[h0(a=>a.query.callbackURL?decodeURIComponent(a.query.callbackURL):"/"),h0(a=>a.query.newUserCallbackURL?decodeURIComponent(a.query.newUserCallbackURL):"/"),h0(a=>a.query.errorCallbackURL?decodeURIComponent(a.query.errorCallbackURL):"/")],requireHeaders:!0,metadata:{openapi:{operationId:"verifyMagicLink",description:"Verify magic link",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}}}},async a=>{let d=a.query.token,e=new URL(a.query.callbackURL?decodeURIComponent(a.query.callbackURL):"/",a.context.baseURL).toString(),f=new URL(a.query.errorCallbackURL?decodeURIComponent(a.query.errorCallbackURL):e,a.context.baseURL);function g(b){throw f.searchParams.set("error",b),a.redirect(f.toString())}let h=new URL(a.query.newUserCallbackURL?decodeURIComponent(a.query.newUserCallbackURL):e,a.context.baseURL).toString(),i=await c(a,d),j=await a.context.internalAdapter.findVerificationValue(i);j||g("INVALID_TOKEN"),j.expiresAt<new Date&&(await a.context.internalAdapter.deleteVerificationValue(j.id),g("EXPIRED_TOKEN")),await a.context.internalAdapter.deleteVerificationValue(j.id);let{email:k,name:l}=JSON.parse(j.value),m=!1,n=await a.context.internalAdapter.findUserByEmail(k).then(a=>a?.user);!n&&(b.disableSignUp?g("new_user_signup_disabled"):(m=!0,(n=await a.context.internalAdapter.createUser({email:k,emailVerified:!0,name:l||""}))||g("failed_to_create_user"))),n.emailVerified||(n=await a.context.internalAdapter.updateUser(n.id,{emailVerified:!0}));let o=await a.context.internalAdapter.createSession(n.id);if(o||g("failed_to_create_session"),await hc(a,{session:o,user:n}),!a.query.callbackURL)return a.json({token:o.token,user:gM(a.context.options,n)});if(m)throw a.redirect(h);throw a.redirect(e)})},rateLimit:[{pathMatcher:a=>a.startsWith("/sign-in/magic-link")||a.startsWith("/magic-link/verify"),window:b.rateLimit?.window||60,max:b.rateLimit?.max||5}],options:a}})({sendMagicLink:async({email:a,url:b})=>{console.log(`
`),console.log(` MAGIC LINK for ${a}:`),console.log(b),console.log(`
`);try{await uH({to:a,subject:"Sign in to Texas Prestige Masonry",html:`<p>Click the link below to sign in:</p><a href="${b}">${b}</a><p>If you didn't request this, you can ignore this email.</p>`,text:`Click the link below to sign in:

${b}

If you didn't request this, you can ignore this email.`})}catch(a){console.error("Failed to send magic link email:",a)}}}),{id:"passkey",endpoints:{generatePasskeyRegistrationOptions:((a,{maxAgeInSeconds:b})=>hY("/passkey/generate-register-options",{method:"GET",use:[iD],query:uy,metadata:{openapi:{operationId:"generatePasskeyRegistrationOptions",description:"Generate registration options for a new passkey",responses:{200:{description:"Success",parameters:{query:{authenticatorAttachment:{description:`Type of authenticator to use for registration.
                          "platform" for device-specific authenticators,
                          "cross-platform" for authenticators that can be used across devices.`,required:!1},name:{description:`Optional custom name for the passkey.
                          This can help identify the passkey when managing multiple credentials.`,required:!1}}},content:{"application/json":{schema:{type:"object",properties:{challenge:{type:"string"},rp:{type:"object",properties:{name:{type:"string"},id:{type:"string"}}},user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},displayName:{type:"string"}}},pubKeyCredParams:{type:"array",items:{type:"object",properties:{type:{type:"string"},alg:{type:"number"}}}},timeout:{type:"number"},excludeCredentials:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},transports:{type:"array",items:{type:"string"}}}}},authenticatorSelection:{type:"object",properties:{authenticatorAttachment:{type:"string"},requireResidentKey:{type:"boolean"},userVerification:{type:"string"}}},attestation:{type:"string"},extensions:{type:"object"}}}}}}}}}},async c=>{let{session:d}=c.context,e=await c.context.adapter.findMany({model:"passkey",where:[{field:"userId",value:d.user.id}]}),f=new TextEncoder().encode(bt(32,"a-z","0-9")),g=await tP({rpName:a.rpName||c.context.appName,rpID:ux(a,c.context.options.baseURL),userID:f,userName:c.query?.name||d.user.email||d.user.id,userDisplayName:d.user.email||d.user.id,attestationType:"none",excludeCredentials:e.map(a=>({id:a.credentialID,transports:a.transports?.split(",")})),authenticatorSelection:{residentKey:"preferred",userVerification:"preferred",...a.authenticatorSelection||{},...c.query?.authenticatorAttachment?{authenticatorAttachment:c.query.authenticatorAttachment}:{}}}),h=bt(32),i=c.context.createAuthCookie(a.advanced.webAuthnChallengeCookie);await c.setSignedCookie(i.name,h,c.context.secret,{...i.attributes,maxAge:b});let j=new Date(Date.now()+1e3*b);return await c.context.internalAdapter.createVerificationValue({identifier:h,value:JSON.stringify({expectedChallenge:g.challenge,userData:{id:d.user.id}}),expiresAt:j}),c.json(g,{status:200})}))(l={origin:null,...P={rpName:"Texas Prestige Masonry",rpID:uJ,origin:uI},advanced:{webAuthnChallengeCookie:"better-auth-passkey",...P?.advanced}},{maxAgeInSeconds:300}),generatePasskeyAuthenticationOptions:((a,{maxAgeInSeconds:b})=>hY("/passkey/generate-authenticate-options",{method:"GET",metadata:{openapi:{operationId:"passkeyGenerateAuthenticateOptions",description:"Generate authentication options for a passkey",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{challenge:{type:"string"},rp:{type:"object",properties:{name:{type:"string"},id:{type:"string"}}},user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},displayName:{type:"string"}}},timeout:{type:"number"},allowCredentials:{type:"array",items:{type:"object",properties:{id:{type:"string"},type:{type:"string"},transports:{type:"array",items:{type:"string"}}}}},userVerification:{type:"string"},authenticatorSelection:{type:"object",properties:{authenticatorAttachment:{type:"string"},requireResidentKey:{type:"boolean"},userVerification:{type:"string"}}},extensions:{type:"object"}}}}}}}}}},async c=>{let d=await iA(c),e=[];d&&(e=await c.context.adapter.findMany({model:"passkey",where:[{field:"userId",value:d.user.id}]}));let f=await uu({rpID:ux(a,c.context.options.baseURL),userVerification:"preferred",...e.length?{allowCredentials:e.map(a=>({id:a.credentialID,transports:a.transports?.split(",")}))}:{}}),g={expectedChallenge:f.challenge,userData:{id:d?.user.id||""}},h=bt(32),i=c.context.createAuthCookie(a.advanced.webAuthnChallengeCookie);await c.setSignedCookie(i.name,h,c.context.secret,{...i.attributes,maxAge:b});let j=new Date(Date.now()+1e3*b);return await c.context.internalAdapter.createVerificationValue({identifier:h,value:JSON.stringify(g),expiresAt:j}),c.json(f,{status:200})}))(l,{maxAgeInSeconds:300}),verifyPasskeyRegistration:hY("/passkey/verify-registration",{method:"POST",body:uz,use:[iD],metadata:{openapi:{operationId:"passkeyVerifyRegistration",description:"Verify registration of a new passkey",responses:{200:{description:"Success",content:{"application/json":{schema:{$ref:"#/components/schemas/Passkey"}}}},400:{description:"Bad request"}}}}},async a=>{let b=l?.origin||a.headers?.get("origin")||"";if(!b)return a.json(null,{status:400});let c=a.body.response,d=a.context.createAuthCookie(l.advanced.webAuthnChallengeCookie),e=await a.getSignedCookie(d.name,a.context.secret);if(!e)throw new gf("BAD_REQUEST",{message:uw.CHALLENGE_NOT_FOUND});let f=await a.context.internalAdapter.findVerificationValue(e);if(!f)return a.json(null,{status:400});let{expectedChallenge:g,userData:h}=JSON.parse(f.value);if(h.id!==a.context.session.user.id)throw new gf("UNAUTHORIZED",{message:uw.YOU_ARE_NOT_ALLOWED_TO_REGISTER_THIS_PASSKEY});try{let{verified:d,registrationInfo:f}=await ut({response:c,expectedChallenge:g,expectedOrigin:b,expectedRPID:ux(l,a.context.options.baseURL),requireUserVerification:!1});if(!d||!f)return a.json(null,{status:400});let{aaguid:i,credentialDeviceType:j,credentialBackedUp:k,credential:m}=f,n=d4.encode(m.publicKey),o={name:a.body.name,userId:h.id,credentialID:m.id,publicKey:n,counter:m.counter,deviceType:j,transports:c.response.transports.join(","),backedUp:k,createdAt:new Date,aaguid:i},p=await a.context.adapter.create({model:"passkey",data:o});return await a.context.internalAdapter.deleteVerificationByIdentifier(e),a.json(p,{status:200})}catch(b){throw a.context.logger.error("Failed to verify registration",b),new gf("INTERNAL_SERVER_ERROR",{message:uw.FAILED_TO_VERIFY_REGISTRATION})}}),verifyPasskeyAuthentication:hY("/passkey/verify-authentication",{method:"POST",body:uA,metadata:{openapi:{operationId:"passkeyVerifyAuthentication",description:"Verify authentication of a passkey",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}}}}}}}},$Infer:{body:{}}}},async a=>{let b=l?.origin||a.headers?.get("origin")||"";if(!b)throw new gf("BAD_REQUEST",{message:"origin missing"});let c=a.body.response,d=a.context.createAuthCookie(l.advanced.webAuthnChallengeCookie),e=await a.getSignedCookie(d.name,a.context.secret);if(!e)throw new gf("BAD_REQUEST",{message:uw.CHALLENGE_NOT_FOUND});let f=await a.context.internalAdapter.findVerificationValue(e);if(!f)throw new gf("BAD_REQUEST",{message:uw.CHALLENGE_NOT_FOUND});let{expectedChallenge:g}=JSON.parse(f.value),h=await a.context.adapter.findOne({model:"passkey",where:[{field:"credentialID",value:c.id}]});if(!h)throw new gf("UNAUTHORIZED",{message:uw.PASSKEY_NOT_FOUND});try{let d=await uv({response:c,expectedChallenge:g,expectedOrigin:b,expectedRPID:ux(l,a.context.options.baseURL),credential:{id:h.credentialID,publicKey:d4.decode(h.publicKey),counter:h.counter,transports:h.transports?.split(",")},requireUserVerification:!1}),{verified:f}=d;if(!f)throw new gf("UNAUTHORIZED",{message:uw.AUTHENTICATION_FAILED});await a.context.adapter.update({model:"passkey",where:[{field:"id",value:h.id}],update:{counter:d.authenticationInfo.newCounter}});let i=await a.context.internalAdapter.createSession(h.userId);if(!i)throw new gf("INTERNAL_SERVER_ERROR",{message:uw.UNABLE_TO_CREATE_SESSION});let j=await a.context.internalAdapter.findUserById(h.userId);if(!j)throw new gf("INTERNAL_SERVER_ERROR",{message:"User not found"});return await hc(a,{session:i,user:j}),await a.context.internalAdapter.deleteVerificationByIdentifier(e),a.json({session:i},{status:200})}catch(b){throw a.context.logger.error("Failed to verify authentication",b),new gf("BAD_REQUEST",{message:uw.AUTHENTICATION_FAILED})}}),listPasskeys:uB,deletePasskey:uC,updatePasskey:uD},schema:gU({passkey:{fields:{name:{type:"string",required:!1},publicKey:{type:"string",required:!0},userId:{type:"string",references:{model:"user",field:"id"},required:!0,index:!0},credentialID:{type:"string",required:!0,index:!0},counter:{type:"number",required:!0},deviceType:{type:"string",required:!0},backedUp:{type:"boolean",required:!0},transports:{type:"string",required:!1},createdAt:{type:"date",required:!1},aaguid:{type:"string",required:!1}}}},P?.schema),$ERROR_CODES:uw,options:P}]},ks),uL=Promise.resolve();async function uM(a){try{return await uL,await uK.api.getSession({headers:a})}catch(a){return console.error("[auth] getSession failed:",a),null}}a.s(["getSessionSafe",()=>uM],35525)}];

//# sourceMappingURL=_3e856ecd._.js.map