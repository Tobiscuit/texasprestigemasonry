module.exports=[69580,e=>{"use strict";var t=e.i(96763),r=e.i(13031);e.i(76757);var l=e.i(5284);let a=(e,t)=>{let a=null,i=e=>({getFieldName:l,schema:a,getDefaultFieldName:i,getDefaultModelName:n,getFieldAttributes:s,getModelName:o})=>{let u=e=>{let t=[],l=[];if(e)for(let[i,s]of Object.entries(e)){let e=a[n(i)]?.fields,[s,o]=i.includes(".")?i.split("."):[void 0,i];if(e)for(let[a,n]of(e.id={type:"string"},Object.entries(e)))t.push(r.sql`${r.sql.ref(`join_${o}`)}.${r.sql.ref(n.fieldName||a)} as ${r.sql.ref(`_joined_${o}_${n.fieldName||a}`)}`),l.push({joinModel:i,joinModelRef:o,fieldName:n.fieldName||a})}return{allSelectsStr:l,allSelects:t}},d=async(r,a,i,n)=>{if(t?.type==="mysql"){await a.execute();let t=r.id?"id":n.length>0&&n[0]?.field?n[0].field:"id";if(!r.id&&0===n.length)return await e.selectFrom(i).selectAll().orderBy(l({model:i,field:t}),"desc").limit(1).executeTakeFirst();let s=r[t]||n[0]?.value;return await e.selectFrom(i).selectAll().orderBy(l({model:i,field:t}),"desc").where(l({model:i,field:t}),"=",s).limit(1).executeTakeFirst()}return t?.type==="mssql"?await a.outputAll("inserted").executeTakeFirst():await a.returningAll().executeTakeFirst()};function c(e,t){if(!t)return{and:null,or:null};let r=[],a=[];return t.forEach(t=>{let{field:i,value:n,operator:s="=",connector:o="AND"}=t,u=l({model:e,field:i}),d=t=>{let r=`${e}.${u}`;return"in"===s.toLowerCase()?t(r,"in",Array.isArray(n)?n:[n]):"not_in"===s.toLowerCase()?t(r,"not in",Array.isArray(n)?n:[n]):"contains"===s?t(r,"like",`%${n}%`):"starts_with"===s?t(r,"like",`${n}%`):"ends_with"===s?t(r,"like",`%${n}`):t(r,"eq"===s?"=":"ne"===s?"<>":"gt"===s?">":"gte"===s?">=":"lt"===s?"<":"lte"===s?"<=":s,n)};"OR"===o?a.push(d):r.push(d)}),{and:r.length?r:null,or:a.length?a:null}}function f(e,t,r){if(!t||!e.length)return e;let a=new Map;for(let i of e){let e={},n={};for(let[e]of Object.entries(t))n[o(e)]={};for(let[t,a]of Object.entries(i)){let i=String(t),s=!1;for(let{joinModel:e,fieldName:t,joinModelRef:u}of r)if(i===`_joined_${u}_${t}`){n[o(e)][l({model:e,field:t})]=a,s=!0;break}s||(e[t]=a)}let s=e.id;if(!s)continue;if(!a.has(s)){let r={...e};for(let[e,l]of Object.entries(t))r[o(e)]="one-to-one"===l.relation?null:[];a.set(s,r)}let u=a.get(s);for(let[e,r]of Object.entries(t)){let t="one-to-one"===r.relation,a=r.limit??100,i=n[o(e)],s=i&&Object.keys(i).length>0&&Object.values(i).some(e=>null!=e);if(t)u[o(e)]=s?i:null;else{let t=o(e);if(Array.isArray(u[t])&&s){if(u[t].length>=a)continue;let r=l({model:e,field:"id"}),n=i[r];n?!u[t].some(e=>e[r]===n)&&u[t].length<a&&u[t].push(i):u[t].length<a&&u[t].push(i)}}}}let i=Array.from(a.values());for(let e of i)for(let[r,l]of Object.entries(t))if("one-to-one"!==l.relation){let t=o(r);if(Array.isArray(e[t])){let r=l.limit??100;e[t].length>r&&(e[t]=e[t].slice(0,r))}}return i}return{create:async({data:t,model:r})=>await d(t,e.insertInto(r).values(t),r,[]),async findOne({model:t,where:r,select:a,join:i}){let{and:n,or:s}=c(t,r),o=e.selectFrom(e=>{let r=e.selectFrom(t);return n&&(r=r.where(e=>e.and(n.map(t=>t(e))))),s&&(r=r.where(e=>e.or(s.map(t=>t(e))))),(r=a?.length&&a.length>0?r.select(a.map(e=>l({model:t,field:e}))):r.selectAll()).as("primary")}).selectAll("primary");if(i)for(let[e,t]of Object.entries(i)){let[r,l]=e.includes(".")?e.split("."):[void 0,e];o=o.leftJoin(`${e} as join_${l}`,e=>e.onRef(`join_${l}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:d,allSelects:p}=u(i);o=o.select(p);let y=await o.execute();if(!y||!Array.isArray(y)||0===y.length)return null;let m=y[0];return i?f(y,i,d)[0]:m},async findMany({model:r,where:a,limit:i,select:n,offset:s,sortBy:o,join:d}){let{and:p,or:y}=c(r,a),m=e.selectFrom(e=>{let a=e.selectFrom(r);return t?.type==="mssql"?void 0!==s?(o||(a=a.orderBy(l({model:r,field:"id"}))),a=a.offset(s).fetch(i||100)):void 0!==i&&(a=a.top(i)):(void 0!==i&&(a=a.limit(i)),void 0!==s&&(a=a.offset(s))),o?.field&&(a=a.orderBy(`${l({model:r,field:o.field})}`,o.direction)),p&&(a=a.where(e=>e.and(p.map(t=>t(e))))),y&&(a=a.where(e=>e.or(y.map(t=>t(e))))),(a=n?.length&&n.length>0?a.select(n.map(e=>l({model:r,field:e}))):a.selectAll()).as("primary")}).selectAll("primary");if(d)for(let[e,t]of Object.entries(d)){let[r,l]=e.includes(".")?e.split("."):[void 0,e];m=m.leftJoin(`${e} as join_${l}`,e=>e.onRef(`join_${l}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:h,allSelects:w}=u(d);m=m.select(w),o?.field&&(m=m.orderBy(`${l({model:r,field:o.field})}`,o.direction));let A=await m.execute();return A?d?f(A,d,h):A:[]},async update({model:t,where:r,update:l}){let{and:a,or:i}=c(t,r),n=e.updateTable(t).set(l);return a&&(n=n.where(e=>e.and(a.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e))))),await d(l,n,t,r)},async updateMany({model:t,where:r,update:l}){let{and:a,or:i}=c(t,r),n=e.updateTable(t).set(l);a&&(n=n.where(e=>e.and(a.map(t=>t(e))))),i&&(n=n.where(e=>e.or(i.map(t=>t(e)))));let s=(await n.executeTakeFirst()).numUpdatedRows;return s>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number(s)},async count({model:t,where:r}){let{and:l,or:a}=c(t,r),i=e.selectFrom(t).select(e.fn.count("id").as("count"));l&&(i=i.where(e=>e.and(l.map(t=>t(e))))),a&&(i=i.where(e=>e.or(a.map(t=>t(e)))));let n=await i.execute();return"number"==typeof n[0].count?n[0].count:"bigint"==typeof n[0].count?Number(n[0].count):parseInt(n[0].count)},async delete({model:t,where:r}){let{and:l,or:a}=c(t,r),i=e.deleteFrom(t);l&&(i=i.where(e=>e.and(l.map(t=>t(e))))),a&&(i=i.where(e=>e.or(a.map(t=>t(e))))),await i.execute()},async deleteMany({model:t,where:r}){let{and:l,or:a}=c(t,r),i=e.deleteFrom(t);l&&(i=i.where(e=>e.and(l.map(t=>t(e))))),a&&(i=i.where(e=>e.or(a.map(t=>t(e)))));let n=(await i.executeTakeFirst()).numDeletedRows;return n>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number(n)},options:t}},n=null;n={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:t?.type!=="sqlite"&&t?.type!=="mssql"&&t?.type!=="mysql"&&!!t?.type,supportsDates:t?.type!=="sqlite"&&t?.type!=="mssql"&&!!t?.type,supportsJSON:t?.type==="postgres",supportsArrays:!1,supportsUUIDs:t?.type==="postgres",transaction:!!t?.transaction&&(t=>e.transaction().execute(e=>t((0,l.createAdapterFactory)({config:n.config,adapter:i(e)})(a))))},adapter:i(e)};let s=(0,l.createAdapterFactory)(n);return e=>(a=e,s(e))};e.s([],85635),e.i(85635),e.s(["createKyselyAdapter",()=>t.createKyselyAdapter,"getKyselyDatabaseType",()=>t.getKyselyDatabaseType,"kyselyAdapter",()=>a],69580)}];

//# sourceMappingURL=node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_e4618ae6._.js.map